/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={4:()=>{},924:(t,e,i)=>{"use strict";var n=i(210),s=i(559),r=s(n("String.prototype.indexOf"));t.exports=function(t,e){var i=n(t,!!e);return"function"==typeof i&&r(t,".prototype.")>-1?s(i):i}},559:(t,e,i)=>{"use strict";var n=i(612),s=i(210),r=s("%Function.prototype.apply%"),o=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||n.call(o,r),l=s("%Object.getOwnPropertyDescriptor%",!0),h=s("%Object.defineProperty%",!0),d=s("%Math.max%");if(h)try{h({},"a",{value:1})}catch(t){h=null}t.exports=function(t){var e=a(n,o,arguments);l&&h&&(l(e,"length").configurable&&h(e,"length",{value:1+d(0,t.length-(arguments.length-1))}));return e};var c=function(){return a(n,r,arguments)};h?h(t.exports,"apply",{value:c}):t.exports.apply=c},187:t=>{"use strict";function e(t,e,n){n=n||2;var r,o,a,l,c,u,f,g=e&&e.length,m=g?e[0]*n:t.length,v=i(t,0,m,n,!0),_=[];if(!v||v.next===v.prev)return _;if(g&&(v=function(t,e,n,s){var r,o,a,l=[];for(r=0,o=e.length;r<o;r++)(a=i(t,e[r]*s,r<o-1?e[r+1]*s:t.length,s,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(h),r=0;r<l.length;r++)n=d(l[r],n);return n}(t,e,v,n)),t.length>80*n){r=a=t[0],o=l=t[1];for(var y=n;y<m;y+=n)(c=t[y])<r&&(r=c),(u=t[y+1])<o&&(o=u),c>a&&(a=c),u>l&&(l=u);f=0!==(f=Math.max(a-r,l-o))?32767/f:0}return s(v,_,n,r,o,f,0),_}function i(t,e,i,n,s){var r,o;if(s===w(t,e,i,n)>0)for(r=e;r<i;r+=n)o=T(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=T(r,t[r],t[r+1],o);return o&&v(o,o.next)&&(x(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!v(n,n.next)&&0!==m(n.prev,n,n.next))n=n.next;else{if(x(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function s(t,e,i,h,d,c,p){if(t){!p&&c&&function(t,e,i,n){var s=t;do{0===s.z&&(s.z=u(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,n,s,r,o,a,l,h=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,h*=2}while(o>1)}(s)}(t,h,d,c);for(var f,g,m=t;t.prev!==t.next;)if(f=t.prev,g=t.next,c?o(t,h,d,c):r(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(g.i/i|0),x(t),t=g.next,m=g.next;else if((t=g)===m){p?1===p?s(t=a(n(t),e,i),e,i,h,d,c,2):2===p&&l(t,e,i,h,d,c):s(n(t),e,i,h,d,c,1);break}}}function r(t){var e=t.prev,i=t,n=t.next;if(m(e,i,n)>=0)return!1;for(var s=e.x,r=i.x,o=n.x,a=e.y,l=i.y,h=n.y,d=s<r?s<o?s:o:r<o?r:o,c=a<l?a<h?a:h:l<h?l:h,u=s>r?s>o?s:o:r>o?r:o,p=a>l?a>h?a:h:l>h?l:h,g=n.next;g!==e;){if(g.x>=d&&g.x<=u&&g.y>=c&&g.y<=p&&f(s,a,r,l,o,h,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function o(t,e,i,n){var s=t.prev,r=t,o=t.next;if(m(s,r,o)>=0)return!1;for(var a=s.x,l=r.x,h=o.x,d=s.y,c=r.y,p=o.y,g=a<l?a<h?a:h:l<h?l:h,v=d<c?d<p?d:p:c<p?c:p,_=a>l?a>h?a:h:l>h?l:h,y=d>c?d>p?d:p:c>p?c:p,E=u(g,v,e,i,n),b=u(_,y,e,i,n),A=t.prevZ,T=t.nextZ;A&&A.z>=E&&T&&T.z<=b;){if(A.x>=g&&A.x<=_&&A.y>=v&&A.y<=y&&A!==s&&A!==o&&f(a,d,l,c,h,p,A.x,A.y)&&m(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,T.x>=g&&T.x<=_&&T.y>=v&&T.y<=y&&T!==s&&T!==o&&f(a,d,l,c,h,p,T.x,T.y)&&m(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;A&&A.z>=E;){if(A.x>=g&&A.x<=_&&A.y>=v&&A.y<=y&&A!==s&&A!==o&&f(a,d,l,c,h,p,A.x,A.y)&&m(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;T&&T.z<=b;){if(T.x>=g&&T.x<=_&&T.y>=v&&T.y<=y&&T!==s&&T!==o&&f(a,d,l,c,h,p,T.x,T.y)&&m(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function a(t,e,i){var s=t;do{var r=s.prev,o=s.next.next;!v(r,o)&&_(r,s,s.next,o)&&b(r,o)&&b(o,r)&&(e.push(r.i/i|0),e.push(s.i/i|0),e.push(o.i/i|0),x(s),x(s.next),s=t=o),s=s.next}while(s!==t);return n(s)}function l(t,e,i,r,o,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&g(l,h)){var d=A(l,h);return l=n(l,l.next),d=n(d,d.next),s(l,e,i,r,o,a,0),void s(d,e,i,r,o,a,0)}h=h.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){var i=function(t,e){var i,n=e,s=t.x,r=t.y,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=s&&a>o&&(o=a,i=n.x<n.next.x?n:n.next,a===s))return i}n=n.next}while(n!==e);if(!i)return null;var l,h=i,d=i.x,u=i.y,p=1/0;n=i;do{s>=n.x&&n.x>=d&&s!==n.x&&f(r<u?s:o,r,d,u,r<u?o:s,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(s-n.x),b(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&c(i,n)))&&(i=n,p=l)),n=n.next}while(n!==h);return i}(t,e);if(!i)return e;var s=A(i,t);return n(s,s.next),n(i,i.next)}function c(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function u(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&_(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var i=t,n=!1,s=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||v(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,i,n){var s=E(m(t,e,i)),r=E(m(t,e,n)),o=E(m(i,n,t)),a=E(m(i,n,e));return s!==r&&o!==a||(!(0!==s||!y(t,i,e))||(!(0!==r||!y(t,n,e))||(!(0!==o||!y(i,t,n))||!(0!==a||!y(i,e,n)))))}function y(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function E(t){return t>0?1:t<0?-1:0}function b(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function A(t,e){var i=new S(t.i,t.x,t.y),n=new S(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function T(t,e,i,n){var s=new S(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function x(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function w(t,e,i,n){for(var s=0,r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,n){var s=e&&e.length,r=s?e[0]*i:t.length,o=Math.abs(w(t,0,r,i));if(s)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,d=a<l-1?e[a+1]*i:t.length;o-=Math.abs(w(t,h,d,i))}var c=0;for(a=0;a<n.length;a+=3){var u=n[a]*i,p=n[a+1]*i,f=n[a+2]*i;c+=Math.abs((t[u]-t[f])*(t[p+1]-t[u+1])-(t[u]-t[p])*(t[f+1]-t[u+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,s=0;s<t.length;s++){for(var r=0;r<t[s].length;r++)for(var o=0;o<e;o++)i.vertices.push(t[s][r][o]);s>0&&(n+=t[s-1].length,i.holes.push(n))}return i}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function n(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||t,o),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,s,r,o){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,n),!0;case 4:return d.fn.call(d.context,e,n,s),!0;case 5:return d.fn.call(d.context,e,n,s,r),!0;case 6:return d.fn.call(d.context,e,n,s,r,o),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];d.fn.apply(d.context,l)}else{var u,p=d.length;for(h=0;h<p;h++)switch(d[h].once&&this.removeListener(t,d[h].fn,void 0,!0),c){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,e);break;case 3:d[h].fn.call(d[h].context,e,n);break;case 4:d[h].fn.call(d[h].context,e,n,s);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d[h].fn.apply(d[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,s){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||s&&!a.once||n&&a.context!==n||o(this,r);else{for(var l=0,h=[],d=a.length;l<d;l++)(a[l].fn!==e||s&&!a[l].once||n&&a[l].context!==n)&&h.push(a[l]);h.length?this._events[r]=1===h.length?h[0]:h:o(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e=Array.prototype.slice,i=Object.prototype.toString;t.exports=function(t){var n=this;if("function"!=typeof n||"[object Function]"!==i.call(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var s,r=e.call(arguments,1),o=Math.max(0,n.length-r.length),a=[],l=0;l<o;l++)a.push("$"+l);if(s=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var i=n.apply(this,r.concat(e.call(arguments)));return Object(i)===i?i:this}return n.apply(t,r.concat(e.call(arguments)))})),n.prototype){var h=function(){};h.prototype=n.prototype,s.prototype=new h,h.prototype=null}return s}},612:(t,e,i)=>{"use strict";var n=i(648);t.exports=Function.prototype.bind||n},806:(t,e,i)=>{"use strict";var n,s,r,o,a=a||function(t,e){var i={},n=i.lib={},s=function(){},r=n.Base={extend:function(t){s.prototype=this;var e=new s;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes;if(t=t.sigBytes,this.clamp(),n%4)for(var s=0;s<t;s++)e[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<t;s+=4)e[n+s>>>2]=i[s>>>2];else e.push.apply(e,i);return this.sigBytes+=t,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i=[],n=0;n<e;n+=4)i.push(4294967296*t.random()|0);return new o.init(i,e)}}),a=i.enc={},l=a.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++){var s=e[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new o.init(i,e/2)}},h=a.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++)i.push(String.fromCharCode(e[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new o.init(i,e)}},d=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},c=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,n=i.words,s=i.sigBytes,r=this.blockSize,a=s/(4*r);if(e=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*r,s=t.min(4*e,s),e){for(var l=0;l<e;l+=r)this._doProcessBlock(n,l);l=n.splice(0,e),i.sigBytes-=s}return new o.init(l,s)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=c.extend({cfg:r.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new u.HMAC.init(t,i).finalize(e)}}});var u=i.algo={};return i}(Math);!function(t){for(var e=a,i=(s=e.lib).WordArray,n=s.Hasher,s=e.algo,r=[],o=[],l=function(t){return 4294967296*(t-(0|t))|0},h=2,d=0;64>d;){var c;t:{c=h;for(var u=t.sqrt(c),p=2;p<=u;p++)if(!(c%p)){c=!1;break t}c=!0}c&&(8>d&&(r[d]=l(t.pow(h,.5))),o[d]=l(t.pow(h,1/3)),d++),h++}var f=[];s=s.SHA256=n.extend({_doReset:function(){this._hash=new i.init(r.slice(0))},_doProcessBlock:function(t,e){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],a=i[3],l=i[4],h=i[5],d=i[6],c=i[7],u=0;64>u;u++){if(16>u)f[u]=0|t[e+u];else{var p=f[u-15],g=f[u-2];f[u]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+f[u-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+f[u-16]}p=c+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&h^~l&d)+o[u]+f[u],g=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&s^n&r^s&r),c=d,d=h,h=l,l=a+p|0,a=r,r=s,s=n,n=p+g|0}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+a|0,i[4]=i[4]+l|0,i[5]=i[5]+h|0,i[6]=i[6]+d|0,i[7]=i[7]+c|0},_doFinalize:function(){var e=this._data,i=e.words,n=8*this._nDataBytes,s=8*e.sigBytes;return i[s>>>5]|=128<<24-s%32,i[14+(s+64>>>9<<4)]=t.floor(n/4294967296),i[15+(s+64>>>9<<4)]=n,e.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=n._createHelper(s),e.HmacSHA256=n._createHmacHelper(s)}(Math),s=(n=a).enc.Utf8,n.algo.HMAC=n.lib.Base.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=s.parse(e));var i=t.blockSize,n=4*i;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),o=this._iKey=e.clone(),a=r.words,l=o.words,h=0;h<i;h++)a[h]^=1549556828,l[h]^=909522486;r.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}}),function(){var t=a,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,n=this._map;t.clamp(),t=[];for(var s=0;s<i;s+=3)for(var r=(e[s>>>2]>>>24-s%4*8&255)<<16|(e[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|e[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;4>o&&s+.75*o<i;o++)t.push(n.charAt(r>>>6*(3-o)&63));if(e=n.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var i=t.length,n=this._map;(s=n.charAt(64))&&(-1!=(s=t.indexOf(s))&&(i=s));for(var s=[],r=0,o=0;o<i;o++)if(o%4){var a=n.indexOf(t.charAt(o-1))<<o%4*2,l=n.indexOf(t.charAt(o))>>>6-o%4*2;s[r>>>2]|=(a|l)<<24-r%4*8,r++}return e.create(s,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){!function(t){t[t.Undefined=0]="Undefined",t[t.Debug=1]="Debug",t[t.Info=2]="Info",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical"}(t.EGAErrorSeverity||(t.EGAErrorSeverity={})),function(t){t[t.Undefined=0]="Undefined",t[t.Start=1]="Start",t[t.Complete=2]="Complete",t[t.Fail=3]="Fail"}(t.EGAProgressionStatus||(t.EGAProgressionStatus={})),function(t){t[t.Undefined=0]="Undefined",t[t.Source=1]="Source",t[t.Sink=2]="Sink"}(t.EGAResourceFlowType||(t.EGAResourceFlowType={})),function(t){t[t.Undefined=0]="Undefined",t[t.Clicked=1]="Clicked",t[t.Show=2]="Show",t[t.FailedShow=3]="FailedShow",t[t.RewardReceived=4]="RewardReceived"}(t.EGAAdAction||(t.EGAAdAction={})),function(t){t[t.Undefined=0]="Undefined",t[t.Unknown=1]="Unknown",t[t.Offline=2]="Offline",t[t.NoFill=3]="NoFill",t[t.InternalError=4]="InternalError",t[t.InvalidRequest=5]="InvalidRequest",t[t.UnableToPrecache=6]="UnableToPrecache"}(t.EGAAdError||(t.EGAAdError={})),function(t){t[t.Undefined=0]="Undefined",t[t.Video=1]="Video",t[t.RewardedVideo=2]="RewardedVideo",t[t.Playable=3]="Playable",t[t.Interstitial=4]="Interstitial",t[t.OfferWall=5]="OfferWall",t[t.Banner=6]="Banner"}(t.EGAAdType||(t.EGAAdType={})),function(t){!function(t){t[t.NoResponse=0]="NoResponse",t[t.BadResponse=1]="BadResponse",t[t.RequestTimeout=2]="RequestTimeout",t[t.JsonEncodeFailed=3]="JsonEncodeFailed",t[t.JsonDecodeFailed=4]="JsonDecodeFailed",t[t.InternalServerError=5]="InternalServerError",t[t.BadRequest=6]="BadRequest",t[t.Unauthorized=7]="Unauthorized",t[t.UnknownResponseCode=8]="UnknownResponseCode",t[t.Ok=9]="Ok",t[t.Created=10]="Created"}(t.EGAHTTPApiResponse||(t.EGAHTTPApiResponse={}))}(t.http||(t.http={})),function(t){!function(t){t[t.Undefined=0]="Undefined",t[t.EventValidation=1]="EventValidation",t[t.Database=2]="Database",t[t.Init=3]="Init",t[t.Http=4]="Http",t[t.Json=5]="Json"}(t.EGASdkErrorCategory||(t.EGASdkErrorCategory={})),function(t){t[t.Undefined=0]="Undefined",t[t.BusinessEvent=1]="BusinessEvent",t[t.ResourceEvent=2]="ResourceEvent",t[t.ProgressionEvent=3]="ProgressionEvent",t[t.DesignEvent=4]="DesignEvent",t[t.ErrorEvent=5]="ErrorEvent",t[t.InitHttp=9]="InitHttp",t[t.EventsHttp=10]="EventsHttp",t[t.ProcessEvents=11]="ProcessEvents",t[t.AddEventsToStore=12]="AddEventsToStore",t[t.AdEvent=20]="AdEvent"}(t.EGASdkErrorArea||(t.EGASdkErrorArea={})),function(t){t[t.Undefined=0]="Undefined",t[t.InvalidCurrency=1]="InvalidCurrency",t[t.InvalidShortString=2]="InvalidShortString",t[t.InvalidEventPartLength=3]="InvalidEventPartLength",t[t.InvalidEventPartCharacters=4]="InvalidEventPartCharacters",t[t.InvalidStore=5]="InvalidStore",t[t.InvalidFlowType=6]="InvalidFlowType",t[t.StringEmptyOrNull=7]="StringEmptyOrNull",t[t.NotFoundInAvailableCurrencies=8]="NotFoundInAvailableCurrencies",t[t.InvalidAmount=9]="InvalidAmount",t[t.NotFoundInAvailableItemTypes=10]="NotFoundInAvailableItemTypes",t[t.WrongProgressionOrder=11]="WrongProgressionOrder",t[t.InvalidEventIdLength=12]="InvalidEventIdLength",t[t.InvalidEventIdCharacters=13]="InvalidEventIdCharacters",t[t.InvalidProgressionStatus=15]="InvalidProgressionStatus",t[t.InvalidSeverity=16]="InvalidSeverity",t[t.InvalidLongString=17]="InvalidLongString",t[t.DatabaseTooLarge=18]="DatabaseTooLarge",t[t.DatabaseOpenOrCreate=19]="DatabaseOpenOrCreate",t[t.JsonError=25]="JsonError",t[t.FailHttpJsonDecode=29]="FailHttpJsonDecode",t[t.FailHttpJsonEncode=30]="FailHttpJsonEncode",t[t.InvalidAdAction=31]="InvalidAdAction",t[t.InvalidAdType=32]="InvalidAdType",t[t.InvalidString=33]="InvalidString"}(t.EGASdkErrorAction||(t.EGASdkErrorAction={})),function(t){t[t.Undefined=0]="Undefined",t[t.Currency=1]="Currency",t[t.CartType=2]="CartType",t[t.ItemType=3]="ItemType",t[t.ItemId=4]="ItemId",t[t.Store=5]="Store",t[t.FlowType=6]="FlowType",t[t.Amount=7]="Amount",t[t.Progression01=8]="Progression01",t[t.Progression02=9]="Progression02",t[t.Progression03=10]="Progression03",t[t.EventId=11]="EventId",t[t.ProgressionStatus=12]="ProgressionStatus",t[t.Severity=13]="Severity",t[t.Message=14]="Message",t[t.AdAction=15]="AdAction",t[t.AdType=16]="AdType",t[t.AdSdkName=17]="AdSdkName",t[t.AdPlacement=18]="AdPlacement"}(t.EGASdkErrorParameter||(t.EGASdkErrorParameter={}))}(t.events||(t.events={}))}(o||(o={})),function(t){!function(t){t[t.Undefined=0]="Undefined",t[t.Debug=1]="Debug",t[t.Info=2]="Info",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical"}(t.EGAErrorSeverity||(t.EGAErrorSeverity={})),function(t){t[t.Undefined=0]="Undefined",t[t.Start=1]="Start",t[t.Complete=2]="Complete",t[t.Fail=3]="Fail"}(t.EGAProgressionStatus||(t.EGAProgressionStatus={})),function(t){t[t.Undefined=0]="Undefined",t[t.Source=1]="Source",t[t.Sink=2]="Sink"}(t.EGAResourceFlowType||(t.EGAResourceFlowType={})),function(t){t[t.Undefined=0]="Undefined",t[t.Clicked=1]="Clicked",t[t.Show=2]="Show",t[t.FailedShow=3]="FailedShow",t[t.RewardReceived=4]="RewardReceived"}(t.EGAAdAction||(t.EGAAdAction={})),function(t){t[t.Undefined=0]="Undefined",t[t.Unknown=1]="Unknown",t[t.Offline=2]="Offline",t[t.NoFill=3]="NoFill",t[t.InternalError=4]="InternalError",t[t.InvalidRequest=5]="InvalidRequest",t[t.UnableToPrecache=6]="UnableToPrecache"}(t.EGAAdError||(t.EGAAdError={})),function(t){t[t.Undefined=0]="Undefined",t[t.Video=1]="Video",t[t.RewardedVideo=2]="RewardedVideo",t[t.Playable=3]="Playable",t[t.Interstitial=4]="Interstitial",t[t.OfferWall=5]="OfferWall",t[t.Banner=6]="Banner"}(t.EGAAdType||(t.EGAAdType={}))}(r||(r={})),function(t){!function(t){var e;!function(t){t[t.Error=0]="Error",t[t.Warning=1]="Warning",t[t.Info=2]="Info",t[t.Debug=3]="Debug"}(e||(e={}));var i=function(){function t(){t.debugEnabled=!1}return t.setInfoLog=function(e){t.instance.infoLogEnabled=e},t.setVerboseLog=function(e){t.instance.infoLogVerboseEnabled=e},t.i=function(i){if(t.instance.infoLogEnabled){var n="Info/"+t.Tag+": "+i;t.instance.sendNotificationMessage(n,e.Info)}},t.w=function(i){var n="Warning/"+t.Tag+": "+i;t.instance.sendNotificationMessage(n,e.Warning)},t.e=function(i){var n="Error/"+t.Tag+": "+i;t.instance.sendNotificationMessage(n,e.Error)},t.ii=function(i){if(t.instance.infoLogVerboseEnabled){var n="Verbose/"+t.Tag+": "+i;t.instance.sendNotificationMessage(n,e.Info)}},t.d=function(i){if(t.debugEnabled){var n="Debug/"+t.Tag+": "+i;t.instance.sendNotificationMessage(n,e.Debug)}},t.prototype.sendNotificationMessage=function(t,i){switch(i){case e.Error:console.error(t);break;case e.Warning:console.warn(t);break;case e.Debug:"function"==typeof console.debug?console.debug(t):console.log(t);break;case e.Info:console.log(t)}},t.instance=new t,t.Tag="GameAnalytics",t}();t.GALogger=i}(t.logging||(t.logging={}))}(o||(o={})),function(t){!function(e){var i=t.logging.GALogger,n=function(){function t(){}return t.getHmac=function(t,e){var i=a.HmacSHA256(e,t);return a.enc.Base64.stringify(i)},t.stringMatch=function(t,e){return!(!t||!e)&&e.test(t)},t.joinStringArray=function(t,e){for(var i="",n=0,s=t.length;n<s;n++)n>0&&(i+=e),i+=t[n];return i},t.stringArrayContainsString=function(t,e){if(0===t.length)return!1;for(var i in t)if(t[i]===e)return!0;return!1},t.encode64=function(e){e=encodeURI(e);var i,n,s,r,o,a="",l=0,h=0,d=0;do{s=(i=e.charCodeAt(d++))>>2,r=(3&i)<<4|(n=e.charCodeAt(d++))>>4,o=(15&n)<<2|(l=e.charCodeAt(d++))>>6,h=63&l,isNaN(n)?o=h=64:isNaN(l)&&(h=64),a=a+t.keyStr.charAt(s)+t.keyStr.charAt(r)+t.keyStr.charAt(o)+t.keyStr.charAt(h),i=n=l=0,s=r=o=h=0}while(d<e.length);return a},t.decode64=function(e){var n,s,r,o,a="",l=0,h=0,d=0;/[^A-Za-z0-9\+\/\=]/g.exec(e)&&i.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=t.keyStr.indexOf(e.charAt(d++))<<2|(r=t.keyStr.indexOf(e.charAt(d++)))>>4,s=(15&r)<<4|(o=t.keyStr.indexOf(e.charAt(d++)))>>2,l=(3&o)<<6|(h=t.keyStr.indexOf(e.charAt(d++))),a+=String.fromCharCode(n),64!=o&&(a+=String.fromCharCode(s)),64!=h&&(a+=String.fromCharCode(l)),n=s=l=0,r=o=h=0}while(d<e.length);return decodeURI(a)},t.timeIntervalSince1970=function(){var t=new Date;return Math.round(t.getTime()/1e3)},t.createGuid=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(t){return(+t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+t/4).toString(16)}))},t.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t}();e.GAUtilities=n}(t.utilities||(t.utilities={}))}(o||(o={})),function(t){!function(e){var i=t.logging.GALogger,n=t.utilities.GAUtilities,s=t.events.EGASdkErrorCategory,r=t.events.EGASdkErrorArea,o=t.events.EGASdkErrorAction,a=t.events.EGASdkErrorParameter,l=function(t,e,i,n,s){this.category=t,this.area=e,this.action=i,this.parameter=n,this.reason=s};e.ValidationResult=l;var h=function(){function e(){}return e.validateBusinessEvent=function(t,n,h,d,c){return e.validateCurrency(t)?n<0?(i.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+n),new l(s.EventValidation,r.BusinessEvent,o.InvalidAmount,a.Amount,n+"")):e.validateShortString(h,!0)?e.validateEventPartLength(d,!1)?e.validateEventPartCharacters(d)?e.validateEventPartLength(c,!1)?e.validateEventPartCharacters(c)?null:(i.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+c),new l(s.EventValidation,r.BusinessEvent,o.InvalidEventPartCharacters,a.ItemId,c)):(i.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+c),new l(s.EventValidation,r.BusinessEvent,o.InvalidEventPartLength,a.ItemId,c)):(i.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+d),new l(s.EventValidation,r.BusinessEvent,o.InvalidEventPartCharacters,a.ItemType,d)):(i.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+d),new l(s.EventValidation,r.BusinessEvent,o.InvalidEventPartLength,a.ItemType,d)):(i.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+h),new l(s.EventValidation,r.BusinessEvent,o.InvalidShortString,a.CartType,h)):(i.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+t),new l(s.EventValidation,r.BusinessEvent,o.InvalidCurrency,a.Currency,t))},e.validateResourceEvent=function(h,d,c,u,p,f,g){return h==t.EGAResourceFlowType.Undefined?(i.w("Validation fail - resource event - flowType: Invalid flow type."),new l(s.EventValidation,r.ResourceEvent,o.InvalidFlowType,a.FlowType,"")):d?n.stringArrayContainsString(f,d)?c>0?u?e.validateEventPartLength(u,!1)?e.validateEventPartCharacters(u)?n.stringArrayContainsString(g,u)?e.validateEventPartLength(p,!1)?e.validateEventPartCharacters(p)?null:(i.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+p),new l(s.EventValidation,r.ResourceEvent,o.InvalidEventPartCharacters,a.ItemId,p)):(i.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+p),new l(s.EventValidation,r.ResourceEvent,o.InvalidEventPartLength,a.ItemId,p)):(i.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+u),new l(s.EventValidation,r.ResourceEvent,o.NotFoundInAvailableItemTypes,a.ItemType,u)):(i.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+u),new l(s.EventValidation,r.ResourceEvent,o.InvalidEventPartCharacters,a.ItemType,u)):(i.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+u),new l(s.EventValidation,r.ResourceEvent,o.InvalidEventPartLength,a.ItemType,u)):(i.w("Validation fail - resource event - itemType: Cannot be (null)"),new l(s.EventValidation,r.ResourceEvent,o.StringEmptyOrNull,a.ItemType,"")):(i.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+c),new l(s.EventValidation,r.ResourceEvent,o.InvalidAmount,a.Amount,c+"")):(i.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+d),new l(s.EventValidation,r.ResourceEvent,o.NotFoundInAvailableCurrencies,a.Currency,d)):(i.w("Validation fail - resource event - currency: Cannot be (null)"),new l(s.EventValidation,r.ResourceEvent,o.StringEmptyOrNull,a.Currency,""))},e.validateProgressionEvent=function(n,h,d,c){if(n==t.EGAProgressionStatus.Undefined)return i.w("Validation fail - progression event: Invalid progression status."),new l(s.EventValidation,r.ProgressionEvent,o.InvalidProgressionStatus,a.ProgressionStatus,"");if(c&&!d&&h)return i.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),new l(s.EventValidation,r.ProgressionEvent,o.WrongProgressionOrder,a.Undefined,h+":"+d+":"+c);if(d&&!h)return i.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),new l(s.EventValidation,r.ProgressionEvent,o.WrongProgressionOrder,a.Undefined,h+":"+d+":"+c);if(!h)return i.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),new l(s.EventValidation,r.ProgressionEvent,o.WrongProgressionOrder,a.Undefined,(h||"")+":"+(d||"")+":"+(c||""));if(!e.validateEventPartLength(h,!1))return i.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+h),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartLength,a.Progression01,h);if(!e.validateEventPartCharacters(h))return i.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+h),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartCharacters,a.Progression01,h);if(d){if(!e.validateEventPartLength(d,!0))return i.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+d),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartLength,a.Progression02,d);if(!e.validateEventPartCharacters(d))return i.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+d),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartCharacters,a.Progression02,d)}if(c){if(!e.validateEventPartLength(c,!0))return i.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+c),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartLength,a.Progression03,c);if(!e.validateEventPartCharacters(c))return i.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+c),new l(s.EventValidation,r.ProgressionEvent,o.InvalidEventPartCharacters,a.Progression03,c)}return null},e.validateDesignEvent=function(t){return e.validateEventIdLength(t)?e.validateEventIdCharacters(t)?null:(i.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+t),new l(s.EventValidation,r.DesignEvent,o.InvalidEventIdCharacters,a.EventId,t)):(i.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 64 characters or less. String: "+t),new l(s.EventValidation,r.DesignEvent,o.InvalidEventIdLength,a.EventId,t))},e.validateErrorEvent=function(n,h){return n==t.EGAErrorSeverity.Undefined?(i.w("Validation fail - error event - severity: Severity was unsupported value."),new l(s.EventValidation,r.ErrorEvent,o.InvalidSeverity,a.Severity,"")):e.validateLongString(h,!0)?null:(i.w("Validation fail - error event - message: Message cannot be above 8192 characters."),new l(s.EventValidation,r.ErrorEvent,o.InvalidLongString,a.Message,h))},e.validateAdEvent=function(n,h,d,c){return n==t.EGAAdAction.Undefined?(i.w("Validation fail - error event - severity: Severity was unsupported value."),new l(s.EventValidation,r.AdEvent,o.InvalidAdAction,a.AdAction,"")):h==t.EGAAdType.Undefined?(i.w("Validation fail - ad event - adType: Ad type was unsupported value."),new l(s.EventValidation,r.AdEvent,o.InvalidAdType,a.AdType,"")):e.validateShortString(d,!1)?e.validateString(c,!1)?null:(i.w("Validation fail - ad event - message: Ad placement cannot be above 64 characters."),new l(s.EventValidation,r.AdEvent,o.InvalidString,a.AdPlacement,c)):(i.w("Validation fail - ad event - message: Ad SDK name cannot be above 32 characters."),new l(s.EventValidation,r.AdEvent,o.InvalidShortString,a.AdSdkName,d))},e.validateSdkErrorEvent=function(t,n,a,l,h){return!!e.validateKeys(t,n)&&(a===s.Undefined?(i.w("Validation fail - sdk error event - type: Category was unsupported value."),!1):l===r.Undefined?(i.w("Validation fail - sdk error event - type: Area was unsupported value."),!1):h!==o.Undefined||(i.w("Validation fail - sdk error event - type: Action was unsupported value."),!1))},e.validateKeys=function(t,e){return!(!n.stringMatch(t,/^[A-z0-9]{32}$/)||!n.stringMatch(e,/^[A-z0-9]{40}$/))},e.validateCurrency=function(t){return!!t&&!!n.stringMatch(t,/^[A-Z]{3}$/)},e.validateEventPartLength=function(t,e){return!(!e||t)||!!t&&!(t.length>64)},e.validateEventPartCharacters=function(t){return!!n.stringMatch(t,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},e.validateEventIdLength=function(t){return!!t&&!!n.stringMatch(t,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},e.validateEventIdCharacters=function(t){return!!t&&!!n.stringMatch(t,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},e.validateAndCleanInitRequestResponse=function(t,e){if(null==t)return i.w("validateInitRequestResponse failed - no response dictionary."),null;var n={};try{var s=t.server_ts;if(!(s>0))return i.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;n.server_ts=s}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof t.server_ts+", value="+t.server_ts+", "+e),null}if(e){try{var r=t.configs;n.configs=r}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'configs' field. type="+typeof t.configs+", value="+t.configs+", "+e),null}try{var o=t.configs_hash;n.configs_hash=o}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'configs_hash' field. type="+typeof t.configs_hash+", value="+t.configs_hash+", "+e),null}try{var a=t.ab_id;n.ab_id=a}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'ab_id' field. type="+typeof t.ab_id+", value="+t.ab_id+", "+e),null}try{var l=t.ab_variant_id;n.ab_variant_id=l}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'ab_variant_id' field. type="+typeof t.ab_variant_id+", value="+t.ab_variant_id+", "+e),null}}return n},e.validateBuild=function(t){return!!e.validateShortString(t,!1)},e.validateSdkWrapperVersion=function(t){return!!n.stringMatch(t,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot|flutter) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},e.validateEngineVersion=function(t){return!(!t||!n.stringMatch(t,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},e.validateUserId=function(t){return!!e.validateString(t,!1)||(i.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},e.validateShortString=function(t,e){return!(!e||t)||!(!t||t.length>32)},e.validateString=function(t,e){return!(!e||t)||!(!t||t.length>64)},e.validateLongString=function(t,e){return!(!e||t)||!(!t||t.length>8192)},e.validateConnectionType=function(t){return n.stringMatch(t,/^(wwan|wifi|lan|offline)$/)},e.validateCustomDimensions=function(t){return e.validateArrayOfStrings(20,32,!1,"custom dimensions",t)},e.validateResourceCurrencies=function(t){if(!e.validateArrayOfStrings(20,64,!1,"resource currencies",t))return!1;for(var s=0;s<t.length;++s)if(!n.stringMatch(t[s],/^[A-Za-z]+$/))return i.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+t[s]),!1;return!0},e.validateResourceItemTypes=function(t){if(!e.validateArrayOfStrings(20,32,!1,"resource item types",t))return!1;for(var n=0;n<t.length;++n)if(!e.validateEventPartCharacters(t[n]))return i.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+t[n]),!1;return!0},e.validateDimension01=function(t,e){return!t||!!n.stringArrayContainsString(e,t)},e.validateDimension02=function(t,e){return!t||!!n.stringArrayContainsString(e,t)},e.validateDimension03=function(t,e){return!t||!!n.stringArrayContainsString(e,t)},e.validateArrayOfStrings=function(t,e,n,s,r){var o=s;if(o||(o="Array"),!r)return i.w(o+" validation failed: array cannot be null. "),!1;if(0==n&&0==r.length)return i.w(o+" validation failed: array cannot be empty. "),!1;if(t>0&&r.length>t)return i.w(o+" validation failed: array cannot exceed "+t+" values. It has "+r.length+" values."),!1;for(var a=0;a<r.length;++a){var l=r[a]?r[a].length:0;if(0===l)return i.w(o+" validation failed: contained an empty string. Array="+JSON.stringify(r)),!1;if(e>0&&l>e)return i.w(o+" validation failed: a string exceeded max allowed length (which is: "+e+"). String was: "+r[a]),!1}return!0},e.validateClientTs=function(t){return!(t<0||t>99999999999)},e}();e.GAValidator=h}(t.validators||(t.validators={}))}(o||(o={})),function(t){!function(t){var e=function(t,e,i){this.name=t,this.value=e,this.version=i};t.NameValueVersion=e;var i=function(t,e){this.name=t,this.version=e};t.NameVersion=i;var n=function(){function t(){}return t.touch=function(){},t.getRelevantSdkVersion=function(){return t.sdkGameEngineVersion?t.sdkGameEngineVersion:t.sdkWrapperVersion},t.getConnectionType=function(){return t.connectionType},t.updateConnectionType=function(){navigator.onLine?"ios"===t.buildPlatform||"android"===t.buildPlatform?t.connectionType="wwan":t.connectionType="lan":t.connectionType="offline"},t.getOSVersionString=function(){return t.buildPlatform+" "+t.osVersionPair.version},t.runtimePlatformToString=function(){return t.osVersionPair.name},t.getBrowserVersionString=function(){var e,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==n.length&&"ios"===t.buildPlatform)return"webkit_"+t.osVersion;if(/trident/i.test(n[1]))return"IE "+((e=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||"");if("Chrome"===n[1]&&null!=(e=i.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return e.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(n[1]&&"fbav"===n[1].toLowerCase()&&(n[1]="facebook",n[2]))return"facebook "+n[2];var s=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(e=i.match(/version\/(\d+)/i))&&s.splice(1,1,e[1]),s.join(" ").toLowerCase()},t.getDeviceModel=function(){return"unknown"},t.getDeviceManufacturer=function(){return"unknown"},t.matchItem=function(t,e){var n,s,r,o,a=new i("unknown","0.0.0"),l=0,h=0;for(l=0;l<e.length;l+=1)if(new RegExp(e[l].value,"i").test(t)){if(n=new RegExp(e[l].version+"[- /:;]([\\d._]+)","i"),o="",(s=t.match(n))&&s[1]&&(r=s[1]),r){var d=r.split(/[._]+/);for(h=0;h<Math.min(d.length,3);h+=1)o+=d[h]+(h<Math.min(d.length,3)-1?".":"")}else o="0.0.0";return a.name=e[l].name,a.version=o,a}return a},t.sdkWrapperVersion="javascript 4.4.6",t.osVersionPair=t.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new e("windows_phone","Windows Phone","OS"),new e("windows","Win","NT"),new e("ios","iPhone","OS"),new e("ios","iPad","OS"),new e("ios","iPod","OS"),new e("android","Android","Android"),new e("blackBerry","BlackBerry","/"),new e("mac_osx","Mac","OS X"),new e("tizen","Tizen","Tizen"),new e("linux","Linux","rv"),new e("kai_os","KAIOS","KAIOS")]),t.buildPlatform=t.runtimePlatformToString(),t.deviceModel=t.getDeviceModel(),t.deviceManufacturer=t.getDeviceManufacturer(),t.osVersion=t.getOSVersionString(),t.browserVersion=t.getBrowserVersionString(),t}();t.GADevice=n}(t.device||(t.device={}))}(o||(o={})),function(t){!function(t){var e=function(){function t(e){this.deadline=e,this.ignore=!1,this.async=!1,this.running=!1,this.id=++t.idCounter}return t.idCounter=0,t}();t.TimedBlock=e}(t.threading||(t.threading={}))}(o||(o={})),function(t){!function(t){var e=function(){function t(t){this.comparer=t,this._subQueues={},this._sortedKeys=[]}return t.prototype.enqueue=function(t,e){-1===this._sortedKeys.indexOf(t)&&this.addQueueOfPriority(t),this._subQueues[t].push(e)},t.prototype.addQueueOfPriority=function(t){var e=this;this._sortedKeys.push(t),this._sortedKeys.sort((function(t,i){return e.comparer.compare(t,i)})),this._subQueues[t]=[]},t.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},t.prototype.hasItems=function(){return this._sortedKeys.length>0},t.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},t.prototype.dequeueFromHighPriorityQueue=function(){var t=this._sortedKeys[0],e=this._subQueues[t].shift();return 0===this._subQueues[t].length&&(this._sortedKeys.shift(),delete this._subQueues[t]),e},t}();t.PriorityQueue=e}(t.threading||(t.threading={}))}(o||(o={})),function(t){!function(e){var i,n,s=t.logging.GALogger;!function(t){t[t.Equal=0]="Equal",t[t.LessOrEqual=1]="LessOrEqual",t[t.NotEqual=2]="NotEqual"}(i=e.EGAStoreArgsOperator||(e.EGAStoreArgsOperator={})),function(t){t[t.Events=0]="Events",t[t.Sessions=1]="Sessions",t[t.Progression=2]="Progression"}(n=e.EGAStore||(e.EGAStore={}));var r=function(){function t(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),t.storageAvailable=!0):t.storageAvailable=!1}catch(t){}}return t.isStorageAvailable=function(){return t.storageAvailable},t.isStoreTooLargeForEvents=function(){return t.instance.eventsStore.length+t.instance.sessionsStore.length>t.MaxNumberOfEntries},t.select=function(e,n,s,r){void 0===n&&(n=[]),void 0===s&&(s=!1),void 0===r&&(r=0);var o=t.getStore(e);if(!o)return null;for(var a=[],l=0;l<o.length;++l){for(var h=o[l],d=!0,c=0;c<n.length;++c){var u=n[c];if(h[u[0]])switch(u[1]){case i.Equal:d=h[u[0]]==u[2];break;case i.LessOrEqual:d=h[u[0]]<=u[2];break;case i.NotEqual:d=h[u[0]]!=u[2];break;default:d=!1}else d=!1;if(!d)break}d&&a.push(h)}return s&&a.sort((function(t,e){return t.client_ts-e.client_ts})),r>0&&a.length>r&&(a=a.slice(0,r+1)),a},t.update=function(e,n,s){void 0===s&&(s=[]);var r=t.getStore(e);if(!r)return!1;for(var o=0;o<r.length;++o){for(var a=r[o],l=!0,h=0;h<s.length;++h){var d=s[h];if(a[d[0]])switch(d[1]){case i.Equal:l=a[d[0]]==d[2];break;case i.LessOrEqual:l=a[d[0]]<=d[2];break;case i.NotEqual:l=a[d[0]]!=d[2];break;default:l=!1}else l=!1;if(!l)break}if(l)for(h=0;h<n.length;++h){var c=n[h];a[c[0]]=c[1]}}return!0},t.delete=function(e,n){var s=t.getStore(e);if(s)for(var r=0;r<s.length;++r){for(var o=s[r],a=!0,l=0;l<n.length;++l){var h=n[l];if(o[h[0]])switch(h[1]){case i.Equal:a=o[h[0]]==h[2];break;case i.LessOrEqual:a=o[h[0]]<=h[2];break;case i.NotEqual:a=o[h[0]]!=h[2];break;default:a=!1}else a=!1;if(!a)break}a&&(s.splice(r,1),--r)}},t.insert=function(e,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=null);var r=t.getStore(e);if(r)if(n){if(!s)return;for(var o=!1,a=0;a<r.length;++a){var l=r[a];if(l[s]==i[s]){for(var h in i)l[h]=i[h];o=!0;break}}o||r.push(i)}else r.push(i)},t.save=function(e){t.isStorageAvailable()?(localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.EventsStoreKey),JSON.stringify(t.instance.eventsStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.SessionsStoreKey),JSON.stringify(t.instance.sessionsStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.ProgressionStoreKey),JSON.stringify(t.instance.progressionStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.ItemsStoreKey),JSON.stringify(t.instance.storeItems))):s.w("Storage is not available, cannot save.")},t.load=function(e){if(t.isStorageAvailable()){try{t.instance.eventsStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.EventsStoreKey))),t.instance.eventsStore||(t.instance.eventsStore=[])}catch(e){s.w("Load failed for 'events' store. Using empty store."),t.instance.eventsStore=[]}try{t.instance.sessionsStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.SessionsStoreKey))),t.instance.sessionsStore||(t.instance.sessionsStore=[])}catch(e){s.w("Load failed for 'sessions' store. Using empty store."),t.instance.sessionsStore=[]}try{t.instance.progressionStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.ProgressionStoreKey))),t.instance.progressionStore||(t.instance.progressionStore=[])}catch(e){s.w("Load failed for 'progression' store. Using empty store."),t.instance.progressionStore=[]}try{t.instance.storeItems=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.ItemsStoreKey))),t.instance.storeItems||(t.instance.storeItems={})}catch(e){s.w("Load failed for 'items' store. Using empty store."),t.instance.progressionStore=[]}}else s.w("Storage is not available, cannot load.")},t.setItem=function(e,i,n){var s=t.StringFormat(t.KeyFormat,e,i);n?t.instance.storeItems[s]=n:s in t.instance.storeItems&&delete t.instance.storeItems[s]},t.getItem=function(e,i){var n=t.StringFormat(t.KeyFormat,e,i);return n in t.instance.storeItems?t.instance.storeItems[n]:null},t.getStore=function(e){switch(e){case n.Events:return t.instance.eventsStore;case n.Sessions:return t.instance.sessionsStore;case n.Progression:return t.instance.progressionStore;default:return s.w("GAStore.getStore(): Cannot find store: "+e),null}},t.instance=new t,t.MaxNumberOfEntries=2e3,t.StringFormat=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return t.replace(/{(\d+)}/g,(function(t,i){return e[i]||""}))},t.KeyFormat="GA::{0}::{1}",t.EventsStoreKey="ga_event",t.SessionsStoreKey="ga_session",t.ProgressionStoreKey="ga_progression",t.ItemsStoreKey="ga_items",t}();e.GAStore=r}(t.store||(t.store={}))}(o||(o={})),function(t){!function(e){var i=t.validators.GAValidator,n=t.utilities.GAUtilities,s=t.logging.GALogger,r=t.store.GAStore,o=t.device.GADevice,a=t.store.EGAStore,l=t.store.EGAStoreArgsOperator,h=function(){function t(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.currentGlobalCustomEventFields={},this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.remoteConfigsListeners=[],this.beforeUnloadListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0,this.isUnloading=!1}return t.setUserId=function(e){t.instance.userId=e,t.cacheIdentifier()},t.getIdentifier=function(){return t.instance.identifier},t.isInitialized=function(){return t.instance.initialized},t.setInitialized=function(e){t.instance.initialized=e},t.getSessionStart=function(){return t.instance.sessionStart},t.getSessionNum=function(){return t.instance.sessionNum},t.getTransactionNum=function(){return t.instance.transactionNum},t.getSessionId=function(){return t.instance.sessionId},t.getCurrentCustomDimension01=function(){return t.instance.currentCustomDimension01},t.getCurrentCustomDimension02=function(){return t.instance.currentCustomDimension02},t.getCurrentCustomDimension03=function(){return t.instance.currentCustomDimension03},t.getGameKey=function(){return t.instance.gameKey},t.getGameSecret=function(){return t.instance.gameSecret},t.getAvailableCustomDimensions01=function(){return t.instance.availableCustomDimensions01},t.setAvailableCustomDimensions01=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions01=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom01 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions02=function(){return t.instance.availableCustomDimensions02},t.setAvailableCustomDimensions02=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions02=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom02 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions03=function(){return t.instance.availableCustomDimensions03},t.setAvailableCustomDimensions03=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions03=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom03 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableResourceCurrencies=function(){return t.instance.availableResourceCurrencies},t.setAvailableResourceCurrencies=function(e){i.validateResourceCurrencies(e)&&(t.instance.availableResourceCurrencies=e,s.i("Set available resource currencies: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableResourceItemTypes=function(){return t.instance.availableResourceItemTypes},t.setAvailableResourceItemTypes=function(e){i.validateResourceItemTypes(e)&&(t.instance.availableResourceItemTypes=e,s.i("Set available resource item types: ("+n.joinStringArray(e,", ")+")"))},t.getBuild=function(){return t.instance.build},t.setBuild=function(e){t.instance.build=e,s.i("Set build version: "+e)},t.getUseManualSessionHandling=function(){return t.instance.useManualSessionHandling},t.isEventSubmissionEnabled=function(){return t.instance._isEventSubmissionEnabled},t.getABTestingId=function(){return t.instance.abId},t.getABTestingVariantId=function(){return t.instance.abVariantId},t.prototype.setDefaultId=function(e){this.defaultUserId=e||"",t.cacheIdentifier()},t.getDefaultId=function(){return t.instance.defaultUserId},t.getSdkConfig=function(){var e=0;for(var i in t.instance.sdkConfig)0===e&&(n=i),++e;if(n&&e>0)return t.instance.sdkConfig;var n;e=0;for(var i in t.instance.sdkConfigCached)0===e&&(n=i),++e;return n&&e>0?t.instance.sdkConfigCached:t.instance.sdkConfigDefault},t.isEnabled=function(){return!!t.instance.initAuthorized},t.setCustomDimension01=function(e){t.instance.currentCustomDimension01=e,r.setItem(t.getGameKey(),t.Dimension01Key,e),s.i("Set custom01 dimension value: "+e)},t.setCustomDimension02=function(e){t.instance.currentCustomDimension02=e,r.setItem(t.getGameKey(),t.Dimension02Key,e),s.i("Set custom02 dimension value: "+e)},t.setCustomDimension03=function(e){t.instance.currentCustomDimension03=e,r.setItem(t.getGameKey(),t.Dimension03Key,e),s.i("Set custom03 dimension value: "+e)},t.incrementSessionNum=function(){var e=t.getSessionNum()+1;t.instance.sessionNum=e},t.incrementTransactionNum=function(){var e=t.getTransactionNum()+1;t.instance.transactionNum=e},t.incrementProgressionTries=function(e){var i=t.getProgressionTries(e)+1;t.instance.progressionTries[e]=i;var n={};n.progression=e,n.tries=i,r.insert(a.Progression,n,!0,"progression")},t.getProgressionTries=function(e){return e in t.instance.progressionTries?t.instance.progressionTries[e]:0},t.clearProgressionTries=function(e){e in t.instance.progressionTries&&delete t.instance.progressionTries[e];var i=[];i.push(["progression",l.Equal,e]),r.delete(a.Progression,i)},t.setKeys=function(e,i){t.instance.gameKey=e,t.instance.gameSecret=i},t.setManualSessionHandling=function(e){t.instance.useManualSessionHandling=e,s.i("Use manual session handling: "+e)},t.setEnabledEventSubmission=function(e){t.instance._isEventSubmissionEnabled=e},t.getEventAnnotations=function(){var e={v:2};e.event_uuid=n.createGuid(),e.user_id=t.instance.identifier,e.client_ts=t.getClientTsAdjusted(),e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.manufacturer=o.deviceManufacturer,e.device=o.deviceModel,e.browser_version=o.browserVersion,e.platform=o.buildPlatform,e.session_id=t.instance.sessionId,e[t.SessionNumKey]=t.instance.sessionNum;var s=o.getConnectionType();if(i.validateConnectionType(s)&&(e.connection_type=s),o.gameEngineVersion&&(e.engine_version=o.gameEngineVersion),t.instance.configurations){var r=0;for(var a in t.instance.configurations){r++;break}r>0&&(e.configurations=t.instance.configurations)}return t.instance.abId&&(e.ab_id=t.instance.abId),t.instance.abVariantId&&(e.ab_variant_id=t.instance.abVariantId),t.instance.build&&(e.build=t.instance.build),e},t.getSdkErrorEventAnnotations=function(){var e={v:2};e.event_uuid=n.createGuid(),e.category=t.CategorySdkError,e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.manufacturer=o.deviceManufacturer,e.device=o.deviceModel,e.platform=o.buildPlatform;var s=o.getConnectionType();return i.validateConnectionType(s)&&(e.connection_type=s),o.gameEngineVersion&&(e.engine_version=o.gameEngineVersion),e},t.getInitAnnotations=function(){var e={};return t.getIdentifier()||t.cacheIdentifier(),r.setItem(t.getGameKey(),t.LastUsedIdentifierKey,t.getIdentifier()),e.user_id=t.getIdentifier(),e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.platform=o.buildPlatform,t.getBuild()?e.build=t.getBuild():e.build=null,e.session_num=t.getSessionNum(),e.random_salt=t.getSessionNum(),e},t.getClientTsAdjusted=function(){var e=n.timeIntervalSince1970(),s=e+t.instance.clientServerTimeOffset;return i.validateClientTs(s)?s:e},t.sessionIsStarted=function(){return 0!=t.instance.sessionStart},t.cacheIdentifier=function(){t.instance.userId?t.instance.identifier=t.instance.userId:t.instance.defaultUserId&&(t.instance.identifier=t.instance.defaultUserId)},t.ensurePersistedStates=function(){r.isStorageAvailable()&&r.load(t.getGameKey());var e=t.instance;e.setDefaultId(null!=r.getItem(t.getGameKey(),t.DefaultUserIdKey)?r.getItem(t.getGameKey(),t.DefaultUserIdKey):n.createGuid()),e.sessionNum=null!=r.getItem(t.getGameKey(),t.SessionNumKey)?Number(r.getItem(t.getGameKey(),t.SessionNumKey)):0,e.transactionNum=null!=r.getItem(t.getGameKey(),t.TransactionNumKey)?Number(r.getItem(t.getGameKey(),t.TransactionNumKey)):0,e.currentCustomDimension01?r.setItem(t.getGameKey(),t.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=r.getItem(t.getGameKey(),t.Dimension01Key)?r.getItem(t.getGameKey(),t.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?r.setItem(t.getGameKey(),t.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=r.getItem(t.getGameKey(),t.Dimension02Key)?r.getItem(t.getGameKey(),t.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?r.setItem(t.getGameKey(),t.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=r.getItem(t.getGameKey(),t.Dimension03Key)?r.getItem(t.getGameKey(),t.Dimension03Key):"",e.currentCustomDimension03);var i=null!=r.getItem(t.getGameKey(),t.SdkConfigCachedKey)?r.getItem(t.getGameKey(),t.SdkConfigCachedKey):"";if(i){var o=JSON.parse(n.decode64(i));if(o){var l=r.getItem(t.getGameKey(),t.LastUsedIdentifierKey);null!=l&&l!=t.getIdentifier()&&(s.w("New identifier spotted compared to last one used, clearing cached configs hash!!"),o.configs_hash&&delete o.configs_hash),e.sdkConfigCached=o}}var h=t.getSdkConfig();e.configsHash=h.configs_hash?h.configs_hash:"",e.abId=h.ab_id?h.ab_id:"",e.abVariantId=h.ab_variant_id?h.ab_variant_id:"";var d=r.select(a.Progression);if(d)for(var c=0;c<d.length;++c){var u=d[c];u&&(e.progressionTries[u.progression]=u.tries)}},t.calculateServerTimeOffset=function(t){return t-n.timeIntervalSince1970()},t.formatString=function(t,e){for(var i=t,n=0;n<e.length;n++){var s=new RegExp("\\{"+n+"\\}","gi");i=i.replace(s,arguments[n])}return i},t.validateAndCleanCustomFields=function(e,i){void 0===i&&(i=null);var r={};if(e){var o=0;for(var a in e){var l=e[a];if(a&&l)if(o<t.MAX_CUSTOM_FIELDS_COUNT){var h=new RegExp("^[a-zA-Z0-9_]{1,"+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(n.stringMatch(a,h)){var d=typeof l;if("string"===d||l instanceof String){var c=l;if(c.length<=t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&c.length>0)r[a]=c,++o;else{p="validateAndCleanCustomFields: entry with key={0}, value={1} has been omitted because its value is an empty string or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")",f=t.formatString(p,[a,l]);s.w(f),i&&i(p,f)}}else if("number"===d||l instanceof Number){var u=l;r[a]=u,++o}else{p="validateAndCleanCustomFields: entry with key={0}, value={1} has been omitted because its value is not a string or number",f=t.formatString(p,[a,l]);s.w(f),i&&i(p,f)}}else{p="validateAndCleanCustomFields: entry with key={0}, value={1} has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+")",f=t.formatString(p,[a,l]);s.w(f),i&&i(p,f)}}else{p="validateAndCleanCustomFields: entry with key={0}, value={1} has been omitted because it exceeds the max number of custom fields ("+t.MAX_CUSTOM_FIELDS_COUNT+")",f=t.formatString(p,[a,l]);s.w(f),i&&i(p,f)}else{var p="validateAndCleanCustomFields: entry with key={0}, value={1} has been omitted because its key or value is null",f=t.formatString(p,[a,l]);s.w(f),i&&i(p,f)}}}return r},t.validateAndFixCurrentDimensions=function(){i.validateDimension01(t.getCurrentCustomDimension01(),t.getAvailableCustomDimensions01())||t.setCustomDimension01(""),i.validateDimension02(t.getCurrentCustomDimension02(),t.getAvailableCustomDimensions02())||t.setCustomDimension02(""),i.validateDimension03(t.getCurrentCustomDimension03(),t.getAvailableCustomDimensions03())||t.setCustomDimension03("")},t.getConfigurationStringValue=function(e,i){return t.instance.configurations[e]?t.instance.configurations[e].toString():i},t.isRemoteConfigsReady=function(){return t.instance.remoteConfigsIsReady},t.addRemoteConfigsListener=function(e){t.instance.remoteConfigsListeners.indexOf(e)<0&&t.instance.remoteConfigsListeners.push(e)},t.removeRemoteConfigsListener=function(e){var i=t.instance.remoteConfigsListeners.indexOf(e);i>-1&&t.instance.remoteConfigsListeners.splice(i,1)},t.getRemoteConfigsContentAsString=function(){return JSON.stringify(t.instance.configurations)},t.populateConfigurations=function(e){var i=e.configs;if(i){t.instance.configurations={};for(var n=0;n<i.length;++n){var s=i[n];if(s){var r=s.key,o=s.value,a=s.start_ts?s.start_ts:Number.MIN_VALUE,l=s.end_ts?s.end_ts:Number.MAX_VALUE,h=t.getClientTsAdjusted();r&&o&&h>a&&h<l&&(t.instance.configurations[r]=o)}}}t.instance.remoteConfigsIsReady=!0;var d=t.instance.remoteConfigsListeners;for(n=0;n<d.length;++n)d[n]&&d[n].onRemoteConfigsUpdated()},t.addOnBeforeUnloadListener=function(e){t.instance.beforeUnloadListeners.indexOf(e)<0&&t.instance.beforeUnloadListeners.push(e)},t.removeOnBeforeUnloadListener=function(e){var i=t.instance.beforeUnloadListeners.indexOf(e);i>-1&&t.instance.beforeUnloadListeners.splice(i,1)},t.notifyBeforeUnloadListeners=function(){for(var e=t.instance.beforeUnloadListeners,i=0;i<e.length;++i)e[i]&&e[i].onBeforeUnload()},t.CategorySdkError="sdk_error",t.MAX_CUSTOM_FIELDS_COUNT=50,t.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,t.instance=new t,t.DefaultUserIdKey="default_user_id",t.SessionNumKey="session_num",t.TransactionNumKey="transaction_num",t.Dimension01Key="dimension01",t.Dimension02Key="dimension02",t.Dimension03Key="dimension03",t.SdkConfigCachedKey="sdk_config_cached",t.LastUsedIdentifierKey="last_used_identifier",t}();e.GAState=h}(t.state||(t.state={}))}(o||(o={})),function(t){!function(e){var i=t.utilities.GAUtilities,n=t.logging.GALogger,s=function(){function t(){}return t.execute=function(e,s,r,o){var a=new Date;if(t.timestampMap[s]||(t.timestampMap[s]=a),t.countMap[s]||(t.countMap[s]=0),(a.getTime()-t.timestampMap[s].getTime())/1e3>=3600&&(t.timestampMap[s]=a,t.countMap[s]=0),!(t.countMap[s]>=t.MaxCount)){var l=i.getHmac(o,r),h=new XMLHttpRequest;h.onreadystatechange=function(){if(4===h.readyState){if(!h.responseText)return;if(200!=h.status)return void n.w("sdk error failed. response code not 200. status code: "+h.status+", description: "+h.statusText+", body: "+h.responseText);t.countMap[s]=t.countMap[s]+1}},h.open("POST",e,!0),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("Authorization",l);try{h.send(r)}catch(t){console.error(t)}}},t.MaxCount=10,t.countMap={},t.timestampMap={},t}();e.SdkErrorTask=s}(t.tasks||(t.tasks={}))}(o||(o={})),function(t){!function(e){var i=t.state.GAState,n=t.logging.GALogger,s=t.utilities.GAUtilities,r=t.validators.GAValidator,o=t.tasks.SdkErrorTask,a=t.events.EGASdkErrorCategory,l=t.events.EGASdkErrorArea,h=t.events.EGASdkErrorAction,d=t.events.EGASdkErrorParameter,c=function(){function t(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.remoteConfigsVersion="v1",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.remoteConfigsBaseUrl=this.protocol+"://"+this.hostName+"/remote_configs/"+this.remoteConfigsVersion,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return t.prototype.requestInit=function(n,s){var r=i.getGameKey(),o=this.remoteConfigsBaseUrl+"/"+this.initializeUrlPath+"?game_key="+r+"&interval_seconds=0&configs_hash="+n,a=i.getInitAnnotations(),l=JSON.stringify(a);if(l){var h=this.createPayloadData(l,this.useGzip),d=[];d.push(l),t.sendRequest(o,h,d,this.useGzip,t.initRequestCallback,s)}else s(e.EGAHTTPApiResponse.JsonEncodeFailed,null)},t.prototype.sendEventsInArray=function(n,s,r){if(0!=n.length){var o=i.getGameKey(),a=this.baseUrl+"/"+o+"/"+this.eventsUrlPath,l=JSON.stringify(n);if(l){var h=this.createPayloadData(l,this.useGzip),d=[];d.push(l),d.push(s),d.push(n.length.toString()),t.sendRequest(a,h,d,this.useGzip,t.sendEventInArrayRequestCallback,r)}else r(e.EGAHTTPApiResponse.JsonEncodeFailed,null,s,n.length)}},t.prototype.sendSdkErrorEvent=function(e,s,a,l,h,d,c){if(i.isEventSubmissionEnabled()&&r.validateSdkErrorEvent(d,c,e,s,a)){var u,p=this.baseUrl+"/"+d+"/"+this.eventsUrlPath,f="",g=i.getSdkErrorEventAnnotations(),m=t.sdkErrorCategoryString(e);g.error_category=m,f+=m;var v=t.sdkErrorAreaString(s);g.error_area=v,f+=":"+v;var _=t.sdkErrorActionString(a);g.error_action=_;var y=t.sdkErrorParameterString(l);if(y.length>0&&(g.error_parameter=y),h.length>0){var E=h;if(h.length>t.MAX_ERROR_MESSAGE_LENGTH)E=h.substring(0,t.MAX_ERROR_MESSAGE_LENGTH);g.reason=E}var b=[];b.push(g),(u=JSON.stringify(b))?o.execute(p,f,u,c):n.w("sendSdkErrorEvent: JSON encoding failed.")}},t.sendEventInArrayRequestCallback=function(n,s,r,o){void 0===o&&(o=null);o[0],o[1];var c,u,p=o[2],f=parseInt(o[3]);c=n.responseText,u=n.status;var g=t.instance.processRequestResponse(u,n.statusText,c,"Events");if(g==e.EGAHTTPApiResponse.Ok||g==e.EGAHTTPApiResponse.Created||g==e.EGAHTTPApiResponse.BadRequest){var m=c?JSON.parse(c):{};if(null==m)return r(e.EGAHTTPApiResponse.JsonDecodeFailed,null,p,f),void t.instance.sendSdkErrorEvent(a.Http,l.EventsHttp,h.FailHttpJsonDecode,d.Undefined,c,i.getGameKey(),i.getGameSecret());e.EGAHTTPApiResponse.BadRequest,r(g,m,p,f)}else r(g,null,p,f)},t.sendRequest=function(t,e,n,r,o,a){var l=new XMLHttpRequest,h=i.getGameSecret(),d=s.getHmac(h,e),c=[];for(var u in c.push(d),n)c.push(n[u]);if(l.onreadystatechange=function(){4===l.readyState&&o(l,t,a,c)},l.open("POST",t,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization",d),r)throw new Error("gzip not supported");try{l.send(e)}catch(t){console.error(t.stack)}},t.initRequestCallback=function(n,s,o,c){void 0===c&&(c=null);var u,p;c[0],c[1];u=n.responseText,p=n.status;var f=u?JSON.parse(u):{},g=t.instance.processRequestResponse(p,n.statusText,u,"Init");if(g==e.EGAHTTPApiResponse.Ok||g==e.EGAHTTPApiResponse.Created||g==e.EGAHTTPApiResponse.BadRequest){if(null==f)return o(e.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0),void t.instance.sendSdkErrorEvent(a.Http,l.InitHttp,h.FailHttpJsonDecode,d.Undefined,u,i.getGameKey(),i.getGameSecret());if(g!==e.EGAHTTPApiResponse.BadRequest){var m=r.validateAndCleanInitRequestResponse(f,g===e.EGAHTTPApiResponse.Created);m?o(g,m,"",0):o(e.EGAHTTPApiResponse.BadResponse,null,"",0)}else o(g,null,"",0)}else o(g,null,"",0)},t.prototype.createPayloadData=function(t,e){if(e)throw new Error("gzip not supported");return t},t.prototype.processRequestResponse=function(t,i,n,s){return n?200===t?e.EGAHTTPApiResponse.Ok:201===t?e.EGAHTTPApiResponse.Created:0===t||401===t?e.EGAHTTPApiResponse.Unauthorized:400===t?e.EGAHTTPApiResponse.BadRequest:500===t?e.EGAHTTPApiResponse.InternalServerError:e.EGAHTTPApiResponse.UnknownResponseCode:e.EGAHTTPApiResponse.NoResponse},t.sdkErrorCategoryString=function(t){switch(t){case a.EventValidation:return"event_validation";case a.Database:return"db";case a.Init:return"init";case a.Http:return"http";case a.Json:return"json"}return""},t.sdkErrorAreaString=function(t){switch(t){case l.BusinessEvent:return"business";case l.ResourceEvent:return"resource";case l.ProgressionEvent:return"progression";case l.DesignEvent:return"design";case l.ErrorEvent:return"error";case l.InitHttp:return"init_http";case l.EventsHttp:return"events_http";case l.ProcessEvents:return"process_events";case l.AddEventsToStore:return"add_events_to_store"}return""},t.sdkErrorActionString=function(t){switch(t){case h.InvalidCurrency:return"invalid_currency";case h.InvalidShortString:return"invalid_short_string";case h.InvalidEventPartLength:return"invalid_event_part_length";case h.InvalidEventPartCharacters:return"invalid_event_part_characters";case h.InvalidStore:return"invalid_store";case h.InvalidFlowType:return"invalid_flow_type";case h.StringEmptyOrNull:return"string_empty_or_null";case h.NotFoundInAvailableCurrencies:return"not_found_in_available_currencies";case h.InvalidAmount:return"invalid_amount";case h.NotFoundInAvailableItemTypes:return"not_found_in_available_item_types";case h.WrongProgressionOrder:return"wrong_progression_order";case h.InvalidEventIdLength:return"invalid_event_id_length";case h.InvalidEventIdCharacters:return"invalid_event_id_characters";case h.InvalidProgressionStatus:return"invalid_progression_status";case h.InvalidSeverity:return"invalid_severity";case h.InvalidLongString:return"invalid_long_string";case h.DatabaseTooLarge:return"db_too_large";case h.DatabaseOpenOrCreate:return"db_open_or_create";case h.JsonError:return"json_error";case h.FailHttpJsonDecode:return"fail_http_json_decode";case h.FailHttpJsonEncode:return"fail_http_json_encode"}return""},t.sdkErrorParameterString=function(t){switch(t){case d.Currency:return"currency";case d.CartType:return"cart_type";case d.ItemType:return"item_type";case d.ItemId:return"item_id";case d.Store:return"store";case d.FlowType:return"flow_type";case d.Amount:return"amount";case d.Progression01:return"progression01";case d.Progression02:return"progression02";case d.Progression03:return"progression03";case d.EventId:return"event_id";case d.ProgressionStatus:return"progression_status";case d.Severity:return"severity";case d.Message:return"message"}return""},t.instance=new t,t.MAX_ERROR_MESSAGE_LENGTH=256,t}();e.GAHTTPApi=c}(t.http||(t.http={}))}(o||(o={})),function(t){var e,i,n,s,r,o,a,l,h,d,c;e=t.events||(t.events={}),i=t.store.GAStore,n=t.store.EGAStore,s=t.store.EGAStoreArgsOperator,r=t.state.GAState,o=t.logging.GALogger,a=t.utilities.GAUtilities,l=t.http.EGAHTTPApiResponse,h=t.http.GAHTTPApi,d=t.validators.GAValidator,c=function(){function c(){}return c.customEventFieldsErrorCallback=function(e,i){if(r.isEventSubmissionEnabled()){var n=new Date;c.timestampMap[e]||(c.timestampMap[e]=n),c.countMap[e]||(c.countMap[e]=0),(n.getTime()-c.timestampMap[e].getTime())/1e3>=3600&&(c.timestampMap[e]=n,c.countMap[e]=0),c.countMap[e]>=c.MAX_ERROR_COUNT||t.threading.GAThreading.performTaskOnGAThread((function(){c.addErrorEvent(t.EGAErrorSeverity.Warning,i,null,!0),c.countMap[e]=c.countMap[e]+1}))}},c.addSessionStartEvent=function(){if(r.isEventSubmissionEnabled()){var t={};t.category=c.CategorySessionStart,r.incrementSessionNum(),i.setItem(r.getGameKey(),r.SessionNumKey,r.getSessionNum().toString()),c.addDimensionsToEvent(t);var e=r.instance.currentGlobalCustomEventFields;c.addCustomFieldsToEvent(t,r.validateAndCleanCustomFields(e,c.customEventFieldsErrorCallback)),c.addEventToStore(t),o.i("Add SESSION START event"),c.processEvents(c.CategorySessionStart,!1)}},c.addSessionEndEvent=function(){if(r.isEventSubmissionEnabled()){var t=r.getSessionStart(),e=r.getClientTsAdjusted()-t;e<0&&(o.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),e=0);var i={};i.category=c.CategorySessionEnd,i.length=e,c.addDimensionsToEvent(i);var n=r.instance.currentGlobalCustomEventFields;c.addCustomFieldsToEvent(i,r.validateAndCleanCustomFields(n,c.customEventFieldsErrorCallback)),c.addEventToStore(i),o.i("Add SESSION END event."),c.processEvents("",!1)}},c.addBusinessEvent=function(t,e,n,s,a,l,u){if(void 0===a&&(a=null),r.isEventSubmissionEnabled()){var p=d.validateBusinessEvent(t,e,a,n,s);if(null==p){var f={};r.incrementTransactionNum(),i.setItem(r.getGameKey(),r.TransactionNumKey,r.getTransactionNum().toString()),f.event_id=n+":"+s,f.category=c.CategoryBusiness,f.currency=t,f.amount=e,f[r.TransactionNumKey]=r.getTransactionNum(),a&&(f.cart_type=a),c.addDimensionsToEvent(f);var g={};if(l&&Object.keys(l).length>0)for(var m in l)g[m]=l[m];else for(var m in r.instance.currentGlobalCustomEventFields)g[m]=r.instance.currentGlobalCustomEventFields[m];if(u&&l&&Object.keys(l).length>0)for(var m in r.instance.currentGlobalCustomEventFields)g[m]||(g[m]=r.instance.currentGlobalCustomEventFields[m]);c.addCustomFieldsToEvent(f,r.validateAndCleanCustomFields(g,c.customEventFieldsErrorCallback)),o.i("Add BUSINESS event: {currency:"+t+", amount:"+e+", itemType:"+n+", itemId:"+s+", cartType:"+a+"}"),c.addEventToStore(f)}else h.instance.sendSdkErrorEvent(p.category,p.area,p.action,p.parameter,p.reason,r.getGameKey(),r.getGameSecret())}},c.addResourceEvent=function(e,i,n,s,a,l,u){if(r.isEventSubmissionEnabled()){var p=d.validateResourceEvent(e,i,n,s,a,r.getAvailableResourceCurrencies(),r.getAvailableResourceItemTypes());if(null==p){e===t.EGAResourceFlowType.Sink&&(n*=-1);var f={},g=c.resourceFlowTypeToString(e);f.event_id=g+":"+i+":"+s+":"+a,f.category=c.CategoryResource,f.amount=n,c.addDimensionsToEvent(f);var m={};if(l&&Object.keys(l).length>0)for(var v in l)m[v]=l[v];else for(var v in r.instance.currentGlobalCustomEventFields)m[v]=r.instance.currentGlobalCustomEventFields[v];if(u&&l&&Object.keys(l).length>0)for(var v in r.instance.currentGlobalCustomEventFields)m[v]||(m[v]=r.instance.currentGlobalCustomEventFields[v]);c.addCustomFieldsToEvent(f,r.validateAndCleanCustomFields(m,c.customEventFieldsErrorCallback)),o.i("Add RESOURCE event: {currency:"+i+", amount:"+n+", itemType:"+s+", itemId:"+a+"}"),c.addEventToStore(f)}else h.instance.sendSdkErrorEvent(p.category,p.area,p.action,p.parameter,p.reason,r.getGameKey(),r.getGameSecret())}},c.addProgressionEvent=function(e,i,n,s,a,l,u,p){if(r.isEventSubmissionEnabled()){var f=c.progressionStatusToString(e),g=d.validateProgressionEvent(e,i,n,s);if(null==g){var m,v={};m=n?s?i+":"+n+":"+s:i+":"+n:i,v.category=c.CategoryProgression,v.event_id=f+":"+m;var _=0;l&&e!=t.EGAProgressionStatus.Start&&(v.score=Math.round(a)),e===t.EGAProgressionStatus.Fail&&r.incrementProgressionTries(m),e===t.EGAProgressionStatus.Complete&&(r.incrementProgressionTries(m),_=r.getProgressionTries(m),v.attempt_num=_,r.clearProgressionTries(m)),c.addDimensionsToEvent(v);var y={};if(u&&Object.keys(u).length>0)for(var E in u)y[E]=u[E];else for(var E in r.instance.currentGlobalCustomEventFields)y[E]=r.instance.currentGlobalCustomEventFields[E];if(p&&u&&Object.keys(u).length>0)for(var E in r.instance.currentGlobalCustomEventFields)y[E]||(y[E]=r.instance.currentGlobalCustomEventFields[E]);c.addCustomFieldsToEvent(v,r.validateAndCleanCustomFields(y,c.customEventFieldsErrorCallback)),o.i("Add PROGRESSION event: {status:"+f+", progression01:"+i+", progression02:"+n+", progression03:"+s+", score:"+a+", attempt:"+_+"}"),c.addEventToStore(v)}else h.instance.sendSdkErrorEvent(g.category,g.area,g.action,g.parameter,g.reason,r.getGameKey(),r.getGameSecret())}},c.addDesignEvent=function(t,e,i,n,s){if(r.isEventSubmissionEnabled()){var a=d.validateDesignEvent(t);if(null==a){var l={};l.category=c.CategoryDesign,l.event_id=t,i&&(l.value=e),c.addDimensionsToEvent(l);var u={};if(n&&Object.keys(n).length>0)for(var p in n)u[p]=n[p];else for(var p in r.instance.currentGlobalCustomEventFields)u[p]=r.instance.currentGlobalCustomEventFields[p];if(s&&n&&Object.keys(n).length>0)for(var p in r.instance.currentGlobalCustomEventFields)u[p]||(u[p]=r.instance.currentGlobalCustomEventFields[p]);c.addCustomFieldsToEvent(l,r.validateAndCleanCustomFields(u,c.customEventFieldsErrorCallback)),o.i("Add DESIGN event: {eventId:"+t+", value:"+e+"}"),c.addEventToStore(l)}else h.instance.sendSdkErrorEvent(a.category,a.area,a.action,a.parameter,a.reason,r.getGameKey(),r.getGameSecret())}},c.addErrorEvent=function(t,e,i,n,s){if(void 0===s&&(s=!1),r.isEventSubmissionEnabled()){var a=c.errorSeverityToString(t),l=d.validateErrorEvent(t,e);if(null==l){var u={};if(u.category=c.CategoryError,u.severity=a,u.message=e,c.addDimensionsToEvent(u),!s){var p={};if(i&&Object.keys(i).length>0)for(var f in i)p[f]=i[f];else for(var f in r.instance.currentGlobalCustomEventFields)p[f]=r.instance.currentGlobalCustomEventFields[f];if(n&&i&&Object.keys(i).length>0)for(var f in r.instance.currentGlobalCustomEventFields)p[f]||(p[f]=r.instance.currentGlobalCustomEventFields[f]);c.addCustomFieldsToEvent(u,r.validateAndCleanCustomFields(p,c.customEventFieldsErrorCallback))}o.i("Add ERROR event: {severity:"+a+", message:"+e+"}"),c.addEventToStore(u)}else h.instance.sendSdkErrorEvent(l.category,l.area,l.action,l.parameter,l.reason,r.getGameKey(),r.getGameSecret())}},c.addAdEvent=function(e,i,n,s,a,l,u,p,f){if(r.isEventSubmissionEnabled()){var g=c.adActionToString(e),m=c.adTypeToString(i),v=c.adErrorToString(a),_=d.validateAdEvent(e,i,n,s);if(null==_){var y={};y.category=c.CategoryAds,y.ad_sdk_name=n,y.ad_placement=s,y.ad_type=m,y.ad_action=g,e==t.EGAAdAction.FailedShow&&v.length>0&&(y.ad_fail_show_reason=v),!u||i!=t.EGAAdType.RewardedVideo&&i!=t.EGAAdType.Video||(y.ad_duration=l),c.addDimensionsToEvent(y);var E={};if(p&&Object.keys(p).length>0)for(var b in p)E[b]=p[b];else for(var b in r.instance.currentGlobalCustomEventFields)E[b]=r.instance.currentGlobalCustomEventFields[b];if(f&&p&&Object.keys(p).length>0)for(var b in r.instance.currentGlobalCustomEventFields)E[b]||(E[b]=r.instance.currentGlobalCustomEventFields[b]);c.addCustomFieldsToEvent(y,r.validateAndCleanCustomFields(E,c.customEventFieldsErrorCallback)),o.i("Add AD event: {ad_sdk_name:"+n+", ad_placement:"+s+", ad_type:"+m+", ad_action:"+g+(e==t.EGAAdAction.FailedShow&&v.length>0?", ad_fail_show_reason:"+v:"")+(!u||i!=t.EGAAdType.RewardedVideo&&i!=t.EGAAdType.Video?"":", ad_duration:"+l)+"}"),c.addEventToStore(y)}else h.instance.sendSdkErrorEvent(_.category,_.area,_.action,_.parameter,_.reason,r.getGameKey(),r.getGameSecret())}},c.processEvents=function(t,l){if(r.isEventSubmissionEnabled())try{var u=a.createGuid();l&&(c.cleanupEvents(),c.fixMissingSessionEndEvents());var p=[];p.push(["status",s.Equal,"new"]);var f=[];f.push(["status",s.Equal,"new"]),t&&(p.push(["category",s.Equal,t]),f.push(["category",s.Equal,t]));var g=[];g.push(["status",u]);var m=i.select(n.Events,p);if(!m||0==m.length)return o.i("Event queue: No events to send"),void c.updateSessionStore();if(m.length>c.MaxEventCount){if(!(m=i.select(n.Events,p,!0,c.MaxEventCount)))return;var v=m[m.length-1].client_ts;if(p.push(["client_ts",s.LessOrEqual,v]),!(m=i.select(n.Events,p)))return;f.push(["client_ts",s.LessOrEqual,v])}if(o.i("Event queue: Sending "+m.length+" events."),!i.update(n.Events,g,f))return;for(var _=[],y=0;y<m.length;++y){var E=m[y],b=JSON.parse(a.decode64(E.event));if(0!=b.length){var A=b.client_ts;A&&!d.validateClientTs(A)&&delete b.client_ts,_.push(b)}}h.instance.sendEventsInArray(_,u,c.processEventsCallback)}catch(t){o.e("Error during ProcessEvents(): "+t.stack),h.instance.sendSdkErrorEvent(e.EGASdkErrorCategory.Json,e.EGASdkErrorArea.ProcessEvents,e.EGASdkErrorAction.JsonError,e.EGASdkErrorParameter.Undefined,t.stack,r.getGameKey(),r.getGameSecret())}},c.processEventsCallback=function(t,e,r,a){var h=[];if(h.push(["status",s.Equal,r]),t===l.Ok)i.delete(n.Events,h),o.i("Event queue: "+a+" events sent.");else if(t===l.NoResponse){var d=[];d.push(["status","new"]),o.w("Event queue: Failed to send events to collector - Retrying next time"),i.update(n.Events,d,h)}else{if(e){var c,u=0;for(var p in e)0==u&&(c=e[p]),++u;t===l.BadRequest&&c.constructor===Array?o.w("Event queue: "+a+" events sent. "+u+" events failed GA server validation."):o.w("Event queue: Failed to send events.")}else o.w("Event queue: Failed to send events.");i.delete(n.Events,h)}},c.cleanupEvents=function(){i.update(n.Events,[["status","new"]])},c.fixMissingSessionEndEvents=function(){if(r.isEventSubmissionEnabled()){var t=[];t.push(["session_id",s.NotEqual,r.getSessionId()]);var e=i.select(n.Sessions,t);if(e&&0!=e.length){o.i(e.length+" session(s) located with missing session_end event.");for(var l=0;l<e.length;++l){var h=JSON.parse(a.decode64(e[l].event)),d=h.client_ts-e[l].timestamp;d=Math.max(0,d),h.category=c.CategorySessionEnd,h.length=d,c.addEventToStore(h)}}}},c.addEventToStore=function(t){if(r.isEventSubmissionEnabled())if(r.isInitialized())try{if(i.isStoreTooLargeForEvents()&&!a.stringMatch(t.category,/^(user|session_end|business)$/))return o.w("Database too large. Event has been blocked."),void h.instance.sendSdkErrorEvent(e.EGASdkErrorCategory.Database,e.EGASdkErrorArea.AddEventsToStore,e.EGASdkErrorAction.DatabaseTooLarge,e.EGASdkErrorParameter.Undefined,"",r.getGameKey(),r.getGameSecret());var l=r.getEventAnnotations();for(var d in t)l[d]=t[d];var u=JSON.stringify(l);o.ii("Event added to queue: "+u);var p={status:"new"};p.category=l.category,p.session_id=l.session_id,p.client_ts=l.client_ts,p.event=a.encode64(JSON.stringify(l)),i.insert(n.Events,p),t.category==c.CategorySessionEnd?i.delete(n.Sessions,[["session_id",s.Equal,l.session_id]]):c.updateSessionStore(),i.isStorageAvailable()&&i.save(r.getGameKey())}catch(d){o.e("addEventToStore: error"),o.e(d.stack),h.instance.sendSdkErrorEvent(e.EGASdkErrorCategory.Database,e.EGASdkErrorArea.AddEventsToStore,e.EGASdkErrorAction.DatabaseTooLarge,e.EGASdkErrorParameter.Undefined,d.stack,r.getGameKey(),r.getGameSecret())}else o.w("Could not add event: SDK is not initialized")},c.updateSessionStore=function(){if(r.sessionIsStarted()){var t={};t.session_id=r.instance.sessionId,t.timestamp=r.getSessionStart();var e=r.getEventAnnotations();c.addDimensionsToEvent(e);var s=r.instance.currentGlobalCustomEventFields;c.addCustomFieldsToEvent(e,r.validateAndCleanCustomFields(s,c.customEventFieldsErrorCallback)),t.event=a.encode64(JSON.stringify(e)),i.insert(n.Sessions,t,!0,"session_id"),i.isStorageAvailable()&&i.save(r.getGameKey())}},c.addDimensionsToEvent=function(t){t&&(r.getCurrentCustomDimension01()&&(t.custom_01=r.getCurrentCustomDimension01()),r.getCurrentCustomDimension02()&&(t.custom_02=r.getCurrentCustomDimension02()),r.getCurrentCustomDimension03()&&(t.custom_03=r.getCurrentCustomDimension03()))},c.addCustomFieldsToEvent=function(t,e){t&&e&&Object.keys(e).length>0&&(t.custom_fields=e)},c.resourceFlowTypeToString=function(e){return e==t.EGAResourceFlowType.Source||e==t.EGAResourceFlowType[t.EGAResourceFlowType.Source]?"Source":e==t.EGAResourceFlowType.Sink||e==t.EGAResourceFlowType[t.EGAResourceFlowType.Sink]?"Sink":""},c.progressionStatusToString=function(e){return e==t.EGAProgressionStatus.Start||e==t.EGAProgressionStatus[t.EGAProgressionStatus.Start]?"Start":e==t.EGAProgressionStatus.Complete||e==t.EGAProgressionStatus[t.EGAProgressionStatus.Complete]?"Complete":e==t.EGAProgressionStatus.Fail||e==t.EGAProgressionStatus[t.EGAProgressionStatus.Fail]?"Fail":""},c.errorSeverityToString=function(e){return e==t.EGAErrorSeverity.Debug||e==t.EGAErrorSeverity[t.EGAErrorSeverity.Debug]?"debug":e==t.EGAErrorSeverity.Info||e==t.EGAErrorSeverity[t.EGAErrorSeverity.Info]?"info":e==t.EGAErrorSeverity.Warning||e==t.EGAErrorSeverity[t.EGAErrorSeverity.Warning]?"warning":e==t.EGAErrorSeverity.Error||e==t.EGAErrorSeverity[t.EGAErrorSeverity.Error]?"error":e==t.EGAErrorSeverity.Critical||e==t.EGAErrorSeverity[t.EGAErrorSeverity.Critical]?"critical":""},c.adActionToString=function(e){return e==t.EGAAdAction.Clicked||e==t.EGAAdAction[t.EGAAdAction.Clicked]?"clicked":e==t.EGAAdAction.Show||e==t.EGAAdAction[t.EGAAdAction.Show]?"show":e==t.EGAAdAction.FailedShow||e==t.EGAAdAction[t.EGAAdAction.FailedShow]?"failed_show":e==t.EGAAdAction.RewardReceived||e==t.EGAAdAction[t.EGAAdAction.RewardReceived]?"reward_received":""},c.adErrorToString=function(e){return e==t.EGAAdError.Unknown||e==t.EGAAdError[t.EGAAdError.Unknown]?"unknown":e==t.EGAAdError.Offline||e==t.EGAAdError[t.EGAAdError.Offline]?"offline":e==t.EGAAdError.NoFill||e==t.EGAAdError[t.EGAAdError.NoFill]?"no_fill":e==t.EGAAdError.InternalError||e==t.EGAAdError[t.EGAAdError.InternalError]?"internal_error":e==t.EGAAdError.InvalidRequest||e==t.EGAAdError[t.EGAAdError.InvalidRequest]?"invalid_request":e==t.EGAAdError.UnableToPrecache||e==t.EGAAdError[t.EGAAdError.UnableToPrecache]?"unable_to_precache":""},c.adTypeToString=function(e){return e==t.EGAAdType.Video||e==t.EGAAdType[t.EGAAdType.Video]?"video":e==t.EGAAdType.RewardedVideo||e==t.EGAAdError[t.EGAAdType.RewardedVideo]?"rewarded_video":e==t.EGAAdType.Playable||e==t.EGAAdError[t.EGAAdType.Playable]?"playable":e==t.EGAAdType.Interstitial||e==t.EGAAdError[t.EGAAdType.Interstitial]?"interstitial":e==t.EGAAdType.OfferWall||e==t.EGAAdError[t.EGAAdType.OfferWall]?"offer_wall":e==t.EGAAdType.Banner||e==t.EGAAdError[t.EGAAdType.Banner]?"banner":""},c.CategorySessionStart="user",c.CategorySessionEnd="session_end",c.CategoryDesign="design",c.CategoryBusiness="business",c.CategoryProgression="progression",c.CategoryResource="resource",c.CategoryError="error",c.CategoryAds="ads",c.MaxEventCount=500,c.MAX_ERROR_COUNT=10,c.countMap={},c.timestampMap={},c}(),e.GAEvents=c}(o||(o={})),function(t){!function(e){var i=t.logging.GALogger,n=t.state.GAState,s=t.events.GAEvents,r=function(){function t(){this.blocks=new e.PriorityQueue({compare:function(t,e){return t-e}}),this.id2TimedBlockMap={},t.startThread()}return t.createTimedBlock=function(t){void 0===t&&(t=0);var i=new Date;return i.setUTCSeconds(i.getUTCSeconds()+t),new e.TimedBlock(i)},t.performTaskOnGAThread=function(i,n){void 0===n&&(n=0);var s=new Date;s.setUTCSeconds(s.getUTCSeconds()+n);var r=new e.TimedBlock(s);r.block=i,t.instance.id2TimedBlockMap[r.id]=r,t.instance.addTimedBlock(r)},t.performTimedBlockOnGAThread=function(e){t.instance.id2TimedBlockMap[e.id]=e,t.instance.addTimedBlock(e)},t.scheduleTimer=function(i,n){var s=new Date;s.setUTCSeconds(s.getUTCSeconds()+i);var r=new e.TimedBlock(s);return r.block=n,t.instance.id2TimedBlockMap[r.id]=r,t.instance.addTimedBlock(r),r.id},t.getTimedBlockById=function(e){return e in t.instance.id2TimedBlockMap?t.instance.id2TimedBlockMap[e]:null},t.ensureEventQueueIsRunning=function(){t.instance.keepRunning=!0,t.instance.isRunning||(t.instance.isRunning=!0,t.scheduleTimer(t.ProcessEventsIntervalInSeconds,t.processEventQueue))},t.endSessionAndStopQueue=function(){n.isInitialized()&&(i.i("Ending session."),t.stopEventQueue(),n.isEnabled()&&n.sessionIsStarted()&&(s.addSessionEndEvent(),n.instance.sessionStart=0))},t.stopEventQueue=function(){t.instance.keepRunning=!1},t.ignoreTimer=function(e){e in t.instance.id2TimedBlockMap&&(t.instance.id2TimedBlockMap[e].ignore=!0)},t.setEventProcessInterval=function(e){e>0&&(t.ProcessEventsIntervalInSeconds=e)},t.prototype.addTimedBlock=function(t){this.blocks.enqueue(t.deadline.getTime(),t)},t.run=function(){clearTimeout(t.runTimeoutId);try{for(var e;e=t.getNextBlock();)if(!e.ignore)if(e.async){if(!e.running){e.running=!0,e.block();break}}else e.block();return void(t.runTimeoutId=setTimeout(t.run,t.ThreadWaitTimeInMs))}catch(t){i.e("Error on GA thread"),i.e(t.stack)}},t.startThread=function(){t.runTimeoutId=setTimeout(t.run,0)},t.getNextBlock=function(){var e=new Date;return t.instance.blocks.hasItems()&&t.instance.blocks.peek().deadline.getTime()<=e.getTime()?t.instance.blocks.peek().async&&t.instance.blocks.peek().running?t.instance.blocks.peek():t.instance.blocks.dequeue():null},t.processEventQueue=function(){s.processEvents("",!0),t.instance.keepRunning?t.scheduleTimer(t.ProcessEventsIntervalInSeconds,t.processEventQueue):t.instance.isRunning=!1},t.instance=new t,t.ThreadWaitTimeInMs=1e3,t.ProcessEventsIntervalInSeconds=8,t}();e.GAThreading=r}(t.threading||(t.threading={}))}(o||(o={})),function(t){var e=t.threading.GAThreading,n=t.logging.GALogger,s=t.store.GAStore,r=t.state.GAState,o=t.http.GAHTTPApi,a=t.device.GADevice,l=t.validators.GAValidator,h=t.http.EGAHTTPApiResponse,d=t.utilities.GAUtilities,c=t.events.GAEvents,u=function(){function u(){}return u.getGlobalObject=function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:void 0},u.init=function(){if(a.touch(),u.methodMap.configureAvailableCustomDimensions01=u.configureAvailableCustomDimensions01,u.methodMap.configureAvailableCustomDimensions02=u.configureAvailableCustomDimensions02,u.methodMap.configureAvailableCustomDimensions03=u.configureAvailableCustomDimensions03,u.methodMap.configureAvailableResourceCurrencies=u.configureAvailableResourceCurrencies,u.methodMap.configureAvailableResourceItemTypes=u.configureAvailableResourceItemTypes,u.methodMap.configureBuild=u.configureBuild,u.methodMap.configureSdkGameEngineVersion=u.configureSdkGameEngineVersion,u.methodMap.configureGameEngineVersion=u.configureGameEngineVersion,u.methodMap.configureUserId=u.configureUserId,u.methodMap.initialize=u.initialize,u.methodMap.addBusinessEvent=u.addBusinessEvent,u.methodMap.addResourceEvent=u.addResourceEvent,u.methodMap.addProgressionEvent=u.addProgressionEvent,u.methodMap.addDesignEvent=u.addDesignEvent,u.methodMap.addErrorEvent=u.addErrorEvent,u.methodMap.addAdEvent=u.addAdEvent,u.methodMap.setEnabledInfoLog=u.setEnabledInfoLog,u.methodMap.setEnabledVerboseLog=u.setEnabledVerboseLog,u.methodMap.setEnabledManualSessionHandling=u.setEnabledManualSessionHandling,u.methodMap.setEnabledEventSubmission=u.setEnabledEventSubmission,u.methodMap.setCustomDimension01=u.setCustomDimension01,u.methodMap.setCustomDimension02=u.setCustomDimension02,u.methodMap.setCustomDimension03=u.setCustomDimension03,u.methodMap.setGlobalCustomEventFields=u.setGlobalCustomEventFields,u.methodMap.setEventProcessInterval=u.setEventProcessInterval,u.methodMap.startSession=u.startSession,u.methodMap.endSession=u.endSession,u.methodMap.onStop=u.onStop,u.methodMap.onResume=u.onResume,u.methodMap.addRemoteConfigsListener=u.addRemoteConfigsListener,u.methodMap.removeRemoteConfigsListener=u.removeRemoteConfigsListener,u.methodMap.getRemoteConfigsValueAsString=u.getRemoteConfigsValueAsString,u.methodMap.isRemoteConfigsReady=u.isRemoteConfigsReady,u.methodMap.getRemoteConfigsContentAsString=u.getRemoteConfigsContentAsString,u.methodMap.addOnBeforeUnloadListener=u.addOnBeforeUnloadListener,u.methodMap.removeOnBeforeUnloadListener=u.removeOnBeforeUnloadListener,void 0!==u.getGlobalObject()&&void 0!==u.getGlobalObject().GameAnalytics&&void 0!==u.getGlobalObject().GameAnalytics.q){var t=u.getGlobalObject().GameAnalytics.q;for(var i in t)u.gaCommand.apply(null,t[i])}window.addEventListener("beforeunload",(function(t){console.log("addEventListener unload"),r.instance.isUnloading=!0,r.notifyBeforeUnloadListeners(),e.endSessionAndStopQueue(),r.instance.isUnloading=!1}))},u.gaCommand=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.length>0&&e[0]in t.GameAnalytics.methodMap&&(e.length>1?t.GameAnalytics.methodMap[e[0]].apply(null,Array.prototype.slice.call(e,1)):t.GameAnalytics.methodMap[e[0]]())},u.configureAvailableCustomDimensions01=function(t){void 0===t&&(t=[]),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions01(t)}))},u.configureAvailableCustomDimensions02=function(t){void 0===t&&(t=[]),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions02(t)}))},u.configureAvailableCustomDimensions03=function(t){void 0===t&&(t=[]),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Available custom dimensions must be set before SDK is initialized"):r.setAvailableCustomDimensions03(t)}))},u.configureAvailableResourceCurrencies=function(t){void 0===t&&(t=[]),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Available resource currencies must be set before SDK is initialized"):r.setAvailableResourceCurrencies(t)}))},u.configureAvailableResourceItemTypes=function(t){void 0===t&&(t=[]),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Available resource item types must be set before SDK is initialized"):r.setAvailableResourceItemTypes(t)}))},u.configureBuild=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("Build version must be set before SDK is initialized."):l.validateBuild(t)?r.setBuild(t):n.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+t)}))},u.configureSdkGameEngineVersion=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)||(l.validateSdkWrapperVersion(t)?a.sdkGameEngineVersion=t:n.i("Validation fail - configure sdk version: Sdk version not supported. String: "+t))}))},u.configureGameEngineVersion=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)||(l.validateEngineVersion(t)?a.gameEngineVersion=t:n.i("Validation fail - configure game engine version: Game engine version not supported. String: "+t))}))},u.configureUserId=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){u.isSdkReady(!0,!1)?n.w("A custom user id must be set before SDK is initialized."):l.validateUserId(t)?r.setUserId(t):n.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+t)}))},u.initialize=function(t,i){void 0===t&&(t=""),void 0===i&&(i=""),a.updateConnectionType();var s=e.createTimedBlock();s.async=!0,u.initTimedBlockId=s.id,s.block=function(){u.isSdkReady(!0,!1)?n.w("SDK already initialized. Can only be called once."):l.validateKeys(t,i)?(r.setKeys(t,i),u.internalInitialize()):n.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+t+", secretKey: "+i)},e.performTimedBlockOnGAThread(s)},u.addBusinessEvent=function(t,i,n,s,o,l,h){if(void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=""),void 0===s&&(s=""),void 0===o&&(o=""),void 0===l&&(l={}),void 0===h&&(h=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add business event"))return;c.addBusinessEvent(t,i,n,s,o,l,h)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add business event")&&c.addBusinessEvent(t,i,n,s,o,l,h)}))},u.addResourceEvent=function(i,n,s,o,l,h,d){if(void 0===i&&(i=t.EGAResourceFlowType.Undefined),void 0===n&&(n=""),void 0===s&&(s=0),void 0===o&&(o=""),void 0===l&&(l=""),void 0===h&&(h={}),void 0===d&&(d=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add resource event"))return;c.addResourceEvent(i,n,s,o,l,h,d)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add resource event")&&c.addResourceEvent(i,n,s,o,l,h,d)}))},u.addProgressionEvent=function(i,n,s,o,l,h,d){if(void 0===i&&(i=t.EGAProgressionStatus.Undefined),void 0===n&&(n=""),void 0===s&&(s=""),void 0===o&&(o=""),void 0===h&&(h={}),void 0===d&&(d=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add progression event"))return;var p="number"==typeof l;c.addProgressionEvent(i,n,s,o,p?l:0,p,h,d)}else e.performTaskOnGAThread((function(){if(u.isSdkReady(!0,!0,"Could not add progression event")){var t="number"==typeof l;c.addProgressionEvent(i,n,s,o,t?l:0,t,h,d)}}))},u.addDesignEvent=function(t,i,n,s){if(void 0===n&&(n={}),void 0===s&&(s=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add design event"))return;var o="number"==typeof i;c.addDesignEvent(t,o?i:0,o,n,s)}else e.performTaskOnGAThread((function(){if(u.isSdkReady(!0,!0,"Could not add design event")){var e="number"==typeof i;c.addDesignEvent(t,e?i:0,e,n,s)}}))},u.addErrorEvent=function(i,n,s,o){if(void 0===i&&(i=t.EGAErrorSeverity.Undefined),void 0===n&&(n=""),void 0===s&&(s={}),void 0===o&&(o=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add error event"))return;c.addErrorEvent(i,n,s,o)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add error event")&&c.addErrorEvent(i,n,s,o)}))},u.addAdEventWithNoAdReason=function(i,n,s,o,l,h,d){if(void 0===i&&(i=t.EGAAdAction.Undefined),void 0===n&&(n=t.EGAAdType.Undefined),void 0===s&&(s=""),void 0===o&&(o=""),void 0===l&&(l=t.EGAAdError.Undefined),void 0===h&&(h={}),void 0===d&&(d=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add ad event"))return;c.addAdEvent(i,n,s,o,l,0,!1,h,d)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add ad event")&&c.addAdEvent(i,n,s,o,l,0,!1,h,d)}))},u.addAdEventWithDuration=function(i,n,s,o,l,h,d){if(void 0===i&&(i=t.EGAAdAction.Undefined),void 0===n&&(n=t.EGAAdType.Undefined),void 0===s&&(s=""),void 0===o&&(o=""),void 0===l&&(l=0),void 0===h&&(h={}),void 0===d&&(d=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add ad event"))return;c.addAdEvent(i,n,s,o,t.EGAAdError.Undefined,l,!0,h,d)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add ad event")&&c.addAdEvent(i,n,s,o,t.EGAAdError.Undefined,l,!0,h,d)}))},u.addAdEvent=function(i,n,s,o,l,h){if(void 0===i&&(i=t.EGAAdAction.Undefined),void 0===n&&(n=t.EGAAdType.Undefined),void 0===s&&(s=""),void 0===o&&(o=""),void 0===l&&(l={}),void 0===h&&(h=!1),a.updateConnectionType(),r.instance.isUnloading){if(!u.isSdkReady(!0,!0,"Could not add ad event"))return;c.addAdEvent(i,n,s,o,t.EGAAdError.Undefined,0,!1,l,h)}else e.performTaskOnGAThread((function(){u.isSdkReady(!0,!0,"Could not add ad event")&&c.addAdEvent(i,n,s,o,t.EGAAdError.Undefined,0,!1,l,h)}))},u.setEnabledInfoLog=function(t){void 0===t&&(t=!1),e.performTaskOnGAThread((function(){t?(n.setInfoLog(t),n.i("Info logging enabled")):(n.i("Info logging disabled"),n.setInfoLog(t))}))},u.setEnabledVerboseLog=function(t){void 0===t&&(t=!1),e.performTaskOnGAThread((function(){t?(n.setVerboseLog(t),n.i("Verbose logging enabled")):(n.i("Verbose logging disabled"),n.setVerboseLog(t))}))},u.setEnabledManualSessionHandling=function(t){void 0===t&&(t=!1),e.performTaskOnGAThread((function(){r.setManualSessionHandling(t)}))},u.setEnabledEventSubmission=function(t){void 0===t&&(t=!1),e.performTaskOnGAThread((function(){t?(r.setEnabledEventSubmission(t),n.i("Event submission enabled")):(n.i("Event submission disabled"),r.setEnabledEventSubmission(t))}))},u.setCustomDimension01=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){l.validateDimension01(t,r.getAvailableCustomDimensions01())?r.setCustomDimension01(t):n.w("Could not set custom01 dimension value to '"+t+"'. Value not found in available custom01 dimension values")}))},u.setCustomDimension02=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){l.validateDimension02(t,r.getAvailableCustomDimensions02())?r.setCustomDimension02(t):n.w("Could not set custom02 dimension value to '"+t+"'. Value not found in available custom02 dimension values")}))},u.setCustomDimension03=function(t){void 0===t&&(t=""),e.performTaskOnGAThread((function(){l.validateDimension03(t,r.getAvailableCustomDimensions03())?r.setCustomDimension03(t):n.w("Could not set custom03 dimension value to '"+t+"'. Value not found in available custom03 dimension values")}))},u.setGlobalCustomEventFields=function(t){void 0===t&&(t={}),e.performTaskOnGAThread((function(){n.i("Set global custom event fields: "+JSON.stringify(t)),r.instance.currentGlobalCustomEventFields=t}))},u.setEventProcessInterval=function(t){e.performTaskOnGAThread((function(){e.setEventProcessInterval(t)}))},u.startSession=function(){if(r.isInitialized()){var t=e.createTimedBlock();t.async=!0,u.initTimedBlockId=t.id,t.block=function(){r.isEnabled()&&r.sessionIsStarted()&&e.endSessionAndStopQueue(),u.resumeSessionAndStartQueue()},e.performTimedBlockOnGAThread(t)}},u.endSession=function(){u.onStop()},u.onStop=function(){e.performTaskOnGAThread((function(){try{e.endSessionAndStopQueue()}catch(t){}}))},u.onResume=function(){var t=e.createTimedBlock();t.async=!0,u.initTimedBlockId=t.id,t.block=function(){u.resumeSessionAndStartQueue()},e.performTimedBlockOnGAThread(t)},u.getRemoteConfigsValueAsString=function(t,e){return void 0===e&&(e=null),r.getConfigurationStringValue(t,e)},u.isRemoteConfigsReady=function(){return r.isRemoteConfigsReady()},u.addRemoteConfigsListener=function(t){r.addRemoteConfigsListener(t)},u.removeRemoteConfigsListener=function(t){r.removeRemoteConfigsListener(t)},u.getRemoteConfigsContentAsString=function(){return r.getRemoteConfigsContentAsString()},u.getABTestingId=function(){return r.getABTestingId()},u.getABTestingVariantId=function(){return r.getABTestingVariantId()},u.addOnBeforeUnloadListener=function(t){r.addOnBeforeUnloadListener(t)},u.removeOnBeforeUnloadListener=function(t){r.removeOnBeforeUnloadListener(t)},u.internalInitialize=function(){r.ensurePersistedStates(),s.setItem(r.getGameKey(),r.DefaultUserIdKey,r.getDefaultId()),r.setInitialized(!0),u.newSession(),r.isEnabled()&&e.ensureEventQueueIsRunning()},u.newSession=function(){n.i("Starting a new session."),r.validateAndFixCurrentDimensions(),o.instance.requestInit(r.instance.configsHash,u.startNewSessionCallback)},u.startNewSessionCallback=function(t,i){if(t!==h.Ok&&t!==h.Created||!i)t==h.Unauthorized?(n.w("Initialize SDK failed - Unauthorized"),r.instance.initAuthorized=!1):(t===h.NoResponse||t===h.RequestTimeout?n.i("Init call (session start) failed - no response. Could be offline or timeout."):t===h.BadResponse||t===h.JsonEncodeFailed||t===h.JsonDecodeFailed?n.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):t!==h.BadRequest&&t!==h.UnknownResponseCode||n.i("Init call (session start) failed - bad request or unknown response."),null==r.instance.sdkConfig?null!=r.instance.sdkConfigCached?(n.i("Init call (session start) failed - using cached init values."),r.instance.sdkConfig=r.instance.sdkConfigCached):(n.i("Init call (session start) failed - using default init values."),r.instance.sdkConfig=r.instance.sdkConfigDefault):n.i("Init call (session start) failed - using cached init values."),r.instance.initAuthorized=!0);else{var o=0;if(i.server_ts){var a=i.server_ts;o=r.calculateServerTimeOffset(a)}if(i.time_offset=o,t!=h.Created){var l=r.getSdkConfig();l.configs&&(i.configs=l.configs),l.configs_hash&&(i.configs_hash=l.configs_hash),l.ab_id&&(i.ab_id=l.ab_id),l.ab_variant_id&&(i.ab_variant_id=l.ab_variant_id)}r.instance.configsHash=i.configs_hash?i.configs_hash:"",r.instance.abId=i.ab_id?i.ab_id:"",r.instance.abVariantId=i.ab_variant_id?i.ab_variant_id:"",s.setItem(r.getGameKey(),r.SdkConfigCachedKey,d.encode64(JSON.stringify(i))),r.instance.sdkConfigCached=i,r.instance.sdkConfig=i,r.instance.initAuthorized=!0}if(r.instance.clientServerTimeOffset=r.getSdkConfig().time_offset?r.getSdkConfig().time_offset:0,r.populateConfigurations(r.getSdkConfig()),!r.isEnabled())return n.w("Could not start session: SDK is disabled."),void e.stopEventQueue();e.ensureEventQueueIsRunning();var p=d.createGuid();r.instance.sessionId=p,r.instance.sessionStart=r.getClientTsAdjusted(),c.addSessionStartEvent();var f=e.getTimedBlockById(u.initTimedBlockId);null!=f&&(f.running=!1),u.initTimedBlockId=-1},u.resumeSessionAndStartQueue=function(){r.isInitialized()&&(n.i("Resuming session."),r.sessionIsStarted()||u.newSession())},u.isSdkReady=function(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=""),i&&(i+=": "),t&&!r.isInitialized()?(e&&n.w(i+"SDK is not initialized"),!1):t&&!r.isEnabled()?(e&&n.w(i+"SDK is disabled"),!1):!(t&&!r.sessionIsStarted())||(e&&n.w(i+"Session has not started yet"),!1)},u.initTimedBlockId=-1,u.methodMap={},u}();t.GameAnalytics=u}(o||(o={})),o.GameAnalytics.init();o.GameAnalytics.gaCommand;t.exports=o},210:(t,e,i)=>{"use strict";var n,s=SyntaxError,r=Function,o=TypeError,a=function(t){try{return r('"use strict"; return ('+t+").constructor;")()}catch(t){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(t){l=null}var h=function(){throw new o},d=l?function(){try{return h}catch(t){try{return l(arguments,"callee").get}catch(t){return h}}}():h,c=i(405)(),u=i(185)(),p=Object.getPrototypeOf||(u?function(t){return t.__proto__}:null),f={},g="undefined"!=typeof Uint8Array&&p?p(Uint8Array):n,m={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":c&&p?p([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":c&&p?p(p([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&c&&p?p((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&c&&p?p((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":c&&p?p(""[Symbol.iterator]()):n,"%Symbol%":c?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":d,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(p)try{null.error}catch(t){var v=p(p(t));m["%Error.prototype%"]=v}var _=function t(e){var i;if("%AsyncFunction%"===e)i=a("async function () {}");else if("%GeneratorFunction%"===e)i=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=a("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var s=t("%AsyncGenerator%");s&&p&&(i=p(s.prototype))}return m[e]=i,i},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},E=i(612),b=i(642),A=E.call(Function.call,Array.prototype.concat),T=E.call(Function.apply,Array.prototype.splice),x=E.call(Function.call,String.prototype.replace),S=E.call(Function.call,String.prototype.slice),w=E.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,R=function(t,e){var i,n=t;if(b(y,n)&&(n="%"+(i=y[n])[0]+"%"),b(m,n)){var r=m[n];if(r===f&&(r=_(n)),void 0===r&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new s("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===w(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=S(t,0,1),i=S(t,-1);if("%"===e&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return x(t,C,(function(t,e,i,s){n[n.length]=i?x(s,I,"$1"):e||t})),n}(t),n=i.length>0?i[0]:"",r=R("%"+n+"%",e),a=r.name,h=r.value,d=!1,c=r.alias;c&&(n=c[0],T(i,A([0,1],c)));for(var u=1,p=!0;u<i.length;u+=1){var f=i[u],g=S(f,0,1),v=S(f,-1);if(('"'===g||"'"===g||"`"===g||'"'===v||"'"===v||"`"===v)&&g!==v)throw new s("property names with quotes must have matching quotes");if("constructor"!==f&&p||(d=!0),b(m,a="%"+(n+="."+f)+"%"))h=m[a];else if(null!=h){if(!(f in h)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var _=l(h,f);h=(p=!!_)&&"get"in _&&!("originalValue"in _.get)?_.get:h[f]}else p=b(h,f),h=h[f];p&&!d&&(m[a]=h)}}return h}},521:function(t,e){!function(t){"use strict";function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var n,s,r,o,a,l,h,d,c,u,p,f,g,m,v,_,y,E={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},b={duration:.5,overwrite:!1,delay:0},A=1e8,T=1/A,x=2*Math.PI,S=x/4,w=0,C=Math.sqrt,I=Math.cos,R=Math.sin,P=function(t){return"string"==typeof t},L=function(t){return"function"==typeof t},M=function(t){return"number"==typeof t},D=function(t){return void 0===t},O=function(t){return"object"==typeof t},k=function(t){return!1!==t},B=function(){return"undefined"!=typeof window},F=function(t){return L(t)||P(t)},N="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},G=Array.isArray,U=/(?:-?\.?\d|\.)+/gi,H=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,V=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,z=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,j=/[+-]=-?[.\d]+/,W=/[^,'"\[\]\s]+/gi,X=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,K={},Y={},$=function(t){return(Y=St(t,K))&&zi},q=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Z=function(t,e){return!e&&console.warn(t)},Q=function(t,e){return t&&(K[t]=e)&&Y&&(Y[t]=e)||K},J=function(){return 0},tt={suppressEvents:!0,isStart:!0,kill:!1},et={suppressEvents:!0,kill:!1},it={suppressEvents:!0},nt={},st=[],rt={},ot={},at={},lt=30,ht=[],dt="",ct=function(t){var e,i,n=t[0];if(O(n)||L(n)||(t=[t]),!(e=(n._gsap||{}).harness)){for(i=ht.length;i--&&!ht[i].targetTest(n););e=ht[i]}for(i=t.length;i--;)t[i]&&(t[i]._gsap||(t[i]._gsap=new Je(t[i],e)))||t.splice(i,1);return t},ut=function(t){return t._gsap||ct(le(t))[0]._gsap},pt=function(t,e,i){return(i=t[e])&&L(i)?t[e]():D(i)&&t.getAttribute&&t.getAttribute(e)||i},ft=function(t,e){return(t=t.split(",")).forEach(e)||t},gt=function(t){return Math.round(1e5*t)/1e5||0},mt=function(t){return Math.round(1e7*t)/1e7||0},vt=function(t,e){var i=e.charAt(0),n=parseFloat(e.substr(2));return t=parseFloat(t),"+"===i?t+n:"-"===i?t-n:"*"===i?t*n:t/n},_t=function(t,e){for(var i=e.length,n=0;t.indexOf(e[n])<0&&++n<i;);return n<i},yt=function(){var t,e,i=st.length,n=st.slice(0);for(rt={},st.length=0,t=0;t<i;t++)(e=n[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Et=function(t,e,i,n){st.length&&!s&&yt(),t.render(e,i,n||s&&e<0&&(t._initted||t._startAt)),st.length&&!s&&yt()},bt=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(W).length<2?e:P(t)?t.trim():t},At=function(t){return t},Tt=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},xt=function(t){return function(e,i){for(var n in i)n in e||"duration"===n&&t||"ease"===n||(e[n]=i[n])}},St=function(t,e){for(var i in e)t[i]=e[i];return t},wt=function t(e,i){for(var n in i)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(e[n]=O(i[n])?t(e[n]||(e[n]={}),i[n]):i[n]);return e},Ct=function(t,e){var i,n={};for(i in t)i in e||(n[i]=t[i]);return n},It=function(t){var e=t.parent||o,i=t.keyframes?xt(G(t.keyframes)):Tt;if(k(t.inherit))for(;e;)i(t,e.vars.defaults),e=e.parent||e._dp;return t},Rt=function(t,e){for(var i=t.length,n=i===e.length;n&&i--&&t[i]===e[i];);return i<0},Pt=function(t,e,i,n,s){void 0===i&&(i="_first"),void 0===n&&(n="_last");var r,o=t[n];if(s)for(r=e[s];o&&o[s]>r;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[n]=e,e._prev=o,e.parent=e._dp=t,e},Lt=function(t,e,i,n){void 0===i&&(i="_first"),void 0===n&&(n="_last");var s=e._prev,r=e._next;s?s._next=r:t[i]===e&&(t[i]=r),r?r._prev=s:t[n]===e&&(t[n]=s),e._next=e._prev=e.parent=null},Mt=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},Dt=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},Ot=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},kt=function(t,e,i,n){return t._startAt&&(s?t._startAt.revert(et):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,n))},Bt=function t(e){return!e||e._ts&&t(e.parent)},Ft=function(t){return t._repeat?Nt(t._tTime,t=t.duration()+t._rDelay)*t:0},Nt=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},Gt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Ut=function(t){return t._end=mt(t._start+(t._tDur/Math.abs(t._ts||t._rts||T)||0))},Ht=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=mt(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Ut(t),i._dirty||Dt(i,t)),t},Vt=function(t,e){var i;if((e._time||e._initted&&!e._dur)&&(i=Gt(t.rawTime(),e),(!e._dur||ie(0,e.totalDuration(),i)-e._tTime>T)&&e.render(i,!0)),Dt(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-T}},zt=function(t,e,i,n){return e.parent&&Mt(e),e._start=mt((M(i)?i:i||t!==o?Jt(t,i,e):t._time)+e._delay),e._end=mt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Pt(t,e,"_first","_last",t._sort?"_start":0),Kt(e)||(t._recent=e),n||Vt(t,e),t._ts<0&&Ht(t,t._tTime),t},jt=function(t,e){return(K.ScrollTrigger||q("scrollTrigger",e))&&K.ScrollTrigger.create(e,t)},Wt=function(t,e,i,n,r){return li(t,e,r),t._initted?!i&&t._pt&&!s&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&c!==Ne.frame?(st.push(t),t._lazy=[r,n],1):void 0:1},Xt=function t(e){var i=e.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||t(i))},Kt=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},Yt=function(t,e,i,n){var r,o,a,l=t.ratio,h=e<0||!e&&(!t._start&&Xt(t)&&(t._initted||!Kt(t))||(t._ts<0||t._dp._ts<0)&&!Kt(t))?0:1,d=t._rDelay,c=0;if(d&&t._repeat&&(c=ie(0,t._tDur,e),o=Nt(c,d),t._yoyo&&1&o&&(h=1-h),o!==Nt(t._tTime,d)&&(l=1-h,t.vars.repeatRefresh&&t._initted&&t.invalidate())),h!==l||s||n||t._zTime===T||!e&&t._zTime){if(!t._initted&&Wt(t,e,n,i,c))return;for(a=t._zTime,t._zTime=e||(i?T:0),i||(i=e&&!a),t.ratio=h,t._from&&(h=1-h),t._time=0,t._tTime=c,r=t._pt;r;)r.r(h,r.d),r=r._next;e<0&&kt(t,e,i,!0),t._onUpdate&&!i&&Se(t,"onUpdate"),c&&t._repeat&&!i&&t.parent&&Se(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===h&&(h&&Mt(t,1),i||s||(Se(t,h?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},$t=function(t,e,i){var n;if(i>e)for(n=t._first;n&&n._start<=i;){if("isPause"===n.data&&n._start>e)return n;n=n._next}else for(n=t._last;n&&n._start>=i;){if("isPause"===n.data&&n._start<e)return n;n=n._prev}},qt=function(t,e,i,n){var s=t._repeat,r=mt(e)||0,o=t._tTime/t._tDur;return o&&!n&&(t._time*=r/t._dur),t._dur=r,t._tDur=s?s<0?1e10:mt(r*(s+1)+t._rDelay*s):r,o>0&&!n&&Ht(t,t._tTime=t._tDur*o),t.parent&&Ut(t),i||Dt(t.parent,t),t},Zt=function(t){return t instanceof ei?Dt(t):qt(t,t._dur)},Qt={_start:0,endTime:J,totalDuration:J},Jt=function t(e,i,n){var s,r,o,a=e.labels,l=e._recent||Qt,h=e.duration()>=A?l.endTime(!1):e._dur;return P(i)&&(isNaN(i)||i in a)?(r=i.charAt(0),o="%"===i.substr(-1),s=i.indexOf("="),"<"===r||">"===r?(s>=0&&(i=i.replace(/=/,"")),("<"===r?l._start:l.endTime(l._repeat>=0))+(parseFloat(i.substr(1))||0)*(o?(s<0?l:n).totalDuration()/100:1)):s<0?(i in a||(a[i]=h),a[i]):(r=parseFloat(i.charAt(s-1)+i.substr(s+1)),o&&n&&(r=r/100*(G(n)?n[0]:n).totalDuration()),s>1?t(e,i.substr(0,s-1),n)+r:h+r)):null==i?h:+i},te=function(t,e,i){var n,s,r=M(e[1]),o=(r?2:1)+(t<2?0:1),a=e[o];if(r&&(a.duration=e[1]),a.parent=i,t){for(n=a,s=i;s&&!("immediateRender"in n);)n=s.vars.defaults||{},s=k(s.vars.inherit)&&s.parent;a.immediateRender=k(n.immediateRender),t<2?a.runBackwards=1:a.startAt=e[o-1]}return new gi(e[0],a,e[o+1])},ee=function(t,e){return t||0===t?e(t):e},ie=function(t,e,i){return i<t?t:i>e?e:i},ne=function(t,e){return P(t)&&(e=X.exec(t))?e[1]:""},se=function(t,e,i){return ee(i,(function(i){return ie(t,e,i)}))},re=[].slice,oe=function(t,e){return t&&O(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&O(t[0]))&&!t.nodeType&&t!==a},ae=function(t,e,i){return void 0===i&&(i=[]),t.forEach((function(t){var n;return P(t)&&!e||oe(t,1)?(n=i).push.apply(n,le(t)):i.push(t)}))||i},le=function(t,e,i){return r&&!e&&r.selector?r.selector(t):!P(t)||i||!l&&Ge()?G(t)?ae(t,i):oe(t)?re.call(t,0):t?[t]:[]:re.call((e||h).querySelectorAll(t),0)},he=function(t){return t=le(t)[0]||Z("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return le(e,i.querySelectorAll?i:i===t?Z("Invalid scope")||h.createElement("div"):t)}},de=function(t){return t.sort((function(){return.5-Math.random()}))},ce=function(t){if(L(t))return t;var e=O(t)?t:{each:t},i=Ye(e.ease),n=e.from||0,s=parseFloat(e.base)||0,r={},o=n>0&&n<1,a=isNaN(n)||o,l=e.axis,h=n,d=n;return P(n)?h=d={center:.5,edges:.5,end:1}[n]||0:!o&&a&&(h=n[0],d=n[1]),function(t,o,c){var u,p,f,g,m,v,_,y,E,b=(c||e).length,T=r[b];if(!T){if(!(E="auto"===e.grid?0:(e.grid||[1,A])[1])){for(_=-A;_<(_=c[E++].getBoundingClientRect().left)&&E<b;);E--}for(T=r[b]=[],u=a?Math.min(E,b)*h-.5:n%E,p=E===A?0:a?b*d/E-.5:n/E|0,_=0,y=A,v=0;v<b;v++)f=v%E-u,g=p-(v/E|0),T[v]=m=l?Math.abs("y"===l?g:f):C(f*f+g*g),m>_&&(_=m),m<y&&(y=m);"random"===n&&de(T),T.max=_-y,T.min=y,T.v=b=(parseFloat(e.amount)||parseFloat(e.each)*(E>b?b-1:l?"y"===l?b/E:E:Math.max(E,b/E))||0)*("edges"===n?-1:1),T.b=b<0?s-b:s,T.u=ne(e.amount||e.each)||0,i=i&&b<0?Xe(i):i}return b=(T[t]-T.min)/T.max||0,mt(T.b+(i?i(b):b)*T.v)+T.u}},ue=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var n=mt(Math.round(parseFloat(i)/t)*t*e);return(n-n%1)/e+(M(i)?0:ne(i))}},pe=function(t,e){var i,n,s=G(t);return!s&&O(t)&&(i=s=t.radius||A,t.values?(t=le(t.values),(n=!M(t[0]))&&(i*=i)):t=ue(t.increment)),ee(e,s?L(t)?function(e){return n=t(e),Math.abs(n-e)<=i?n:e}:function(e){for(var s,r,o=parseFloat(n?e.x:e),a=parseFloat(n?e.y:0),l=A,h=0,d=t.length;d--;)(s=n?(s=t[d].x-o)*s+(r=t[d].y-a)*r:Math.abs(t[d]-o))<l&&(l=s,h=d);return h=!i||l<=i?t[h]:e,n||h===e||M(e)?h:h+ne(e)}:ue(t))},fe=function(t,e,i,n){return ee(G(t)?!e:!0===i?!!(i=0):!n,(function(){return G(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(n=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+.99*i))/i)*i*n)/n}))},ge=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},me=function(t,e){return function(i){return t(parseFloat(i))+(e||ne(i))}},ve=function(t,e,i){return Ae(t,e,0,1,i)},_e=function(t,e,i){return ee(i,(function(i){return t[~~e(i)]}))},ye=function t(e,i,n){var s=i-e;return G(e)?_e(e,t(0,e.length),i):ee(n,(function(t){return(s+(t-e)%s)%s+e}))},Ee=function t(e,i,n){var s=i-e,r=2*s;return G(e)?_e(e,t(0,e.length-1),i):ee(n,(function(t){return e+((t=(r+(t-e)%r)%r||0)>s?r-t:t)}))},be=function(t){for(var e,i,n,s,r=0,o="";~(e=t.indexOf("random(",r));)n=t.indexOf(")",e),s="["===t.charAt(e+7),i=t.substr(e+7,n-e-7).match(s?W:U),o+=t.substr(r,e-r)+fe(s?i:+i[0],s?0:+i[1],+i[2]||1e-5),r=n+1;return o+t.substr(r,t.length-r)},Ae=function(t,e,i,n,s){var r=e-t,o=n-i;return ee(s,(function(e){return i+((e-t)/r*o||0)}))},Te=function t(e,i,n,s){var r=isNaN(e+i)?0:function(t){return(1-t)*e+t*i};if(!r){var o,a,l,h,d,c=P(e),u={};if(!0===n&&(s=1)&&(n=null),c)e={p:e},i={p:i};else if(G(e)&&!G(i)){for(l=[],h=e.length,d=h-2,a=1;a<h;a++)l.push(t(e[a-1],e[a]));h--,r=function(t){t*=h;var e=Math.min(d,~~t);return l[e](t-e)},n=i}else s||(e=St(G(e)?[]:{},e));if(!l){for(o in i)ri.call(u,e,o,"get",i[o]);r=function(t){return xi(t,u)||(c?e.p:e)}}}return ee(n,r)},xe=function(t,e,i){var n,s,r,o=t.labels,a=A;for(n in o)(s=o[n]-e)<0==!!i&&s&&a>(s=Math.abs(s))&&(r=n,a=s);return r},Se=function(t,e,i){var n,s,o,a=t.vars,l=a[e],h=r,d=t._ctx;if(l)return n=a[e+"Params"],s=a.callbackScope||t,i&&st.length&&yt(),d&&(r=d),o=n?l.apply(s,n):l.call(s),r=h,o},we=function(t){return Mt(t),t.scrollTrigger&&t.scrollTrigger.kill(!!s),t.progress()<1&&Se(t,"onInterrupt"),t},Ce=[],Ie=function(t){if(B()&&t){var e=(t=!t.name&&t.default||t).name,i=L(t),n=e&&!i&&t.init?function(){this._props=[]}:t,s={init:J,render:xi,add:ri,kill:wi,modifier:Si,rawVars:0},r={targetTest:0,get:0,getSetter:Ei,aliases:{},register:0};if(Ge(),t!==n){if(ot[e])return;Tt(n,Tt(Ct(t,s),r)),St(n.prototype,St(s,Ct(t,r))),ot[n.prop=e]=n,t.targetTest&&(ht.push(n),nt[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}Q(e,n),t.register&&t.register(zi,n,Ri)}else t&&Ce.push(t)},Re=255,Pe={aqua:[0,Re,Re],lime:[0,Re,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Re],navy:[0,0,128],white:[Re,Re,Re],olive:[128,128,0],yellow:[Re,Re,0],orange:[Re,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Re,0,0],pink:[Re,192,203],cyan:[0,Re,Re],transparent:[Re,Re,Re,0]},Le=function(t,e,i){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(i-e)*t*6:t<.5?i:3*t<2?e+(i-e)*(2/3-t)*6:e)*Re+.5|0},Me=function(t,e,i){var n,s,r,o,a,l,h,d,c,u,p=t?M(t)?[t>>16,t>>8&Re,t&Re]:0:Pe.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Pe[t])p=Pe[t];else if("#"===t.charAt(0)){if(t.length<6&&(n=t.charAt(1),s=t.charAt(2),r=t.charAt(3),t="#"+n+n+s+s+r+r+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&Re,p&Re,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&Re,t&Re]}else if("hsl"===t.substr(0,3))if(p=u=t.match(U),e){if(~t.indexOf("="))return p=t.match(H),i&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,n=2*(l=+p[2]/100)-(s=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=Le(o+1/3,n,s),p[1]=Le(o,n,s),p[2]=Le(o-1/3,n,s);else p=t.match(U)||Pe.transparent;p=p.map(Number)}return e&&!u&&(n=p[0]/Re,s=p[1]/Re,r=p[2]/Re,l=((h=Math.max(n,s,r))+(d=Math.min(n,s,r)))/2,h===d?o=a=0:(c=h-d,a=l>.5?c/(2-h-d):c/(h+d),o=h===n?(s-r)/c+(s<r?6:0):h===s?(r-n)/c+2:(n-s)/c+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),i&&p.length<4&&(p[3]=1),p},De=function(t){var e=[],i=[],n=-1;return t.split(ke).forEach((function(t){var s=t.match(V)||[];e.push.apply(e,s),i.push(n+=s.length+1)})),e.c=i,e},Oe=function(t,e,i){var n,s,r,o,a="",l=(t+a).match(ke),h=e?"hsla(":"rgba(",d=0;if(!l)return t;if(l=l.map((function(t){return(t=Me(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),i&&(r=De(t),(n=i.c).join(a)!==r.c.join(a)))for(o=(s=t.replace(ke,"1").split(V)).length-1;d<o;d++)a+=s[d]+(~n.indexOf(d)?l.shift()||h+"0,0,0,0)":(r.length?r:l.length?l:i).shift());if(!s)for(o=(s=t.split(ke)).length-1;d<o;d++)a+=s[d]+l[d];return a+s[o]},ke=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Pe)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Be=/hsl[a]?\(/,Fe=function(t){var e,i=t.join(" ");if(ke.lastIndex=0,ke.test(i))return e=Be.test(i),t[1]=Oe(t[1],e),t[0]=Oe(t[0],e,De(t[1])),!0},Ne=function(){var t,e,i,n,s,r,o=Date.now,c=500,u=33,f=o(),g=f,m=1e3/240,v=m,_=[],y=function i(a){var l,h,d,p,y=o()-g,E=!0===a;if(y>c&&(f+=y-u),((l=(d=(g+=y)-f)-v)>0||E)&&(p=++n.frame,s=d-1e3*n.time,n.time=d/=1e3,v+=l+(l>=m?4:m-l),h=1),E||(t=e(i)),h)for(r=0;r<_.length;r++)_[r](d,s,p,a)};return n={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(t){return s/(1e3/(t||60))},wake:function(){d&&(!l&&B()&&(a=l=window,h=a.document||{},K.gsap=zi,(a.gsapVersions||(a.gsapVersions=[])).push(zi.version),$(Y||a.GreenSockGlobals||!a.gsap&&a||{}),i=a.requestAnimationFrame,Ce.forEach(Ie)),t&&n.sleep(),e=i||function(t){return setTimeout(t,v-1e3*n.time+1|0)},p=1,y(2))},sleep:function(){(i?a.cancelAnimationFrame:clearTimeout)(t),p=0,e=J},lagSmoothing:function(t,e){c=t||1/0,u=Math.min(e||33,c)},fps:function(t){m=1e3/(t||240),v=1e3*n.time+m},add:function(t,e,i){var s=e?function(e,i,r,o){t(e,i,r,o),n.remove(s)}:t;return n.remove(t),_[i?"unshift":"push"](s),Ge(),s},remove:function(t,e){~(e=_.indexOf(t))&&_.splice(e,1)&&r>=e&&r--},_listeners:_}}(),Ge=function(){return!p&&Ne.wake()},Ue={},He=/^[\d.\-M][\d.\-,\s]/,Ve=/["']/g,ze=function(t){for(var e,i,n,s={},r=t.substr(1,t.length-3).split(":"),o=r[0],a=1,l=r.length;a<l;a++)i=r[a],e=a!==l-1?i.lastIndexOf(","):i.length,n=i.substr(0,e),s[o]=isNaN(n)?n.replace(Ve,"").trim():+n,o=i.substr(e+1).trim();return s},je=function(t){var e=t.indexOf("(")+1,i=t.indexOf(")"),n=t.indexOf("(",e);return t.substring(e,~n&&n<i?t.indexOf(")",i+1):i)},We=function(t){var e=(t+"").split("("),i=Ue[e[0]];return i&&e.length>1&&i.config?i.config.apply(null,~t.indexOf("{")?[ze(e[1])]:je(t).split(",").map(bt)):Ue._CE&&He.test(t)?Ue._CE("",t):i},Xe=function(t){return function(e){return 1-t(1-e)}},Ke=function t(e,i){for(var n,s=e._first;s;)s instanceof ei?t(s,i):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===i||(s.timeline?t(s.timeline,i):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=i)),s=s._next},Ye=function(t,e){return t&&(L(t)?t:Ue[t]||We(t))||e},$e=function(t,e,i,n){void 0===i&&(i=function(t){return 1-e(1-t)}),void 0===n&&(n=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var s,r={easeIn:e,easeOut:i,easeInOut:n};return ft(t,(function(t){for(var e in Ue[t]=K[t]=r,Ue[s=t.toLowerCase()]=i,r)Ue[s+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Ue[t+"."+e]=r[e]})),r},qe=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},Ze=function t(e,i,n){var s=i>=1?i:1,r=(n||(e?.3:.45))/(i<1?i:1),o=r/x*(Math.asin(1/s)||0),a=function(t){return 1===t?1:s*Math.pow(2,-10*t)*R((t-o)*r)+1},l="out"===e?a:"in"===e?function(t){return 1-a(1-t)}:qe(a);return r=x/r,l.config=function(i,n){return t(e,i,n)},l},Qe=function t(e,i){void 0===i&&(i=1.70158);var n=function(t){return t?--t*t*((i+1)*t+i)+1:0},s="out"===e?n:"in"===e?function(t){return 1-n(1-t)}:qe(n);return s.config=function(i){return t(e,i)},s};ft("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var i=e<5?e+1:e;$e(t+",Power"+(i-1),e?function(t){return Math.pow(t,i)}:function(t){return t},(function(t){return 1-Math.pow(1-t,i)}),(function(t){return t<.5?Math.pow(2*t,i)/2:1-Math.pow(2*(1-t),i)/2}))})),Ue.Linear.easeNone=Ue.none=Ue.Linear.easeIn,$e("Elastic",Ze("in"),Ze("out"),Ze()),f=7.5625,v=2*(m=1/(g=2.75)),_=2.5*m,$e("Bounce",(function(t){return 1-y(1-t)}),y=function(t){return t<m?f*t*t:t<v?f*Math.pow(t-1.5/g,2)+.75:t<_?f*(t-=2.25/g)*t+.9375:f*Math.pow(t-2.625/g,2)+.984375}),$e("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),$e("Circ",(function(t){return-(C(1-t*t)-1)})),$e("Sine",(function(t){return 1===t?1:1-I(t*S)})),$e("Back",Qe("in"),Qe("out"),Qe()),Ue.SteppedEase=Ue.steps=K.SteppedEase={config:function(t,e){void 0===t&&(t=1);var i=1/t,n=t+(e?0:1),s=e?1:0,r=1-T;return function(t){return((n*ie(0,r,t)|0)+s)*i}}},b.ease=Ue["quad.out"],ft("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return dt+=t+","+t+"Params,"}));var Je=function(t,e){this.id=w++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:pt,this.set=e?e.getSetter:Ei},ti=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,qt(this,+t.duration,1,1),this.data=t.data,r&&(this._ctx=r,r.data.push(this)),p||Ne.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,qt(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Ge(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(Ht(this,t),!i._dp||i.parent||Vt(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&zt(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===T||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Et(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+Ft(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+Ft(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*i,e):this._repeat?Nt(this._tTime,i)+1:1},e.timeScale=function(t){if(!arguments.length)return this._rts===-T?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?Gt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-T?0:this._rts,this.totalTime(ie(-Math.abs(this._delay),this._tDur,e),!0),Ut(this),Ot(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ge(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==T&&(this._tTime-=T)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&zt(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(k(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Gt(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=it);var e=s;return s=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),s=e,this},e.globalTime=function(t){for(var e=this,i=arguments.length?t:e.rawTime();e;)i=e._start+i/(e._ts||1),e=e._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(t):i},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,Zt(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,Zt(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(Jt(this,t),k(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,k(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-T:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-T,this},e.isActive=function(){var t,e=this.parent||this._dp,i=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=i&&t<this.endTime(!0)-T))},e.eventCallback=function(t,e,i){var n=this.vars;return arguments.length>1?(e?(n[t]=e,i&&(n[t+"Params"]=i),"onUpdate"===t&&(this._onUpdate=e)):delete n[t],this):n[t]},e.then=function(t){var e=this;return new Promise((function(i){var n=L(t)?t:At,s=function(){var t=e.then;e.then=null,L(n)&&(n=n(e))&&(n.then||n===e)&&(e.then=t),i(n),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?s():e._prom=s}))},e.kill=function(){we(this)},t}();Tt(ti.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-T,_prom:0,_ps:!1,_rts:1});var ei=function(t){function n(e,n){var s;return void 0===e&&(e={}),(s=t.call(this,e)||this).labels={},s.smoothChildTiming=!!e.smoothChildTiming,s.autoRemoveChildren=!!e.autoRemoveChildren,s._sort=k(e.sortChildren),o&&zt(e.parent||o,i(s),n),e.reversed&&s.reverse(),e.paused&&s.paused(!0),e.scrollTrigger&&jt(i(s),e.scrollTrigger),s}e(n,t);var r=n.prototype;return r.to=function(t,e,i){return te(0,arguments,this),this},r.from=function(t,e,i){return te(1,arguments,this),this},r.fromTo=function(t,e,i,n){return te(2,arguments,this),this},r.set=function(t,e,i){return e.duration=0,e.parent=this,It(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new gi(t,e,Jt(this,i),1),this},r.call=function(t,e,i){return zt(this,gi.delayedCall(0,t,e),i)},r.staggerTo=function(t,e,i,n,s,r,o){return i.duration=e,i.stagger=i.stagger||n,i.onComplete=r,i.onCompleteParams=o,i.parent=this,new gi(t,i,Jt(this,s)),this},r.staggerFrom=function(t,e,i,n,s,r,o){return i.runBackwards=1,It(i).immediateRender=k(i.immediateRender),this.staggerTo(t,e,i,n,s,r,o)},r.staggerFromTo=function(t,e,i,n,s,r,o,a){return n.startAt=i,It(n).immediateRender=k(n.immediateRender),this.staggerTo(t,e,n,s,r,o,a)},r.render=function(t,e,i){var n,r,a,l,h,d,c,u,p,f,g,m,v=this._time,_=this._dirty?this.totalDuration():this._tDur,y=this._dur,E=t<=0?0:mt(t),b=this._zTime<0!=t<0&&(this._initted||!y);if(this!==o&&E>_&&t>=0&&(E=_),E!==this._tTime||i||b){if(v!==this._time&&y&&(E+=this._time-v,t+=this._time-v),n=E,p=this._start,d=!(u=this._ts),b&&(y||(v=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(g=this._yoyo,h=y+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*h+t,e,i);if(n=mt(E%h),E===_?(l=this._repeat,n=y):((l=~~(E/h))&&l===E/h&&(n=y,l--),n>y&&(n=y)),f=Nt(this._tTime,h),!v&&this._tTime&&f!==l&&this._tTime-f*h-this._dur<=0&&(f=l),g&&1&l&&(n=y-n,m=1),l!==f&&!this._lock){var A=g&&1&f,x=A===(g&&1&l);if(l<f&&(A=!A),v=A?0:y,this._lock=1,this.render(v||(m?0:mt(l*h)),e,!y)._lock=0,this._tTime=E,!e&&this.parent&&Se(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),v&&v!==this._time||d!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,_=this._tDur,x&&(this._lock=2,v=A?y:-1e-4,this.render(v,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!d)return this;Ke(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=$t(this,mt(v),mt(n)))&&(E-=n-(n=c._start)),this._tTime=E,this._time=n,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,v=0),!v&&n&&!e&&!l&&(Se(this,"onStart"),this._tTime!==E))return this;if(n>=v&&t>=0)for(r=this._first;r;){if(a=r._next,(r._act||n>=r._start)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,i);if(r.render(r._ts>0?(n-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(n-r._start)*r._ts,e,i),n!==this._time||!this._ts&&!d){c=0,a&&(E+=this._zTime=-T);break}}r=a}else{r=this._last;for(var S=t<0?t:n;r;){if(a=r._prev,(r._act||S<=r._end)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,i);if(r.render(r._ts>0?(S-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(S-r._start)*r._ts,e,i||s&&(r._initted||r._startAt)),n!==this._time||!this._ts&&!d){c=0,a&&(E+=this._zTime=S?-T:T);break}}r=a}}if(c&&!e&&(this.pause(),c.render(n>=v?0:-T)._zTime=n>=v?1:-1,this._ts))return this._start=p,Ut(this),this.render(t,e,i);this._onUpdate&&!e&&Se(this,"onUpdate",!0),(E===_&&this._tTime>=this.totalDuration()||!E&&v)&&(p!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((t||!y)&&(E===_&&this._ts>0||!E&&this._ts<0)&&Mt(this,1),e||t<0&&!v||!E&&!v&&_||(Se(this,E===_&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(E<_&&this.timeScale()>0)&&this._prom())))}return this},r.add=function(t,e){var i=this;if(M(e)||(e=Jt(this,e,t)),!(t instanceof ti)){if(G(t))return t.forEach((function(t){return i.add(t,e)})),this;if(P(t))return this.addLabel(t,e);if(!L(t))return this;t=gi.delayedCall(0,t)}return this!==t?zt(this,t,e):this},r.getChildren=function(t,e,i,n){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=-A);for(var s=[],r=this._first;r;)r._start>=n&&(r instanceof gi?e&&s.push(r):(i&&s.push(r),t&&s.push.apply(s,r.getChildren(!0,e,i)))),r=r._next;return s},r.getById=function(t){for(var e=this.getChildren(1,1,1),i=e.length;i--;)if(e[i].vars.id===t)return e[i]},r.remove=function(t){return P(t)?this.removeLabel(t):L(t)?this.killTweensOf(t):(Lt(this,t),t===this._recent&&(this._recent=this._last),Dt(this))},r.totalTime=function(e,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=mt(Ne.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,i),this._forcing=0,this):this._tTime},r.addLabel=function(t,e){return this.labels[t]=Jt(this,e),this},r.removeLabel=function(t){return delete this.labels[t],this},r.addPause=function(t,e,i){var n=gi.delayedCall(0,e||J,i);return n.data="isPause",this._hasPause=1,zt(this,n,Jt(this,t))},r.removePause=function(t){var e=this._first;for(t=Jt(this,t);e;)e._start===t&&"isPause"===e.data&&Mt(e),e=e._next},r.killTweensOf=function(t,e,i){for(var n=this.getTweensOf(t,i),s=n.length;s--;)ii!==n[s]&&n[s].kill(t,e);return this},r.getTweensOf=function(t,e){for(var i,n=[],s=le(t),r=this._first,o=M(e);r;)r instanceof gi?_t(r._targets,s)&&(o?(!ii||r._initted&&r._ts)&&r.globalTime(0)<=e&&r.globalTime(r.totalDuration())>e:!e||r.isActive())&&n.push(r):(i=r.getTweensOf(s,e)).length&&n.push.apply(n,i),r=r._next;return n},r.tweenTo=function(t,e){e=e||{};var i,n=this,s=Jt(n,t),r=e,o=r.startAt,a=r.onStart,l=r.onStartParams,h=r.immediateRender,d=gi.to(n,Tt({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:e.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale())||T,onStart:function(){if(n.pause(),!i){var t=e.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale());d._dur!==t&&qt(d,t,0,1).render(d._time,!0,!0),i=1}a&&a.apply(d,l||[])}},e));return h?d.render(0):d},r.tweenFromTo=function(t,e,i){return this.tweenTo(e,Tt({startAt:{time:Jt(this,t)}},i))},r.recent=function(){return this._recent},r.nextLabel=function(t){return void 0===t&&(t=this._time),xe(this,Jt(this,t))},r.previousLabel=function(t){return void 0===t&&(t=this._time),xe(this,Jt(this,t),1)},r.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+T)},r.shiftChildren=function(t,e,i){void 0===i&&(i=0);for(var n,s=this._first,r=this.labels;s;)s._start>=i&&(s._start+=t,s._end+=t),s=s._next;if(e)for(n in r)r[n]>=i&&(r[n]+=t);return Dt(this)},r.invalidate=function(e){var i=this._first;for(this._lock=0;i;)i.invalidate(e),i=i._next;return t.prototype.invalidate.call(this,e)},r.clear=function(t){void 0===t&&(t=!0);for(var e,i=this._first;i;)e=i._next,this.remove(i),i=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Dt(this)},r.totalDuration=function(t){var e,i,n,s=0,r=this,a=r._last,l=A;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-t:t));if(r._dirty){for(n=r.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(i=a._start)>l&&r._sort&&a._ts&&!r._lock?(r._lock=1,zt(r,a,i-a._delay,1)._lock=0):l=i,i<0&&a._ts&&(s-=i,(!n&&!r._dp||n&&n.smoothChildTiming)&&(r._start+=i/r._ts,r._time-=i,r._tTime-=i),r.shiftChildren(-i,!1,-Infinity),l=0),a._end>s&&a._ts&&(s=a._end),a=e;qt(r,r===o&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},n.updateRoot=function(t){if(o._ts&&(Et(o,Gt(t,o)),c=Ne.frame),Ne.frame>=lt){lt+=E.autoSleep||120;var e=o._first;if((!e||!e._ts)&&E.autoSleep&&Ne._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Ne.sleep()}}},n}(ti);Tt(ei.prototype,{_lock:0,_hasPause:0,_forcing:0});var ii,ni,si=function(t,e,i,n,s,r,o){var a,l,h,d,c,u,p,f,g=new Ri(this._pt,t,e,0,1,Ti,null,s),m=0,v=0;for(g.b=i,g.e=n,i+="",(p=~(n+="").indexOf("random("))&&(n=be(n)),r&&(r(f=[i,n],t,e),i=f[0],n=f[1]),l=i.match(z)||[];a=z.exec(n);)d=a[0],c=n.substring(m,a.index),h?h=(h+1)%5:"rgba("===c.substr(-5)&&(h=1),d!==l[v++]&&(u=parseFloat(l[v-1])||0,g._pt={_next:g._pt,p:c||1===v?c:",",s:u,c:"="===d.charAt(1)?vt(u,d)-u:parseFloat(d)-u,m:h&&h<4?Math.round:0},m=z.lastIndex);return g.c=m<n.length?n.substring(m,n.length):"",g.fp=o,(j.test(n)||p)&&(g.e=0),this._pt=g,g},ri=function(t,e,i,n,s,r,o,a,l,h){L(n)&&(n=n(s||0,t,r));var d,c=t[e],u="get"!==i?i:L(c)?l?t[e.indexOf("set")||!L(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():c,p=L(c)?l?_i:vi:mi;if(P(n)&&(~n.indexOf("random(")&&(n=be(n)),"="===n.charAt(1)&&((d=vt(u,n)+(ne(u)||0))||0===d)&&(n=d)),!h||u!==n||ni)return isNaN(u*n)||""===n?(!c&&!(e in t)&&q(e,n),si.call(this,t,e,u,n,p,a||E.stringFilter,l)):(d=new Ri(this._pt,t,e,+u||0,n-(u||0),"boolean"==typeof c?Ai:bi,0,p),l&&(d.fp=l),o&&d.modifier(o,this,t),this._pt=d)},oi=function(t,e,i,n,s){if(L(t)&&(t=ui(t,s,e,i,n)),!O(t)||t.style&&t.nodeType||G(t)||N(t))return P(t)?ui(t,s,e,i,n):t;var r,o={};for(r in t)o[r]=ui(t[r],s,e,i,n);return o},ai=function(t,e,i,n,s,r){var o,a,l,h;if(ot[t]&&!1!==(o=new ot[t]).init(s,o.rawVars?e[t]:oi(e[t],n,s,r,i),i,n,r)&&(i._pt=a=new Ri(i._pt,s,t,0,1,o.render,o,0,o.priority),i!==u))for(l=i._ptLookup[i._targets.indexOf(s)],h=o._props.length;h--;)l[o._props[h]]=a;return o},li=function t(e,i,r){var a,l,h,d,c,u,p,f,g,m,v,_,y,E=e.vars,x=E.ease,S=E.startAt,w=E.immediateRender,C=E.lazy,I=E.onUpdate,R=E.onUpdateParams,P=E.callbackScope,L=E.runBackwards,M=E.yoyoEase,D=E.keyframes,O=E.autoRevert,B=e._dur,F=e._startAt,N=e._targets,G=e.parent,U=G&&"nested"===G.data?G.vars.targets:N,H="auto"===e._overwrite&&!n,V=e.timeline;if(V&&(!D||!x)&&(x="none"),e._ease=Ye(x,b.ease),e._yEase=M?Xe(Ye(!0===M?x:M,b.ease)):0,M&&e._yoyo&&!e._repeat&&(M=e._yEase,e._yEase=e._ease,e._ease=M),e._from=!V&&!!E.runBackwards,!V||D&&!E.stagger){if(_=(f=N[0]?ut(N[0]).harness:0)&&E[f.prop],a=Ct(E,nt),F&&(F._zTime<0&&F.progress(1),i<0&&L&&w&&!O?F.render(-1,!0):F.revert(L&&B?et:tt),F._lazy=0),S){if(Mt(e._startAt=gi.set(N,Tt({data:"isStart",overwrite:!1,parent:G,immediateRender:!0,lazy:!F&&k(C),startAt:null,delay:0,onUpdate:I,onUpdateParams:R,callbackScope:P,stagger:0},S))),e._startAt._dp=0,e._startAt._sat=e,i<0&&(s||!w&&!O)&&e._startAt.revert(et),w&&B&&i<=0&&r<=0)return void(i&&(e._zTime=i))}else if(L&&B&&!F)if(i&&(w=!1),h=Tt({overwrite:!1,data:"isFromStart",lazy:w&&!F&&k(C),immediateRender:w,stagger:0,parent:G},a),_&&(h[f.prop]=_),Mt(e._startAt=gi.set(N,h)),e._startAt._dp=0,e._startAt._sat=e,i<0&&(s?e._startAt.revert(et):e._startAt.render(-1,!0)),e._zTime=i,w){if(!i)return}else t(e._startAt,T,T);for(e._pt=e._ptCache=0,C=B&&k(C)||C&&!B,l=0;l<N.length;l++){if(p=(c=N[l])._gsap||ct(N)[l]._gsap,e._ptLookup[l]=m={},rt[p.id]&&st.length&&yt(),v=U===N?l:U.indexOf(c),f&&!1!==(g=new f).init(c,_||a,e,v,U)&&(e._pt=d=new Ri(e._pt,c,g.name,0,1,g.render,g,0,g.priority),g._props.forEach((function(t){m[t]=d})),g.priority&&(u=1)),!f||_)for(h in a)ot[h]&&(g=ai(h,a,e,v,c,U))?g.priority&&(u=1):m[h]=d=ri.call(e,c,h,"get",a[h],v,U,0,E.stringFilter);e._op&&e._op[l]&&e.kill(c,e._op[l]),H&&e._pt&&(ii=e,o.killTweensOf(c,m,e.globalTime(i)),y=!e.parent,ii=0),e._pt&&C&&(rt[p.id]=1)}u&&Ii(e),e._onInit&&e._onInit(e)}e._onUpdate=I,e._initted=(!e._op||e._pt)&&!y,D&&i<=0&&V.render(A,!0,!0)},hi=function(t,e,i,n,s,r,o){var a,l,h,d,c=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!c)for(c=t._ptCache[e]=[],h=t._ptLookup,d=t._targets.length;d--;){if((a=h[d][e])&&a.d&&a.d._pt)for(a=a.d._pt;a&&a.p!==e&&a.fp!==e;)a=a._next;if(!a)return ni=1,t.vars[e]="+=0",li(t,o),ni=0,1;c.push(a)}for(d=c.length;d--;)(a=(l=c[d])._pt||l).s=!n&&0!==n||s?a.s+(n||0)+r*a.c:n,a.c=i-a.s,l.e&&(l.e=gt(i)+ne(l.e)),l.b&&(l.b=a.s+ne(l.b))},di=function(t,e){var i,n,s,r,o=t[0]?ut(t[0]).harness:0,a=o&&o.aliases;if(!a)return e;for(n in i=St({},e),a)if(n in i)for(s=(r=a[n].split(",")).length;s--;)i[r[s]]=i[n];return i},ci=function(t,e,i,n){var s,r,o=e.ease||n||"power1.inOut";if(G(e))r=i[t]||(i[t]=[]),e.forEach((function(t,i){return r.push({t:i/(e.length-1)*100,v:t,e:o})}));else for(s in e)r=i[s]||(i[s]=[]),"ease"===s||r.push({t:parseFloat(t),v:e[s],e:o})},ui=function(t,e,i,n,s){return L(t)?t.call(e,i,n,s):P(t)&&~t.indexOf("random(")?be(t):t},pi=dt+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",fi={};ft(pi+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return fi[t]=1}));var gi=function(t){function s(e,s,r,a){var l;"number"==typeof s&&(r.duration=s,s=r,r=null);var h,d,c,u,p,f,g,m,v=(l=t.call(this,a?s:It(s))||this).vars,_=v.duration,y=v.delay,b=v.immediateRender,A=v.stagger,x=v.overwrite,S=v.keyframes,w=v.defaults,C=v.scrollTrigger,I=v.yoyoEase,R=s.parent||o,P=(G(e)||N(e)?M(e[0]):"length"in s)?[e]:le(e);if(l._targets=P.length?ct(P):Z("GSAP target "+e+" not found. https://greensock.com",!E.nullTargetWarn)||[],l._ptLookup=[],l._overwrite=x,S||A||F(_)||F(y)){if(s=l.vars,(h=l.timeline=new ei({data:"nested",defaults:w||{},targets:R&&"nested"===R.data?R.vars.targets:P})).kill(),h.parent=h._dp=i(l),h._start=0,A||F(_)||F(y)){if(u=P.length,g=A&&ce(A),O(A))for(p in A)~pi.indexOf(p)&&(m||(m={}),m[p]=A[p]);for(d=0;d<u;d++)(c=Ct(s,fi)).stagger=0,I&&(c.yoyoEase=I),m&&St(c,m),f=P[d],c.duration=+ui(_,i(l),d,f,P),c.delay=(+ui(y,i(l),d,f,P)||0)-l._delay,!A&&1===u&&c.delay&&(l._delay=y=c.delay,l._start+=y,c.delay=0),h.to(f,c,g?g(d,f,P):0),h._ease=Ue.none;h.duration()?_=y=0:l.timeline=0}else if(S){It(Tt(h.vars.defaults,{ease:"none"})),h._ease=Ye(S.ease||s.ease||"none");var L,D,B,U=0;if(G(S))S.forEach((function(t){return h.to(P,t,">")})),h.duration();else{for(p in c={},S)"ease"===p||"easeEach"===p||ci(p,S[p],c,S.easeEach);for(p in c)for(L=c[p].sort((function(t,e){return t.t-e.t})),U=0,d=0;d<L.length;d++)(B={ease:(D=L[d]).e,duration:(D.t-(d?L[d-1].t:0))/100*_})[p]=D.v,h.to(P,B,U),U+=B.duration;h.duration()<_&&h.to({},{duration:_-h.duration()})}}_||l.duration(_=h.duration())}else l.timeline=0;return!0!==x||n||(ii=i(l),o.killTweensOf(P),ii=0),zt(R,i(l),r),s.reversed&&l.reverse(),s.paused&&l.paused(!0),(b||!_&&!S&&l._start===mt(R._time)&&k(b)&&Bt(i(l))&&"nested"!==R.data)&&(l._tTime=-T,l.render(Math.max(0,-y)||0)),C&&jt(i(l),C),l}e(s,t);var r=s.prototype;return r.render=function(t,e,i){var n,s,r,o,a,l,h,d,c,u=this._time,p=this._tDur,f=this._dur,g=t<0,m=t>p-T&&!g?p:t<T?0:t;if(f){if(m!==this._tTime||!t||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==g){if(n=m,d=this.timeline,this._repeat){if(o=f+this._rDelay,this._repeat<-1&&g)return this.totalTime(100*o+t,e,i);if(n=mt(m%o),m===p?(r=this._repeat,n=f):((r=~~(m/o))&&r===m/o&&(n=f,r--),n>f&&(n=f)),(l=this._yoyo&&1&r)&&(c=this._yEase,n=f-n),a=Nt(this._tTime,o),n===u&&!i&&this._initted)return this._tTime=m,this;r!==a&&(d&&this._yEase&&Ke(d,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=i=1,this.render(mt(o*r),!0).invalidate()._lock=0))}if(!this._initted){if(Wt(this,g?t:n,i,e,m))return this._tTime=0,this;if(u!==this._time)return this;if(f!==this._dur)return this.render(t,e,i)}if(this._tTime=m,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(c||this._ease)(n/f),this._from&&(this.ratio=h=1-h),n&&!u&&!e&&!r&&(Se(this,"onStart"),this._tTime!==m))return this;for(s=this._pt;s;)s.r(h,s.d),s=s._next;d&&d.render(t<0?t:!n&&l?-T:d._dur*d._ease(n/this._dur),e,i)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(g&&kt(this,t,e,i),Se(this,"onUpdate")),this._repeat&&r!==a&&this.vars.onRepeat&&!e&&this.parent&&Se(this,"onRepeat"),m!==this._tDur&&m||this._tTime!==m||(g&&!this._onUpdate&&kt(this,t,!0,!0),(t||!f)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&Mt(this,1),e||g&&!u||!(m||u||l)||(Se(this,m===p?"onComplete":"onReverseComplete",!0),this._prom&&!(m<p&&this.timeScale()>0)&&this._prom()))}}else Yt(this,t,e,i);return this},r.targets=function(){return this._targets},r.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},r.resetTo=function(t,e,i,n){p||Ne.wake(),this._ts||this.play();var s,r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||li(this,r),s=this._ease(r/this._dur),hi(this,t,e,i,n,s,r)?this.resetTo(t,e,i,n):(Ht(this,0),this.parent||Pt(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},r.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?we(this):this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,ii&&!0!==ii.vars.overwrite)._first||we(this),this.parent&&i!==this.timeline.totalDuration()&&qt(this,this._dur*this.timeline._tDur/i,0,1),this}var n,s,r,o,a,l,h,d=this._targets,c=t?le(t):d,u=this._ptLookup,p=this._pt;if((!e||"all"===e)&&Rt(d,c))return"all"===e&&(this._pt=0),we(this);for(n=this._op=this._op||[],"all"!==e&&(P(e)&&(a={},ft(e,(function(t){return a[t]=1})),e=a),e=di(d,e)),h=d.length;h--;)if(~c.indexOf(d[h]))for(a in s=u[h],"all"===e?(n[h]=e,o=s,r={}):(r=n[h]=n[h]||{},o=e),o)(l=s&&s[a])&&("kill"in l.d&&!0!==l.d.kill(a)||Lt(this,l,"_pt"),delete s[a]),"all"!==r&&(r[a]=1);return this._initted&&!this._pt&&p&&we(this),this},s.to=function(t,e){return new s(t,e,arguments[2])},s.from=function(t,e){return te(1,arguments)},s.delayedCall=function(t,e,i,n){return new s(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:n})},s.fromTo=function(t,e,i){return te(2,arguments)},s.set=function(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new s(t,e)},s.killTweensOf=function(t,e,i){return o.killTweensOf(t,e,i)},s}(ti);Tt(gi.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),ft("staggerTo,staggerFrom,staggerFromTo",(function(t){gi[t]=function(){var e=new ei,i=re.call(arguments,0);return i.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,i)}}));var mi=function(t,e,i){return t[e]=i},vi=function(t,e,i){return t[e](i)},_i=function(t,e,i,n){return t[e](n.fp,i)},yi=function(t,e,i){return t.setAttribute(e,i)},Ei=function(t,e){return L(t[e])?vi:D(t[e])&&t.setAttribute?yi:mi},bi=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},Ai=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},Ti=function(t,e){var i=e._pt,n="";if(!t&&e.b)n=e.b;else if(1===t&&e.e)n=e.e;else{for(;i;)n=i.p+(i.m?i.m(i.s+i.c*t):Math.round(1e4*(i.s+i.c*t))/1e4)+n,i=i._next;n+=e.c}e.set(e.t,e.p,n,e)},xi=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},Si=function(t,e,i,n){for(var s,r=this._pt;r;)s=r._next,r.p===n&&r.modifier(t,e,i),r=s},wi=function(t){for(var e,i,n=this._pt;n;)i=n._next,n.p===t&&!n.op||n.op===t?Lt(this,n,"_pt"):n.dep||(e=1),n=i;return!e},Ci=function(t,e,i,n){n.mSet(t,e,n.m.call(n.tween,i,n.mt),n)},Ii=function(t){for(var e,i,n,s,r=t._pt;r;){for(e=r._next,i=n;i&&i.pr>r.pr;)i=i._next;(r._prev=i?i._prev:s)?r._prev._next=r:n=r,(r._next=i)?i._prev=r:s=r,r=e}t._pt=n},Ri=function(){function t(t,e,i,n,s,r,o,a,l){this.t=e,this.s=n,this.c=s,this.p=i,this.r=r||bi,this.d=o||this,this.set=a||mi,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,i){this.mSet=this.mSet||this.set,this.set=Ci,this.m=t,this.mt=i,this.tween=e},t}();ft(dt+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return nt[t]=1})),K.TweenMax=K.TweenLite=gi,K.TimelineLite=K.TimelineMax=ei,o=new ei({sortChildren:!1,defaults:b,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),E.stringFilter=Fe;var Pi=[],Li={},Mi=[],Di=0,Oi=0,ki=function(t){return(Li[t]||Mi).map((function(t){return t()}))},Bi=function(){var t=Date.now(),e=[];t-Di>2&&(ki("matchMediaInit"),Pi.forEach((function(t){var i,n,s,r,o=t.queries,l=t.conditions;for(n in o)(i=a.matchMedia(o[n]).matches)&&(s=1),i!==l[n]&&(l[n]=i,r=1);r&&(t.revert(),s&&e.push(t))})),ki("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t)})),Di=t,ki("matchMedia"))},Fi=function(){function t(t,e){this.selector=e&&he(e),this.data=[],this._r=[],this.isReverted=!1,this.id=Oi++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,i){L(t)&&(i=e,e=t,t=L);var n=this,s=function(){var t,s=r,o=n.selector;return s&&s!==n&&s.data.push(n),i&&(n.selector=he(i)),r=n,t=e.apply(n,arguments),L(t)&&n._r.push(t),r=s,n.selector=o,n.isReverted=!1,t};return n.last=s,t===L?s(n):t?n[t]=s:s},e.ignore=function(t){var e=r;r=null,t(this),r=e},e.getTweens=function(){var e=[];return this.data.forEach((function(i){return i instanceof t?e.push.apply(e,i.getTweens()):i instanceof gi&&!(i.parent&&"nested"===i.parent.data)&&e.push(i)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var i=this;if(t){var n=this.getTweens();this.data.forEach((function(t){"isFlip"===t.data&&(t.revert(),t.getChildren(!0,!0,!1).forEach((function(t){return n.splice(n.indexOf(t),1)})))})),n.map((function(t){return{g:t.globalTime(0),t}})).sort((function(t,e){return e.g-t.g||-1})).forEach((function(e){return e.t.revert(t)})),this.data.forEach((function(e){return e instanceof ei?"nested"!==e.data&&e.kill():!(e instanceof gi)&&e.revert&&e.revert(t)})),this._r.forEach((function(e){return e(t,i)})),this.isReverted=!0}else this.data.forEach((function(t){return t.kill&&t.kill()}));if(this.clear(),e)for(var s=Pi.length;s--;)Pi[s].id===this.id&&Pi.splice(s,1)},e.revert=function(t){this.kill(t||{})},t}(),Ni=function(){function t(t){this.contexts=[],this.scope=t}var e=t.prototype;return e.add=function(t,e,i){O(t)||(t={matches:t});var n,s,o,l=new Fi(0,i||this.scope),h=l.conditions={};for(s in r&&!l.selector&&(l.selector=r.selector),this.contexts.push(l),e=l.add("onMatch",e),l.queries=t,t)"all"===s?o=1:(n=a.matchMedia(t[s]))&&(Pi.indexOf(l)<0&&Pi.push(l),(h[s]=n.matches)&&(o=1),n.addListener?n.addListener(Bi):n.addEventListener("change",Bi));return o&&e(l),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),Gi={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((function(t){return Ie(t)}))},timeline:function(t){return new ei(t)},getTweensOf:function(t,e){return o.getTweensOf(t,e)},getProperty:function(t,e,i,n){P(t)&&(t=le(t)[0]);var s=ut(t||{}).get,r=i?At:bt;return"native"===i&&(i=""),t?e?r((ot[e]&&ot[e].get||s)(t,e,i,n)):function(e,i,n){return r((ot[e]&&ot[e].get||s)(t,e,i,n))}:t},quickSetter:function(t,e,i){if((t=le(t)).length>1){var n=t.map((function(t){return zi.quickSetter(t,e,i)})),s=n.length;return function(t){for(var e=s;e--;)n[e](t)}}t=t[0]||{};var r=ot[e],o=ut(t),a=o.harness&&(o.harness.aliases||{})[e]||e,l=r?function(e){var n=new r;u._pt=0,n.init(t,i?e+i:e,u,0,[t]),n.render(1,n),u._pt&&xi(1,u)}:o.set(t,a);return r?l:function(e){return l(t,a,i?e+i:e,o,1)}},quickTo:function(t,e,i){var n,s=zi.to(t,St(((n={})[e]="+=0.1",n.paused=!0,n),i||{})),r=function(t,i,n){return s.resetTo(e,t,i,n)};return r.tween=s,r},isTweening:function(t){return o.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Ye(t.ease,b.ease)),wt(b,t||{})},config:function(t){return wt(E,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,n=t.plugins,s=t.defaults,r=t.extendTimeline;(n||"").split(",").forEach((function(t){return t&&!ot[t]&&!K[t]&&Z(e+" effect requires "+t+" plugin.")})),at[e]=function(t,e,n){return i(le(t),Tt(e||{},s),n)},r&&(ei.prototype[e]=function(t,i,n){return this.add(at[e](t,O(i)?i:(n=i)&&{},this),n)})},registerEase:function(t,e){Ue[t]=Ye(e)},parseEase:function(t,e){return arguments.length?Ye(t,e):Ue},getById:function(t){return o.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var i,n,s=new ei(t);for(s.smoothChildTiming=k(t.smoothChildTiming),o.remove(s),s._dp=0,s._time=s._tTime=o._time,i=o._first;i;)n=i._next,!e&&!i._dur&&i instanceof gi&&i.vars.onComplete===i._targets[0]||zt(s,i,i._start-i._delay),i=n;return zt(o,s,0),s},context:function(t,e){return t?new Fi(t,e):r},matchMedia:function(t){return new Ni(t)},matchMediaRefresh:function(){return Pi.forEach((function(t){var e,i,n=t.conditions;for(i in n)n[i]&&(n[i]=!1,e=1);e&&t.revert()}))||Bi()},addEventListener:function(t,e){var i=Li[t]||(Li[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=Li[t],n=i&&i.indexOf(e);n>=0&&i.splice(n,1)},utils:{wrap:ye,wrapYoyo:Ee,distribute:ce,random:fe,snap:pe,normalize:ve,getUnit:ne,clamp:se,splitColor:Me,toArray:le,selector:he,mapRange:Ae,pipe:ge,unitize:me,interpolate:Te,shuffle:de},install:$,effects:at,ticker:Ne,updateRoot:ei.updateRoot,plugins:ot,globalTimeline:o,core:{PropTween:Ri,globals:Q,Tween:gi,Timeline:ei,Animation:ti,getCache:ut,_removeLinkedListItem:Lt,reverting:function(){return s},context:function(t){return t&&r&&(r.data.push(t),t._ctx=r),r},suppressOverwrites:function(t){return n=t}}};ft("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return Gi[t]=gi[t]})),Ne.add(ei.updateRoot),u=Gi.to({},{duration:0});var Ui=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},Hi=function(t,e){var i,n,s,r=t._targets;for(i in e)for(n=r.length;n--;)(s=t._ptLookup[n][i])&&(s=s.d)&&(s._pt&&(s=Ui(s,i)),s&&s.modifier&&s.modifier(e[i],t,r[n],i))},Vi=function(t,e){return{name:t,rawVars:1,init:function(t,i,n){n._onInit=function(t){var n,s;if(P(i)&&(n={},ft(i,(function(t){return n[t]=1})),i=n),e){for(s in n={},i)n[s]=e(i[s]);i=n}Hi(t,i)}}}},zi=Gi.registerPlugin({name:"attr",init:function(t,e,i,n,s){var r,o,a;for(r in this.tween=i,e)a=t.getAttribute(r)||"",(o=this.add(t,"setAttribute",(a||0)+"",e[r],n,s,0,0,r)).op=r,o.b=a,this._props.push(r)},render:function(t,e){for(var i=e._pt;i;)s?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Vi("roundProps",ue),Vi("modifiers"),Vi("snap",pe))||Gi;gi.version=ei.version=zi.version="3.12.1",d=1,B()&&Ge();var ji,Wi,Xi,Ki,Yi,$i,qi,Zi,Qi=Ue.Power0,Ji=Ue.Power1,tn=Ue.Power2,en=Ue.Power3,nn=Ue.Power4,sn=Ue.Linear,rn=Ue.Quad,on=Ue.Cubic,an=Ue.Quart,ln=Ue.Quint,hn=Ue.Strong,dn=Ue.Elastic,cn=Ue.Back,un=Ue.SteppedEase,pn=Ue.Bounce,fn=Ue.Sine,gn=Ue.Expo,mn=Ue.Circ,vn=function(){return"undefined"!=typeof window},_n={},yn=180/Math.PI,En=Math.PI/180,bn=Math.atan2,An=1e8,Tn=/([A-Z])/g,xn=/(left|right|width|margin|padding|x)/i,Sn=/[\s,\(]\S/,wn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Cn=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},In=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Rn=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},Pn=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},Ln=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},Mn=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},Dn=function(t,e,i){return t.style[e]=i},On=function(t,e,i){return t.style.setProperty(e,i)},kn=function(t,e,i){return t._gsap[e]=i},Bn=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},Fn=function(t,e,i,n,s){var r=t._gsap;r.scaleX=r.scaleY=i,r.renderTransform(s,r)},Nn=function(t,e,i,n,s){var r=t._gsap;r[e]=i,r.renderTransform(s,r)},Gn="transform",Un=Gn+"Origin",Hn=function t(e,i){var n=this,s=this.target,r=s.style;if(e in _n&&r){if(this.tfm=this.tfm||{},"transform"===e)return wn.transform.split(",").forEach((function(e){return t.call(n,e,i)}));if(~(e=wn[e]||e).indexOf(",")?e.split(",").forEach((function(t){return n.tfm[t]=rs(s,t)})):this.tfm[e]=s._gsap.x?s._gsap[e]:rs(s,e),this.props.indexOf(Gn)>=0)return;s._gsap.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Un,i,"")),e=Gn}(r||i)&&this.props.push(e,i,r[e])},Vn=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},zn=function(){var t,e,i=this.props,n=this.target,s=n.style,r=n._gsap;for(t=0;t<i.length;t+=3)i[t+1]?n[i[t]]=i[t+2]:i[t+2]?s[i[t]]=i[t+2]:s.removeProperty("--"===i[t].substr(0,2)?i[t]:i[t].replace(Tn,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)r[e]=this.tfm[e];r.svg&&(r.renderTransform(),n.setAttribute("data-svg-origin",this.svgo||"")),(t=qi())&&t.isStart||s[Gn]||(Vn(s),r.uncache=1)}},jn=function(t,e){var i={target:t,props:[],revert:zn,save:Hn};return t._gsap||zi.core.getCache(t),e&&e.split(",").forEach((function(t){return i.save(t)})),i},Wn=function(t,e){var i=Wi.createElementNS?Wi.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Wi.createElement(t);return i.style?i:Wi.createElement(t)},Xn=function t(e,i,n){var s=getComputedStyle(e);return s[i]||s.getPropertyValue(i.replace(Tn,"-$1").toLowerCase())||s.getPropertyValue(i)||!n&&t(e,Yn(i)||i,1)||""},Kn="O,Moz,ms,Ms,Webkit".split(","),Yn=function(t,e,i){var n=(e||Yi).style,s=5;if(t in n&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);s--&&!(Kn[s]+t in n););return s<0?null:(3===s?"ms":s>=0?Kn[s]:"")+t},$n=function(){vn()&&window.document&&(ji=window,Wi=ji.document,Xi=Wi.documentElement,Yi=Wn("div")||{style:{}},Wn("div"),Gn=Yn(Gn),Un=Gn+"Origin",Yi.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Zi=!!Yn("perspective"),qi=zi.core.reverting,Ki=1)},qn=function t(e){var i,n=Wn("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,r=this.nextSibling,o=this.style.cssText;if(Xi.appendChild(n),n.appendChild(this),this.style.display="block",e)try{i=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(i=this._gsapBBox());return s&&(r?s.insertBefore(this,r):s.appendChild(this)),Xi.removeChild(n),this.style.cssText=o,i},Zn=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},Qn=function(t){var e;try{e=t.getBBox()}catch(i){e=qn.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===qn||(e=qn.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+Zn(t,["x","cx","x1"])||0,y:+Zn(t,["y","cy","y1"])||0,width:0,height:0}},Jn=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!Qn(t))},ts=function(t,e){if(e){var i=t.style;e in _n&&e!==Un&&(e=Gn),i.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),i.removeProperty(e.replace(Tn,"-$1").toLowerCase())):i.removeAttribute(e)}},es=function(t,e,i,n,s,r){var o=new Ri(t._pt,e,i,0,1,r?Mn:Ln);return t._pt=o,o.b=n,o.e=s,t._props.push(i),o},is={deg:1,rad:1,turn:1},ns={grid:1,flex:1},ss=function t(e,i,n,s){var r,o,a,l,h=parseFloat(n)||0,d=(n+"").trim().substr((h+"").length)||"px",c=Yi.style,u=xn.test(i),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(u?"Width":"Height"),g=100,m="px"===s,v="%"===s;return s===d||!h||is[s]||is[d]?h:("px"!==d&&!m&&(h=t(e,i,n,"px")),l=e.getCTM&&Jn(e),!v&&"%"!==d||!_n[i]&&!~i.indexOf("adius")?(c[u?"width":"height"]=g+(m?d:s),o=~i.indexOf("adius")||"em"===s&&e.appendChild&&!p?e:e.parentNode,l&&(o=(e.ownerSVGElement||{}).parentNode),o&&o!==Wi&&o.appendChild||(o=Wi.body),(a=o._gsap)&&v&&a.width&&u&&a.time===Ne.time&&!a.uncache?gt(h/a.width*g):((v||"%"===d)&&!ns[Xn(o,"display")]&&(c.position=Xn(e,"position")),o===e&&(c.position="static"),o.appendChild(Yi),r=Yi[f],o.removeChild(Yi),c.position="absolute",u&&v&&((a=ut(o)).time=Ne.time,a.width=o[f]),gt(m?r*h/g:r&&h?g/r*h:0))):(r=l?e.getBBox()[u?"width":"height"]:e[f],gt(v?h/r*g:h/100*r)))},rs=function(t,e,i,n){var s;return Ki||$n(),e in wn&&"transform"!==e&&~(e=wn[e]).indexOf(",")&&(e=e.split(",")[0]),_n[e]&&"transform"!==e?(s=vs(t,n),s="transformOrigin"!==e?s[e]:s.svg?s.origin:_s(Xn(t,Un))+" "+s.zOrigin+"px"):(!(s=t.style[e])||"auto"===s||n||~(s+"").indexOf("calc("))&&(s=ds[e]&&ds[e](t,e,i)||Xn(t,e)||pt(t,e)||("opacity"===e?1:0)),i&&!~(s+"").trim().indexOf(" ")?ss(t,e,s,i)+i:s},os=function(t,e,i,n){if(!i||"none"===i){var s=Yn(e,t,1),r=s&&Xn(t,s,1);r&&r!==i?(e=s,i=r):"borderColor"===e&&(i=Xn(t,"borderTopColor"))}var o,a,l,h,d,c,u,p,f,g,m,v=new Ri(this._pt,t.style,e,0,1,Ti),_=0,y=0;if(v.b=i,v.e=n,i+="","auto"==(n+="")&&(t.style[e]=n,n=Xn(t,e)||n,t.style[e]=i),Fe(o=[i,n]),i=o[0],n=o[1],l=i.match(V)||[],(n.match(V)||[]).length){for(;a=V.exec(n);)u=a[0],f=n.substring(_,a.index),d?d=(d+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(d=1),u!==(c=l[y++]||"")&&(h=parseFloat(c)||0,m=c.substr((h+"").length),"="===u.charAt(1)&&(u=vt(h,u)+m),p=parseFloat(u),g=u.substr((p+"").length),_=V.lastIndex-g.length,g||(g=g||E.units[e]||m,_===n.length&&(n+=g,v.e+=g)),m!==g&&(h=ss(t,e,c,g)||0),v._pt={_next:v._pt,p:f||1===y?f:",",s:h,c:p-h,m:d&&d<4||"zIndex"===e?Math.round:0});v.c=_<n.length?n.substring(_,n.length):""}else v.r="display"===e&&"none"===n?Mn:Ln;return j.test(n)&&(v.e=0),this._pt=v,v},as={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ls=function(t){var e=t.split(" "),i=e[0],n=e[1]||"50%";return"top"!==i&&"bottom"!==i&&"left"!==n&&"right"!==n||(t=i,i=n,n=t),e[0]=as[i]||i,e[1]=as[n]||n,e.join(" ")},hs=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i,n,s,r=e.t,o=r.style,a=e.u,l=r._gsap;if("all"===a||!0===a)o.cssText="",n=1;else for(s=(a=a.split(",")).length;--s>-1;)i=a[s],_n[i]&&(n=1,i="transformOrigin"===i?Un:Gn),ts(r,i);n&&(ts(r,Gn),l&&(l.svg&&r.removeAttribute("transform"),vs(r,1),l.uncache=1,Vn(o)))}},ds={clearProps:function(t,e,i,n,s){if("isFromStart"!==s.data){var r=t._pt=new Ri(t._pt,e,i,0,0,hs);return r.u=n,r.pr=-10,r.tween=s,t._props.push(i),1}}},cs=[1,0,0,1,0,0],us={},ps=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},fs=function(t){var e=Xn(t,Gn);return ps(e)?cs:e.substr(7).match(H).map(gt)},gs=function(t,e){var i,n,s,r,o=t._gsap||ut(t),a=t.style,l=fs(t);return o.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(s=t.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")?cs:l:(l!==cs||t.offsetParent||t===Xi||o.svg||(s=a.display,a.display="block",(i=t.parentNode)&&t.offsetParent||(r=1,n=t.nextElementSibling,Xi.appendChild(t)),l=fs(t),s?a.display=s:ts(t,"display"),r&&(n?i.insertBefore(t,n):i?i.appendChild(t):Xi.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},ms=function(t,e,i,n,s,r){var o,a,l,h=t._gsap,d=s||gs(t,!0),c=h.xOrigin||0,u=h.yOrigin||0,p=h.xOffset||0,f=h.yOffset||0,g=d[0],m=d[1],v=d[2],_=d[3],y=d[4],E=d[5],b=e.split(" "),A=parseFloat(b[0])||0,T=parseFloat(b[1])||0;i?d!==cs&&(a=g*_-m*v)&&(l=A*(-m/a)+T*(g/a)-(g*E-m*y)/a,A=A*(_/a)+T*(-v/a)+(v*E-_*y)/a,T=l):(A=(o=Qn(t)).x+(~b[0].indexOf("%")?A/100*o.width:A),T=o.y+(~(b[1]||b[0]).indexOf("%")?T/100*o.height:T)),n||!1!==n&&h.smooth?(y=A-c,E=T-u,h.xOffset=p+(y*g+E*v)-y,h.yOffset=f+(y*m+E*_)-E):h.xOffset=h.yOffset=0,h.xOrigin=A,h.yOrigin=T,h.smooth=!!n,h.origin=e,h.originIsAbsolute=!!i,t.style[Un]="0px 0px",r&&(es(r,h,"xOrigin",c,A),es(r,h,"yOrigin",u,T),es(r,h,"xOffset",p,h.xOffset),es(r,h,"yOffset",f,h.yOffset)),t.setAttribute("data-svg-origin",A+" "+T)},vs=function(t,e){var i=t._gsap||new Je(t);if("x"in i&&!e&&!i.uncache)return i;var n,s,r,o,a,l,h,d,c,u,p,f,g,m,v,_,y,b,A,T,x,S,w,C,I,R,P,L,M,D,O,k,B=t.style,F=i.scaleX<0,N="px",G="deg",U=getComputedStyle(t),H=Xn(t,Un)||"0";return n=s=r=l=h=d=c=u=p=0,o=a=1,i.svg=!(!t.getCTM||!Jn(t)),U.translate&&("none"===U.translate&&"none"===U.scale&&"none"===U.rotate||(B[Gn]=("none"!==U.translate?"translate3d("+(U.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==U.rotate?"rotate("+U.rotate+") ":"")+("none"!==U.scale?"scale("+U.scale.split(" ").join(",")+") ":"")+("none"!==U[Gn]?U[Gn]:"")),B.scale=B.rotate=B.translate="none"),m=gs(t,i.svg),i.svg&&(i.uncache?(I=t.getBBox(),H=i.xOrigin-I.x+"px "+(i.yOrigin-I.y)+"px",C=""):C=!e&&t.getAttribute("data-svg-origin"),ms(t,C||H,!!C||i.originIsAbsolute,!1!==i.smooth,m)),f=i.xOrigin||0,g=i.yOrigin||0,m!==cs&&(b=m[0],A=m[1],T=m[2],x=m[3],n=S=m[4],s=w=m[5],6===m.length?(o=Math.sqrt(b*b+A*A),a=Math.sqrt(x*x+T*T),l=b||A?bn(A,b)*yn:0,(c=T||x?bn(T,x)*yn+l:0)&&(a*=Math.abs(Math.cos(c*En))),i.svg&&(n-=f-(f*b+g*T),s-=g-(f*A+g*x))):(k=m[6],D=m[7],P=m[8],L=m[9],M=m[10],O=m[11],n=m[12],s=m[13],r=m[14],h=(v=bn(k,M))*yn,v&&(C=S*(_=Math.cos(-v))+P*(y=Math.sin(-v)),I=w*_+L*y,R=k*_+M*y,P=S*-y+P*_,L=w*-y+L*_,M=k*-y+M*_,O=D*-y+O*_,S=C,w=I,k=R),d=(v=bn(-T,M))*yn,v&&(_=Math.cos(-v),O=x*(y=Math.sin(-v))+O*_,b=C=b*_-P*y,A=I=A*_-L*y,T=R=T*_-M*y),l=(v=bn(A,b))*yn,v&&(C=b*(_=Math.cos(v))+A*(y=Math.sin(v)),I=S*_+w*y,A=A*_-b*y,w=w*_-S*y,b=C,S=I),h&&Math.abs(h)+Math.abs(l)>359.9&&(h=l=0,d=180-d),o=gt(Math.sqrt(b*b+A*A+T*T)),a=gt(Math.sqrt(w*w+k*k)),v=bn(S,w),c=Math.abs(v)>2e-4?v*yn:0,p=O?1/(O<0?-O:O):0),i.svg&&(C=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!ps(Xn(t,Gn)),C&&t.setAttribute("transform",C))),Math.abs(c)>90&&Math.abs(c)<270&&(F?(o*=-1,c+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,c+=c<=0?180:-180)),e=e||i.uncache,i.x=n-((i.xPercent=n&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-n)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+N,i.y=s-((i.yPercent=s&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-s)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+N,i.z=r+N,i.scaleX=gt(o),i.scaleY=gt(a),i.rotation=gt(l)+G,i.rotationX=gt(h)+G,i.rotationY=gt(d)+G,i.skewX=c+G,i.skewY=u+G,i.transformPerspective=p+N,(i.zOrigin=parseFloat(H.split(" ")[2])||0)&&(B[Un]=_s(H)),i.xOffset=i.yOffset=0,i.force3D=E.force3D,i.renderTransform=i.svg?Ss:Zi?xs:Es,i.uncache=0,i},_s=function(t){return(t=t.split(" "))[0]+" "+t[1]},ys=function(t,e,i){var n=ne(e);return gt(parseFloat(e)+parseFloat(ss(t,"x",i+"px",n)))+n},Es=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,xs(t,e)},bs="0deg",As="0px",Ts=") ",xs=function(t,e){var i=e||this,n=i.xPercent,s=i.yPercent,r=i.x,o=i.y,a=i.z,l=i.rotation,h=i.rotationY,d=i.rotationX,c=i.skewX,u=i.skewY,p=i.scaleX,f=i.scaleY,g=i.transformPerspective,m=i.force3D,v=i.target,_=i.zOrigin,y="",E="auto"===m&&t&&1!==t||!0===m;if(_&&(d!==bs||h!==bs)){var b,A=parseFloat(h)*En,T=Math.sin(A),x=Math.cos(A);A=parseFloat(d)*En,b=Math.cos(A),r=ys(v,r,T*b*-_),o=ys(v,o,-Math.sin(A)*-_),a=ys(v,a,x*b*-_+_)}g!==As&&(y+="perspective("+g+Ts),(n||s)&&(y+="translate("+n+"%, "+s+"%) "),(E||r!==As||o!==As||a!==As)&&(y+=a!==As||E?"translate3d("+r+", "+o+", "+a+") ":"translate("+r+", "+o+Ts),l!==bs&&(y+="rotate("+l+Ts),h!==bs&&(y+="rotateY("+h+Ts),d!==bs&&(y+="rotateX("+d+Ts),c===bs&&u===bs||(y+="skew("+c+", "+u+Ts),1===p&&1===f||(y+="scale("+p+", "+f+Ts),v.style[Gn]=y||"translate(0, 0)"},Ss=function(t,e){var i,n,s,r,o,a=e||this,l=a.xPercent,h=a.yPercent,d=a.x,c=a.y,u=a.rotation,p=a.skewX,f=a.skewY,g=a.scaleX,m=a.scaleY,v=a.target,_=a.xOrigin,y=a.yOrigin,E=a.xOffset,b=a.yOffset,A=a.forceCSS,T=parseFloat(d),x=parseFloat(c);u=parseFloat(u),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),u+=f),u||p?(u*=En,p*=En,i=Math.cos(u)*g,n=Math.sin(u)*g,s=Math.sin(u-p)*-m,r=Math.cos(u-p)*m,p&&(f*=En,o=Math.tan(p-f),s*=o=Math.sqrt(1+o*o),r*=o,f&&(o=Math.tan(f),i*=o=Math.sqrt(1+o*o),n*=o)),i=gt(i),n=gt(n),s=gt(s),r=gt(r)):(i=g,r=m,n=s=0),(T&&!~(d+"").indexOf("px")||x&&!~(c+"").indexOf("px"))&&(T=ss(v,"x",d,"px"),x=ss(v,"y",c,"px")),(_||y||E||b)&&(T=gt(T+_-(_*i+y*s)+E),x=gt(x+y-(_*n+y*r)+b)),(l||h)&&(o=v.getBBox(),T=gt(T+l/100*o.width),x=gt(x+h/100*o.height)),o="matrix("+i+","+n+","+s+","+r+","+T+","+x+")",v.setAttribute("transform",o),A&&(v.style[Gn]=o)},ws=function(t,e,i,n,s){var r,o,a=360,l=P(s),h=parseFloat(s)*(l&&~s.indexOf("rad")?yn:1)-n,d=n+h+"deg";return l&&("short"===(r=s.split("_")[1])&&(h%=a)!=h%(a/2)&&(h+=h<0?a:-a),"cw"===r&&h<0?h=(h+a*An)%a-~~(h/a)*a:"ccw"===r&&h>0&&(h=(h-a*An)%a-~~(h/a)*a)),t._pt=o=new Ri(t._pt,e,i,n,h,In),o.e=d,o.u="deg",t._props.push(i),o},Cs=function(t,e){for(var i in e)t[i]=e[i];return t},Is=function(t,e,i){var n,s,r,o,a,l,h,d=Cs({},i._gsap),c="perspective,force3D,transformOrigin,svgOrigin",u=i.style;for(s in d.svg?(r=i.getAttribute("transform"),i.setAttribute("transform",""),u[Gn]=e,n=vs(i,1),ts(i,Gn),i.setAttribute("transform",r)):(r=getComputedStyle(i)[Gn],u[Gn]=e,n=vs(i,1),u[Gn]=r),_n)(r=d[s])!==(o=n[s])&&c.indexOf(s)<0&&(a=ne(r)!==(h=ne(o))?ss(i,s,r,h):parseFloat(r),l=parseFloat(o),t._pt=new Ri(t._pt,n,s,a,l-a,Cn),t._pt.u=h||0,t._props.push(s));Cs(n,d)};ft("padding,margin,Width,Radius",(function(t,e){var i="Top",n="Right",s="Bottom",r="Left",o=(e<3?[i,n,s,r]:[i+r,i+n,s+n,s+r]).map((function(i){return e<2?t+i:"border"+i+t}));ds[e>1?"border"+t:t]=function(t,e,i,n,s){var r,a;if(arguments.length<4)return r=o.map((function(e){return rs(t,e,i)})),5===(a=r.join(" ")).split(r[0]).length?r[0]:a;r=(n+"").split(" "),a={},o.forEach((function(t,e){return a[t]=r[e]=r[e]||r[(e-1)/2|0]})),t.init(e,a,s)}}));var Rs,Ps,Ls,Ms,Ds={name:"css",register:$n,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,n,s){var r,o,a,l,h,d,c,u,p,f,g,m,v,_,y,b,A=this._props,T=t.style,x=i.vars.startAt;for(c in Ki||$n(),this.styles=this.styles||jn(t),b=this.styles.props,this.tween=i,e)if("autoRound"!==c&&(o=e[c],!ot[c]||!ai(c,e,i,n,t,s)))if(h=typeof o,d=ds[c],"function"===h&&(h=typeof(o=o.call(i,n,t,s))),"string"===h&&~o.indexOf("random(")&&(o=be(o)),d)d(this,t,c,o,i)&&(y=1);else if("--"===c.substr(0,2))r=(getComputedStyle(t).getPropertyValue(c)+"").trim(),o+="",ke.lastIndex=0,ke.test(r)||(u=ne(r),p=ne(o)),p?u!==p&&(r=ss(t,c,r,p)+p):u&&(o+=u),this.add(T,"setProperty",r,o,n,s,0,0,c),A.push(c),b.push(c,0,T[c]);else if("undefined"!==h){if(x&&c in x?(r="function"==typeof x[c]?x[c].call(i,n,t,s):x[c],P(r)&&~r.indexOf("random(")&&(r=be(r)),ne(r+"")||(r+=E.units[c]||ne(rs(t,c))||""),"="===(r+"").charAt(1)&&(r=rs(t,c))):r=rs(t,c),l=parseFloat(r),(f="string"===h&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),c in wn&&("autoAlpha"===c&&(1===l&&"hidden"===rs(t,"visibility")&&a&&(l=0),b.push("visibility",0,T.visibility),es(this,T,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==c&&"transform"!==c&&~(c=wn[c]).indexOf(",")&&(c=c.split(",")[0])),g=c in _n)if(this.styles.save(c),m||((v=t._gsap).renderTransform&&!e.parseTransform||vs(t,e.parseTransform),_=!1!==e.smoothOrigin&&v.smooth,(m=this._pt=new Ri(this._pt,T,Gn,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===c)this._pt=new Ri(this._pt,v,"scaleY",v.scaleY,(f?vt(v.scaleY,f+a):a)-v.scaleY||0,Cn),this._pt.u=0,A.push("scaleY",c),c+="X";else{if("transformOrigin"===c){b.push(Un,0,T[Un]),o=ls(o),v.svg?ms(t,o,0,_,0,this):((p=parseFloat(o.split(" ")[2])||0)!==v.zOrigin&&es(this,v,"zOrigin",v.zOrigin,p),es(this,T,c,_s(r),_s(o)));continue}if("svgOrigin"===c){ms(t,o,1,_,0,this);continue}if(c in us){ws(this,v,c,l,f?vt(l,f+o):o);continue}if("smoothOrigin"===c){es(this,v,"smooth",v.smooth,o);continue}if("force3D"===c){v[c]=o;continue}if("transform"===c){Is(this,o,t);continue}}else c in T||(c=Yn(c)||c);if(g||(a||0===a)&&(l||0===l)&&!Sn.test(o)&&c in T)a||(a=0),(u=(r+"").substr((l+"").length))!==(p=ne(o)||(c in E.units?E.units[c]:u))&&(l=ss(t,c,r,p)),this._pt=new Ri(this._pt,g?v:T,c,l,(f?vt(l,f+a):a)-l,g||"px"!==p&&"zIndex"!==c||!1===e.autoRound?Cn:Pn),this._pt.u=p||0,u!==p&&"%"!==p&&(this._pt.b=r,this._pt.r=Rn);else if(c in T)os.call(this,t,c,r,f?f+o:o);else if(c in t)this.add(t,c,r||t[c],f?f+o:o,n,s);else if("parseTransform"!==c){q(c,o);continue}g||(c in T?b.push(c,0,T[c]):b.push(c,1,r||t[c])),A.push(c)}y&&Ii(this)},render:function(t,e){if(e.tween._time||!qi())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:rs,aliases:wn,getSetter:function(t,e,i){var n=wn[e];return n&&n.indexOf(",")<0&&(e=n),e in _n&&e!==Un&&(t._gsap.x||rs(t,"x"))?i&&$i===i?"scale"===e?Bn:kn:($i=i||{})&&("scale"===e?Fn:Nn):t.style&&!D(t.style[e])?Dn:~e.indexOf("-")?On:Ei(t,e)},core:{_removeProperty:ts,_getMatrix:gs}};zi.utils.checkPrefix=Yn,zi.core.getStyleSaver=jn,Ls="0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",Ms=ft((Rs="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Ps="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){_n[t]=1})),ft(Ps,(function(t){E.units[t]="deg",us[t]=1})),wn[Ms[13]]=Rs+","+Ps,ft(Ls,(function(t){var e=t.split(":");wn[e[1]]=Ms[e[0]]})),ft("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){E.units[t]="px"})),zi.registerPlugin(Ds);var Os=zi.registerPlugin(Ds)||zi,ks=Os.core.Tween;t.Back=cn,t.Bounce=pn,t.CSSPlugin=Ds,t.Circ=mn,t.Cubic=on,t.Elastic=dn,t.Expo=gn,t.Linear=sn,t.Power0=Qi,t.Power1=Ji,t.Power2=tn,t.Power3=en,t.Power4=nn,t.Quad=rn,t.Quart=an,t.Quint=ln,t.Sine=fn,t.SteppedEase=un,t.Strong=hn,t.TimelineLite=ei,t.TimelineMax=ei,t.TweenLite=gi,t.TweenMax=ks,t.default=Os,t.gsap=Os,"undefined"==typeof window||window!==t?Object.defineProperty(t,"__esModule",{value:!0}):delete window.default}(e)},185:t=>{"use strict";var e={foo:{}},i=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof i)}},405:(t,e,i)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,s=i(419);t.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&s())))}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,e);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},642:(t,e,i)=>{"use strict";var n=i(612);t.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},766:(t,e,i)=>{var n;!function(){"use strict";var s=function(){this.init()};s.prototype={init:function(){var t=this||r;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||r;if(t=parseFloat(t),e.ctx||p(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,r.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var o=e._howls[i]._soundById(n[s]);o&&o._node&&(o._node.volume=o._volume*t)}return e}return e._volume},mute:function(t){var e=this||r;e.ctx||p(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,r.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var o=e._howls[i]._soundById(n[s]);o&&o._node&&(o._node.muted=!!t||o._muted)}return e},stop:function(){for(var t=this||r,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||r,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,p()),t},codecs:function(t){return(this||r)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||r;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||r,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",s=n.match(/OPR\/([0-6].)/g),o=s&&parseInt(s[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),l=n.match(/Version\/(.*?) /),h=a&&l&&parseInt(l[1],10)<15;return t._codecs={mp3:!(o||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(h||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(h||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||r;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch(i){t.noAudio=!0;break}for(var s=0;s<t._howls.length;s++)if(!t._howls[s]._webAudio)for(var r=t._howls[s]._getSoundIds(),o=0;o<r.length;o++){var a=t._howls[s]._soundById(r[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var l=t.ctx.createBufferSource();l.buffer=t._scratchBuffer,l.connect(t.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),l.onended=function(){l.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||r;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||r;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&r.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&r.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var r=new s,o=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(t){var e=this;return r.ctx||p(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=r.usingWebAudio&&!e._html5,void 0!==r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(r.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var n,s;if(t._format&&t._format[i])n=t._format[i];else{if("string"!=typeof(s=t._src[i])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(s))||(n=/\.([^.]+)$/.exec(s.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&r.codecs(n)){e=t._src[i];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new a(t),t._webAudio&&h(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var i=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(void 0===t&&(t="__default",!i._playLock)){for(var s=0,o=0;o<i._sounds.length;o++)i._sounds[o]._paused&&!i._sounds[o]._ended&&(s++,n=i._sounds[o]._id);1===s?t=null:n=null}}var a=n?i._soundById(n):i._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==i._state){a._sprite=t,a._ended=!1;var l=a._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(n&&!a._paused)return e||i._loadQueue("play"),a._id;i._webAudio&&r._autoResume();var h=Math.max(0,a._seek>0?a._seek:i._sprite[t][0]/1e3),d=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-h),c=1e3*d/Math.abs(a._rate),u=i._sprite[t][0]/1e3,p=(i._sprite[t][0]+i._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var f=function(){a._paused=!1,a._seek=h,a._start=u,a._stop=p,a._loop=!(!a._loop&&!i._sprite[t][2])};if(!(h>=p)){var g=a._node;if(i._webAudio){var m=function(){i._playLock=!1,f(),i._refreshBuffer(a);var t=a._muted||i._muted?0:a._volume;g.gain.setValueAtTime(t,r.ctx.currentTime),a._playStart=r.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,h,86400):g.bufferSource.noteGrainOn(0,h,d):a._loop?g.bufferSource.start(0,h,86400):g.bufferSource.start(0,h,d),c!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),c)),e||setTimeout((function(){i._emit("play",a._id),i._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?m():(i._playLock=!0,i.once("resume",m),i._clearTimer(a._id))}else{var v=function(){g.currentTime=h,g.muted=a._muted||i._muted||r._muted||g.muted,g.volume=a._volume*r.volume(),g.playbackRate=a._rate;try{var n=g.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(i._playLock=!0,f(),n.then((function(){i._playLock=!1,g._unlocked=!0,e?i._loadQueue():i._emit("play",a._id)})).catch((function(){i._playLock=!1,i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(i._playLock=!1,f(),i._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),c):(i._endTimers[a._id]=function(){i._ended(a),g.removeEventListener("ended",i._endTimers[a._id],!1)},g.addEventListener("ended",i._endTimers[a._id],!1))}catch(t){i._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=i._src,g.load());var _=window&&window.ejecta||!g.readyState&&r._navigator.isCocoonJS;if(g.readyState>=3||_)v();else{i._playLock=!0,i._state="loading";var y=function(){i._state="loaded",v(),g.removeEventListener(r._canPlayEvent,y,!1)};g.addEventListener(r._canPlayEvent,y,!1),i._clearTimer(a._id)}}return a._id}i._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var s=e._soundById(i[n]);if(s&&!s._paused&&(s._seek=e.seek(i[n]),s._rateSeek=0,s._paused=!0,e._stopFade(i[n]),s._node))if(e._webAudio){if(!s._node.bufferSource)continue;void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),e._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||s._node.pause();arguments[1]||e._emit("pause",s?s._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),s=0;s<n.length;s++){i._clearTimer(n[s]);var r=i._soundById(n[s]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,i._stopFade(n[s]),r._node&&(i._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),i._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&i._clearSound(r._node))),e||i._emit("stop",r._id))}return i},mute:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(void 0===e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var n=i._getSoundIds(e),s=0;s<n.length;s++){var o=i._soundById(n[s]);o&&(o._muted=t,o._interval&&i._stopFade(o._id),i._webAudio&&o._node?o._node.gain.setValueAtTime(t?0:o._volume,r.ctx.currentTime):o._node&&(o._node.muted=!!r._muted||t),i._emit("mute",o._id))}return i},volume:function(){var t,e,i,n=this,s=arguments;if(0===s.length)return n._volume;if(1===s.length||2===s.length&&void 0===s[1]?n._getSoundIds().indexOf(s[0])>=0?e=parseInt(s[0],10):t=parseFloat(s[0]):s.length>=2&&(t=parseFloat(s[0]),e=parseInt(s[1],10)),!(void 0!==t&&t>=0&&t<=1))return(i=e?n._soundById(e):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,s)}}),n;void 0===e&&(n._volume=t),e=n._getSoundIds(e);for(var o=0;o<e.length;o++)(i=n._soundById(e[o]))&&(i._volume=t,s[2]||n._stopFade(e[o]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(t,r.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=t*r.volume()),n._emit("volume",i._id));return n},fade:function(t,e,i,n){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(t,e,i,n)}}),s;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),s.volume(t,n);for(var o=s._getSoundIds(n),a=0;a<o.length;a++){var l=s._soundById(o[a]);if(l){if(n||s._stopFade(o[a]),s._webAudio&&!l._muted){var h=r.ctx.currentTime,d=h+i/1e3;l._volume=t,l._node.gain.setValueAtTime(t,h),l._node.gain.linearRampToValueAtTime(e,d)}s._startFadeInterval(l,t,e,i,o[a],void 0===n)}}return s},_startFadeInterval:function(t,e,i,n,s,r){var o=this,a=e,l=i-e,h=Math.abs(l/.01),d=Math.max(4,h>0?n/h:n),c=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var s=(Date.now()-c)/n;c=Date.now(),a+=l*s,a=Math.round(100*a)/100,a=l<0?Math.max(i,a):Math.min(i,a),o._webAudio?t._volume=a:o.volume(a,t._id,!0),r&&(o._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,o.volume(i,t._id),o._emit("fade",t._id))}),d)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,i,n=this,s=arguments;if(0===s.length)return n._loop;if(1===s.length){if("boolean"!=typeof s[0])return!!(i=n._soundById(parseInt(s[0],10)))&&i._loop;t=s[0],n._loop=t}else 2===s.length&&(t=s[0],e=parseInt(s[1],10));for(var r=n._getSoundIds(e),o=0;o<r.length;o++)(i=n._soundById(r[o]))&&(i._loop=t,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,n.playing(r[o])&&(n.pause(r[o],!0),n.play(r[o],!0)))));return n},rate:function(){var t,e,i,n=this,s=arguments;if(0===s.length)e=n._sounds[0]._id;else if(1===s.length){n._getSoundIds().indexOf(s[0])>=0?e=parseInt(s[0],10):t=parseFloat(s[0])}else 2===s.length&&(t=parseFloat(s[0]),e=parseInt(s[1],10));if("number"!=typeof t)return(i=n._soundById(e))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,s)}}),n;void 0===e&&(n._rate=t),e=n._getSoundIds(e);for(var o=0;o<e.length;o++)if(i=n._soundById(e[o])){n.playing(e[o])&&(i._rateSeek=n.seek(e[o]),i._playStart=n._webAudio?r.ctx.currentTime:i._playStart),i._rate=t,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(t,r.ctx.currentTime):i._node&&(i._node.playbackRate=t);var a=n.seek(e[o]),l=1e3*((n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-a)/Math.abs(i._rate);!n._endTimers[e[o]]&&i._paused||(n._clearTimer(e[o]),n._endTimers[e[o]]=setTimeout(n._ended.bind(n,i),l)),n._emit("rate",i._id)}return n},seek:function(){var t,e,i=this,n=arguments;if(0===n.length)i._sounds.length&&(e=i._sounds[0]._id);else if(1===n.length){i._getSoundIds().indexOf(n[0])>=0?e=parseInt(n[0],10):i._sounds.length&&(e=i._sounds[0]._id,t=parseFloat(n[0]))}else 2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10));if(void 0===e)return 0;if("number"==typeof t&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var s=i._soundById(e);if(s){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var o=i.playing(e)?r.ctx.currentTime-s._playStart:0,a=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(a+o*Math.abs(s._rate))}return s._node.currentTime}var l=i.playing(e);l&&i.pause(e,!0),s._seek=t,s._ended=!1,i._clearTimer(e),i._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=t);var h=function(){l&&i.play(e,!0),i._emit("seek",e)};if(l&&!i._webAudio){var d=function(){i._playLock?setTimeout(d,0):h()};setTimeout(d,0)}else h()}return i},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var n=0;n<e._sounds.length;n++)if(!e._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,n=e._soundById(t);return n&&(i=e._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(r._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),r._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=r._howls.indexOf(t);n>=0&&r._howls.splice(n,1);var s=!0;for(i=0;i<r._howls.length;i++)if(r._howls[i]._src===t._src||t._src.indexOf(r._howls[i]._src)>=0){s=!1;break}return l&&s&&delete l[t._src],r.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var s=this["_on"+t];return"function"==typeof e&&s.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),this},off:function(t,e,i){var n=this,s=n["_on"+t],r=0;if("number"==typeof e&&(i=e,e=null),e||i)for(r=0;r<s.length;r++){var o=i===s[r].id;if(e===s[r].fn&&o||!e&&o){s.splice(r,1);break}}else if(t)n["_on"+t]=[];else{var a=Object.keys(n);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(n[a[r]])&&(n[a[r]]=[])}return n},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var n=this,s=n["_on"+t],r=s.length-1;r>=0;r--)s[r].id&&s[r].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(n,s[r].fn),0),s[r].once&&n.off(t,s[r].fn,s[r].id));return n._loadQueue(t),n},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!(!t._loop&&!e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=r.ctx.currentTime;var s=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),s)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),r._autoSuspend()),e._webAudio||n||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new a(t)},_drain:function(){var t=this,e=t._pool,i=0,n=0;if(!(t._sounds.length<e)){for(n=0;n<t._sounds.length;n++)t._sounds[n]._ended&&i++;for(n=t._sounds.length-1;n>=0;n--){if(i<=e)return;t._sounds[n]._ended&&(t._webAudio&&t._sounds[n]._node&&t._sounds[n]._node.disconnect(0),t._sounds.splice(n,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=r.ctx.createBufferSource(),t._node.bufferSource.buffer=l[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,r.ctx.currentTime),this},_cleanBuffer:function(t){var e=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=r._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(t){this._parent=t,this.init()};a.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++r._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=r._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),t._node.gain.setValueAtTime(i,r.ctx.currentTime),t._node.paused=!0,t._node.connect(r.masterGain)):r.noAudio||(t._node=r._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(r._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=i*r.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++r._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(r._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var l={},h=function(t){var e=t._src;if(l[e])return t._duration=l[e].duration,void u(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),s=0;s<i.length;++s)n[s]=i.charCodeAt(s);c(n.buffer,t)}else{var r=new XMLHttpRequest;r.open(t._xhr.method,e,!0),r.withCredentials=t._xhr.withCredentials,r.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){r.setRequestHeader(e,t._xhr.headers[e])})),r.onload=function(){var e=(r.status+"")[0];"0"===e||"2"===e||"3"===e?c(r.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete l[e],t.load())},d(r)}},d=function(t){try{t.send()}catch(e){t.onerror()}},c=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(t){t&&e._sounds.length>0?(l[e._src]=t,u(e,t)):i()};"undefined"!=typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(t).then(n).catch(i):r.ctx.decodeAudioData(t,n,i)},u=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},p=function(){if(r.usingWebAudio){try{"undefined"!=typeof AudioContext?r.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch(t){r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),e=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!n&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};void 0===(n=function(){return{Howler:r,Howl:o}}.apply(e,[]))||(t.exports=n),e.Howler=r,e.Howl=o,void 0!==i.g?(i.g.HowlerGlobal=s,i.g.Howler=r,i.g.Howl=o,i.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=s,window.Howler=r,window.Howl=o,window.Sound=a)}(),function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var n=this;return n.ctx&&n.ctx.listener?(e="number"!=typeof e?n._pos[1]:e,i="number"!=typeof i?n._pos[2]:i,"number"!=typeof t?n._pos:(n._pos=[t,e,i],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(t,e,i,n,s,r){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return e="number"!=typeof e?a[1]:e,i="number"!=typeof i?a[2]:i,n="number"!=typeof n?a[3]:n,s="number"!=typeof s?a[4]:s,r="number"!=typeof r?a[5]:r,"number"!=typeof t?a:(o._orientation=[t,e,i,n,s,r],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(s,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(r,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(t,e,i,n,s,r),o)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(t,i)}}),n;var s=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return n._stereo;n._stereo=t,n._pos=[t,0,0]}for(var r=n._getSoundIds(i),o=0;o<r.length;o++){var a=n._soundById(r[o]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,s),"spatial"===s?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(t,i,n,s){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(t,i,n,s)}}),r;if(i="number"!=typeof i?0:i,n="number"!=typeof n?-.5:n,void 0===s){if("number"!=typeof t)return r._pos;r._pos=[t,i,n]}for(var o=r._getSoundIds(s),a=0;a<o.length;a++){var l=r._soundById(o[a]);if(l){if("number"!=typeof t)return l._pos;l._pos=[t,i,n],l._node&&(l._panner&&!l._panner.pan||e(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(t,i,n)),r._emit("pos",l._id)}}return r},Howl.prototype.orientation=function(t,i,n,s){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(t,i,n,s)}}),r;if(i="number"!=typeof i?r._orientation[1]:i,n="number"!=typeof n?r._orientation[2]:n,void 0===s){if("number"!=typeof t)return r._orientation;r._orientation=[t,i,n]}for(var o=r._getSoundIds(s),a=0;a<o.length;a++){var l=r._soundById(o[a]);if(l){if("number"!=typeof t)return l._orientation;l._orientation=[t,i,n],l._node&&(l._panner||(l._pos||(l._pos=r._pos||[0,0,-.5]),e(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(t,i,n)),r._emit("orientation",l._id)}}return r},Howl.prototype.pannerAttr=function(){var t,i,n,s=this,r=arguments;if(!s._webAudio)return s;if(0===r.length)return s._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(n=s._soundById(parseInt(r[0],10)))?n._pannerAttr:s._pannerAttr;t=r[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),s._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:s._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:s._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:s._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:s._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:s._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:s._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:s._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:s._panningModel})}else 2===r.length&&(t=r[0],i=parseInt(r[1],10));for(var o=s._getSoundIds(i),a=0;a<o.length;a++)if(n=s._soundById(o[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:l.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:l.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:l.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:l.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:l.panningModel};var h=n._panner;h?(h.coneInnerAngle=l.coneInnerAngle,h.coneOuterAngle=l.coneOuterAngle,h.coneOuterGain=l.coneOuterGain,h.distanceModel=l.distanceModel,h.maxDistance=l.maxDistance,h.refDistance=l.refDistance,h.rolloffFactor=l.rolloffFactor,h.panningModel=l.panningModel):(n._pos||(n._pos=s._pos||[0,0,-.5]),e(n,"spatial"))}return s},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()},250:(t,e,i)=>{"use strict";e.__esModule=!0,function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i(883));var n=i(883);e.default=n.default},883:(t,e)=>{"use strict";e.__esModule=!0;var i=/iPhone/i,n=/iPod/i,s=/iPad/i,r=/\biOS-universal(?:.+)Mac\b/i,o=/\bAndroid(?:.+)Mobile\b/i,a=/Android/i,l=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,h=/Silk/i,d=/Windows Phone/i,c=/\bWindows(?:.+)ARM\b/i,u=/BlackBerry/i,p=/BB10/i,f=/Opera Mini/i,g=/\b(CriOS|Chrome)(?:.+)Mobile/i,m=/Mobile(?:.+)Firefox\b/i,v=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};e.default=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var _=e.userAgent,y=_.split("[FBAN");void 0!==y[1]&&(_=y[0]),void 0!==(y=_.split("Twitter"))[1]&&(_=y[0]);var E=function(t){return function(e){return e.test(t)}}(_),b={apple:{phone:E(i)&&!E(d),ipod:E(n),tablet:!E(i)&&(E(s)||v(e))&&!E(d),universal:E(r),device:(E(i)||E(n)||E(s)||E(r)||v(e))&&!E(d)},amazon:{phone:E(l),tablet:!E(l)&&E(h),device:E(l)||E(h)},android:{phone:!E(d)&&E(l)||!E(d)&&E(o),tablet:!E(d)&&!E(l)&&!E(o)&&(E(h)||E(a)),device:!E(d)&&(E(l)||E(h)||E(o)||E(a))||E(/\bokhttp\b/i)},windows:{phone:E(d),tablet:E(c),device:E(d)||E(c)},other:{blackberry:E(u),blackberry10:E(p),opera:E(f),firefox:E(m),chrome:E(g),device:E(u)||E(p)||E(f)||E(m)||E(g)},any:!1,phone:!1,tablet:!1};return b.any=b.apple.device||b.android.device||b.windows.device||b.other.device,b.phone=b.apple.phone||b.android.phone||b.windows.phone,b.tablet=b.apple.tablet||b.android.tablet||b.windows.tablet,b}},631:(t,e,i)=>{var n="function"==typeof Map&&Map.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=n&&s&&"function"==typeof s.get?s.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=a&&l&&"function"==typeof l.get?l.get:null,d=a&&Set.prototype.forEach,c="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,u="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,g=Object.prototype.toString,m=Function.prototype.toString,v=String.prototype.match,_=String.prototype.slice,y=String.prototype.replace,E=String.prototype.toUpperCase,b=String.prototype.toLowerCase,A=RegExp.prototype.test,T=Array.prototype.concat,x=Array.prototype.join,S=Array.prototype.slice,w=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,L="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,M=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function O(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||A.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-w(-t):w(t);if(n!==t){var s=String(n),r=_.call(e,s.length+1);return y.call(s,i,"$&_")+"."+y.call(y.call(r,/([0-9]{3})/g,"$&_"),/_$/,"")}}return y.call(e,i,"$&_")}var k=i(654),B=k.custom,F=V(B)?B:null;function N(t,e,i){var n="double"===(i.quoteStyle||e)?'"':"'";return n+t+n}function G(t){return y.call(String(t),/"/g,"&quot;")}function U(t){return!("[object Array]"!==W(t)||L&&"object"==typeof t&&L in t)}function H(t){return!("[object RegExp]"!==W(t)||L&&"object"==typeof t&&L in t)}function V(t){if(P)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!R)return!1;try{return R.call(t),!0}catch(t){}return!1}t.exports=function t(e,i,n,s){var a=i||{};if(j(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(j(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!j(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(j(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(j(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var g=a.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return K(e,a);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var E=String(e);return g?O(e,E):E}if("bigint"==typeof e){var A=String(e)+"n";return g?O(e,A):A}var w=void 0===a.depth?5:a.depth;if(void 0===n&&(n=0),n>=w&&w>0&&"object"==typeof e)return U(e)?"[Array]":"[Object]";var I=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=x.call(Array(t.indent+1)," ")}return{base:i,prev:x.call(Array(e+1),i)}}(a,n);if(void 0===s)s=[];else if(X(s,e)>=0)return"[Circular]";function B(e,i,r){if(i&&(s=S.call(s)).push(i),r){var o={depth:a.depth};return j(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),t(e,o,n+1,s)}return t(e,a,n+1,s)}if("function"==typeof e&&!H(e)){var z=function(t){if(t.name)return t.name;var e=v.call(m.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),Y=J(e,B);return"[Function"+(z?": "+z:" (anonymous)")+"]"+(Y.length>0?" { "+x.call(Y,", ")+" }":"")}if(V(e)){var tt=P?y.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):R.call(e);return"object"!=typeof e||P?tt:$(tt)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var et="<"+b.call(String(e.nodeName)),it=e.attributes||[],nt=0;nt<it.length;nt++)et+=" "+it[nt].name+"="+N(G(it[nt].value),"double",a);return et+=">",e.childNodes&&e.childNodes.length&&(et+="..."),et+="</"+b.call(String(e.nodeName))+">"}if(U(e)){if(0===e.length)return"[]";var st=J(e,B);return I&&!function(t){for(var e=0;e<t.length;e++)if(X(t[e],"\n")>=0)return!1;return!0}(st)?"["+Q(st,I)+"]":"[ "+x.call(st,", ")+" ]"}if(function(t){return!("[object Error]"!==W(t)||L&&"object"==typeof t&&L in t)}(e)){var rt=J(e,B);return"cause"in Error.prototype||!("cause"in e)||M.call(e,"cause")?0===rt.length?"["+String(e)+"]":"{ ["+String(e)+"] "+x.call(rt,", ")+" }":"{ ["+String(e)+"] "+x.call(T.call("[cause]: "+B(e.cause),rt),", ")+" }"}if("object"==typeof e&&l){if(F&&"function"==typeof e[F]&&k)return k(e,{depth:w-n});if("symbol"!==l&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!r||!t||"object"!=typeof t)return!1;try{r.call(t);try{h.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var ot=[];return o&&o.call(e,(function(t,i){ot.push(B(i,e,!0)+" => "+B(t,e))})),Z("Map",r.call(e),ot,I)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t);try{r.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var at=[];return d&&d.call(e,(function(t){at.push(B(t,e))})),Z("Set",h.call(e),at,I)}if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{u.call(t,u)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return q("WeakMap");if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t,u);try{c.call(t,c)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return q("WeakSet");if(function(t){if(!p||!t||"object"!=typeof t)return!1;try{return p.call(t),!0}catch(t){}return!1}(e))return q("WeakRef");if(function(t){return!("[object Number]"!==W(t)||L&&"object"==typeof t&&L in t)}(e))return $(B(Number(e)));if(function(t){if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(t){}return!1}(e))return $(B(C.call(e)));if(function(t){return!("[object Boolean]"!==W(t)||L&&"object"==typeof t&&L in t)}(e))return $(f.call(e));if(function(t){return!("[object String]"!==W(t)||L&&"object"==typeof t&&L in t)}(e))return $(B(String(e)));if(!function(t){return!("[object Date]"!==W(t)||L&&"object"==typeof t&&L in t)}(e)&&!H(e)){var lt=J(e,B),ht=D?D(e)===Object.prototype:e instanceof Object||e.constructor===Object,dt=e instanceof Object?"":"null prototype",ct=!ht&&L&&Object(e)===e&&L in e?_.call(W(e),8,-1):dt?"Object":"",ut=(ht||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(ct||dt?"["+x.call(T.call([],ct||[],dt||[]),": ")+"] ":"");return 0===lt.length?ut+"{}":I?ut+"{"+Q(lt,I)+"}":ut+"{ "+x.call(lt,", ")+" }"}return String(e)};var z=Object.prototype.hasOwnProperty||function(t){return t in this};function j(t,e){return z.call(t,e)}function W(t){return g.call(t)}function X(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}function K(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,n="... "+i+" more character"+(i>1?"s":"");return K(_.call(t,0,e.maxStringLength),e)+n}return N(y.call(y.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Y),"single",e)}function Y(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+E.call(e.toString(16))}function $(t){return"Object("+t+")"}function q(t){return t+" { ? }"}function Z(t,e,i,n){return t+" ("+e+") {"+(n?Q(i,n):x.call(i,", "))+"}"}function Q(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+x.call(t,","+i)+"\n"+e.prev}function J(t,e){var i=U(t),n=[];if(i){n.length=t.length;for(var s=0;s<t.length;s++)n[s]=j(t,s)?e(t[s],t):""}var r,o="function"==typeof I?I(t):[];if(P){r={};for(var a=0;a<o.length;a++)r["$"+o[a]]=o[a]}for(var l in t)j(t,l)&&(i&&String(Number(l))===l&&l<t.length||P&&r["$"+l]instanceof Symbol||(A.call(/[^\w$]/,l)?n.push(e(l,t)+": "+e(t[l],t)):n.push(l+": "+e(t[l],t))));if("function"==typeof I)for(var h=0;h<o.length;h++)M.call(t,o[h])&&n.push("["+e(o[h])+"]: "+e(t[o[h]],t));return n}},478:(t,e,i)=>{"use strict";var n=i(210),s=i(924),r=i(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),l=n("%Map%",!0),h=s("WeakMap.prototype.get",!0),d=s("WeakMap.prototype.set",!0),c=s("WeakMap.prototype.has",!0),u=s("Map.prototype.get",!0),p=s("Map.prototype.set",!0),f=s("Map.prototype.has",!0),g=function(t,e){for(var i,n=t;null!==(i=n.next);n=i)if(i.key===e)return n.next=i.next,i.next=t.next,t.next=i,i};t.exports=function(){var t,e,i,n={assert:function(t){if(!n.has(t))throw new o("Side channel does not contain "+r(t))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return h(t,n)}else if(l){if(e)return u(e,n)}else if(i)return function(t,e){var i=g(t,e);return i&&i.value}(i,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return c(t,n)}else if(l){if(e)return f(e,n)}else if(i)return function(t,e){return!!g(t,e)}(i,n);return!1},set:function(n,s){a&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new a),d(t,n,s)):l?(e||(e=new l),p(e,n,s)):(i||(i={key:{},next:null}),function(t,e,i){var n=g(t,e);n?n.value=i:t.next={key:e,next:t.next,value:i}}(i,n,s))}};return n}},511:function(t,e,i){var n;t=i.nmd(t),function(s){e&&e.nodeType,t&&t.nodeType;var r="object"==typeof i.g&&i.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,l=36,h=1,d=26,c=38,u=700,p=72,f=128,g="-",m=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,b=Math.floor,A=String.fromCharCode;function T(t){throw new RangeError(y[t])}function x(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function S(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+x((t=t.replace(_,".")).split("."),e).join(".")}function w(t){for(var e,i,n=[],s=0,r=t.length;s<r;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<r?56320==(64512&(i=t.charCodeAt(s++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),s--):n.push(e);return n}function C(t){return x(t,(function(t){var e="";return t>65535&&(e+=A((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=A(t)})).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,i){var n=0;for(t=i?b(t/u):t>>1,t+=b(t/e);t>E*d>>1;n+=l)t=b(t/E);return b(n+(E+1)*t/(t+c))}function P(t){var e,i,n,s,r,o,c,u,m,v,_,y=[],E=t.length,A=0,x=f,S=p;for((i=t.lastIndexOf(g))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&T("not-basic"),y.push(t.charCodeAt(n));for(s=i>0?i+1:0;s<E;){for(r=A,o=1,c=l;s>=E&&T("invalid-input"),((u=(_=t.charCodeAt(s++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:l)>=l||u>b((a-A)/o))&&T("overflow"),A+=u*o,!(u<(m=c<=S?h:c>=S+d?d:c-S));c+=l)o>b(a/(v=l-m))&&T("overflow"),o*=v;S=R(A-r,e=y.length+1,0==r),b(A/e)>a-x&&T("overflow"),x+=b(A/e),A%=e,y.splice(A++,0,x)}return C(y)}function L(t){var e,i,n,s,r,o,c,u,m,v,_,y,E,x,S,C=[];for(y=(t=w(t)).length,e=f,i=0,r=p,o=0;o<y;++o)(_=t[o])<128&&C.push(A(_));for(n=s=C.length,s&&C.push(g);n<y;){for(c=a,o=0;o<y;++o)(_=t[o])>=e&&_<c&&(c=_);for(c-e>b((a-i)/(E=n+1))&&T("overflow"),i+=(c-e)*E,e=c,o=0;o<y;++o)if((_=t[o])<e&&++i>a&&T("overflow"),_==e){for(u=i,m=l;!(u<(v=m<=r?h:m>=r+d?d:m-r));m+=l)S=u-v,x=l-v,C.push(A(I(v+S%x,0))),u=b(S/x);C.push(A(I(u,0))),r=R(i,E,n==s),i=0,++n}++i,++e}return C.join("")}o={version:"1.4.1",ucs2:{decode:w,encode:C},decode:P,encode:L,toASCII:function(t){return S(t,(function(t){return v.test(t)?"xn--"+L(t):t}))},toUnicode:function(t){return S(t,(function(t){return m.test(t)?P(t.slice(4).toLowerCase()):t}))}},void 0===(n=function(){return o}.call(e,i,e,t))||(t.exports=n)}()},532:t=>{"use strict";var e=String.prototype.replace,i=/%20/g,n="RFC1738",s="RFC3986";t.exports={default:s,formatters:{RFC1738:function(t){return e.call(t,i,"+")},RFC3986:function(t){return String(t)}},RFC1738:n,RFC3986:s}},984:(t,e,i)=>{"use strict";var n=i(730),s=i(325),r=i(532);t.exports={formats:r,parse:s,stringify:n}},325:(t,e,i)=>{"use strict";var n=i(368),s=Object.prototype.hasOwnProperty,r=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},h=function(t,e,i,n){if(t){var r=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(r),h=a?r.slice(0,a.index):r,d=[];if(h){if(!i.plainObjects&&s.call(Object.prototype,h)&&!i.allowPrototypes)return;d.push(h)}for(var c=0;i.depth>0&&null!==(a=o.exec(r))&&c<i.depth;){if(c+=1,!i.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;d.push(a[1])}return a&&d.push("["+r.slice(a.index)+"]"),function(t,e,i,n){for(var s=n?e:l(e,i),r=t.length-1;r>=0;--r){var o,a=t[r];if("[]"===a&&i.parseArrays)o=[].concat(s);else{o=i.plainObjects?Object.create(null):{};var h="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,d=parseInt(h,10);i.parseArrays||""!==h?!isNaN(d)&&a!==h&&String(d)===h&&d>=0&&i.parseArrays&&d<=i.arrayLimit?(o=[])[d]=s:"__proto__"!==h&&(o[h]=s):o={0:s}}s=o}return s}(d,e,i,n)}};t.exports=function(t,e){var i=function(t){if(!t)return o;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?o.charset:t.charset;return{allowDots:void 0===t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var d="string"==typeof t?function(t,e){var i,h={__proto__:null},d=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,c=e.parameterLimit===1/0?void 0:e.parameterLimit,u=d.split(e.delimiter,c),p=-1,f=e.charset;if(e.charsetSentinel)for(i=0;i<u.length;++i)0===u[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===u[i]?f="utf-8":"utf8=%26%2310003%3B"===u[i]&&(f="iso-8859-1"),p=i,i=u.length);for(i=0;i<u.length;++i)if(i!==p){var g,m,v=u[i],_=v.indexOf("]="),y=-1===_?v.indexOf("="):_+1;-1===y?(g=e.decoder(v,o.decoder,f,"key"),m=e.strictNullHandling?null:""):(g=e.decoder(v.slice(0,y),o.decoder,f,"key"),m=n.maybeMap(l(v.slice(y+1),e),(function(t){return e.decoder(t,o.decoder,f,"value")}))),m&&e.interpretNumericEntities&&"iso-8859-1"===f&&(m=a(m)),v.indexOf("[]=")>-1&&(m=r(m)?[m]:m),s.call(h,g)?h[g]=n.combine(h[g],m):h[g]=m}return h}(t,i):t,c=i.plainObjects?Object.create(null):{},u=Object.keys(d),p=0;p<u.length;++p){var f=u[p],g=h(f,d[f],i,"string"==typeof t);c=n.merge(c,g,i)}return!0===i.allowSparse?c:n.compact(c)}},730:(t,e,i)=>{"use strict";var n=i(478),s=i(368),r=i(532),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,h=Array.prototype.push,d=function(t,e){h.apply(t,l(e)?e:[e])},c=Date.prototype.toISOString,u=r.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:s.encode,encodeValuesOnly:!1,format:u,formatter:r.formatters[u],indices:!1,serializeDate:function(t){return c.call(t)},skipNulls:!1,strictNullHandling:!1},f={},g=function t(e,i,r,o,a,h,c,u,g,m,v,_,y,E,b,A){for(var T,x=e,S=A,w=0,C=!1;void 0!==(S=S.get(f))&&!C;){var I=S.get(e);if(w+=1,void 0!==I){if(I===w)throw new RangeError("Cyclic object value");C=!0}void 0===S.get(f)&&(w=0)}if("function"==typeof u?x=u(i,x):x instanceof Date?x=v(x):"comma"===r&&l(x)&&(x=s.maybeMap(x,(function(t){return t instanceof Date?v(t):t}))),null===x){if(a)return c&&!E?c(i,p.encoder,b,"key",_):i;x=""}if("string"==typeof(T=x)||"number"==typeof T||"boolean"==typeof T||"symbol"==typeof T||"bigint"==typeof T||s.isBuffer(x))return c?[y(E?i:c(i,p.encoder,b,"key",_))+"="+y(c(x,p.encoder,b,"value",_))]:[y(i)+"="+y(String(x))];var R,P=[];if(void 0===x)return P;if("comma"===r&&l(x))E&&c&&(x=s.maybeMap(x,c)),R=[{value:x.length>0?x.join(",")||null:void 0}];else if(l(u))R=u;else{var L=Object.keys(x);R=g?L.sort(g):L}for(var M=o&&l(x)&&1===x.length?i+"[]":i,D=0;D<R.length;++D){var O=R[D],k="object"==typeof O&&void 0!==O.value?O.value:x[O];if(!h||null!==k){var B=l(x)?"function"==typeof r?r(M,O):M:M+(m?"."+O:"["+O+"]");A.set(e,w);var F=n();F.set(f,A),d(P,t(k,B,r,o,a,h,"comma"===r&&E&&l(x)?null:c,u,g,m,v,_,y,E,b,F))}}return P};t.exports=function(t,e){var i,s=t,h=function(t){if(!t)return p;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||p.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=r.default;if(void 0!==t.format){if(!o.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=r.formatters[i],s=p.filter;return("function"==typeof t.filter||l(t.filter))&&(s=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===t.allowDots?p.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:p.charsetSentinel,delimiter:void 0===t.delimiter?p.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:p.encode,encoder:"function"==typeof t.encoder?t.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:p.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:p.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:p.strictNullHandling}}(e);"function"==typeof h.filter?s=(0,h.filter)("",s):l(h.filter)&&(i=h.filter);var c,u=[];if("object"!=typeof s||null===s)return"";c=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var f=a[c];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===f&&e&&e.commaRoundTrip;i||(i=Object.keys(s)),h.sort&&i.sort(h.sort);for(var v=n(),_=0;_<i.length;++_){var y=i[_];h.skipNulls&&null===s[y]||d(u,g(s[y],y,f,m,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,v))}var E=u.join(h.delimiter),b=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),E.length>0?b+E:""}},368:(t,e,i)=>{"use strict";var n=i(532),s=Object.prototype.hasOwnProperty,r=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(i[n]=t[n]);return i};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],d=o[h];"object"==typeof d&&null!==d&&-1===i.indexOf(d)&&(e.push({obj:o,prop:h}),i.push(d))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(r(i)){for(var n=[],s=0;s<i.length;++s)void 0!==i[s]&&n.push(i[s]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,i){var n=t.replace(/\+/g," ");if("iso-8859-1"===i)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,i,s,r){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",h=0;h<a.length;++h){var d=a.charCodeAt(h);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||r===n.RFC1738&&(40===d||41===d)?l+=a.charAt(h):d<128?l+=o[d]:d<2048?l+=o[192|d>>6]+o[128|63&d]:d<55296||d>=57344?l+=o[224|d>>12]+o[128|d>>6&63]+o[128|63&d]:(h+=1,d=65536+((1023&d)<<10|1023&a.charCodeAt(h)),l+=o[240|d>>18]+o[128|d>>12&63]+o[128|d>>6&63]+o[128|63&d])}return l},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(r(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i}return e(t)},merge:function t(e,i,n){if(!i)return e;if("object"!=typeof i){if(r(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(n&&(n.plainObjects||n.allowPrototypes)||!s.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var o=e;return r(e)&&!r(i)&&(o=a(e,n)),r(e)&&r(i)?(i.forEach((function(i,r){if(s.call(e,r)){var o=e[r];o&&"object"==typeof o&&i&&"object"==typeof i?e[r]=t(o,i,n):e.push(i)}else e[r]=i})),e):Object.keys(i).reduce((function(e,r){var o=i[r];return s.call(e,r)?e[r]=t(e[r],o,n):e[r]=o,e}),o)}}},575:(t,e,i)=>{"use strict";var n=i(511);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(l),d=["%","/","?",";","#"].concat(h),c=["/","?","#"],u=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=i(984);function _(t,e,i){if(t&&"object"==typeof t&&t instanceof s)return t;var n=new s;return n.parse(t,e,i),n}s.prototype.parse=function(t,e,i){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),o=-1!==s&&s<t.indexOf("#")?"?":"#",l=t.split(o);l[0]=l[0].replace(/\\/g,"/");var _=t=l.join(o);if(_=_.trim(),!i&&1===t.split("#").length){var y=a.exec(_);if(y)return this.path=_,this.href=_,this.pathname=y[1],y[2]?(this.search=y[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var E=r.exec(_);if(E){var b=(E=E[0]).toLowerCase();this.protocol=b,_=_.substr(E.length)}if(i||E||_.match(/^\/\/[^@/]+@[^@/]+/)){var A="//"===_.substr(0,2);!A||E&&g[E]||(_=_.substr(2),this.slashes=!0)}if(!g[E]&&(A||E&&!m[E])){for(var T,x,S=-1,w=0;w<c.length;w++){-1!==(C=_.indexOf(c[w]))&&(-1===S||C<S)&&(S=C)}-1!==(x=-1===S?_.lastIndexOf("@"):_.lastIndexOf("@",S))&&(T=_.slice(0,x),_=_.slice(x+1),this.auth=decodeURIComponent(T)),S=-1;for(w=0;w<d.length;w++){var C;-1!==(C=_.indexOf(d[w]))&&(-1===S||C<S)&&(S=C)}-1===S&&(S=_.length),this.host=_.slice(0,S),_=_.slice(S),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var R=this.hostname.split(/\./),P=(w=0,R.length);w<P;w++){var L=R[w];if(L&&!L.match(u)){for(var M="",D=0,O=L.length;D<O;D++)L.charCodeAt(D)>127?M+="x":M+=L[D];if(!M.match(u)){var k=R.slice(0,w),B=R.slice(w+1),F=L.match(p);F&&(k.push(F[1]),B.unshift(F[2])),B.length&&(_="/"+B.join(".")+_),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+N,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!f[b])for(w=0,P=h.length;w<P;w++){var U=h[w];if(-1!==_.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),_=_.split(U).join(H)}}var V=_.indexOf("#");-1!==V&&(this.hash=_.substr(V),_=_.slice(0,V));var z=_.indexOf("?");if(-1!==z?(this.search=_.substr(z),this.query=_.substr(z+1),e&&(this.query=v.parse(this.query)),_=_.slice(0,z)):e&&(this.search="",this.query={}),_&&(this.pathname=_),m[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var j=this.search||"";this.path=N+j}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",s=!1,r="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(r=v.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||r&&"?"+r||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||m[e])&&!1!==s?(s="//"+(s||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):s||(s=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+s+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+n},s.prototype.resolve=function(t){return this.resolveObject(_(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if("string"==typeof t){var e=new s;e.parse(t,!1,!0),t=e}for(var i=new s,n=Object.keys(this),r=0;r<n.length;r++){var o=n[r];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var h=a[l];"protocol"!==h&&(i[h]=t[h])}return m[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!m[t.protocol]){for(var d=Object.keys(t),c=0;c<d.length;c++){var u=d[c];i[u]=t[u]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||g[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var f=i.pathname||"",v=i.search||"";i.path=f+v}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var _=i.pathname&&"/"===i.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),E=y||_||i.host&&t.pathname,b=E,A=i.pathname&&i.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!m[i.protocol]);if(T&&(i.hostname="",i.port=null,i.host&&(""===A[0]?A[0]=i.host:A.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),E=E&&(""===p[0]||""===A[0])),y)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,A=p;else if(p.length)A||(A=[]),A.pop(),A=A.concat(p),i.search=t.search,i.query=t.query;else if(null!=t.search){if(T)i.host=A.shift(),i.hostname=i.host,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname);return i.search=t.search,i.query=t.query,null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!A.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var x=A.slice(-1)[0],S=(i.host||t.host||A.length>1)&&("."===x||".."===x)||""===x,w=0,C=A.length;C>=0;C--)"."===(x=A[C])?A.splice(C,1):".."===x?(A.splice(C,1),w++):w&&(A.splice(C,1),w--);if(!E&&!b)for(;w--;w)A.unshift("..");!E||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),S&&"/"!==A.join("/").substr(-1)&&A.push("");var I,R=""===A[0]||A[0]&&"/"===A[0].charAt(0);T&&(i.hostname=R?"":A.length?A.shift():"",i.host=i.hostname,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname));return(E=E||i.host&&A.length)&&!R&&A.unshift(""),A.length>0?i.pathname=A.join("/"):(i.pathname=null,i.path=null),null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},s.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=_,e.DB=function(t,e){return _(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=_(t)),t instanceof s?t.format():s.prototype.format.call(t)}},933:(t,e,i)=>{var n;!function(){function s(t,e,i){return t.call.apply(t.bind,arguments)}function r(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function o(t,e,i){return(o=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:r).apply(null,arguments)}var a=Date.now||function(){return+new Date};function l(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var h=!!window.FontFace;function d(t,e,i,n){if(e=t.c.createElement(e),i)for(var s in i)i.hasOwnProperty(s)&&("style"==s?e.style.cssText=i[s]:e.setAttribute(s,i[s]));return n&&e.appendChild(t.c.createTextNode(n)),e}function c(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function p(t,e,i){e=e||[],i=i||[];for(var n=t.className.split(/\s+/),s=0;s<e.length;s+=1){for(var r=!1,o=0;o<n.length;o+=1)if(e[s]===n[o]){r=!0;break}r||n.push(e[s])}for(e=[],s=0;s<n.length;s+=1){for(r=!1,o=0;o<i.length;o+=1)if(n[s]===i[o]){r=!0;break}r||e.push(n[s])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function f(t,e){for(var i=t.className.split(/\s+/),n=0,s=i.length;n<s;n++)if(i[n]==e)return!0;return!1}function g(t,e,i){function n(){a&&s&&r&&(a(o),a=null)}e=d(t,"link",{rel:"stylesheet",href:e,media:"all"});var s=!1,r=!0,o=null,a=i||null;h?(e.onload=function(){s=!0,n()},e.onerror=function(){s=!0,o=Error("Stylesheet failed to load"),n()}):setTimeout((function(){s=!0,n()}),0),c(t,"head",e)}function m(t,e,i,n){var s=t.c.getElementsByTagName("head")[0];if(s){var r=d(t,"script",{src:e}),o=!1;return r.onload=r.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,i&&i(null),r.onload=r.onreadystatechange=null,"HEAD"==r.parentNode.tagName&&s.removeChild(r))},s.appendChild(r),setTimeout((function(){o||(o=!0,i&&i(Error("Script load timeout")))}),n||5e3),r}return null}function v(){this.a=0,this.c=null}function _(t){return t.a++,function(){t.a--,E(t)}}function y(t,e){t.c=e,E(t)}function E(t){0==t.a&&t.c&&(t.c(),t.c=null)}function b(t){this.a=t||"-"}function A(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function T(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var n=t[i].replace(/['"]/g,"");-1!=n.indexOf(" ")||/^\d/.test(n)?e.push("'"+n+"'"):e.push(n)}return e.join(",")}function x(t){return t.a+t.f}function S(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function w(t){var e=4,i="n",n=null;return t&&((n=t.match(/(normal|oblique|italic)/i))&&n[1]&&(i=n[1].substr(0,1).toLowerCase()),(n=t.match(/([1-9]00|normal|bold)/i))&&n[1]&&(/bold/i.test(n[1])?e=7:/[1-9]00/.test(n[1])&&(e=parseInt(n[1].substr(0,1),10)))),i+e}function C(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new b("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function I(t){if(t.g){var e=f(t.f,t.a.c("wf","active")),i=[],n=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),p(t.f,i,n)}R(t,"inactive")}function R(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,x(i)):t.h[e]())}function P(){this.c={}}function L(t,e){this.c=t,this.f=e,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function M(t){c(t.c,"body",t.a)}function D(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+T(t.c)+";font-style:"+S(t)+";font-weight:"+t.f+"00;"}function O(t,e,i,n,s,r){this.g=t,this.j=e,this.a=n,this.c=i,this.f=s||3e3,this.h=r||void 0}function k(t,e,i,n,s,r,o){this.v=t,this.B=e,this.c=i,this.a=n,this.s=o||"BESbswy",this.f={},this.w=s||3e3,this.u=r||null,this.m=this.j=this.h=this.g=null,this.g=new L(this.c,this.s),this.h=new L(this.c,this.s),this.j=new L(this.c,this.s),this.m=new L(this.c,this.s),t=D(t=new A(this.a.c+",serif",x(this.a))),this.g.a.style.cssText=t,t=D(t=new A(this.a.c+",sans-serif",x(this.a))),this.h.a.style.cssText=t,t=D(t=new A("serif",x(this.a))),this.j.a.style.cssText=t,t=D(t=new A("sans-serif",x(this.a))),this.m.a.style.cssText=t,M(this.g),M(this.h),M(this.j),M(this.m)}b.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},O.prototype.start=function(){var t=this.c.o.document,e=this,i=a(),n=new Promise((function(n,s){!function r(){a()-i>=e.f?s():t.fonts.load(function(t){return S(t)+" "+t.f+"00 300px "+T(t.c)}(e.a),e.h).then((function(t){1<=t.length?n():setTimeout(r,25)}),(function(){s()}))}()})),s=null,r=new Promise((function(t,i){s=setTimeout(i,e.f)}));Promise.race([r,n]).then((function(){s&&(clearTimeout(s),s=null),e.g(e.a)}),(function(){e.j(e.a)}))};var B={D:"serif",C:"sans-serif"},F=null;function N(){if(null===F){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);F=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return F}function G(t,e,i){for(var n in B)if(B.hasOwnProperty(n)&&e===t.f[B[n]]&&i===t.f[B[n]])return!0;return!1}function U(t){var e,i=t.g.a.offsetWidth,n=t.h.a.offsetWidth;(e=i===t.f.serif&&n===t.f["sans-serif"])||(e=N()&&G(t,i,n)),e?a()-t.A>=t.w?N()&&G(t,i,n)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?H(t,t.v):H(t,t.B):function(t){setTimeout(o((function(){U(this)}),t),50)}(t):H(t,t.v)}function H(t,e){setTimeout(o((function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),e(this.a)}),t),0)}function V(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}k.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=a(),U(this)};var z=null;function j(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&p(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),R(t,"active")):I(t.a))}function W(t){this.j=t,this.a=new P,this.h=0,this.f=this.g=!0}function X(t,e,i,n,s){var r=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=s||null,a=n||{};if(0===i.length&&r)I(e.a);else{e.f+=i.length,r&&(e.j=r);var l,h=[];for(l=0;l<i.length;l++){var d=i[l],c=a[d.c],u=e.a,f=d;if(u.g&&p(u.f,[u.a.c("wf",f.c,x(f).toString(),"loading")]),R(u,"fontloading",f),u=null,null===z)if(window.FontFace){f=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);z=f?42<parseInt(f[1],10):!g}else z=!1;u=z?new O(o(e.g,e),o(e.h,e),e.c,d,e.s,c):new k(o(e.g,e),o(e.h,e),e.c,d,e.s,t,c),h.push(u)}for(l=0;l<h.length;l++)h[l].start()}}),0)}function K(t,e){this.c=t,this.a=e}function Y(t,e){this.c=t,this.a=e}function $(t,e){this.c=t||q,this.a=[],this.f=[],this.g=e||""}V.prototype.g=function(t){var e=this.a;e.g&&p(e.f,[e.a.c("wf",t.c,x(t).toString(),"active")],[e.a.c("wf",t.c,x(t).toString(),"loading"),e.a.c("wf",t.c,x(t).toString(),"inactive")]),R(e,"fontactive",t),this.m=!0,j(this)},V.prototype.h=function(t){var e=this.a;if(e.g){var i=f(e.f,e.a.c("wf",t.c,x(t).toString(),"active")),n=[],s=[e.a.c("wf",t.c,x(t).toString(),"loading")];i||n.push(e.a.c("wf",t.c,x(t).toString(),"inactive")),p(e.f,n,s)}R(e,"fontinactive",t),j(this)},W.prototype.load=function(t){this.c=new l(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var n=[],s=i.timeout;!function(t){t.g&&p(t.f,[t.a.c("wf","loading")]),R(t,"loading")}(e);n=function(t,e,i){var n,s=[];for(n in e)if(e.hasOwnProperty(n)){var r=t.c[n];r&&s.push(r(e[n],i))}return s}(t.a,i,t.c);var r=new V(t.c,e,s);for(t.h=n.length,e=0,i=n.length;e<i;e++)n[e].load((function(e,i,n){X(t,r,e,i,n)}))}(this,new C(this.c,t),t)},K.prototype.load=function(t){function e(){if(r["__mti_fntLst"+n]){var i,s=r["__mti_fntLst"+n](),o=[];if(s)for(var a=0;a<s.length;a++){var l=s[a].fontfamily;null!=s[a].fontStyle&&null!=s[a].fontWeight?(i=s[a].fontStyle+s[a].fontWeight,o.push(new A(l,i))):o.push(new A(l))}t(o)}else setTimeout((function(){e()}),50)}var i=this,n=i.a.projectId,s=i.a.version;if(n){var r=i.c.o;m(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+n+".js"+(s?"?v="+s:""),(function(s){s?t([]):(r["__MonotypeConfiguration__"+n]=function(){return i.a},e())})).id="__MonotypeAPIScript__"+n}else t([])},Y.prototype.load=function(t){var e,i,n=this.a.urls||[],s=this.a.families||[],r=this.a.testStrings||{},o=new v;for(e=0,i=n.length;e<i;e++)g(this.c,n[e],_(o));var a=[];for(e=0,i=s.length;e<i;e++)if((n=s[e].split(":"))[1])for(var l=n[1].split(","),h=0;h<l.length;h+=1)a.push(new A(n[0],l[h]));else a.push(new A(n[0]));y(o,(function(){t(a,r)}))};var q="https://fonts.googleapis.com/css";function Z(t){this.f=t,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"",cyrillic:"",greek:"",khmer:"",Hanuman:""},J={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},tt={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function it(t,e){this.c=t,this.a=e}var nt={Arimo:!0,Cousine:!0,Tinos:!0};function st(t,e){this.c=t,this.a=e}function rt(t,e){this.c=t,this.f=e,this.a=[]}it.prototype.load=function(t){var e=new v,i=this.c,n=new $(this.a.api,this.a.text),s=this.a.families;!function(t,e){for(var i=e.length,n=0;n<i;n++){var s=e[n].split(":");3==s.length&&t.f.push(s.pop());var r="";2==s.length&&""!=s[1]&&(r=":"),t.a.push(s.join(r))}}(n,s);var r=new Z(s);!function(t){for(var e=t.f.length,i=0;i<e;i++){var n=t.f[i].split(":"),s=n[0].replace(/\+/g," "),r=["n4"];if(2<=n.length){var o;if(o=[],a=n[1])for(var a,l=(a=a.split(",")).length,h=0;h<l;h++){var d;if((d=a[h]).match(/^[\w-]+$/))if(null==(c=et.exec(d.toLowerCase())))d="";else{if(d=null==(d=c[2])||""==d?"n":tt[d],null==(c=c[1])||""==c)c="4";else var c=J[c]||(isNaN(c)?"4":c.substr(0,1));d=[d,c].join("")}else d="";d&&o.push(d)}0<o.length&&(r=o),3==n.length&&(o=[],0<(n=(n=n[2])?n.split(","):o).length&&(n=Q[n[0]])&&(t.c[s]=n))}for(t.c[s]||(n=Q[s])&&(t.c[s]=n),n=0;n<r.length;n+=1)t.a.push(new A(s,r[n]))}}(r),g(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],n=0;n<e;n++)i.push(t.a[n].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(n),_(e)),y(e,(function(){t(r.a,r.c,nt)}))},st.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var n=[],s=0;s<e.length;s+=2)for(var r=e[s],o=e[s+1],a=0;a<o.length;a++)n.push(new A(r,o[a]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(n)}}),2e3):t([])},rt.prototype.load=function(t){var e=this.f.id,i=this.c.o,n=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var s=0,r=i.fonts.length;s<r;++s){var o=i.fonts[s];n.a.push(new A(o.name,w("font-weight:"+o.weight+";font-style:"+o.style)))}t(n.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var ot=new W(window);ot.a.c.custom=function(t,e){return new Y(e,t)},ot.a.c.fontdeck=function(t,e){return new rt(e,t)},ot.a.c.monotype=function(t,e){return new K(e,t)},ot.a.c.typekit=function(t,e){return new st(e,t)},ot.a.c.google=function(t,e){return new it(e,t)};var at={load:o(ot.load,ot)};void 0===(n=function(){return at}.call(e,i,e,t))||(t.exports=n)}()},654:()=>{}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=i(729),e=i.n(t);class n{constructor(...e){this.eventEmitter=new t}addEventListener(t,e){this.eventEmitter.addListener(t,e)}removeAllEventListeners(t){this.eventEmitter.removeAllListeners(t)}removeEventListener(t,e){this.eventEmitter.removeListener(t,e)}dispatchEvent(t,...e){this.eventEmitter.emit(t,...e)}}class s{static addEventListener(t,e,i){const n=t;n.addEventListener?n.addEventListener(e,i):t.on(e,i)}static removeEventListener(t,e,i){const n=t;n.removeEventListener?n.removeEventListener(e,i):t.off(e,i)}static dispatch(t,e,...i){const n=t;n.dispatchEvent?n.dispatchEvent(e,...i):t.emit(e,...i)}}class r{constructor(t){this.listenerThis=t,this.construction()}construction(){this.listenersByTypeMap=new b}destruction(){this.removeAllListeners(),this.listenerThis=null}addEventListener(t,e,i){var n=this.getEventListeners(e),r=new x;r.dispatcher=t,r.type=e,this.listenerThis?r.listener=i.bind(this.listenerThis):r.listener=i,r.sourceListener=i,n.push(r),s.addEventListener(t,e,r.listener)}removeEventListener(t,e,i){let n,r=[],o=this.getEventListeners(e),a=o.length;for(let e=0;e<a;e++)n=o[e],n.dispatcher==t&&n.sourceListener==i&&(s.removeEventListener(n.dispatcher,n.type,n.listener),r.push(n));c.removeItems(o,r)}removeAllListeners(t){let e=this.listenersByTypeMap.getAllItems(),i=e.length;for(let n=0;n<i;n++){let i,s=e[n].concat(),r=s.length;for(let e=0;e<r;e++)i=s[e],t&&i.dispatcher!=t||this.removeEventListener(i.dispatcher,i.type,i.sourceListener)}}getEventListeners(t){return this.listenersByTypeMap.containsKey(t)||this.listenersByTypeMap.push([],t),this.listenersByTypeMap.getItem(t)}}class o extends n{constructor(...t){super(...t),this.construction(...t),this.isConstructed=!0,this.addListeners(),this.commitData()}construction(...t){this.eventListenerHelper=new r(this)}destruction(){this.removeListeners(),this.eventListenerHelper&&(this.eventListenerHelper.destruction(),this.eventListenerHelper=null)}addListeners(){this.removeListeners()}removeListeners(){this.eventListenerHelper&&this.eventListenerHelper.removeAllListeners()}commitData(){}arrange(){}get data(){return this._data}set data(t){this.data!=t&&(this.processDataUnset(this._data),this._data=t,this.processDataSet(this._data),this.commitData())}processDataUnset(t){}processDataSet(t){}}class a{}a.COMPLETE="COMPLETE";class l{}l.TERMINATE="TERMINATE",l.GENERAL_ERROR="GENERAL_ERROR";class h{static getRandomFloat(t,e){return Math.random()*(e-t)+t}static getRandomInt(t,e){if(t>e){const i=e;e=t,t=i}return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}static getListOfIntegers(t,e){let i=[];if((t=Math.floor(t))<(e=Math.floor(e)))for(let n=t;n<=e;n++)i.push(n);else console.error("NumberTools | GetListOfIntegers __ WARNING! variable 'from' is not less than 'to'");return i}static roundTo(t,e=10,i=!1,n=!0,s=!1){let r=t,o=1/e;i&&(r=Math.floor(t*o)/o),n&&(r=Math.round(t*o)/o),s&&(r=Math.ceil(t*o)/o);let a=(e.toString().split(".")[1]||[]).length;return a>0&&(r=parseFloat(r.toFixed(a))),r}static getDeltaBetweenNums(t,e,i){i<0?i=0:i>1&&(i=1);return t+i*(e-t)}static getMinMax(t,e,i){return Math.min(Math.max(t,e),i)}static getSign(t){let e=1;return t<0&&(e=-1),e}}h.MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Math.pow(2,53)-1;class d{static copyProps(t,e,i){for(var n,s=!1,r=Object.keys(e),o=r.length,a=0;a<o;a++)if(t[n=r[a]]!=e[n]){let r=!1;(!(null==i?void 0:i.ignoreExistedProperties)||(null==i?void 0:i.ignoreExistedProperties)&&void 0===t[n])&&(r=!0),r&&(null==i?void 0:i.ignoreNonExistedProperties)&&(t.hasOwnProperty(n)||(r=!1)),r&&((null==i?void 0:i.overrideExistedProperties)?t[n]=d.clone(e[n]):d.copySingleProp(t,e,n),s=!0)}return s}static copySingleProp(t,e,i,n){if(Array.isArray(e[i])){let s=e[i],r=t[i];r||(r=[],t[i]=r);let o=s.length;for(let t=0;t<o;t++)d.isObject(r[t])?d.copyProps(r[t],s[t],n):r[t]=d.clone(s[t])}else d.isObject(e[i])?(t[i]||(t[i]={}),d.copyProps(t[i],e[i],n)):t[i]=e[i]}static copySinglePropFromValue(t,e,i,n){d.copyProps(t,{[e]:i},n)}static clone(t){let e;return Array.isArray(t)?(e=[],d.copyProps(e,t)):d.isObject(t)?(e={},d.copyProps(e,t)):e=t,e}static isObject(t){return t===Object(t)}static isSimpleType(t){var e=!1;return Array.isArray(t)||d.isObject(t)||(e=!0),e}static isString(t){return"string"==typeof t}static isNumber(t){return"number"==typeof t}static getObjectConstructorName(t){return t.constructor?d.getConstructorName(t.constructor):""}static getConstructorName(t){return t.name?t.name:""}static checkIfEqual(t,e){let i=!0;if(t!==e)if(!!t!=!!e)i=!1;else{let n=!0;if(Array.isArray(t)&&Array.isArray(e)&&t.length!==e.length&&(n=!1,i=!1),n)for(let n in t){if(!t.hasOwnProperty(n)||!e.hasOwnProperty(n)){i=!1;break}if("object"==typeof t[n]&&"object"==typeof e[n]){if(!d.checkIfEqual(t[n],e[n])){i=!1;break}}else if(t[n]!==e[n]){i=!1;break}}}return i}}class c{static removeItem(t,e,i=c.REMOVE_COUNT_ALL){let n=!1;i==c.REMOVE_COUNT_ALL&&(i=Number.MAX_VALUE);let s=0,r=t.indexOf(e);for(;-1!=r&&s<i;)t.splice(r,1),r=t.indexOf(e,r),s++;return s>0&&(n=!0),n}static removeItems(t,e){let i;for(let n=0;n<e.length;n++)i=e[n],c.removeItem(t,i)}static checkIfEqual(t,e){let i=!0;if(!t&&e||t&&!e)i=!1;else if(t&&e)if(t.length!=e.length)i=!1;else{let n=t.length;for(let s=0;s<n;s++)if(!d.checkIfEqual(t[s],e[s])){i=!1;break}}return i}static checkIfSomeEqual(t,e){return e.some((e=>t.indexOf(e)>=0))}static getDifference(t,e){let i=[],n=[...t,...e];for(let s of n)-1!==t.indexOf(s)&&-1!==e.indexOf(s)||i.push(s);return i}static getSimilar(t,e){let i=[];for(let n of t)-1!==e.indexOf(n)&&i.push(n);return i}static changeItemIndex(t,e,i){if(i>=e.length)return;let n=e.indexOf(t);-1!=n&&n!=i&&e.splice(i,0,e.splice(n,1)[0])}static randomizeArray(t){t.sort(c.randomizeSortFunction)}static randomizeSortFunction(t,e){return-1+Math.floor(3*Math.random())}static randomizeItemsInArray(t,e){let i,n,s=t.length;for(let r=0;r<e;r++)i=h.getRandomInt(0,s-1),n=h.getRandomInt(0,s-1),c.swapItemsInArray(t,i,n)}static swapItemsInArray(t,e,i){let n=t[e],s=t[i];t[e]=s,t[i]=n}static getRandomItemBasedOnWeights(t,e){let i;e||(e=Array(t.length).fill(1));const n=t.length;if(e.length<t.length)for(let t=e.length;t<n;t++)e[t]=1;let s=0;for(let t=0;t<n;t++)s+=e[t];const r=Math.random()*s;let o=0;for(let s=0;s<n;s++){if(o+=e[s],r<o){i=t[s];break}}return i}static getRandomItem(t,e=null){let i=null,n=t.concat();if(e&&c.removeItems(n,e),n.length>0){i=n[Math.floor(Math.random()*n.length)]}return i}static getUniqueItems(t){return t.filter(c.removeDuplicatesFilter)}static removeDuplicatesFilter(t,e,i){return 0==e||-1==i.lastIndexOf(t,e-1)}}c.REMOVE_COUNT_ALL=-1;class u extends o{get isExecuting(){return this._isExecuting}get isCompleted(){return this._isCompleted}constructor(...t){super(...t)}execute(){return this.constructorName=d.getConstructorName(this.constructor),console.log("Command | execute __ name: "+this.constructorName),this.executePrommise=new Promise(((t,e)=>{this.promiseResolve=t,this.promiseReject=e,this.isExecuting||this.isCompleted||(this._isExecuting=!0,-1==u.cache.indexOf(this)&&(u.cache.push(this),u.cache.length>u.CACHE_COMMANDS_COUNT_FOR_WARNING&&console.log("Command | execute __WARNING! Too many commands in the cache!")),this.guard()?this.executeInternal():this.notifyComplete())})),this.executePrommise.catch((t=>{console.warn("Command | notifyComplete __ Completed with error! name: ",this.constructorName," | reason: ",t)})),this.executePrommise}guard(){return!0}notifyComplete(t,e){console.log("Command | notifyComplete __ name: ",this.constructorName," | this.success: ",this.success),this._isExecuting=!1,this.isCompleted||(c.removeItem(u.cache,this),this._isCompleted=!0,this.removeListeners(),this.dispatchEvent(a.COMPLETE),this.success?this.promiseResolve(t):this.promiseReject(e)),this.destruction()}terminate(t){return t||(t=l.TERMINATE),this.errorCode=t,this.notifyComplete(null,this.errorCode),this.executePrommise}get success(){var t=!0;return this.errorCode&&(t=!1),t}}u.cache=[],u.CACHE_COMMANDS_COUNT_FOR_WARNING=200;var p,f,g=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};class m extends u{constructor(t){super(t),this.callback=t}executeInternal(){return g(this,void 0,void 0,(function*(){yield this.callback(),this.notifyComplete()}))}}class v{}v.COMMAND_COMPLETE="COMMAND_COMPLETE",v.PROGRESS="PROGRESS";class _{}_.QUEUE_COMMAND_ERROR="QUEUE_COMMAND_ERROR";class y extends u{constructor(t=null){super(),t||(t=[]),this.queueCommands=t.concat(),this.curCommandIndex=-1,this._progress=0,this.isNeedCompleteAfterTheLastCommand=!0,this.isNeedChangeProgressByCommandComplete=!0}executeInternal(){this.executeNextCommand()}executeNextCommand(){if(!this.isCompleted&&!this.runningCommand)if(this.curCommandIndex<this.queueCommands.length-1){this.curCommandIndex++;var t=this.queueCommands[this.curCommandIndex];this.runningCommand=t,this.addSingleCommandListeners(this.runningCommand),this.runningCommand.execute()}else this.isNeedCompleteAfterTheLastCommand&&this.notifyComplete()}addSingleCommandListeners(t){this.eventListenerHelper.addEventListener(t,a.COMPLETE,this.onCommandComplete)}removeSingleCommandListeners(t){this.eventListenerHelper&&this.eventListenerHelper.removeEventListener(t,a.COMPLETE,this.onCommandComplete)}onCommandComplete(){this.lastCompleteCommand=this.runningCommand,this.resetRunningCommandData(),this.lastCompleteCommand&&(this.dispatchEvent(v.COMMAND_COMPLETE,this.lastCompleteCommand),this.isNeedChangeProgressByCommandComplete&&this.setProgress(this.curCommandIndex+1),!this.lastCompleteCommand.success&&this.isNeedAbortOnQueueCommandError?(this.errorCode=_.QUEUE_COMMAND_ERROR,this.terminate()):this.executeNextCommand())}dispatchProgressEvent(){this.dispatchEvent(v.PROGRESS,this.progress)}get progress(){return this._progress}setProgress(t){t!=this.progress&&(this._progress=t,this.dispatchProgressEvent())}resetRunningCommandData(){this.runningCommand&&(this.removeSingleCommandListeners(this.runningCommand),this.runningCommand=null)}terminate(t){let e=[];return this.runningCommand&&e.push(this.runningCommand.terminate(t)),Promise.all(e).finally((()=>{super.terminate(t)})),this.executePrommise}notifyComplete(){super.notifyComplete(),this.resetRunningCommandData(),this.queueCommands=[],this.curCommandIndex=0}add(t){this.queueCommands.push(t)}getCurrentRunningCommand(){return this.runningCommand}}class E{}E.CHANGE="AssociativeArrayEvent.CHANGE";class b extends n{constructor(){super(),this.map={},this.list=[]}destruction(){this.map=null,this.list=null}dispatchChangeEvent(){this.dispatchEvent(E.CHANGE)}reset(){for(;this.list.length>0;)this.removeByIndex(0)}push(t,e,i=!0){this.addToIndex(t,e,this.list.length,i)}addToIndex(t,e,i,n=!0){var s=!0;n&&this.containsKey(e)&&(s=!1),s&&(this.list.splice(i,0,t),this.map[e]=t),this.dispatchChangeEvent()}remove(t){if(this.contains(t)){var e=this.indexOf(t);this.removeByIndex(e)}}removeByKey(t){var e=this.getItem(t);this.remove(e)}removeByIndex(t){var e=this.list.splice(t,1)[0],i=this.getItemKey(e);delete this.map[i],this.dispatchChangeEvent()}contains(t){var e=!1;return-1!=this.indexOf(t)&&(e=!0),e}containsKey(t){var e=!1;return this.map[t]&&(e=!0),e}indexOf(t){return this.list.indexOf(t)}getItem(t){return this.map[t]}getItemByIndex(t){var e;return t<this.list.length&&(e=this.list[t]),e}getItemKey(t){var e,i=null;for(e in this.map)if(this.map[e]==t){i=e;break}return i}getAllItems(t=!0){let e=this.list;return t&&(e=this.list.concat()),e}getAllKeys(){return Object.keys(this.map)}get length(){return this.list.length}forEach(t,e){this.list.forEach(t,e)}every(t,e){return this.list.every(t,e)}sort(t){this.list.sort(t)}clone(){let t=new b;return t.list=this.list.concat(),d.copyProps(t.map,this.map),t}}class A{static getObjectUniqueId(t){let e;if(d.isObject(t))t.hasOwnProperty(A.UNIQUE_ID_PROP_NAME)||(A.globalUniqueId++,t[A.UNIQUE_ID_PROP_NAME]=A.globalUniqueId.toString()),e=t[A.UNIQUE_ID_PROP_NAME];else{const i=t.toString();A.simpleTypesUniqueValuesMap[i]||(A.globalUniqueId++,A.simpleTypesUniqueValuesMap[i]=A.globalUniqueId.toString()),e=A.simpleTypesUniqueValuesMap[i]}return e}static getUniqueIdForPool(t){return t||(t=A.DEFAULT_POOL_ID),A.uniqueIdByPool[t]||0===A.uniqueIdByPool[t]?A.uniqueIdByPool[t]===h.MAX_SAFE_INTEGER?A.uniqueIdByPool[t]=0:A.uniqueIdByPool[t]++:A.uniqueIdByPool[t]=0,A.uniqueIdByPool[t].toString()}static setCounterForPool(t,e){e||(e=A.DEFAULT_POOL_ID),A.uniqueIdByPool[e]=t}}A.UNIQUE_ID_PROP_NAME="flashistUniqueId",A.DEFAULT_POOL_ID="defaultPoolId",A.globalUniqueId=0,A.uniqueIdByPool={},A.simpleTypesUniqueValuesMap={};class T{constructor(){this.map={},this.keys=[]}getItem(t){var e=A.getObjectUniqueId(t);return this.map[e]}addItem(t,e){var i=A.getObjectUniqueId(t);this.map[i]!==e&&(this.map[i]=e,-1===this.keys.indexOf(t)&&this.keys.push(t))}removeItemByKey(t){var e=A.getObjectUniqueId(t);const i=!!this.map[e];return i&&(delete this.map[e],c.removeItem(this.keys,t)),i}getKeys(){return this.keys.concat()}get length(){return this.keys.length}}class x{}!function(t){t.CHANGE="LockEvent.CHANGE"}(p||(p={}));class S extends o{constructor(){super(...arguments),this.lockers=[]}get enabled(){return this.lockers.length>0}add(t){-1===this.lockers.indexOf(t)&&(this.lockers.push(t),this.dispatchEvent(p.CHANGE))}remove(t){const e=this.lockers.indexOf(t);-1!==e&&(this.lockers.splice(e,1),this.dispatchEvent(p.CHANGE))}}class w extends o{constructor(){super()}}class C extends w{constructor(){super()}log(...t){console.log.apply(console,t)}error(...t){console.error.apply(console,t)}debug(...t){console.debug.apply(console,t)}startLogTime(t){console.time(t)}stopLogTime(t){console.timeEnd(t)}}class I{static addLoggerItem(t){I.loggerItems.push(t),I.loggerItemsCount=I.loggerItems.length}static log(...t){for(var e=0;e<I.loggerItemsCount;e++)I.loggerItems[e].log.apply(I.loggerItems[e],t)}static error(...t){for(var e=0;e<I.loggerItemsCount;e++)I.loggerItems[e].error.apply(I.loggerItems[e],t)}static debug(...t){for(var e=0;e<I.loggerItemsCount;e++)I.loggerItems[e].debug.apply(I.loggerItems[e],t)}static logCurrentTime(){var t=new Date;I.log("time: "+t.getTime())}static startLogTime(t){for(var e=0;e<I.loggerItemsCount;e++)I.loggerItems[e].startLogTime.apply(I.loggerItems[e],t)}static stopLogTime(t){for(var e=0;e<I.loggerItemsCount;e++)I.loggerItems[e].stopLogTime.apply(I.loggerItems[e],t)}}I.loggerItems=[],I.loggerItemsCount=0;class R{constructor(){this.objectsToClassMap=new T}addObject(t,e){if(!t)return;let i=this.getObjectsByClass(e);i&&-1==i.indexOf(t)&&i.push(t)}getObject(t,...e){let i,n=this.getObjectsByClass(t);return i=n.length>0?n.shift():this.createNewObject(t,...e),i}createNewObject(t,...e){return new t(...e)}getObjectsByClass(t){let e=this.objectsToClassMap.getItem(t);return e||(e=[],this.objectsToClassMap.addItem(t,e)),e}}class P{static destruction(){P.delayedFunctionInfos=null,P.delayedFunctions=null,clearInterval(P.checkInterval)}static onTimer(){P.callAllDelayedFunctions()}static callAllDelayedFunctions(){if(P.delayedFunctionInfos.length<=0)return;let t;for(let e=0;e<P.delayedFunctionInfos.length;e++)t=P.delayedFunctionInfos[e],t.delayStartTime||(t.delayStartTime=Date.now()),(!t.delayTime||t.delayTime<=Date.now()-t.delayStartTime)&&(t.func.apply(t.thisContext,t.applyArgs),c.removeItem(P.delayedFunctionInfos,t),c.removeItem(P.delayedFunctions,t.func,1))}static addDelayedFunction(t,e,i=null,n=0,s=!1){if(s&&P.checkIsSameFunctionWithSameParamsExist(t,e,i))return;let r={func:t,thisContext:e,applyArgs:i,delayTime:n,delayStartTime:0};P.delayedFunctionInfos.push(r),P.delayedFunctions.push(r.func),P.isDelayedFunctionsChange=!0}static addDelayedUniqueFunction(t,e,i=null,n=0){P.addDelayedFunction(t,e,i,n,!0)}static checkIsSameFunctionWithSameParamsExist(t,e,i=null){let n=!1;if(-1!=P.delayedFunctions.indexOf(t)){let s,r=P.delayedFunctionInfos.length;for(let o=0;o<r;o++)if(s=P.delayedFunctionInfos[o],s&&s.func==t&&s.thisContext===e&&c.checkIfEqual(i,s.applyArgs)){n=!0;break}}return n}}P.checkIntervalTime=16,P.delayedFunctionInfos=[],P.delayedFunctions=[],P.pseudoStaticConstructor=void(P.checkInterval=setInterval((()=>{P.onTimer()}),P.checkIntervalTime));class L{}L.KEY_DOWN="keydown",L.KEY_PRESS="keypress",L.KEY_UP="keyup",function(t){t.MOUSE_WHEEL="wheel"}(f||(f={}));class M{static substituteList(t,...e){return M.substitute(t,e)}static substitute(t,e=null){var i,n,s,r=t;if(d.isSimpleType(e)&&(e=[e]),e)for(s in e)i=e[s],n="{"+s+"}",r=M.replaceText(r,n,i);return r}static replaceText(t,e,i){return t.split(e).join(i)}static groupCharacters(t,e=3,i=" ",n=!0){let s=[],r=t.split("");n&&(r=r.reverse());let o=r.length;for(let n=0;n<o;n++)s.push(r[n]),n>0&&n<t.length-1&&(n+1)%e==0&&s.push(i);n&&(s=s.reverse());return s.join("")}static splitByCapitalLetters(t){return t.split(/(?=[A-Z])/)}static capitalizeFirstLetter(t,e=navigator.language){return t.charAt(0).toLocaleUpperCase(e)+t.substring(1)}static count(t,e){let i=t.split(e).length-1;return i<0&&(i=0),i}}var D,O,k;!function(t){t.MOBILE="mobile",t.TABLET="tablet",t.DESKTOP="desktop"}(D||(D={})),function(t){t.IOS="iOS",t.ANDROID="Android",t.MAC_OS="Mac OS",t.WINDOWS="Windows",t.LINUX="Linux"}(O||(O={})),function(t){t.CHANGE="change",t.ERROR="error"}(k||(k={}));class B{static request(t=document.documentElement,e){return new Promise(((i,n)=>{const s=()=>{B.off("change",s),i()};B.on("change",s);const r=t[B.nativeAPI.requestFullscreen](e);r instanceof Promise&&r.then(s).catch(n)}))}static exit(){return new Promise(((t,e)=>{if(!B.isFullscreen)return void t();const i=()=>{B.off("change",i),t()};B.on("change",i);const n=document[B.nativeAPI.exitFullscreen]();n instanceof Promise&&n.then(i).catch(e)}))}static toggle(t=document.documentElement,e){return B.isFullscreen?B.exit():B.request(t,e)}static onChange(t){B.on("change",t)}static onError(t){B.on("error",t)}static on(t,e){const i=B.eventNameMap[t];i&&document.addEventListener(i,e,!1)}static off(t,e){const i=B.eventNameMap[t];i&&document.removeEventListener(i,e,!1)}static get isFullscreen(){return document[B.nativeAPI.fullscreenElement]}static get element(){var t;return null!==(t=document[B.nativeAPI.fullscreenElement])&&void 0!==t?t:void 0}static get isEnabled(){return!!document[B.nativeAPI.fullscreenEnabled]}}B.methodMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],B.nativeAPI=(()=>{if("undefined"==typeof document)return!1;const t=B.methodMap[0],e={};for(const i of B.methodMap){if((null==i?void 0:i[1])in document){const n=i.length;for(let s=0;s<n;s++)e[t[s]]=i[s];return e}}return!1})(),B.eventNameMap={[k.CHANGE]:B.nativeAPI.fullscreenchange,[k.ERROR]:B.nativeAPI.fullscreenerror};var F=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(F||{}),N=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(N||{}),G=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(G||{}),U=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(U||{}),H=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(H||{}),V=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(V||{}),z=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(z||{}),j=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(j||{}),W=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(W||{}),X=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(X||{}),K=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(K||{}),Y=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(Y||{}),$=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))($||{}),q=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(q||{}),Z=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(Z||{}),Q=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(Q||{}),J=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(J||{}),tt=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(tt||{}),et=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(et||{});const it={createCanvas:(t,e)=>{const i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},nt={ADAPTER:it,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var st=i(250),rt=i.n(st);const ot=(rt().default??rt())(globalThis.navigator);nt.RETINA_PREFIX=/@([0-9\.]+)x/,nt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var at=i(187),lt=i.n(at);i(575);const ht={};function dt(t,e,i=3){if(ht[e])return;let n=(new Error).stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(n=n.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(n))),ht[e]=!0}function ct(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function ut(t){return t.split("?")[0].split("#")[0]}const pt={toPosix(t){return e="\\",i="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),i);var e,i},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){ct(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const i=/^[^/:]+:\/{0,2}/.exec(t);return i?i[0]:""},toAbsolute(t,e,i){if(ct(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const n=ut(this.toPosix(e??nt.ADAPTER.getBaseUrl())),s=ut(this.toPosix(i??this.rootname(n)));return(t=this.toPosix(t)).startsWith("/")?pt.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(ct(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const i=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return t=function(t,e){let i="",n=0,s=-1,r=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(s!==a-1&&1!==r)if(s!==a-1&&2===r){if(i.length<2||2!==n||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){const t=i.lastIndexOf("/");if(t!==i.length-1){-1===t?(i="",n=0):(i=i.slice(0,t),n=i.length-1-i.lastIndexOf("/")),s=a,r=0;continue}}else if(2===i.length||1===i.length){i="",n=0,s=a,r=0;continue}e&&(i.length>0?i+="/..":i="..",n=2)}else i.length>0?i+=`/${t.slice(s+1,a)}`:i=t.slice(s+1,a),n=a-s-1;s=a,r=0}else 46===o&&-1!==r?++r:r=-1}return i}(t,!1),t.length>0&&n&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return ct(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let i=0;i<t.length;++i){const n=t[i];if(ct(n),n.length>0)if(void 0===e)e=n;else{const s=t[i-1]??"";this.extname(s)?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(ct(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const i=47===e;let n=-1,s=!0;const r=this.getProtocol(t),o=t;for(let i=(t=t.slice(r.length)).length-1;i>=1;--i)if(e=t.charCodeAt(i),47===e){if(!s){n=i;break}}else s=!1;return-1===n?i?"/":this.isUrl(o)?r+t:r:i&&1===n?"//":r+t.slice(0,n)},rootname(t){ct(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const i=t.indexOf("/",e.length);e=-1!==i?t.slice(0,i):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){ct(t),e&&ct(e),t=ut(this.toPosix(t));let i,n=0,s=-1,r=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(47===l){if(!r){n=i+1;break}}else-1===a&&(r=!1,a=i+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(s=i):(o=-1,s=a))}return n===s?s=a:-1===s&&(s=t.length),t.slice(n,s)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!r){n=i+1;break}}else-1===s&&(r=!1,s=i+1);return-1===s?"":t.slice(n,s)},extname(t){ct(t);let e=-1,i=0,n=-1,s=!0,r=0;for(let o=(t=ut(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===n&&(s=!1,n=o+1),46===a?-1===e?e=o:1!==r&&(r=1):-1!==e&&(r=-1);else if(!s){i=o+1;break}}return-1===e||-1===n||0===r||1===r&&e===n-1&&e===i+1?"":t.slice(e,n)},parse(t){ct(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let i=(t=ut(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let s;e.root=this.rootname(t),s=n||this.hasProtocol(t)?1:0;let r=-1,o=0,a=-1,l=!0,h=t.length-1,d=0;for(;h>=s;--h)if(i=t.charCodeAt(h),47!==i)-1===a&&(l=!1,a=h+1),46===i?-1===r?r=h:1!==d&&(d=1):-1!==r&&(d=-1);else if(!l){o=h+1;break}return-1===r||-1===a||0===d||1===d&&r===a-1&&r===o+1?-1!==a&&(e.base=e.name=0===o&&n?t.slice(1,a):t.slice(o,a)):(0===o&&n?(e.name=t.slice(1,r),e.base=t.slice(1,a)):(e.name=t.slice(o,r),e.base=t.slice(o,a)),e.ext=t.slice(r,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"};let ft,gt;async function mt(){return ft??(ft=(async()=>{const t=document.createElement("canvas").getContext("webgl");if(!t)return $.UNPACK;const e=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!e)return $.UNPACK;const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const s=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,s),t.deleteFramebuffer(n),t.deleteTexture(i),t.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?$.PMA:$.UNPACK})()),ft}var vt={grad:.9,turn:360,rad:360/(2*Math.PI)},_t=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},yt=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},Et=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t>i?i:t>e?t:e},bt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},At=function(t){return{r:Et(t.r,0,255),g:Et(t.g,0,255),b:Et(t.b,0,255),a:Et(t.a)}},Tt=function(t){return{r:yt(t.r),g:yt(t.g),b:yt(t.b),a:yt(t.a,3)}},xt=/^#([0-9a-f]{3,8})$/i,St=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},wt=function(t){var e=t.r,i=t.g,n=t.b,s=t.a,r=Math.max(e,i,n),o=r-Math.min(e,i,n),a=o?r===e?(i-n)/o:r===i?2+(n-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:r?o/r*100:0,v:r/255*100,a:s}},Ct=function(t){var e=t.h,i=t.s,n=t.v,s=t.a;e=e/360*6,i/=100,n/=100;var r=Math.floor(e),o=n*(1-i),a=n*(1-(e-r)*i),l=n*(1-(1-e+r)*i),h=r%6;return{r:255*[n,a,o,o,l,n][h],g:255*[l,n,n,a,o,o][h],b:255*[o,o,l,n,n,a][h],a:s}},It=function(t){return{h:bt(t.h),s:Et(t.s,0,100),l:Et(t.l,0,100),a:Et(t.a)}},Rt=function(t){return{h:yt(t.h),s:yt(t.s),l:yt(t.l),a:yt(t.a,3)}},Pt=function(t){return Ct((i=(e=t).s,{h:e.h,s:(i*=((n=e.l)<50?n:100-n)/100)>0?2*i/(n+i)*100:0,v:n+i,a:e.a}));var e,i,n},Lt=function(t){return{h:(e=wt(t)).h,s:(s=(200-(i=e.s))*(n=e.v)/100)>0&&s<200?i*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,i,n,s},Mt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Dt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ot=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Bt={string:[[function(t){var e=xt.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?yt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?yt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Ot.exec(t)||kt.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:At({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=Mt.exec(t)||Dt.exec(t);if(!e)return null;var i,n,s=It({h:(i=e[1],n=e[2],void 0===n&&(n="deg"),Number(i)*(vt[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return Pt(s)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,n=t.b,s=t.a,r=void 0===s?1:s;return _t(e)&&_t(i)&&_t(n)?At({r:Number(e),g:Number(i),b:Number(n),a:Number(r)}):null},"rgb"],[function(t){var e=t.h,i=t.s,n=t.l,s=t.a,r=void 0===s?1:s;if(!_t(e)||!_t(i)||!_t(n))return null;var o=It({h:Number(e),s:Number(i),l:Number(n),a:Number(r)});return Pt(o)},"hsl"],[function(t){var e=t.h,i=t.s,n=t.v,s=t.a,r=void 0===s?1:s;if(!_t(e)||!_t(i)||!_t(n))return null;var o=function(t){return{h:bt(t.h),s:Et(t.s,0,100),v:Et(t.v,0,100),a:Et(t.a)}}({h:Number(e),s:Number(i),v:Number(n),a:Number(r)});return Ct(o)},"hsv"]]},Ft=function(t,e){for(var i=0;i<e.length;i++){var n=e[i][0](t);if(n)return[n,e[i][1]]}return[null,void 0]},Nt=function(t){return"string"==typeof t?Ft(t.trim(),Bt.string):"object"==typeof t&&null!==t?Ft(t,Bt.object):[null,void 0]},Gt=function(t,e){var i=Lt(t);return{h:i.h,s:Et(i.s+100*e,0,100),l:i.l,a:i.a}},Ut=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Ht=function(t,e){var i=Lt(t);return{h:i.h,s:i.s,l:Et(i.l+100*e,0,100),a:i.a}},Vt=function(){function t(t){this.parsed=Nt(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return yt(Ut(this.rgba),2)},t.prototype.isDark=function(){return Ut(this.rgba)<.5},t.prototype.isLight=function(){return Ut(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=Tt(this.rgba)).r,i=t.g,n=t.b,r=(s=t.a)<1?St(yt(255*s)):"","#"+St(e)+St(i)+St(n)+r;var t,e,i,n,s,r},t.prototype.toRgb=function(){return Tt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=Tt(this.rgba)).r,i=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+n+", "+s+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,s},t.prototype.toHsl=function(){return Rt(Lt(this.rgba))},t.prototype.toHslString=function(){return e=(t=Rt(Lt(this.rgba))).h,i=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+s+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,s},t.prototype.toHsv=function(){return t=wt(this.rgba),{h:yt(t.h),s:yt(t.s),v:yt(t.v),a:yt(t.a,3)};var t},t.prototype.invert=function(){return zt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),zt(Gt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),zt(Gt(this.rgba,-t))},t.prototype.grayscale=function(){return zt(Gt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),zt(Ht(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),zt(Ht(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?zt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):yt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=Lt(this.rgba);return"number"==typeof t?zt({h:t,s:e.s,l:e.l,a:e.a}):yt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===zt(t).toHex()},t}(),zt=function(t){return t instanceof Vt?t:new Vt(t)},jt=[];!function(t){t.forEach((function(t){jt.indexOf(t)<0&&(t(Vt,Bt),jt.push(t))}))}([function(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var s in i)n[i[s]]=s;var r={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var l=this.toRgb(),h=1/0,d="black";if(!r.length)for(var c in i)r[c]=new t(i[c]).toRgb();for(var u in i){var p=(s=l,o=r[u],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));p<h&&(h=p,d=u)}return d}},e.string.push([function(e){var n=e.toLowerCase(),s="transparent"===n?"#0000":i[n];return s?new t(s).toRgb():null},"name"])}]);const Wt=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if("number"===i||"string"===i||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,i)=>t===e[i]));if(null!==t&&null!==e){const i=Object.keys(t),n=Object.keys(e);return i.length===n.length&&i.every((i=>t[i]===e[i]))}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*i),t[2]=Math.round(255*n),t}toRgbArray(t){t=t??[];const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[i,n,s,r]=t.temp.setValue(e)._components;return this._components[0]*=i,this._components[1]*=n,this._components[2]*=s,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,s=255&this._int;return e&&(i=i*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(255*t<<24)+(i<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,n,s]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t}normalize(e){let i,n,s,r;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){i=(e>>16&255)/255,n=(e>>8&255)/255,s=(255&e)/255,r=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[i,n,s,r=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[i,n,s,r=255]=e,i/=255,n/=255,s/=255,r/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const i=t.HEX_PATTERN.exec(e);i&&(e=`#${i[2]}`)}const o=zt(e);o.isValid()&&(({r:i,g:n,b:s,a:r}=o.rgba),i/=255,n/=255,s/=255)}if(void 0===i)throw new Error(`Unable to convert color ${e}`);this._components[0]=i,this._components[1]=n,this._components[2]=s,this._components[3]=r,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*i|0)}_clamp(t,e=0,i=1){return"number"==typeof t?Math.min(Math.max(t,e),i):(t.forEach(((n,s)=>{t[s]=Math.min(Math.max(n,e),i)})),t)}};Wt.shared=new Wt,Wt.temp=new Wt,Wt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Xt=Wt;const Kt=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[U.NORMAL_NPM]=U.NORMAL,t[U.ADD_NPM]=U.ADD,t[U.SCREEN_NPM]=U.SCREEN,e[U.NORMAL]=U.NORMAL_NPM,e[U.ADD]=U.ADD_NPM,e[U.SCREEN]=U.SCREEN_NPM;const i=[];return i.push(e),i.push(t),i}();function Yt(t,e){return Kt[e?1:0][t]}function $t(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Float32Array,Uint32Array,Int32Array,Uint8Array;function qt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Zt(t){return!(t&t-1||!t)}function Qt(t){let e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,i=((t>>>=i)>15?1:0)<<2,e|=i,i=((t>>>=i)>3?1:0)<<1,e|=i,e|(t>>>=i)>>1}function Jt(t,e,i){const n=t.length;let s;if(e>=n||0===i)return;const r=n-(i=e+i>n?n-e:i);for(s=e;s<r;++s)t[s]=t[s+i];t.length=r}function te(t){return 0===t?0:t<0?-1:1}let ee=0;function ie(){return++ee}const ne=class{constructor(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};ne.EMPTY=new ne(0,0,0,0);let se=ne;const re={},oe=Object.create(null),ae=Object.create(null);class le{constructor(t,e,i){this._canvas=nt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||nt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function he(t,e,i){for(let n=0,s=4*i*e;n<e;++n,s+=4)if(0!==t[s+3])return!1;return!0}function de(t,e,i,n,s){const r=4*e;for(let e=n,o=n*r+4*i;e<=s;++e,o+=r)if(0!==t[o+3])return!1;return!0}function ce(t){const e=function(t){const{width:e,height:i}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const s=n.getImageData(0,0,e,i).data;let r=0,o=0,a=e-1,l=i-1;for(;o<i&&he(s,e,o);)++o;if(o===i)return se.EMPTY;for(;he(s,e,l);)--l;for(;de(s,e,r,o,l);)++r;for(;de(s,e,a,o,l);)--a;return++a,++l,new se(r,o,a,l)}(t),{width:i,height:n}=e;let s=null;if(!e.isEmpty()){const r=t.getContext("2d");if(null===r)throw new TypeError("Failed to get canvas 2D context");s=r.getImageData(e.left,e.top,i,n)}return{width:i,height:n,data:s}}function ue(t,e=1){const i=nt.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var pe=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(pe||{});const fe=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ge=(t,e)=>fe(t).priority??e,me={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(fe).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(fe).forEach((t=>{t.type.forEach((e=>{const i=this._addHandlers,n=this._queue;i[e]?i[e](t):(n[e]=n[e]||[],n[e].push(t))}))})),this},handle(t,e,i){const n=this._addHandlers,s=this._removeHandlers;if(n[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,s[t]=i;const r=this._queue;return r[t]&&(r[t].forEach((t=>e(t))),delete r[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,i=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>ge(e,i)-ge(t,i))))}),(t=>{const i=e.indexOf(t.ref);-1!==i&&e.splice(i,1)}))}};class ve{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const _e=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function ye(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class Ee{constructor(){this.data=0,this.blendMode=U.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==U.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new Ee;return t.depthTest=!1,t.blend=!0,t}}Ee.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const be=[];function Ae(t,e){if(!t)return null;let i="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(i=e[1].toLowerCase())}for(let n=be.length-1;n>=0;--n){const s=be[n];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Te{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,s,r,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:h}=this;this._aliasCount++;for(let d=0,c=h.length;d<c;d++)h[d][l](t,e,i,n,s,r,o,a);return h===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Te.prototype,{dispatch:{value:Te.prototype.emit},run:{value:Te.prototype.emit}});class xe{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Te("setRealSize"),this.onUpdate=new Te("update"),this.onError=new Te("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Se extends xe{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===$.UNPACK);const s=e.realWidth,r=e.realHeight;return i.width===s&&i.height===r?n.texSubImage2D(e.target,0,0,0,s,r,e.format,i.type,this.data):(i.width=s,i.height=r,n.texImage2D(e.target,0,i.internalFormat,s,r,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return null===t||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const we={scaleMode:X.NEAREST,alphaMode:$.NPM},Ce=class t extends(e()){constructor(e=null,i=null){super(),i=Object.assign({},t.defaultOptions,i);const{alphaMode:n,mipmap:s,anisotropicLevel:r,scaleMode:o,width:a,height:l,wrapMode:h,format:d,type:c,target:u,resolution:p,resourceOptions:f}=i;e&&!(e instanceof xe)&&((e=Ae(e,f)).internal=!0),this.resolution=p||nt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=o,this.format=d,this.type=c,this.target=u,this.alphaMode=n,this.uid=ie(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Zt(this.realWidth)&&Zt(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ae[this.cacheId],delete oe[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,i,n=nt.STRICT_TEXTURE_CACHE){const s="string"==typeof e;let r=null;if(s)r=e;else{if(!e._pixiId){const t=i?.pixiIdPrefix||"pixiid";e._pixiId=`${t}_${ie()}`}r=e._pixiId}let o=ae[r];if(s&&n&&!o)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return o||(o=new t(e,i),o.cacheId=r,t.addToCache(o,r)),o}static fromBuffer(e,i,n,s){e=e||new Float32Array(i*n*4);const r=new Se(e,{width:i,height:n,...s?.resourceOptions});let o,a;return e instanceof Float32Array?(o=V.RGBA,a=j.FLOAT):e instanceof Int32Array?(o=V.RGBA_INTEGER,a=j.INT):e instanceof Uint32Array?(o=V.RGBA_INTEGER,a=j.UNSIGNED_INT):e instanceof Int16Array?(o=V.RGBA_INTEGER,a=j.SHORT):e instanceof Uint16Array?(o=V.RGBA_INTEGER,a=j.UNSIGNED_SHORT):e instanceof Int8Array?(o=V.RGBA,a=j.BYTE):(o=V.RGBA,a=j.UNSIGNED_BYTE),r.internal=!0,new t(r,Object.assign({},we,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ae[e]&&ae[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ae[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=ae[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ae[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ae[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Ce.defaultOptions={mipmap:Y.POW2,anisotropicLevel:0,scaleMode:X.LINEAR,wrapMode:K.CLAMP,alphaMode:$.UNPACK,target:z.TEXTURE_2D,format:V.RGBA,type:j.UNSIGNED_BYTE},Ce._globalBatch=0;let Ie=Ce;class Re{constructor(){this.texArray=null,this.blend=0,this.type=H.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Pe=0;class Le{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Pe++,this.disposeRunner=new Te("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?et.ELEMENT_ARRAY_BUFFER:et.ARRAY_BUFFER}get index(){return this.type===et.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Le(t)}}class Me{constructor(t,e=0,i=!1,n=j.FLOAT,s,r,o,a=1){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=r,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,i,n,s){return new Me(t,e,i,n,s)}}const De={Float32Array,Uint32Array,Int32Array,Uint8Array};const Oe={5126:4,5123:2,5121:1};let ke=0;const Be={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Fe{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ke++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Te("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,s,r,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Le||(e instanceof Array&&(e=new Float32Array(e)),e=new Le(e));const l=t.split("|");if(l.length>1){for(let t=0;t<l.length;t++)this.addAttribute(l[t],e,i,n,s);return this}let h=this.buffers.indexOf(e);return-1===h&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new Me(h,i,n,s,r,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Le||(t instanceof Array&&(t=new Uint16Array(t)),t=new Le(t)),t.type=et.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new Le;let n;for(n in this.attributes){const i=this.attributes[n],s=this.buffers[i.buffer];t.push(s.data),e.push(i.size*Oe[i.type]/4),i.buffer=0}for(i.data=function(t,e){let i=0,n=0;const s={};for(let s=0;s<t.length;s++)n+=e[s],i+=t[s].length;const r=new ArrayBuffer(4*i);let o=null,a=0;for(let i=0;i<t.length;i++){const l=e[i],h=t[i],d=$t(h);s[d]||(s[d]=new De[d](r)),o=s[d];for(let t=0;t<h.length;t++)o[(t/l|0)*n+a+t%l]=h[t];a+=l}return new Float32Array(r)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Fe;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Le(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new Me(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=et.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Fe,i=[],n=[],s=[];let r;for(let e=0;e<t.length;e++){r=t[e];for(let t=0;t<r.buffers.length;t++)n[t]=n[t]||0,n[t]+=r.buffers[t].data.length,s[t]=0}for(let t=0;t<r.buffers.length;t++)i[t]=new(Be[$t(r.buffers[t].data)])(n[t]),e.buffers[t]=new Le(i[t]);for(let e=0;e<t.length;e++){r=t[e];for(let t=0;t<r.buffers.length;t++)i[t].set(r.buffers[t].data,s[t]),s[t]+=r.buffers[t].data.length}if(e.attributes=r.attributes,r.indexBuffer){e.indexBuffer=e.buffers[r.buffers.indexOf(r.indexBuffer)],e.indexBuffer.type=et.ELEMENT_ARRAY_BUFFER;let i=0,n=0,s=0,o=0;for(let t=0;t<r.buffers.length;t++)if(r.buffers[t]!==r.indexBuffer){o=t;break}for(const t in r.attributes){const e=r.attributes[t];(0|e.buffer)===o&&(n+=e.size*Oe[e.type]/4)}for(let r=0;r<t.length;r++){const a=t[r].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+s]+=i;i+=t[r].buffers[o].data.length/n,s+=a.length}}return e}}class Ne extends Fe{constructor(t=!1){super(),this._buffer=new Le(null,t,!1),this._indexBuffer=new Le(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,j.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,j.FLOAT).addAttribute("aColor",this._buffer,4,!0,j.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,j.FLOAT).addIndex(this._indexBuffer)}}const Ge=2*Math.PI,Ue=180/Math.PI,He=Math.PI/180;var Ve=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Ve||{});class ze{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ze(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}ze.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const je=[new ze,new ze,new ze,new ze];class We{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=Ve.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new We(0,0,0,0)}clone(){return new We(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const i=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>i}const i=this.left,n=this.right,s=this.top,r=this.bottom;if(n<=i||r<=s)return!1;const o=je[0].set(t.left,t.top),a=je[1].set(t.left,t.bottom),l=je[2].set(t.right,t.top),h=je[3].set(t.right,t.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(0===d||(e.apply(o,o),e.apply(a,a),e.apply(l,l),e.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=i||Math.min(o.x,a.x,l.x,h.x)>=n||Math.max(o.y,a.y,l.y,h.y)<=s||Math.min(o.y,a.y,l.y,h.y)>=r))return!1;const c=d*(a.y-o.y),u=d*(o.x-a.x),p=c*i+u*s,f=c*n+u*s,g=c*i+u*r,m=c*n+u*r;if(Math.max(p,f,g,m)<=c*o.x+u*o.y||Math.min(p,f,g,m)>=c*h.x+u*h.y)return!1;const v=d*(o.y-l.y),_=d*(l.x-o.x),y=v*i+_*s,E=v*n+_*s,b=v*i+_*r,A=v*n+_*r;return!(Math.max(y,E,b,A)<=v*o.x+_*o.y||Math.min(y,E,b,A)>=v*h.x+_*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this}}We.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Xe{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Ve.CIRC}clone(){return new Xe(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=i}getBounds(){return new We(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}Xe.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Ke{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=Ve.ELIP}clone(){return new Ke(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new We(this.x-this.width,this.y-this.height,this.width,this.height)}}Ke.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ye{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,n=e.length;i<n;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.type=Ve.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Ye(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let s=0,r=n-1;s<n;r=s++){const n=this.points[2*s],o=this.points[2*s+1],a=this.points[2*r],l=this.points[2*r+1];o>e!=l>e&&t<(e-o)/(l-o)*(a-n)+n&&(i=!i)}return i}}Ye.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`};class $e{constructor(t=0,e=0,i=0,n=0,s=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=s,this.type=Ve.RREC}clone(){return new $e(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=e-(this.y+i);const r=i*i;if(n*n+s*s<=r||(n=t-(this.x+this.width-i),n*n+s*s<=r)||(s=e-(this.y+this.height-i),n*n+s*s<=r)||(n=t-(this.x+i),n*n+s*s<=r))return!0}return!1}}$e.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class qe{constructor(t=1,e=0,i=0,n=1,s=0,r=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=r}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,s,r){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=r,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new ze;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new ze;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,r=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,n,s,r,o,a,l){return this.a=Math.cos(o+l)*s,this.b=Math.sin(o+l)*s,this.c=-Math.sin(o-a)*r,this.d=Math.cos(o-a)*r,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,i=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,s=this.d,r=t.pivot,o=-Math.atan2(-n,s),a=Math.atan2(i,e),l=Math.abs(o+a);return l<1e-5||Math.abs(Ge-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(r.x*e+r.y*n),t.position.y=this.ty+(r.x*i+r.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,r=t*n-e*i;return this.a=n/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-n*s)/r,this.ty=-(t*this.ty-e*s)/r,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new qe;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new qe}static get TEMP_MATRIX(){return new qe}}qe.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Ze=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Qe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Je=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ti=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ei=[],ii=[],ni=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];ei.push(e);for(let i=0;i<16;i++){const n=ni(Ze[t]*Ze[i]+Je[t]*Qe[i]),s=ni(Qe[t]*Ze[i]+ti[t]*Qe[i]),r=ni(Ze[t]*Je[i]+Je[t]*ti[i]),o=ni(Qe[t]*Je[i]+ti[t]*ti[i]);for(let t=0;t<16;t++)if(Ze[t]===n&&Qe[t]===s&&Je[t]===r&&ti[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new qe;e.set(Ze[t],Qe[t],Je[t],ti[t],0,0),ii.push(e)}}();const si={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Ze[t],uY:t=>Qe[t],vX:t=>Je[t],vY:t=>ti[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>ei[t][e],sub:(t,e)=>ei[t][si.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?si.S:si.N:2*Math.abs(e)<=Math.abs(t)?t>0?si.E:si.W:e>0?t>0?si.SE:si.SW:t>0?si.NE:si.NW,matrixAppendRotationInv:(t,e,i=0,n=0)=>{const s=ii[si.inv(e)];s.tx=i,s.ty=n,t.append(s)}};class ri{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ri(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}ri.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const oi=class{constructor(){this.worldTransform=new qe,this.localTransform=new qe,this.position=new ri(this.onChange,this,0,0),this.scale=new ri(this.onChange,this,1,1),this.pivot=new ri(this.onChange,this,0,0),this.skew=new ri(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};oi.IDENTITY=new oi;let ai=oi;ai.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const li=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],hi={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},di={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const ci={};let ui,pi=ci;function fi(){if(!ui){ui=Q.MEDIUM;const t=function(){if(pi===ci||pi?.isContextLost()){const t=nt.ADAPTER.createCanvas();let e;nt.PREFER_ENV>=F.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),pi=e}return pi}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e&&(ui=e.precision?Q.HIGH:Q.MEDIUM)}}return ui}const gi={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mi(t){return gi[t]}let vi=null;const _i={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function yi(t,e){if(!vi){const e=Object.keys(_i);vi={};for(let i=0;i<e.length;++i){const n=e[i];vi[t[n]]=_i[n]}}return vi[e]}function Ei(t,e,i){if("precision"!==t.substring(0,9)){let n=e;return e===Q.HIGH&&i!==Q.HIGH&&(n=Q.MEDIUM),`precision ${n} float;\n${t}`}return i!==Q.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let bi=0;const Ai={},Ti=class t{constructor(e,i,n="pixi-shader",s={}){this.extra={},this.id=bi++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),Ai[n]?(Ai[n]++,n+=`-${Ai[n]}`):Ai[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=Ei(this.vertexSrc,t.defaultVertexPrecision,Q.HIGH),this.fragmentSrc=Ei(this.fragmentSrc,t.defaultFragmentPrecision,fi())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(e,i,n){const s=e+i;let r=re[s];return r||(re[s]=r=new t(e,i,n)),r}};Ti.defaultVertexPrecision=Q.HIGH,Ti.defaultFragmentPrecision=ot.apple.device?Q.HIGH:Q.MEDIUM;let xi=Ti,Si=0;class wi{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Si++,this.static=!!e,this.ubo=!!i,t instanceof Le?(this.buffer=t,this.buffer.type=et.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Le(new Float32Array(1)),this.buffer.type=et.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new wi(e,i)}static from(t,e,i){return new wi(t,e,i)}static uboFrom(t,e){return new wi(t,e??!0,!0)}}class Ci{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof wi?e:new wi(e):new wi({}),this.disposeRunner=new Te("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(!0===n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=xi.from(t,e);return new Ci(n,i)}}class Ii{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=wi.from({uSamplers:e},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new xi(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new qe,default:this.defaultGroupCache[t]};return new Ci(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Ri{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Pi{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Li=class t extends Pi{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Ne,this.vertexSize=6,this.state=Ee.for2d(),this.size=4*t.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const i=nt.ADAPTER.getNavigator();if(ot.tablet||ot.phone){if(ot.apple.device){const t=i.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(ot.android.device){const t=i.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!ot.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return dt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:e=t.defaultVertexSrc,fragment:i=t.defaultFragmentTemplate}={}){this.shaderGenerator=new Ii(e,i)}contextChange(){const e=this.renderer.gl;nt.PREFER_ENV===F.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=_e.replace(/%forloop%/gi,ye(t));if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:i}=t,n=this.size/4,s=Math.floor(n/this.maxTextures)+1;for(;e.length<n;)e.push(new Re);for(;i.length<s;)i.push(new Ri);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:i}=this,n=t._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++Ie._globalBatch,l=0,h=n[0],d=0;s.copyBoundTextures(r,i);for(let t=0;t<this._bufferSize;++t){const c=e[t];e[t]=null,c._batchEnabled!==a&&(h.count>=i&&(s.boundArray(h,r,a,i),this.buildDrawCalls(h,d,t),d=t,h=n[++l],++a),c._batchEnabled=a,c.touched=o,h.elements[h.count++]=c)}h.count>0&&(s.boundArray(h,r,a,i),this.buildDrawCalls(h,d,this._bufferSize),++l,++a);for(let t=0;t<r.length;t++)r[t]=null;Ie._globalBatch=a}buildDrawCalls(e,i,n){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:o,vertexSize:a}=this,l=t._drawCallPool;let h=this._dcIndex,d=this._aIndex,c=this._iIndex,u=l[h];u.start=this._iIndex,u.texArray=e;for(let t=i;t<n;++t){const n=s[t],p=n._texture.baseTexture,f=Kt[p.alphaMode?1:0][n.blendMode];s[t]=null,i<t&&u.blend!==f&&(u.size=c-u.start,i=t,u=l[++h],u.texArray=e,u.start=c),this.packInterleavedGeometry(n,r,o,d,c),d+=n.vertexData.length/2*a,c+=n.indices.length,u.blend=f}i<n&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=d,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:i,_indexBuffer:n}=this;t.canUploadSameBuffer?(e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:i,state:n}=this.renderer,s=t._drawCallPool;let r=null;for(let t=0;t<e;t++){const{texArray:e,type:o,size:a,start:l,blend:h}=s[t];r!==e&&(r=e,this.bindAndClearTexArray(e)),this.state.blendMode=h,n.set(this.state),i.drawElements(o,a,i.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=qt(Math.ceil(t/8)),i=Qt(e),n=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new ve(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=qt(Math.ceil(t/12)),i=Qt(e),n=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,i,n,s){const{uint32View:r,float32View:o}=e,a=n/this.vertexSize,l=t.uvs,h=t.indices,d=t.vertexData,c=t._texture.baseTexture._batchLocation,u=Math.min(t.worldAlpha,1),p=Xt.shared.setValue(t._tintRGB).toPremultiplied(u,t._texture.baseTexture.alphaMode>0);for(let t=0;t<d.length;t+=2)o[n++]=d[t],o[n++]=d[t+1],o[n++]=l[t],o[n++]=l[t+1],r[n++]=p,o[n++]=c;for(let t=0;t<h.length;t++)i[s++]=a+h[t]}};Li.defaultBatchSize=4096,Li.extension={name:"batch",type:pe.RendererPlugin},Li._drawCallPool=[],Li._textureArrayPool=[];let Mi=Li;me.add(Mi);const Di=class t extends Ci{constructor(e,i,n){super(xi.from(e||t.defaultVertexSrc,i||t.defaultFragmentSrc),n),this.padding=0,this.resolution=t.defaultResolution,this.multisample=t.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Ee}apply(t,e,i,n,s){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};Di.defaultResolution=1,Di.defaultMultisample=tt.NONE;let Oi=Di;class ki{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Xt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:n}=t,s=i??e;void 0!==s&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}ki.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},ki.extension={type:[pe.RendererSystem,pe.CanvasRendererSystem],name:"background"},me.add(ki);class Bi{constructor(t){this.renderer=t,this.emptyRenderer=new Pi(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:s,ids:r,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=s[t],l=o._batchLocation;if(l>=0&&l<n&&e[l]===o)r[t]=l;else for(;a<n;){const n=e[a];if(!n||n._batchEnabled!==i||n._batchLocation!==a){r[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}Bi.extension={type:pe.RendererSystem,name:"batch"},me.add(Bi);let Fi=0;class Ni{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Fi++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Fi++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(nt.PREFER_ENV>=F.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ni.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Ni.extension={type:pe.RendererSystem,name:"context"},me.add(Ni);class Gi{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Te("disposeFramebuffer"),this.multisample=tt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Ie(null,{scaleMode:X.NEAREST,resolution:1,mipmap:Y.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Ie(null,{scaleMode:X.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Y.OFF,format:V.DEPTH_COMPONENT,type:j.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Ui extends Ie{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=tt.NONE),super(null,t),this.mipmap=Y.OFF,this.valid=!0,this._clear=new Xt([0,0,0,0]),this.framebuffer=new Gi(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Hi extends xe{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const i=new URL(t,document.baseURI);return i.hostname!==e.hostname||i.port!==e.port||i.protocol!==e.protocol?"anonymous":""}(e)}upload(t,e,i,n){const s=t.gl,r=e.realWidth,o=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===$.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||i.width!==r||i.height!==o?(i.width=r,i.height=o,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Vi extends Hi{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Hi.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??nt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const i=this.source;this.url=i.src;const n=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?n():(i.onload=n,i.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then((t=>t.blob())).then((i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===$.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const s in n){const r=n[s];if(r!==i&&r.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class zi{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,s=e.height;if(i){const e=t.width/2/n,r=t.height/2/s,o=t.x/n+e,a=t.y/s+r;i=si.add(i,si.NW),this.x0=o+e*si.uX(i),this.y0=a+r*si.uY(i),i=si.add(i,2),this.x1=o+e*si.uX(i),this.y1=a+r*si.uY(i),i=si.add(i,2),this.x2=o+e*si.uX(i),this.y2=a+r*si.uY(i),i=si.add(i,2),this.x3=o+e*si.uX(i),this.y3=a+r*si.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}zi.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const ji=new zi;function Wi(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Xi extends(e()){constructor(t,e,i,n,s,r,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new We(0,0,1,1)),t instanceof Xi&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=ji,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=r?new ze(r.x,r.y):new ze(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&oe[t.url]&&Xi.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Xi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Xi(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===ji&&(this._uvs=new zi),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=nt.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let s=null;if(n)s=t;else if(t instanceof Ie){if(!t.cacheId){const i=e?.pixiIdPrefix||"pixiid";t.cacheId=`${i}-${ie()}`,Ie.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${ie()}`}s=t._pixiId}let r=oe[s];if(n&&i&&!r)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return r||t instanceof Ie?!r&&t instanceof Ie&&(r=new Xi(t),Xi.addToCache(r,s)):(e.resolution||(e.resolution=ue(t)),r=new Xi(new Ie(t,e)),r.baseTexture.cacheId=s,Ie.addToCache(r.baseTexture,s),Xi.addToCache(r,s)),r}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),n=Xi.from(t,Object.assign({resourceOptions:i},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,i,n){return new Xi(Ie.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const s=new Ie(t,Object.assign({scaleMode:Ie.defaultOptions.scaleMode,resolution:ue(e)},n)),{resource:r}=s;r instanceof Vi&&(r.url=e);const o=new Xi(s);return i||(i=e),Ie.addToCache(o.baseTexture,i),Xi.addToCache(o,i),i!==e&&(Ie.addToCache(o.baseTexture,e),Xi.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),oe[e]&&oe[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),oe[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=oe[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete oe[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)oe[t.textureCacheIds[e]]===t&&delete oe[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:s}=t,r=e+n>this.baseTexture.width,o=i+s>this.baseTexture.height;if(r||o){const t=r&&o?"and":"or",a=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,l=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${l}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Xi._EMPTY||(Xi._EMPTY=new Xi(new Ie),Wi(Xi._EMPTY),Wi(Xi._EMPTY.baseTexture)),Xi._EMPTY}static get WHITE(){if(!Xi._WHITE){const t=nt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Xi._WHITE=new Xi(Ie.from(t)),Wi(Xi._WHITE),Wi(Xi._WHITE.baseTexture)}return Xi._WHITE}}class Ki extends Xi{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,r=Math.round(e*n)/n;this.valid=s>0&&r>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=r,i&&this.baseTexture.resize(s,r),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ki(new Ui(t))}}class Yi{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=tt.NONE){const n=new Ui(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ki(n)}getOptimalTexture(t,e,i=1,n=tt.NONE){let s;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?s=n>1?-n:-1:(s=((65535&(t=qt(t)))<<16|65535&(e=qt(e)))>>>0,n>1&&(s+=4294967296*n)),this.texturePool[s]||(this.texturePool[s]=[]);let r=this.texturePool[s].pop();return r||(r=this.createTexture(t,e,n)),r.filterPoolKey=s,r.setResolution(i),r}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||tt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Yi.SCREEN_KEY=-1;class $i extends Fe{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class qi extends Fe{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Le(this.vertices),this.uvBuffer=new Le(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Zi{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=tt.NONE,this.sourceFrame=new We,this.destinationFrame=new We,this.bindingSourceFrame=new We,this.bindingDestinationFrame=new We,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Qi=[new ze,new ze,new ze,new ze],Ji=new qe;class tn{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Yi,this.statePool=[],this.quad=new $i,this.quadUv=new qi,this.tempRect=new We,this.activeState={},this.globalUniforms=new wi({outputFrame:new We,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new Zi,r=i.renderTexture;let o,a;if(r.current){const t=r.current;o=t.resolution,a=t.multisample}else o=i.resolution,a=i.multisample;let l=e[0].resolution||o,h=e[0].multisample??a,d=e[0].padding,c=e[0].autoFit,u=e[0].legacy??!0;for(let t=1;t<e.length;t++){const i=e[t];l=Math.min(l,i.resolution||o),h=Math.min(h,i.multisample??a),d=this.useMaxPadding?Math.max(d,i.padding):d+i.padding,c=c&&i.autoFit,u=u||(i.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=r.current),n.push(s),s.resolution=l,s.multisample=h,s.legacy=u,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(d);const p=this.tempRect.copyFrom(r.sourceFrame);i.projection.transform&&this.transformAABB(Ji.copyFrom(i.projection.transform).invert(),p),c?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,r.current?r.current.resolution:i.resolution,r.sourceFrame,r.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,h),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=s.sourceFrame.width,f.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(r.sourceFrame),s.bindingDestinationFrame.copyFrom(r.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,r.bind(s.renderTexture,s.sourceFrame,f),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,r=n.inputPixel,o=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],r[0]=Math.round(s[0]*e.resolution),r[1]=Math.round(s[1]*e.resolution),r[2]=1/r[0],r[3]=1/r[1],o[0]=.5*r[2],o[1]=.5*r[3],o[2]=e.sourceFrame.width*s[2]-.5*r[2],o[3]=e.sourceFrame.height*s[3]-.5*r[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,a.renderTexture,q.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let s=0;for(s=0;s<i.length-1;++s){1===s&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),i[s].apply(this,t,n,q.CLEAR,e);const r=t;t=n,n=r}i[s].apply(this,t,a.renderTexture,q.BLEND,e),s>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=q.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,i.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=1&n.stateId||this.forceClear;(e===q.CLEAR||e===q.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(H.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(H.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=e._texture,r=t.set(n.width,0,0,n.height,i.x,i.y),o=e.worldTransform.copyTo(qe.TEMP_MATRIX);return o.invert(),r.prepend(o),r.scale(1/s.width,1/s.height),r.translate(e.anchor.x,e.anchor.y),r}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=tt.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if("number"==typeof t){const i=t;t=e,e=i}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||tt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Qi[0],n=Qi[1],s=Qi[2],r=Qi[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),r.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(r,r);const o=Math.min(i.x,n.x,s.x,r.x),a=Math.min(i.y,n.y,s.y,r.y),l=Math.max(i.x,n.x,s.x,r.x),h=Math.max(i.y,n.y,s.y,r.y);e.x=o,e.y=a,e.width=l-o,e.height=h-a}roundFrame(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:t,b:e,c:i,d:n}=s;if((Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(s=s?Ji.copyFrom(s):Ji.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}tn.extension={type:pe.RendererSystem,name:"filter"},me.add(tn);class en{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=tt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const nn=new We;class sn{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Gi(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new We,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;nt.PREFER_ENV===F.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const i=t.colorTextures[e];this.renderer.texture.unbind(i.parentTextureArray||i)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>i,n=e.height>>i,s=t/e.width;this.setViewport(e.x*s,e.y*s,t,n)}else{const e=t.width>>i,n=t.height>>i;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,s=G.COLOR|G.DEPTH){const{gl:r}=this;r.clearColor(t,e,i,n),r.clear(s)}initFramebuffer(t){const{gl:e}=this,i=new en(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){let n;e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),n=1===this.renderer.context.webGLVersion?e.DEPTH_STENCIL:t.depth&&t.stencil?e.DEPTH24_STENCIL8:t.depth?e.DEPTH_COMPONENT24:e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let r=0;r<s;r++){const s=n[r],o=s.parentTextureArray||s;this.renderer.texture.bind(o,0),0===r&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let r=s.length;i.drawBuffers||(r=Math.min(r,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let a=0;a<r;a++){const r=s[a],l=r.parentTextureArray||r;this.renderer.texture.bind(l,0),0===a&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,r.target,l._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}if(!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture)n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null);else{let e,s;n.stencil=n.stencil||i.createRenderbuffer(),1===this.renderer.context.webGLVersion?(e=i.DEPTH_STENCIL_ATTACHMENT,s=i.DEPTH_STENCIL):t.depth&&t.stencil?(e=i.DEPTH_STENCIL_ATTACHMENT,s=i.DEPTH24_STENCIL8):t.depth?(e=i.DEPTH_ATTACHMENT,s=i.DEPTH_COMPONENT24):(e=i.STENCIL_ATTACHMENT,s=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,s,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,s,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,e,i.RENDERBUFFER,n.stencil)}}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=tt.NONE;if(t<=1||null===e)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return 1===i&&(i=tt.NONE),i}blit(t,e,i){const{current:n,renderer:s,gl:r,CONTEXT_UID:o}=this;if(2!==s.context.webGLVersion||!n)return;const a=n.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new Gi(n.width,n.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=nn).width=n.width,e.height=n.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),r.bindFramebuffer(r.READ_FRAMEBUFFER,a.framebuffer),r.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,r.COLOR_BUFFER_BIT,l?r.NEAREST:r.LINEAR),r.bindFramebuffer(r.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,r=e.stencil=s.createRenderbuffer();let o,a;s.bindRenderbuffer(s.RENDERBUFFER,r),1===this.renderer.context.webGLVersion?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH_STENCIL):t.depth?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH24_STENCIL8):(o=s.STENCIL_ATTACHMENT,a=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,a,i,n):s.renderbufferStorage(s.RENDERBUFFER,a,i,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,r)}reset(){this.current=this.unknownFramebuffer,this.viewport=new We}destroy(){this.renderer=null}}sn.extension={type:pe.RendererSystem,name:"framebuffer"},me.add(sn);const rn={5126:4,5123:2,5121:1};class on{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;nt.PREFER_ENV===F.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,i)=>e.vertexAttribDivisorANGLE(t,i),t.drawElementsInstanced=(t,i,n,s,r)=>e.drawElementsInstancedANGLE(t,i,n,s,r),t.drawArraysInstanced=(t,i,n,s)=>e.drawArraysInstancedANGLE(t,i,n,s)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const r=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==r&&(this._activeVao=r,this.hasVao?i.bindVertexArray(r):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const t in n)if(!i[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,s=["g",t.id];for(const t in i)n[t]&&s.push(t,n[t].location);return s.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let h=l[a];if(h)return l[o.id]=h,h;const d=t.buffers,c=t.attributes,u={},p={};for(const t in d)u[t]=0,p[t]=0;for(const t in c)!c[t].size&&o.attributeData[t]?c[t].size=o.attributeData[t].size:c[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),u[c[t].buffer]+=c[t].size*rn[c[t].type];for(const t in c){const e=c[t],i=e.size;void 0===e.stride&&(u[e.buffer]===i*rn[e.type]?e.stride=0:e.stride=u[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=i*rn[e.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(let t=0;t<d.length;t++){const e=d[t];r.bind(e),i&&e._glBuffers[s].refCount++}return this.activateVao(t,o),l[o.id]=h,l[a]=h,n.bindVertexArray(null),r.unbind(et.ARRAY_BUFFER),h}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,r=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(r)for(let t=0;t<s.length;t++){const i=s[t]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0===i.refCount&&!e&&r.dispose(s[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,r=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let a=null;for(const t in o){const l=o[t],h=r[l.buffer],d=h._glBuffers[n];if(e.attributeData[t]){a!==d&&(s.bind(h),a=d);const n=e.attributeData[t].location;if(i.enableVertexAttribArray(n),i.vertexAttribPointer(n,l.size,l.type||i.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(n,l.divisor)}}}}draw(t,e,i,n){const{gl:s}=this,r=this._activeGeometry;if(r.indexBuffer){const o=r.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?r.instanced?s.drawElementsInstanced(t,e||r.indexBuffer.data.length,a,(i||0)*o,n||1):s.drawElements(t,e||r.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else r.instanced?s.drawArraysInstanced(t,i,e||r.getSize(),n||1):s.drawArrays(t,i,e||r.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}on.extension={type:pe.RendererSystem,name:"geometry"},me.add(on);const an=new qe;class ln{constructor(t,e){this._texture=t,this.mapCoord=new qe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],r=t[n+1];e[n]=s*i.a+r*i.c+i.tx,e[n+1]=s*i.b+r*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,s=e.trim;s&&(an.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(an));const r=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/r.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/r.width,o[1]=(e._frame.y+a+l)/r.height,o[2]=(e._frame.x+e._frame.width-a+l)/r.width,o[3]=(e._frame.y+e._frame.height-a+l)/r.height,this.uClampOffset[0]=l/r.realWidth,this.uClampOffset[1]=l/r.realHeight,this.isSimple=e._frame.width===r.width&&e._frame.height===r.height&&0===e.rotate,!0}}class hn extends Oi{constructor(t,e,i){let n=null;"string"!=typeof t&&void 0===e&&void 0===i&&(n=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=n,this.maskMatrix=new qe}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const s=this._maskSprite,r=s._texture;r.valid&&(r.uvMatrix||(r.uvMatrix=new ln(r,0)),r.uvMatrix.update(),this.uniforms.npmAlpha=r.baseTexture.alphaMode?0:1,this.uniforms.mask=r,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(r.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=r.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class dn{constructor(t=null){this.type=J.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Oi.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=J.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class cn{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const t=this.maskDataPool.pop()||new dn;t.pooled=!0,t.maskObject=e,i=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==J.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case J.SCISSOR:this.renderer.scissor.push(i);break;case J.STENCIL:this.renderer.stencil.push(i);break;case J.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case J.COLOR:this.pushColorMask(i)}i.type===J.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case J.SCISSOR:this.renderer.scissor.pop(e);break;case J.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case J.SPRITE:this.popSpriteMask(e);break;case J.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===J.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=J.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=J.SCISSOR:t.type=J.STENCIL:t.type=J.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new hn])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,n),i.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}cn.extension={type:pe.RendererSystem,name:"mask"},me.add(cn);class un{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const pn=new qe,fn=[],gn=class t extends un{constructor(t){super(t),this.glConst=nt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,s=n.renderTexture,r=i.getBounds(!0,fn.pop()??new We);this.roundFrameToPixels(r,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&r.fit(e),t._scissorRectLocal=r}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:n,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(e){const{maskObject:i}=e;if(!i.isFastRect||!i.isFastRect()||t.isMatrixRotated(i.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const n=e._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(e,i,n,s,r){t.isMatrixRotated(r)||((r=r?pn.copyFrom(r):pn.identity()).translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,e),e.fit(s),e.x=Math.round(e.x*i),e.y=Math.round(e.y*i),e.width=Math.round(e.width*i),e.height=Math.round(e.height*i))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&fn.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};gn.extension={type:pe.RendererSystem,name:"scissor"};let mn=gn;me.add(mn);class vn extends un{constructor(t){super(t),this.glConst=nt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;0!==s&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==s&&(t._colorMask=s,i.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;0!==n&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(i._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}vn.extension={type:pe.RendererSystem,name:"stencil"},me.add(vn);class _n{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(dt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(dt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(dt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}_n.extension={type:[pe.RendererSystem,pe.CanvasRendererSystem],name:"_plugin"},me.add(_n);class yn{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new qe,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const s=this.projectionMatrix,r=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=r*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-r-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}yn.extension={type:pe.RendererSystem,name:"projection"},me.add(yn);const En=new ai,bn=new We;class An{constructor(t){this.renderer=t,this._tempMatrix=new qe}generateTexture(t,e){const{region:i,...n}=e||{},s=i?.copyTo(bn)||t.getLocalBounds(bn,!0),r=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/r),s.height=Math.max(s.height,1/r),n.width=s.width,n.height=s.height,n.resolution=r,n.multisample??(n.multisample=this.renderer.multisample);const o=Ki.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const a=t.transform;return t.transform=En,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}An.extension={type:[pe.RendererSystem,pe.CanvasRendererSystem],name:"textureGenerator"},me.add(An);const Tn=new We,xn=new We;class Sn{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new We,this.destinationFrame=new We,this.viewportFrame=new We}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const n=this.renderer;let s,r,o;this.current=t,t?(s=t.baseTexture,o=s.resolution,e||(Tn.width=t.frame.width,Tn.height=t.frame.height,e=Tn),i||(xn.x=t.frame.x,xn.y=t.frame.y,xn.width=e.width,xn.height=e.height,i=xn),r=s.framebuffer):(o=n.resolution,e||(Tn.width=n._view.screen.width,Tn.height=n._view.screen.height,e=Tn),i||((i=Tn).width=e.width,i.height=e.height));const a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,t||(a.y=n.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(r,a),this.renderer.projection.update(i,e,o,!r),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Xt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,o=s.width!==r.width||s.height!==r.height;if(o){let{x:t,y:e,width:i,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,i,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Sn.extension={type:pe.RendererSystem,name:"renderTexture"},me.add(Sn);class wn{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Cn(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}function In(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Rn(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return In(2*e);case"bvec3":return In(3*e);case"bvec4":return In(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Pn(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e),s=n.split("\n"),r={},o=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||r[t])&&(r[t]=!0,!0))),a=[""];o.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=i.join("\n");a[0]=l,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Ln(t,e){const i=Cn(t,t.VERTEX_SHADER,e.vertexSrc),n=Cn(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,n);const r=e.extra?.transformFeedbackVaryings;if(r&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,r.names,"separate"===r.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,i,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||Pn(t,i),t.getShaderParameter(n,t.COMPILE_STATUS)||Pn(t,n),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,s,i,n),e.attributeData=function(t,e){const i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;const r=yi(e,n.type),o={type:r,name:n.name,size:mi(r),location:e.getAttribLocation(t,n.name)};i[n.name]=o}return i}(s,t),e.uniformData=function(t,e){const i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;s++){const n=e.getActiveUniform(t,s),r=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),a=yi(e,n.type);i[r]={name:r,index:s,type:a,size:n.size,isArray:o,value:Rn(a,n.size)}}return i}(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const i=Object.keys(e.attributeData);i.sort(((t,e)=>t>e?1:-1));for(let n=0;n<i.length;n++)e.attributeData[i[n]].location=n,t.bindAttribLocation(s,n,i[n]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(n);const o={};for(const i in e.uniformData){const n=e.uniformData[i];o[i]={location:t.getUniformLocation(s,i),value:Rn(n.type,n.size)}}return new wn(s,o)}function Mn(t,e,i,n,s){i.buffer.update(s)}const Dn={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},On={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function kn(t,e){if(!t.autoManage)return{size:0,syncFunc:Mn};const i=function(t,e){const i=[];for(const n in t)e[n]&&i.push(e[n]);return i.sort(((t,e)=>t.index-e.index)),i}(t.uniforms,e),{uboElements:n,size:s}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let i=0,n=0,s=0;for(let t=0;t<e.length;t++){const r=e[t];if(i=On[r.data.type],r.data.size>1&&(i=Math.max(i,16)*r.data.size),r.dataLen=i,n%i!=0&&n<16){const t=n%i%16;n+=t,s+=t}n+i>16?(s=16*Math.ceil(s/16),r.offset=s,s+=i,n=i):(r.offset=s,n+=i,s+=i)}return s=16*Math.ceil(s/16),{uboElements:e,size:s}}(i),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<n.length;e++){const i=n[e],s=t.uniforms[i.data.name],o=i.data.name;let a=!1;for(let t=0;t<li.length;t++){const e=li[t];if(e.codeUbo&&e.test(i.data,s)){r.push(`offset = ${i.offset/4};`,li[t].codeUbo(i.data.name,s)),a=!0;break}}if(!a)if(i.data.size>1){const t=mi(i.data.type),e=Math.max(On[i.data.type]/16,1),n=t/e,s=(4-n%4)%4;r.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${s};\n                }\n\n                `)}else{const t=Dn[i.data.type];r.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n                ${t};\n                `)}}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}let Bn;let Fn=0;const Nn={textureCount:0,uboCount:0};class Gn{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Fn++}systemCheck(){if(!function(){if("boolean"==typeof Bn)return Bn;try{Bn=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{Bn=!1}return Bn}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(Nn.textureCount=0,Nn.uboCount=0,this.syncUniformGroup(t.uniformGroup,Nn)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const s=e[n];if(!s){!0===t.uniforms[n]?.group&&(t.uniforms[n].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const r=t.uniforms[n];let o=!1;for(let t=0;t<li.length;t++)if(li[t].test(s,r)){i.push(li[t].code(n,r)),o=!0;break}if(!o){const t=(1!==s.size||s.isArray?di:hi)[s.type].replace("location",`ud["${n}"].location`);i.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Nn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const r=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[r];if(o||(o=this._uboCache[r]=kn(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,s=[`${i}-`];for(const t in n)s.push(t),e[t]&&s.push(e[t].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=Ln(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Gn.extension={type:pe.RendererSystem,name:"shader"},me.add(Gn);class Un{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Un.defaultOptions={hello:!1},Un.extension={type:[pe.RendererSystem,pe.CanvasRendererSystem],name:"startup"},me.add(Un);const Hn=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=U.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Ee,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[U.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.ADD]=[t.ONE,t.ONE],e[U.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.NONE]=[0,0],e[U.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[U.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[U.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[U.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[U.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[U.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[U.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[U.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[U.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[U.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[U.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):!e&&-1!==i&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Hn.extension={type:pe.RendererSystem,name:"state"};let Vn=Hn;me.add(Vn);class zn extends(e()){constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),i=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new Te(t)}))}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const t in this.runners)this.runners[t].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach((n=>{const s=i.find((t=>this._systemsHash[t]===n));n[t.name](e[s])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const jn=class t{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=t.defaultMaxIdle,this.checkCountMax=t.defaultCheckCountMax,this.mode=t.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Z.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){let t=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[t++]=e[i]);e.length=t}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};jn.defaultMode=Z.AUTO,jn.defaultMaxIdle=3600,jn.defaultCheckCountMax=600,jn.extension={type:pe.RendererSystem,name:"textureGC"};let Wn=jn;me.add(Wn);class Xn{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=j.UNSIGNED_BYTE,this.internalFormat=V.RGBA,this.samplerType=0}}class Kn{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ie,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[j.UNSIGNED_BYTE]:{[V.RGBA]:t.RGBA8,[V.RGB]:t.RGB8,[V.RG]:t.RG8,[V.RED]:t.R8,[V.RGBA_INTEGER]:t.RGBA8UI,[V.RGB_INTEGER]:t.RGB8UI,[V.RG_INTEGER]:t.RG8UI,[V.RED_INTEGER]:t.R8UI,[V.ALPHA]:t.ALPHA,[V.LUMINANCE]:t.LUMINANCE,[V.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[j.BYTE]:{[V.RGBA]:t.RGBA8_SNORM,[V.RGB]:t.RGB8_SNORM,[V.RG]:t.RG8_SNORM,[V.RED]:t.R8_SNORM,[V.RGBA_INTEGER]:t.RGBA8I,[V.RGB_INTEGER]:t.RGB8I,[V.RG_INTEGER]:t.RG8I,[V.RED_INTEGER]:t.R8I},[j.UNSIGNED_SHORT]:{[V.RGBA_INTEGER]:t.RGBA16UI,[V.RGB_INTEGER]:t.RGB16UI,[V.RG_INTEGER]:t.RG16UI,[V.RED_INTEGER]:t.R16UI,[V.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[j.SHORT]:{[V.RGBA_INTEGER]:t.RGBA16I,[V.RGB_INTEGER]:t.RGB16I,[V.RG_INTEGER]:t.RG16I,[V.RED_INTEGER]:t.R16I},[j.UNSIGNED_INT]:{[V.RGBA_INTEGER]:t.RGBA32UI,[V.RGB_INTEGER]:t.RGB32UI,[V.RG_INTEGER]:t.RG32UI,[V.RED_INTEGER]:t.R32UI,[V.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[j.INT]:{[V.RGBA_INTEGER]:t.RGBA32I,[V.RGB_INTEGER]:t.RGB32I,[V.RG_INTEGER]:t.RG32I,[V.RED_INTEGER]:t.R32I},[j.FLOAT]:{[V.RGBA]:t.RGBA32F,[V.RGB]:t.RGB32F,[V.RG]:t.RG32F,[V.RED]:t.R32F,[V.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[j.HALF_FLOAT]:{[V.RGBA]:t.RGBA16F,[V.RGB]:t.RGB16F,[V.RG]:t.RG16F,[V.RED]:t.R16F},[j.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:t.RGB565},[j.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:t.RGBA4},[j.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:t.RGB5_A1},[j.UNSIGNED_INT_2_10_10_10_REV]:{[V.RGBA]:t.RGB10_A2,[V.RGBA_INTEGER]:t.RGB10_A2UI},[j.UNSIGNED_INT_10F_11F_11F_REV]:{[V.RGB]:t.R11F_G11F_B10F},[j.UNSIGNED_INT_5_9_9_9_REV]:{[V.RGB]:t.RGB9_E5},[j.UNSIGNED_INT_24_8]:{[V.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[j.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[V.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[j.UNSIGNED_BYTE]:{[V.RGBA]:t.RGBA,[V.RGB]:t.RGB,[V.ALPHA]:t.ALPHA,[V.LUMINANCE]:t.LUMINANCE,[V.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[j.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:t.RGB},[j.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:t.RGBA},[j.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:t.RGBA}},e}(t),this.samplerTypes=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[t.RGB]:W.FLOAT,[t.RGBA]:W.FLOAT,[t.ALPHA]:W.FLOAT,[t.LUMINANCE]:W.FLOAT,[t.LUMINANCE_ALPHA]:W.FLOAT,[t.R8]:W.FLOAT,[t.R8_SNORM]:W.FLOAT,[t.RG8]:W.FLOAT,[t.RG8_SNORM]:W.FLOAT,[t.RGB8]:W.FLOAT,[t.RGB8_SNORM]:W.FLOAT,[t.RGB565]:W.FLOAT,[t.RGBA4]:W.FLOAT,[t.RGB5_A1]:W.FLOAT,[t.RGBA8]:W.FLOAT,[t.RGBA8_SNORM]:W.FLOAT,[t.RGB10_A2]:W.FLOAT,[t.RGB10_A2UI]:W.FLOAT,[t.SRGB8]:W.FLOAT,[t.SRGB8_ALPHA8]:W.FLOAT,[t.R16F]:W.FLOAT,[t.RG16F]:W.FLOAT,[t.RGB16F]:W.FLOAT,[t.RGBA16F]:W.FLOAT,[t.R32F]:W.FLOAT,[t.RG32F]:W.FLOAT,[t.RGB32F]:W.FLOAT,[t.RGBA32F]:W.FLOAT,[t.R11F_G11F_B10F]:W.FLOAT,[t.RGB9_E5]:W.FLOAT,[t.R8I]:W.INT,[t.R8UI]:W.UINT,[t.R16I]:W.INT,[t.R16UI]:W.UINT,[t.R32I]:W.INT,[t.R32UI]:W.UINT,[t.RG8I]:W.INT,[t.RG8UI]:W.UINT,[t.RG16I]:W.INT,[t.RG16UI]:W.UINT,[t.RG32I]:W.INT,[t.RG32UI]:W.UINT,[t.RGB8I]:W.INT,[t.RGB8UI]:W.UINT,[t.RGB16I]:W.INT,[t.RGB16UI]:W.UINT,[t.RGB32I]:W.INT,[t.RGB32UI]:W.UINT,[t.RGBA8I]:W.INT,[t.RGBA8UI]:W.UINT,[t.RGBA16I]:W.INT,[t.RGBA16UI]:W.UINT,[t.RGBA32I]:W.INT,[t.RGBA32UI]:W.UINT,[t.DEPTH_COMPONENT16]:W.FLOAT,[t.DEPTH_COMPONENT24]:W.FLOAT,[t.DEPTH_COMPONENT32F]:W.FLOAT,[t.DEPTH_STENCIL]:W.FLOAT,[t.DEPTH24_STENCIL8]:W.FLOAT,[t.DEPTH32F_STENCIL8]:W.FLOAT}:{[t.RGB]:W.FLOAT,[t.RGBA]:W.FLOAT,[t.ALPHA]:W.FLOAT,[t.LUMINANCE]:W.FLOAT,[t.LUMINANCE_ALPHA]:W.FLOAT,[t.DEPTH_STENCIL]:W.FLOAT},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const i=new Xn(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Xn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<i.length;t++)i[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let i=t-1;i>=0;--i){const t=e[i];t&&t._glTextures[n].samplerType!==W.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new Xn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??W.FLOAT,2===this.webGLVersion&&t.type===j.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==W.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,s=t.realHeight,r=i.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,r.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Jt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==Y.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=K.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==Y.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===X.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===X.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===X.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===X.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Kn.extension={type:pe.RendererSystem,name:"texture"},me.add(Kn);class Yn{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let s=0;s<t.buffers.length;s++){const r=t.buffers[s];r&&(i.buffer.update(r),r._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,r._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];if(!n)continue;const r=n._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!e&&s.dispose(n,e))}i&&(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Yn.extension={type:pe.RendererSystem,name:"transformFeedback"},me.add(Yn);class $n{constructor(t){this.renderer=t}init(t){this.screen=new We(0,0,t.width,t.height),this.element=t.view||nt.ADAPTER.createCanvas(),this.resolution=t.resolution||nt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}$n.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},$n.extension={type:[pe.RendererSystem,pe.CanvasRendererSystem],name:"_view"},me.add($n),nt.PREFER_ENV=F.WEBGL2,nt.STRICT_TEXTURE_CACHE=!1,nt.RENDER_OPTIONS={...Ni.defaultOptions,...ki.defaultOptions,...$n.defaultOptions,...Un.defaultOptions},Object.defineProperties(nt,{WRAP_MODE:{get:()=>Ie.defaultOptions.wrapMode,set(t){dt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Ie.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>Ie.defaultOptions.scaleMode,set(t){dt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Ie.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>Ie.defaultOptions.mipmap,set(t){dt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Ie.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>Ie.defaultOptions.anisotropicLevel,set(t){dt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Ie.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(dt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Oi.defaultResolution),set(t){Oi.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(dt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Oi.defaultMultisample),set(t){Oi.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>Mi.defaultMaxTextures,set(t){dt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Mi.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>Mi.defaultBatchSize,set(t){dt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Mi.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Mi.canUploadSameBuffer,set(t){dt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Mi.canUploadSameBuffer=t}},GC_MODE:{get:()=>Wn.defaultMode,set(t){dt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Wn.defaultMode=t}},GC_MAX_IDLE:{get:()=>Wn.defaultMaxIdle,set(t){dt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Wn.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Wn.defaultCheckCountMax,set(t){dt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Wn.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>xi.defaultVertexPrecision,set(t){dt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),xi.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>xi.defaultFragmentPrecision,set(t){dt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),xi.defaultFragmentPrecision=t}}});var qn=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(qn||{});class Zn{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Qn=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Zn(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=qn.NORMAL){return this._addListener(new Zn(t,e,i))}addOnce(t,e,i=qn.NORMAL){return this._addListener(new Zn(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let i;if(e>this.lastTime){if(i=this.elapsedMS=e-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*t.targetFPMS;const n=this._head;let s=n.next;for(;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const i=Math.min(this.maxFPS,e),n=Math.min(Math.max(0,i)/1e3,t.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};Qn.targetFPMS=.06;let Jn=Qn;Object.defineProperties(nt,{TARGET_FPMS:{get:()=>Jn.targetFPMS,set(t){dt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Jn.targetFPMS=t}}});class ts{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,qn.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Jn.shared:new Jn,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}ts.extension=pe.Application,me.add(ts);const es=[];me.handleByList(pe.Renderer,es);const is="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class ns{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=tt.HIGH?this.multisample=tt.HIGH:e>=tt.MEDIUM?this.multisample=tt.MEDIUM:e>=tt.LOW?this.multisample=tt.LOW:this.multisample=tt.NONE}destroy(){}}ns.extension={type:pe.RendererSystem,name:"_multisample"},me.add(ns);class ss{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class rs{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const r=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,r.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new ss(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}rs.extension={type:pe.RendererSystem,name:"buffer"},me.add(rs);class os{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,s,r,o;if(e&&(n=e.renderTexture,s=e.clear,r=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=r,!i.context.isLost){if(n||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}os.extension={type:pe.RendererSystem,name:"objectRenderer"},me.add(os);const as=class t extends zn{constructor(e){super(),this.type=N.WEBGL,e=Object.assign({},nt.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new wi({projectionMatrix:new qe},!0);const i={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:t.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(i),"useContextAlpha"in e&&(dt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=t.__plugins,this.options=e,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(typeof gt>"u"&&(gt=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:nt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!nt.ADAPTER.getWebGLRenderingContext())return!1;const e=nt.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!i?.getContextAttributes()?.stencil;if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,n}catch{return!1}}()),gt)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return dt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return dt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return dt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return dt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){dt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return dt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){dt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return dt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};as.extension={type:pe.Renderer,priority:1},as.__plugins={},as.__systems={};let ls=as;me.handleByMap(pe.RendererPlugin,ls.__plugins),me.handleByMap(pe.RendererSystem,ls.__systems),me.add(ls);class hs extends xe{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new Ie;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof xe?this.addResourceAt(t[i],i):this.addResourceAt(Ae(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),this.update(),Promise.resolve(this)})),this._load}}const ds=class t extends hs{constructor(e,i){const{width:n,height:s,autoLoad:r,linkBaseTexture:o}=i||{};if(e&&e.length!==t.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:n,height:s});for(let e=0;e<t.SIDES;e++)this.items[e].target=z.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=!1!==o,e&&this.initFromArray(e,i),!1!==r&&this.load()}bind(t){super.bind(t),t.target=z.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=z.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(e,i,n){const s=this.itemDirtyIds;for(let r=0;r<t.SIDES;r++){const t=this.items[r];(s[r]<t.dirtyId||n.dirtyId<i.dirtyId)&&(t.valid&&t.resource?(t.resource.upload(e,t,n),s[r]=t.dirtyId):s[r]<-1&&(e.gl.texImage2D(t.target,0,n.internalFormat,i.realWidth,i.realHeight,0,i.format,n.type,null),s[r]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===t.SIDES}};ds.SIDES=6;let cs=ds;class us extends Hi{constructor(t,e){let i,n,s;e=e||{},"string"==typeof t?(i=us.EMPTY,n=t,s=!0):(i=t,n=null,s=!1),super(i),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await nt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await e.blob();if(this.destroyed)return;const n=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===$.UNPACK?"premultiply":"none"});if(this.destroyed)return void n.close();this.source=n,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return us._EMPTY=us._EMPTY??nt.ADAPTER.createCanvas(0,0),us._EMPTY}}const ps=class t extends Hi{constructor(t,e){e=e||{},super(nt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.update(),e(this)},t.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Hi.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),n=Math.round(n),s=Math.round(s);const r=this.source;r.width=n,r.height=s,r._pixiId=`canvas_${ie()}`,r.getContext("2d").drawImage(t,0,0,e,i,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(e){const i=t.SVG_SIZE.exec(e),n={};return i&&(n[i[1]]=Math.round(parseFloat(i[3])),n[i[5]]=Math.round(parseFloat(i[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,i){return"svg"===i||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&t.SVG_XML.test(e)}};ps.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,ps.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let fs=ps;const gs=class t extends Hi{constructor(e,i){if(i=i||{},!(e instanceof HTMLVideoElement)){const n=document.createElement("video");!1!==i.autoLoad&&n.setAttribute("preload","auto"),!1!==i.playsinline&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),!0===i.muted&&(n.setAttribute("muted",""),n.muted=!0),!0===i.loop&&n.setAttribute("loop",""),!1!==i.autoPlay&&n.setAttribute("autoplay",""),"string"==typeof e&&(e=[e]);const s=e[0].src||e[0];Hi.crossOrigin(n,s,i.crossorigin);for(let i=0;i<e.length;++i){const s=document.createElement("source");let{src:r,mime:o}=e[i];if(r=r||e[i],r.startsWith("data:"))o=r.slice(5,r.indexOf(";"));else if(!r.startsWith("blob:")){const e=r.split("?").shift().toLowerCase(),i=e.slice(e.lastIndexOf(".")+1);o=o||t.MIME_TYPES[i]||`video/${i}`}s.src=r,o&&(s.type=o),n.appendChild(s)}e=n}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=i.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==i.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==i.autoLoad&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const t=Jn.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Jn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Jn.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Jn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,i){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.includes(i)}};gs.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],gs.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ms=gs;be.push(us,Vi,class extends Hi{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},ms,fs,Se,cs,class extends hs{constructor(t,e){const{width:i,height:n}=e||{};let s,r;Array.isArray(t)?(s=t,r=t.length):r=t,super(r,{width:i,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=z.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:s,items:r}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let t=0;t<n;t++){const n=r[t];s[t]<n.dirtyId&&(s[t]=n.dirtyId,n.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,n.resource.width,n.resource.height,1,e.format,i.type,n.resource.source))}return!0}});class vs{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?We.EMPTY:((t=t||new We(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:s,d:r,tx:o,ty:a}=t,l=i*e.x+s*e.y+o,h=n*e.x+r*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,r=t[0],o=t[1];e=r<e?r:e,i=o<i?o:i,n=r>n?r:n,s=o>s?o:s,r=t[2],o=t[3],e=r<e?r:e,i=o<i?o:i,n=r>n?r:n,s=o>s?o:s,r=t[4],o=t[5],e=r<e?r:e,i=o<i?o:i,n=r>n?r:n,s=o>s?o:s,r=t[6],o=t[7],e=r<e?r:e,i=o<i?o:i,n=r>n?r:n,s=o>s?o:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)}addFrameMatrix(t,e,i,n,s){const r=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,d=t.ty;let c=this.minX,u=this.minY,p=this.maxX,f=this.maxY,g=r*e+a*i+h,m=o*e+l*i+d;c=g<c?g:c,u=m<u?m:u,p=g>p?g:p,f=m>f?m:f,g=r*n+a*i+h,m=o*n+l*i+d,c=g<c?g:c,u=m<u?m:u,p=g>p?g:p,f=m>f?m:f,g=r*e+a*s+h,m=o*e+l*s+d,c=g<c?g:c,u=m<u?m:u,p=g>p?g:p,f=m>f?m:f,g=r*n+a*s+h,m=o*n+l*s+d,c=g<c?g:c,u=m<u?m:u,p=g>p?g:p,f=m>f?m:f,this.minX=c,this.minY=u,this.maxX=p,this.maxY=f}addVertexData(t,e,i){let n=this.minX,s=this.minY,r=this.maxX,o=this.maxY;for(let a=e;a<i;a+=2){const e=t[a],i=t[a+1];n=e<n?e:n,s=i<s?i:s,r=e>r?e:r,o=i>o?i:o}this.minX=n,this.minY=s,this.maxX=r,this.maxY=o}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,s=0,r=s){const o=t.a,a=t.b,l=t.c,h=t.d,d=t.tx,c=t.ty;let u=this.minX,p=this.minY,f=this.maxX,g=this.maxY;for(let t=i;t<n;t+=2){const i=e[t],n=e[t+1],m=o*i+l*n+d,v=h*n+a*i+c;u=Math.min(u,m-s),f=Math.max(f,m+s),p=Math.min(p,v-r),g=Math.max(g,v+r)}this.minX=u,this.minY=p,this.maxX=f,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,r=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=r){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=n<e?n:e,this.maxX=s>o?s:o,this.maxY=r>a?r:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,r=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=r){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=n<e?n:e,this.maxX=s>o?s:o,this.maxY=r>a?r:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,s,r){t-=s,e-=r,i+=s,n+=r,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class _s extends(e()){constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ai,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new vs,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(_s.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new We),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new We),t=this._localBoundsRect),this._localBounds||(this._localBounds=new vs);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const r=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,r}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,s=0,r=0,o=0,a=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=r,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new ys),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ue}set angle(t){this.transform.rotation=t*He}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class ys extends _s{constructor(){super(...arguments),this.sortDirty=null}}_s.prototype.displayObjectUpdateTransform=_s.prototype.updateTransform;const Es=new qe;function bs(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const As=class t extends _s{constructor(){super(),this.children=[],this.sortableChildren=t.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Jt(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,Jt(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Jt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e-i;let s;if(n>0&&n<=e){s=this.children.splice(i,n);for(let t=0;t<s.length;++t)s[t].parent=null,s[t].transform&&(s[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<s.length;++t)s[t].emit("removed",this),this.emit("childRemoved",s[t],this,t);return s}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e];i._lastSortedIndex=e,!t&&0!==i.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(bs),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const i=e.renderTexture.sourceFrame;if(!(i.width>0&&i.height>0))return;let n,s;this.cullArea?(n=this.cullArea,s=this.worldTransform):this._render!==t.prototype._render&&(n=this.getBounds(!0));const r=e.projection.transform;if(r&&(s?(s=Es.copyFrom(s),s.prepend(r)):s=r),n&&i.intersects(n,s))this._render(e);else if(this.cullArea)return;for(let t=0,i=this.children.length;t<i;++t){const i=this.children[t],n=i.cullable;i.cullable=n||!this.cullArea,i.render(e),i.cullable=n}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const n=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==J.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<i.length;++e)i[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};As.defaultSortableChildren=!1;let Ts=As;Ts.prototype.containerUpdateTransform=Ts.prototype.updateTransform,Object.defineProperties(nt,{SORTABLE_CHILDREN:{get:()=>Ts.defaultSortableChildren,set(t){dt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ts.defaultSortableChildren=t}}});const xs=new ze,Ss=new Uint16Array([0,1,2,0,2,3]);class ws extends Ts{constructor(t){super(),this._anchor=new ri(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Xt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=U.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Xi.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Ss,this.pluginName="batch",this.isSprite=!0,this._roundPixels=nt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=te(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=te(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,r=e.d,o=e.tx,a=e.ty,l=this.vertexData,h=t.trim,d=t.orig,c=this._anchor;let u=0,p=0,f=0,g=0;if(h?(p=h.x-c._x*d.width,u=p+h.width,g=h.y-c._y*d.height,f=g+h.height):(p=-c._x*d.width,u=p+d.width,g=-c._y*d.height,f=g+d.height),l[0]=i*p+s*g+o,l[1]=r*g+n*p+a,l[2]=i*u+s*g+o,l[3]=r*g+n*u+a,l[4]=i*u+s*f+o,l[5]=r*f+n*u+a,l[6]=i*p+s*f+o,l[7]=r*f+n*p+a,this._roundPixels){const t=nt.RESOLUTION;for(let e=0;e<l.length;++e)l[e]=Math.round(l[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,r=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,d=s.ty,c=-n._x*i.width,u=c+i.width,p=-n._y*i.height,f=p+i.height;if(e[0]=r*c+a*p+h,e[1]=l*p+o*c+d,e[2]=r*u+a*p+h,e[3]=l*p+o*u+d,e[4]=r*u+a*f+h,e[5]=l*f+o*u+d,e[6]=r*c+a*f+h,e[7]=l*f+o*c+d,this._roundPixels){const t=nt.RESOLUTION;for(let i=0;i<e.length;++i)e[i]=Math.round(e[i]*t)/t}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new vs),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new We),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,xs);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return xs.x>=n&&xs.x<n+e&&(s=-i*this.anchor.y,xs.y>=s&&xs.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof Xi?t:Xi.from(t,e);return new ws(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=te(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=te(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Xi.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Cs=new qe;_s.prototype._cacheAsBitmap=!1,_s.prototype._cacheData=null,_s.prototype._cacheAsBitmapResolution=null,_s.prototype._cacheAsBitmapMultisample=null;class Is{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(_s.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Is),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),_s.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},_s.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(new We,!0);if(this.filters?.length){const t=this.filters[0].padding;i.pad(t)}const n=this.cacheAsBitmapResolution||t.resolution;i.ceil(n),i.width=Math.max(i.width,1/n),i.height=Math.max(i.height,1/n);const s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=Ki.create({width:i.width,height:i.height,resolution:n,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${ie()}`;this._cacheData.textureCacheId=h,Ie.addToCache(l.baseTexture,h),Xi.addToCache(l,h);const d=this.transform.localTransform.copyTo(Cs).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(s,r,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new ws(l);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-i.x/i.width,c.anchor.y=-i.y/i.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},_s.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},_s.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(new We,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform,r=this.cacheAsBitmapResolution||t.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);const o=Ki.create({width:e.width,height:e.height,resolution:r}),a=`cacheAsBitmap_${ie()}`;this._cacheData.textureCacheId=a,Ie.addToCache(o.baseTexture,a),Xi.addToCache(o,a);const l=Cs;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new ws(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},_s.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},_s.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},_s.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ie.removeFromCache(this._cacheData.textureCacheId),Xi.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},_s.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},_s.prototype.name=null,Ts.prototype.getChildByName=function(t,e){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,i=this.children.length;e<i;e++){const i=this.children[e];if(!i.getChildByName)continue;const n=i.getChildByName(t,!0);if(n)return n}return null},_s.prototype.getGlobalPosition=function(t=new ze,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const Rs={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Ps=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Ls extends Oi{constructor(t,e=8,i=4,n=Oi.defaultResolution,s=5){const r=function(t,e){const i=Math.ceil(t/2);let n,s="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",r="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=n.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(i-1)+".0"),r+=t,r+="\n"}return s=s.replace("%blur%",r),s=s.replace("%size%",t.toString()),s}(s,t),o=function(t){const e=Rs[t],i=e.length;let n,s=Ps,r="";for(let s=0;s<t;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());n=s,s>=i&&(n=t-s-1),o=o.replace("%value%",e[n].toString()),r+=o,r+="\n"}return s=s.replace("%blur%",r),s=s.replace("%size%",t.toString()),s}(s);super(r,o),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,n);else{const s=t.getFilterTexture(),r=t.renderer;let o=e,a=s;this.state.blend=!1,t.applyFilter(this,o,a,q.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,q.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,r.shader.bind(this),r.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class Ms extends Oi{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(is,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,n,s]=Xt.shared.setValue(t).toArray(),r=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(r,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=1/3,r=(0,Math.sqrt)(s),o=[i+(1-i)*s,s*(1-i)-r*n,s*(1-i)+r*n,0,0,s*(1-i)+r*n,i+s*(1-i),s*(1-i)-r*n,0,0,s*(1-i)-r*n,s*(1-i)+r*n,i+s*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=2*t/3+1,n=-.5*(i-1),s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,n,s){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const r=Xt.shared,[o,a,l]=r.setValue(i).toArray(),[h,d,c]=r.setValue(n).toArray(),u=[.3,.59,.11,0,0,o,a,l,t,0,h,d,c,e,0,o-h,a-d,l-c,0,0];this._loadMatrix(u,s)}night(t,e){const i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Ms.prototype.grayscale=Ms.prototype.greyscale;const Ds={AlphaFilter:class extends Oi{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends Oi{constructor(t=8,e=4,i=Oi.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Ls(!0,t,e,i,n),this.blurYFilter=new Ls(!1,t,e,i,n),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,n){const s=Math.abs(this.blurXFilter.strength),r=Math.abs(this.blurYFilter.strength);if(s&&r){const s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,q.CLEAR),this.blurYFilter.apply(t,s,i,n),t.returnFilterTexture(s)}else r?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:Ls,ColorMatrixFilter:Ms,DisplacementFilter:class extends Oi{constructor(t,e){const i=new qe;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new ze(e,e)}apply(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,r=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==r&&0!==o&&(this.uniforms.rotation[0]=s.a/r,this.uniforms.rotation[1]=s.b/r,this.uniforms.rotation[2]=s.c/o,this.uniforms.rotation[3]=s.d/o),t.applyFilter(this,e,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends Oi{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends Oi{constructor(t=.5,e=Math.random()){super(is,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(Ds).forEach((([t,e])=>{Object.defineProperty(Ds,t,{get:()=>(dt("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const Os=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Jn.system.add(this.tickerUpdate,this,qn.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Jn.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class ks{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ks.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ze,this.page=new ze,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Bs extends ks{constructor(){super(...arguments),this.client=new ze,this.movement=new ze,this.offset=new ze,this.global=new ze,this.screen=new ze}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,r,o,a,l,h,d,c,u,p,f){throw new Error("Method not implemented.")}}class Fs extends Bs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Ns extends Bs{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ns.DOM_DELTA_PIXEL=0,Ns.DOM_DELTA_LINE=1,Ns.DOM_DELTA_PAGE=2;const Gs=new ze,Us=new ze;class Hs{constructor(t){this.dispatch=new(e()),this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Os.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,Gs.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(0===i.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let e=i.length-1;e>=0;e--)n.forEach((n=>{t.currentTarget=i[e],this.notifyTarget(t,n)}))}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,s,r=!1){let o=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Os.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let l=a.length-1;l>=0;l--){const h=a[l],d=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,i,n,s,r||s(t,i));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const e=t.isInteractive();(d.length>0||e)&&(e&&this._allInteractiveElements.push(t),d.push(t)),0===this._hitElements.length&&(this._hitElements=d),o=!0}}}const a=this._isInteractive(e),l=t.isInteractive();return a&&l&&this._allInteractiveElements.push(t),r||this._hitElements.length>0?null:o?this._hitElements:a&&!s(t,i)&&n(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,n,s){if(this._interactivePrune(t)||s(t,i))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Os.pauseUpdate=!1),t.interactiveChildren&&t.children){const r=t.children;for(let o=r.length-1;o>=0;o--){const a=r[o],l=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,i,n,s);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const e=t.isInteractive();return(l.length>0||e)&&l.push(t),l}}}const r=this._isInteractive(e),o=t.isInteractive();return r&&n(t,i)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable&&"none"!==t.eventMode&&("passive"!==t.eventMode||t.interactiveChildren)&&!t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Us),!t.hitArea.contains(Us.x,Us.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const i=`on${e=e??t.type}`;t.currentTarget[i]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&s!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",r=this.createPointerEvent(t,n,s);if(this.dispatchEvent(r,"pointerout"),i&&this.dispatchEvent(r,"mouseout"),!e.composedPath().includes(s)){const n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(r)}if(s!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",r=this.clonePointerEvent(e,n);this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover");let o=s?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==s&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(r)}const r=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?r.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&r.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?r.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&r.push("globaltouchmove")),i&&(this.moveOnAll?r.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&r.push("globalmousemove"),this.cursor=e.target?.cursor),r.length>0&&this.all(e,r),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const r=this.createPointerEvent(t,"pointerleave",n);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),i&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(r)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let r=s;if(s&&!i.composedPath().includes(s)){let e=s;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],r=e}if(r){const s=this.clonePointerEvent(i,"click");s.target=r,s.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===s.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=e,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Fs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):("mouse"===n.pointerType||"pen"===n.pointerType)&&this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Ns))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(Fs);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Ns);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Fs);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Fs&&e instanceof Fs&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Bs&&e instanceof Bs&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const Vs={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},zs=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Hs(null),Os.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Fs(null),this.rootWheelEvent=new Ns(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,i)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:i,resolution:n}=this.renderer;this.setTargetElement(i),this.resolution=n,t._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],n=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Os.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let t=0,e=n.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,n[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Os.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Os.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Os.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const n=t.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=1),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Vs[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};zs.extension={name:"events",type:[pe.RendererSystem,pe.CanvasRendererSystem]},zs.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let js=zs;function Ws(t){return"dynamic"===t||"static"===t}me.add(js);const Xs={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Ws(js.defaultEventMode)},set interactive(t){dt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??js.defaultEventMode},set eventMode(t){this._internalInteractive=Ws(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const n="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,n)},removeEventListener(t,e,i){const n="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof ks))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};_s.mixin(Xs);_s.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Ks{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ot.tablet||ot.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(ot.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:r,height:o,resolution:a}=this.renderer,l=n/r*a,h=s/o*a;let d=this.div;d.style.left=`${e}px`,d.style.top=`${i}px`,d.style.width=`${r}px`,d.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,Jt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{d=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(d.style.left=(i.tx+t.x*i.a)*l+"px",d.style.top=(i.ty+t.y*i.d)*h+"px",d.style.width=t.width*i.a*l+"px",d.style.height=t.height*i.d*h+"px"):(t=e.getBounds(),this.capHitArea(t),d.style.left=t.x*l+"px",d.style.top=t.y*h+"px",d.style.width=t.width*l+"px",d.style.height=t.height*h+"px",d.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(d.title=e.accessibleTitle),d.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&d.setAttribute("aria-label",e.accessibleHint)),(e.accessibleTitle!==d.title||e.tabIndex!==d.tabIndex)&&(d.title=e.accessibleTitle,d.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new ks(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(s,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Ks.extension={name:"accessibility",type:[pe.RendererPlugin,pe.CanvasRendererPlugin]},me.add(Ks);const Ys=class t{constructor(e){this.stage=new Ts,e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){for(const e of es)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(e,i){const n=t._plugins.slice(0);n.reverse(),n.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Ys._plugins=[];let $s=Ys;me.handleByList(pe.Application,$s._plugins);class qs{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}qs.extension=pe.Application,me.add(qs);const Zs={loader:pe.LoadParser,resolver:pe.ResolveParser,cache:pe.CacheParser,detection:pe.DetectionParser};me.handle(pe.Asset,(t=>{const e=t.ref;Object.entries(Zs).filter((([t])=>!!e[t])).forEach((([t,i])=>me.add(Object.assign(e[t],{extension:e[t].extension??i}))))}),(t=>{const e=t.ref;Object.keys(Zs).filter((t=>!!e[t])).forEach((t=>me.remove(e[t])))}));class Qs{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Js(t,e){const i=t.split("?")[0],n=pt.extname(i).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const tr=(t,e,i=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||i?e(t):t)):t);const er=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=tr(t);let n;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];if(s.test(e)){n=s.getCacheableAssets(i,e);break}}n||(n={},i.forEach((t=>{n[t]=e})));const s=Object.keys(n),r={cacheKeys:s,keys:i};if(i.forEach((t=>{this._cacheMap.set(t,r)})),s.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,n[t])})),e instanceof Xi){const t=e;i.forEach((e=>{t.baseTexture!==Xi.EMPTY.baseTexture&&Ie.addToCache(t.baseTexture,e),Xi.addToCache(t,e)}))}}remove(t){if(!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},ir=t=>!Array.isArray(t);class nr{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let i=0;i<this.parsers.length;i++){const n=this.parsers[i];if(n.load&&n.test?.(t,e,this)){s=n;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),i.parser=s;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];s.parse&&s.parse&&await(s.testParse?.(n,e,this))&&(n=await s.parse(n,e,this)||n,i.parser=s)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},s=ir(t),r=tr(t,(t=>({alias:[t],src:t}))),o=r.length,a=r.map((async t=>{const s=pt.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,t)),n[t.src]=await this.promiseCache[s].promise,e&&e(++i/o)}catch(e){throw delete this.promiseCache[s],delete n[t.src],new Error(`[Loader.load] Failed to load ${s}.\n${e}`)}}));return await Promise.all(a),s?n[r[0].src]:n}async unload(t){const e=tr(t,(t=>({alias:[t],src:t}))).map((async t=>{const e=pt.toAbsolute(t.src),i=this.promiseCache[e];if(i){const n=await i.promise;delete this.promiseCache[e],i.parser?.unload?.(n,t,this)}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var sr=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(sr||{});function rr(t,e){if(Array.isArray(e)){for(const i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}const or={extension:{type:pe.LoadParser,priority:sr.Low},name:"loadJson",test:t=>rr(t,"application/json")||Js(t,".json"),load:async t=>await(await nt.ADAPTER.fetch(t)).json()};me.add(or);const ar={name:"loadTxt",extension:{type:pe.LoadParser,priority:sr.Low},test:t=>rr(t,"text/plain")||Js(t,".txt"),load:async t=>await(await nt.ADAPTER.fetch(t)).text()};me.add(ar);const lr=["normal","bold","100","200","300","400","500","600","700","800","900"],hr=[".ttf",".otf",".woff",".woff2"],dr=["font/ttf","font/otf","font/woff","font/woff2"],cr=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const ur=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;const pr={extension:{type:pe.LoadParser,priority:sr.Low},name:"loadWebFont",test:t=>rr(t,dr)||Js(t,hr),async load(t,e){const i=nt.ADAPTER.getFontFaceSet();if(i){const s=[],r=e.data?.family??function(t){const e=pt.extname(t),i=pt.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=i.length>0;for(const t of i)if(!t.match(cr)){n=!1;break}let s=i.join(" ");return n||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}(t),o=e.data?.weights?.filter((t=>lr.includes(t)))??["normal"],a=e.data??{};for(let e=0;e<o.length;e++){const l=o[e],h=new FontFace(r,`url(${n=t,ur.test(n)?n:encodeURI(n)})`,{...a,weight:l});await h.load(),i.add(h),s.push(h)}return 1===s.length?s[0]:s}var n;return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>nt.ADAPTER.getFontFaceSet().delete(t)))}};me.add(pr);let fr,gr=0;const mr={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},vr={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let _r;const yr=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([mr.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",(n=>{i.terminate(),URL.revokeObjectURL(e),t(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===fr&&(fr=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<fr&&(_r||(_r=URL.createObjectURL(new Blob([vr.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(_r),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise(((i,n)=>{this.queue.push({id:t,arguments:e,resolve:i,reject:n})}));return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[gr]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:gr++,id:i})}};function Er(t,e,i){t.resource.internal=!0;const n=new Xi(t),s=()=>{delete e.promiseCache[i],er.has(i)&&er.remove(i)};return n.baseTexture.once("destroyed",(()=>{i in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())})),n.once("destroyed",(()=>{t.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())})),n}const br=[".jpeg",".jpg",".png",".webp",".avif"],Ar=["image/jpeg","image/png","image/webp","image/avif"];const Tr={name:"loadTextures",extension:{type:pe.LoadParser,priority:sr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>rr(t,Ar)||Js(t,br),async load(t,e,i){const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;s=n?this.config.preferWorkers&&await yr.isImageBitmapSupported()?await yr.loadImageBitmap(t):await async function(t){const e=await nt.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const i=await e.blob();return await createImageBitmap(i)}(t):await new Promise(((e,i)=>{const n=new Image;n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):(n.onload=()=>e(n),n.onerror=t=>i(t))}));const r={...e.data};r.resolution??(r.resolution=ue(t)),n&&void 0===r.resourceOptions?.ownsImageBitmap&&(r.resourceOptions={...r.resourceOptions},r.resourceOptions.ownsImageBitmap=!0);const o=new Ie(s,r);return o.resource.src=t,Er(o,i,t)},unload(t){t.destroy(!0)}};me.add(Tr);const xr={extension:{type:pe.LoadParser,priority:sr.High},name:"loadSVG",test:t=>rr(t,"image/svg+xml")||Js(t,".svg"),testParse:async t=>fs.test(t),async parse(t,e,i){const n=new fs(t,e?.data?.resourceOptions);await n.load();const s=new Ie(n,{resolution:ue(t),...e?.data});return s.resource.src=e.src,Er(s,i,e.src)},load:async(t,e)=>(await nt.ADAPTER.fetch(t)).text(),unload:Tr.unload};me.add(xr);const Sr=[".mp4",".m4v",".webm",".ogv"],wr=["video/mp4","video/webm","video/ogg"],Cr={name:"loadVideo",extension:{type:pe.LoadParser,priority:sr.High},config:{defaultAutoPlay:!0},test:t=>rr(t,wr)||Js(t,Sr),async load(t,e,i){let n;const s=await(await nt.ADAPTER.fetch(t)).blob(),r=URL.createObjectURL(s);try{const s={autoPlay:this.config.defaultAutoPlay,...e?.data?.resourceOptions},o=new ms(r,s);await o.load();const a=new Ie(o,{alphaMode:await mt(),resolution:ue(t),...e?.data});a.resource.src=t,n=Er(a,i,t),n.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(r)}))}catch(t){throw URL.revokeObjectURL(r),t}return n},unload(t){t.destroy(!0)}};function Ir(t,e,i,n,s){const r=e[i];for(let o=0;o<r.length;o++){const a=r[o];i<e.length-1?Ir(t.replace(n[i],a),e,i+1,n,s):s.push(t.replace(n[i],a))}}function Rr(t){const e=t.match(/\{(.*?)\}/g),i=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),Ir(t,n,0,e,i)}else i.push(t);return i}me.add(Cr);class Pr{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,name:i,src:n,srcs:s}=t;return tr(e||i||n||s,(t=>"string"==typeof t?t:Array.isArray(t)?t.map((t=>t?.src??t?.srcs??t)):t?.src||t?.srcs?t.src??t.srcs:t),!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach((e=>{const n=e.src??e.srcs,s=e.alias??e.name;let r;if("string"==typeof s){const e=this._createBundleAssetId(t,s);i.push(e),r=[s,e]}else{const e=s.map((e=>this._createBundleAssetId(t,e)));i.push(...e),r=[...s,...e]}this.add({...e,alias:r,src:n})})):Object.keys(e).forEach((n=>{const s=[n,this._createBundleAssetId(t,n)];if("string"==typeof e[n])this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const t=e[n],i=t.src??t.srcs;this.add({...t,alias:s,src:Array.isArray(i)?i:[i]})}i.push(...s)})),this._bundles[t]=i}add(t,e,i,n,s){const r=[];let o;"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]?(dt("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),r.push({alias:t,src:e,data:i,format:n,loadParser:s})):Array.isArray(t)?r.push(...t):r.push(t),o=t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)},tr(r).forEach((t=>{const{src:e,srcs:i}=t;let{data:n,format:s,loadParser:r}=t;const a=tr(e||i).map((t=>"string"==typeof t?Rr(t):Array.isArray(t)?t:[t])),l=this.getAlias(t);Array.isArray(l)?l.forEach(o):o(l);const h=[];a.forEach((t=>{t.forEach((t=>{let e={};if("object"!=typeof t){e.src=t;for(let i=0;i<this._parsers.length;i++){const n=this._parsers[i];if(n.test(t)){e=n.parse(t);break}}}else n=t.data??n,s=t.format??s,r=t.loadParser??r,e={...e,...t};if(!l)throw new Error(`[Resolver] alias is undefined for this asset: ${e.src}`);e=this.buildResolvedAsset(e,{aliases:l,data:n,format:s,loadParser:r}),h.push(e)}))})),l.forEach((t=>{this._assetMap[t]=h}))}))}resolveBundle(t){const e=ir(t);t=tr(t);const i={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),s={};for(const e in n){const i=n[e];s[this._extractAssetIdFromBundle(t,e)]=i}i[t]=s}})),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const i in e)t[i]=e[i].src;return t}return e.src}resolve(t){const e=ir(t);t=tr(t);const i={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const i=e[0],n=this._getPreferredOrder(e);n?.priority.forEach((t=>{n.params[t].forEach((i=>{const n=e.filter((e=>!!e[t]&&e[t]===i));n.length&&(e=n)}))})),this._resolverHash[t]=e[0]??i}else this._resolverHash[t]=this.buildResolvedAsset({alias:[t],src:t},{});i[t]=this._resolverHash[t]})),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],i=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:s,format:r}=e;return(this._basePath||this._rootPath)&&(t.src=pt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=r??pt.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}const Lr=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Pr,this.loader=new nr,this.cache=er,this._backgroundLoader=new Qs(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,i="number"==typeof e?[e]:e,n=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,n,s){this.resolver.add(t,e,i,n,s)}async load(t,e){this._initialized||await this.init();const i=ir(t),n=tr(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),s=this.resolver.resolve(n),r=await this._mapLoadToResolve(s,e);return i?r[n[0]]:r}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;"string"==typeof t&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},r=Object.keys(n);let o=0,a=0;const l=()=>{e?.(++o/a)},h=r.map((t=>{const e=n[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,l).then((e=>{s[t]=e}))}));return await Promise.all(h),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return er.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=er.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const r={};return i.forEach(((t,e)=>{const i=s[t.src],o=[t.src];t.alias&&o.push(...t.alias),r[n[e]]=i,er.set(o,i)})),r}async unload(t){this._initialized||await this.init();const e=tr(t).map((t=>"string"!=typeof t?t.src:t)),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=tr(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{er.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter(((t,i)=>e.indexOf(t)===i)),e}get detections(){return this._detections}get preferWorkers(){return Tr.config.preferWorkers}set preferWorkers(t){dt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((i=>{e.config[i]=t[i]}))}))}};me.handleByList(pe.LoadParser,Lr.loader.parsers).handleByList(pe.ResolveParser,Lr.resolver.parsers).handleByList(pe.CacheParser,Lr.cache.parsers).handleByList(pe.DetectionParser,Lr.detections);const Mr={extension:pe.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Xi)),getCacheableAssets:(t,e)=>{const i={};return t.forEach((t=>{e.forEach(((e,n)=>{i[t+(0===n?"":n+1)]=e}))})),i}};async function Dr(t){if("Image"in globalThis)return new Promise((e=>{const i=new Image;i.onload=()=>{e(!0)},i.onerror=()=>{e(!1)},i.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}me.add(Mr);const Or={extension:{type:pe.DetectionParser,priority:1},test:async()=>Dr("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};me.add(Or);const kr={extension:{type:pe.DetectionParser,priority:0},test:async()=>Dr("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};me.add(kr);const Br=["png","jpg","jpeg"],Fr={extension:{type:pe.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Br],remove:async t=>t.filter((t=>!Br.includes(t)))};me.add(Fr);const Nr="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Gr(t){return!Nr&&""!==document.createElement("video").canPlayType(t)}const Ur={extension:{type:pe.DetectionParser,priority:0},test:async()=>Gr("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))};me.add(Ur);const Hr={extension:{type:pe.DetectionParser,priority:0},test:async()=>Gr("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))};me.add(Hr);const Vr={extension:{type:pe.DetectionParser,priority:0},test:async()=>Gr("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))};me.add(Vr);const zr={extension:pe.ResolveParser,test:Tr.test,parse:t=>({resolution:parseFloat(nt.RETINA_PREFIX.exec(t)?.[1]??"1"),format:pt.extname(t).slice(1),src:t})};me.add(zr);const jr=(t,e)=>{const i=e.split("?")[1];return i&&(t+=`?${i}`),t};var Wr=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(Wr||{});const Xr={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};i(4);let Kr,Yr;function $r(){Yr={s3tc:Kr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Kr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Kr.getExtension("WEBGL_compressed_texture_etc"),etc1:Kr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Kr.getExtension("WEBGL_compressed_texture_pvrtc")||Kr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Kr.getExtension("WEBGL_compressed_texture_atc"),astc:Kr.getExtension("WEBGL_compressed_texture_astc")}}const qr={extension:{type:pe.DetectionParser,priority:2},test:async()=>{const t=nt.ADAPTER.createCanvas().getContext("webgl");return t?(Kr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{Yr||$r();const e=[];for(const t in Yr)Yr[t]&&e.push(t);return[...e,...t]},remove:async t=>(Yr||$r(),t.filter((t=>!(t in Yr))))};me.add(qr);class Zr extends Se{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;"string"==typeof t?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new ve(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new ve(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class Qr extends Zr{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Qr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Qr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:i,levelHeight:s,levelBuffer:r}=this._levelBuffers[t];n.compressedTexImage2D(n.TEXTURE_2D,e,this.format,i,s,0,r)}return!0}onBlobLoaded(){this._levelBuffers=Qr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,n,s,r,o){const a=new Array(i);let l=t.byteOffset,h=r,d=o,c=h+n-1&~(n-1),u=d+s-1&~(s-1),p=c*u*Xr[e];for(let r=0;r<i;r++)a[r]={levelID:r,levelWidth:i>1?h:c,levelHeight:i>1?d:u,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,h=h>>1||1,d=d>>1||1,c=h+n-1&~(n-1),u=d+s-1&~(s-1),p=c*u*Xr[e];return a}}const Jr=124,to=3,eo=4,io=7,no=19,so=2,ro=0,oo=1,ao=2,lo=3,ho={827611204:Wr.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:Wr.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:Wr.COMPRESSED_RGBA_S3TC_DXT5_EXT},co={70:Wr.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Wr.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Wr.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Wr.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Wr.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Wr.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Wr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Wr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Wr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const uo=[171,75,84,88,32,49,49,187,13,10,26,10],po=12,fo=16,go=24,mo=28,vo=36,_o=40,yo=44,Eo=48,bo=52,Ao=56,To=60,xo=64,So={[j.UNSIGNED_BYTE]:1,[j.UNSIGNED_SHORT]:2,[j.INT]:4,[j.UNSIGNED_INT]:4,[j.FLOAT]:4,[j.HALF_FLOAT]:8},wo={[V.RGBA]:4,[V.RGB]:3,[V.RG]:2,[V.RED]:1,[V.LUMINANCE]:1,[V.LUMINANCE_ALPHA]:2,[V.ALPHA]:1},Co={[j.UNSIGNED_SHORT_4_4_4_4]:2,[j.UNSIGNED_SHORT_5_5_5_1]:2,[j.UNSIGNED_SHORT_5_6_5]:2};function Io(t,e,i=!1){const n=new DataView(e);if(!function(t,e){for(let i=0;i<uo.length;i++)if(e.getUint8(i)!==uo[i])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,n))return null;const s=67305985===n.getUint32(po,!0),r=n.getUint32(fo,s),o=n.getUint32(go,s),a=n.getUint32(mo,s),l=n.getUint32(vo,s),h=n.getUint32(_o,s)||1,d=n.getUint32(yo,s)||1,c=n.getUint32(Eo,s)||1,u=n.getUint32(bo,s),p=n.getUint32(Ao,s),f=n.getUint32(To,s);if(0===h||1!==d)throw new Error("Only 2D textures are supported");if(1!==u)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");const g=l+3&-4,m=h+3&-4,v=new Array(c);let _,y=l*h;if(0===r&&(y=g*m),_=0!==r?So[r]?So[r]*wo[o]:Co[r]:Xr[a],void 0===_)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const E=i?function(t,e,i){const n=new Map;let s=0;for(;s<e;){const r=t.getUint32(xo+s,i),o=xo+s+4,a=3-(r+3)%4;if(0===r||r>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<r&&0!==t.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=(new TextDecoder).decode(new Uint8Array(t.buffer,o,l)),d=new DataView(t.buffer,o+l+1,r-l-1);n.set(h,d),s+=4+r+a}return n}(n,f,s):null;let b=y*_,A=l,T=h,x=g,S=m,w=xo+f;for(let t=0;t<p;t++){const i=n.getUint32(w,s);let o=w+4;for(let i=0;i<c;i++){let n=v[i];n||(n=v[i]=new Array(p)),n[t]={levelID:t,levelWidth:p>1||0!==r?A:x,levelHeight:p>1||0!==r?T:S,levelBuffer:new Uint8Array(e,o,b)},o+=b}w+=i+4,w=w%4!=0?w+4-w%4:w,A=A>>1||1,T=T>>1||1,x=A+4-1&-4,S=T+4-1&-4,b=x*S*_}return 0!==r?{uncompressed:v.map((t=>{let e=t[0].levelBuffer,i=!1;return r===j.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):r===j.UNSIGNED_INT?(i=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):r===j.INT&&(i=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new Se(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:r,format:i?Ro(o):o}})),kvData:E}:{compressed:v.map((t=>new Qr(null,{format:a,width:l,height:h,levels:p,levelBuffers:t}))),kvData:E}}function Ro(t){switch(t){case V.RGBA:return V.RGBA_INTEGER;case V.RGB:return V.RGB_INTEGER;case V.RG:return V.RG_INTEGER;case V.RED:return V.RED_INTEGER;default:return t}}const Po={extension:{type:pe.LoadParser,priority:sr.High},name:"loadDDS",test:t=>Js(t,".dds"),async load(t,e,i){const n=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(t,0,Jr/Uint32Array.BYTES_PER_ELEMENT),n=i[to],s=i[eo],r=i[io],o=new Uint32Array(t,no*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const i=o[so];if(808540228!==i){const e=ho[i],o=new Uint8Array(t,128);return[new Qr(o,{format:e,width:s,height:n,levels:r})]}const a=128,l=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),h=l[ro],d=l[oo],c=l[ao],u=l[lo],p=co[h];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(4===c)throw new Error("DDSParser does not support cubemap textures");if(6===d)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,g=148;if(1===u)f.push(new Uint8Array(t,g));else{const e=Xr[p];let i=0,o=s,a=n;for(let t=0;t<r;t++)i+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let l=g;for(let e=0;e<u;e++)f.push(new Uint8Array(t,l,i)),l+=i}return f.map((t=>new Qr(t,{format:p,width:s,height:n,levels:r})))}throw 64&a?new Error("DDSParser does not support uncompressed texture data."):512&a?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&a?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&a?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await nt.ADAPTER.fetch(t)).arrayBuffer()).map((n=>Er(new Ie(n,{mipmap:Y.OFF,alphaMode:$.NO_PREMULTIPLIED_ALPHA,resolution:ue(t),...e.data}),i,t)));return 1===n.length?n[0]:n},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};me.add(Po);const Lo={extension:{type:pe.LoadParser,priority:sr.High},name:"loadKTX",test:t=>Js(t,".ktx"),async load(t,e,i){const n=await(await nt.ADAPTER.fetch(t)).arrayBuffer(),{compressed:s,uncompressed:r,kvData:o}=Io(t,n),a=s??r,l={mipmap:Y.OFF,alphaMode:$.NO_PREMULTIPLIED_ALPHA,resolution:ue(t),...e.data},h=a.map((e=>{a===r&&Object.assign(l,{type:e.type,format:e.format});const n=e.resource??e,s=new Ie(n,l);return s.ktxKeyValueData=o,Er(s,i,t)}));return 1===h.length?h[0]:h},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};me.add(Lo);const Mo={extension:pe.ResolveParser,test:t=>{const e=pt.extname(t).slice(1);return["basis","ktx","dds"].includes(e)},parse:t=>{const e=pt.extname(t).slice(1);if("ktx"===e){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(nt.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(nt.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e,src:t}}};me.add(Mo);const Do=new We,Oo=class t{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,n){const s=new Image;return s.src=await this.base64(t,e,i,n),s}async base64(t,e,i,n){const s=this.canvas(t,n);if(void 0!==s.toBlob)return new Promise(((t,n)=>{s.toBlob((e=>{if(!e)return void n(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n,i.readAsDataURL(e)}),e,i)}));if(void 0!==s.toDataURL)return s.toDataURL(e,i);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:i});return new Promise(((e,i)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=i,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,i){const{pixels:n,width:s,height:r,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,i);o&&t._flipY(n,s,r),a&&t._unpremultiplyAlpha(n);const l=new le(s,r,1),h=new ImageData(new Uint8ClampedArray(n.buffer),s,r);return l.context.putImageData(h,0,0),l.canvas}pixels(e,i){const{pixels:n,width:s,height:r,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,i);return o&&t._flipY(n,s,r),a&&t._unpremultiplyAlpha(n),n}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,s,r=!1,o=!1,a=!1;t&&(t instanceof Ki?s=t:(s=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),a=!0,e&&(Do.width=e.width,Do.height=e.height,e=Do)));const l=i.gl;if(s){if(n=s.baseTexture.resolution,e=e??s.frame,r=!1,o=s.baseTexture.alphaMode>0&&s.baseTexture.format===V.RGBA,!a){i.renderTexture.bind(s);const t=s.framebuffer.glFramebuffers[i.CONTEXT_UID];t.blitFramebuffer&&i.framebuffer.bind(t.blitFramebuffer)}}else n=i.resolution,e||((e=Do).width=i.width/n,e.height=i.height/n),r=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const h=Math.max(Math.round(e.width*n),1),d=Math.max(Math.round(e.height*n),1),c=new Uint8Array(4*h*d);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),h,d,l.RGBA,l.UNSIGNED_BYTE,c),a&&s?.destroy(!0),{pixels:c,width:h,height:d,flipY:r,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,i){const n=e<<2,s=i>>1,r=new Uint8Array(n);for(let e=0;e<s;e++){const s=e*n,o=(i-e-1)*n;r.set(t.subarray(s,s+n)),t.copyWithin(s,o,o+n),t.set(r,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const e=t[i+3];if(0!==e){const n=255.001/e;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5}}}};Oo.extension={name:"extract",type:pe.RendererSystem};let ko=Oo;me.add(ko);const Bo={build(t){const e=t.points;let i,n,s,r,o,a;if(t.type===Ve.CIRC){const e=t.shape;i=e.x,n=e.y,o=a=e.radius,s=r=0}else if(t.type===Ve.ELIP){const e=t.shape;i=e.x,n=e.y,o=e.width,a=e.height,s=r=0}else{const e=t.shape,l=e.width/2,h=e.height/2;i=e.x+l,n=e.y+h,o=a=Math.max(0,Math.min(e.radius,Math.min(l,h))),s=l-o,r=h-a}if(!(o>=0&&a>=0&&s>=0&&r>=0))return void(e.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(s?4:0)+(r?4:0);if(e.length=h,0===h)return;if(0===l)return e.length=8,e[0]=e[6]=i+s,e[1]=e[3]=n+r,e[2]=e[4]=i-s,void(e[5]=e[7]=n-r);let d=0,c=4*l+(s?2:0)+2,u=c,p=h;{const t=s+o,a=r,l=i+t,h=i-t,f=n+a;if(e[d++]=l,e[d++]=f,e[--c]=f,e[--c]=h,r){const t=n-a;e[u++]=h,e[u++]=t,e[--p]=t,e[--p]=l}}for(let t=1;t<l;t++){const h=Math.PI/2*(t/l),f=s+Math.cos(h)*o,g=r+Math.sin(h)*a,m=i+f,v=i-f,_=n+g,y=n-g;e[d++]=m,e[d++]=_,e[--c]=_,e[--c]=v,e[u++]=v,e[u++]=y,e[--p]=y,e[--p]=m}{const t=r+a,o=i+s,l=i-s,h=n+t,c=n-t;e[d++]=o,e[d++]=h,e[--p]=c,e[--p]=o,s&&(e[d++]=l,e[d++]=h,e[--p]=c,e[--p]=l)}},triangulate(t,e){const i=t.points,n=e.points,s=e.indices;if(0===i.length)return;let r=n.length/2;const o=r;let a,l;if(t.type!==Ve.RREC){const e=t.shape;a=e.x,l=e.y}else{const e=t.shape;a=e.x+e.width/2,l=e.y+e.height/2}const h=t.matrix;n.push(t.matrix?h.a*a+h.c*l+h.tx:a,t.matrix?h.b*a+h.d*l+h.ty:l),r++,n.push(i[0],i[1]);for(let t=2;t<i.length;t+=2)n.push(i[t],i[t+1]),s.push(r++,o,r);s.push(o+1,o,r)}};function Fo(t,e=!1){const i=t.length;if(i<6)return;let n=0;for(let e=0,s=t[i-2],r=t[i-1];e<i;e+=2){const i=t[e],o=t[e+1];n+=(i-s)*(o+r),s=i,r=o}if(!e&&n>0||e&&n<=0){const e=i/2;for(let n=e+e%2;n<i;n+=2){const e=i-n-2,s=i-n-1,r=n,o=n+1;[t[e],t[r]]=[t[r],t[e]],[t[s],t[o]]=[t[o],t[s]]}}}const No={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points;const n=t.holes,s=e.points,r=e.indices;if(i.length>=6){Fo(i,!1);const t=[];for(let e=0;e<n.length;e++){const s=n[e];Fo(s.points,!0),t.push(i.length/2),i=i.concat(s.points)}const e=lt()(i,t,2);if(!e)return;const o=s.length/2;for(let t=0;t<e.length;t+=3)r.push(e[t]+o),r.push(e[t+1]+o),r.push(e[t+2]+o);for(let t=0;t<i.length;t++)s.push(i[t])}}},Go={build(t){const e=t.shape,i=e.x,n=e.y,s=e.width,r=e.height,o=t.points;o.length=0,s>=0&&r>=0&&o.push(i,n,i+s,n,i+s,n+r,i,n+r)},triangulate(t,e){const i=t.points,n=e.points;if(0===i.length)return;const s=n.length/2;n.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Uo={build(t){Bo.build(t)},triangulate(t,e){Bo.triangulate(t,e)}};var Ho=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Ho||{}),Vo=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Vo||{});const zo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class jo{static curveTo(t,e,i,n,s,r){const o=r[r.length-2],a=r[r.length-1]-e,l=o-t,h=n-e,d=i-t,c=Math.abs(a*d-l*h);if(c<1e-8||0===s)return(r[r.length-2]!==t||r[r.length-1]!==e)&&r.push(t,e),null;const u=a*a+l*l,p=h*h+d*d,f=a*h+l*d,g=s*Math.sqrt(u)/c,m=s*Math.sqrt(p)/c,v=g*f/u,_=m*f/p,y=g*d+m*l,E=g*h+m*a,b=l*(m+v),A=a*(m+v),T=d*(g+_),x=h*(g+_);return{cx:y+t,cy:E+e,radius:s,startAngle:Math.atan2(A-E,b-y),endAngle:Math.atan2(x-E,T-y),anticlockwise:l*h>d*a}}static arc(t,e,i,n,s,r,o,a,l){const h=o-r,d=zo._segmentsCount(Math.abs(h)*s,40*Math.ceil(Math.abs(h)/Ge)),c=h/(2*d),u=2*c,p=Math.cos(c),f=Math.sin(c),g=d-1,m=g%1/g;for(let t=0;t<=g;++t){const e=c+r+u*(t+m*t),o=Math.cos(e),a=-Math.sin(e);l.push((p*o+f*a)*s+i,(p*-a+f*o)*s+n)}}}class Wo{static curveLength(t,e,i,n,s,r,o,a){let l=0,h=0,d=0,c=0,u=0,p=0,f=0,g=0,m=0,v=0,_=0,y=t,E=e;for(let b=1;b<=10;++b)h=b/10,d=h*h,c=d*h,u=1-h,p=u*u,f=p*u,g=f*t+3*p*h*i+3*u*d*s+c*o,m=f*e+3*p*h*n+3*u*d*r+c*a,v=y-g,_=E-m,y=g,E=m,l+=Math.sqrt(v*v+_*_);return l}static curveTo(t,e,i,n,s,r,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const h=zo._segmentsCount(Wo.curveLength(a,l,t,e,i,n,s,r));let d=0,c=0,u=0,p=0,f=0;o.push(a,l);for(let g=1,m=0;g<=h;++g)m=g/h,d=1-m,c=d*d,u=c*d,p=m*m,f=p*m,o.push(u*a+3*c*m*t+3*d*p*i+f*s,u*l+3*c*m*e+3*d*p*n+f*r)}}function Xo(t,e,i,n,s,r,o,a){let l,h;o?(l=n,h=-i):(l=-n,h=i);const d=t-i*s+l,c=e-n*s+h,u=t+i*r+l,p=e+n*r+h;return a.push(d,c,u,p),2}function Ko(t,e,i,n,s,r,o,a){const l=i-t,h=n-e;let d=Math.atan2(l,h),c=Math.atan2(s-t,r-e);a&&d<c?d+=2*Math.PI:!a&&d>c&&(c+=2*Math.PI);let u=d;const p=c-d,f=Math.abs(p),g=Math.sqrt(l*l+h*h),m=1+(15*f*Math.sqrt(g)/Math.PI>>0),v=p/m;if(u+=v,a){o.push(t,e,i,n);for(let i=1,n=u;i<m;i++,n+=v)o.push(t,e,t+Math.sin(n)*g,e+Math.cos(n)*g);o.push(t,e,s,r)}else{o.push(i,n,t,e);for(let i=1,n=u;i<m;i++,n+=v)o.push(t+Math.sin(n)*g,e+Math.cos(n)*g,t,e);o.push(s,r,t,e)}return 2*m}function Yo(t,e){t.lineStyle.native?function(t,e){let i=0;const n=t.shape,s=t.points||n.points,r=n.type!==Ve.POLY||n.closeStroke;if(0===s.length)return;const o=e.points,a=e.indices,l=s.length/2,h=o.length/2;let d=h;for(o.push(s[0],s[1]),i=1;i<l;i++)o.push(s[2*i],s[2*i+1]),a.push(d,d+1),d++;r&&a.push(d,h)}(t,e):function(t,e){const i=t.shape;let n=t.points||i.points.slice();const s=e.closePointEps;if(0===n.length)return;const r=t.lineStyle,o=new ze(n[0],n[1]),a=new ze(n[n.length-2],n[n.length-1]),l=i.type!==Ve.POLY||i.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){n=n.slice(),h&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);n.unshift(t,e),n.push(t,e)}const d=e.points,c=n.length/2;let u=n.length;const p=d.length/2,f=r.width/2,g=f*f,m=r.miterLimit*r.miterLimit;let v=n[0],_=n[1],y=n[2],E=n[3],b=0,A=0,T=-(_-E),x=v-y,S=0,w=0,C=Math.sqrt(T*T+x*x);T/=C,x/=C,T*=f,x*=f;const I=r.alignment,R=2*(1-I),P=2*I;l||(r.cap===Vo.ROUND?u+=Ko(v-T*(R-P)*.5,_-x*(R-P)*.5,v-T*R,_-x*R,v+T*P,_+x*P,d,!0)+2:r.cap===Vo.SQUARE&&(u+=Xo(v,_,T,x,R,P,!0,d))),d.push(v-T*R,_-x*R,v+T*P,_+x*P);for(let t=1;t<c-1;++t){v=n[2*(t-1)],_=n[2*(t-1)+1],y=n[2*t],E=n[2*t+1],b=n[2*(t+1)],A=n[2*(t+1)+1],T=-(_-E),x=v-y,C=Math.sqrt(T*T+x*x),T/=C,x/=C,T*=f,x*=f,S=-(E-A),w=y-b,C=Math.sqrt(S*S+w*w),S/=C,w/=C,S*=f,w*=f;const e=y-v,i=_-E,s=y-b,o=A-E,a=e*s+i*o,l=i*s-o*e,h=l<0;if(Math.abs(l)<.001*Math.abs(a)){d.push(y-T*R,E-x*R,y+T*P,E+x*P),a>=0&&(r.join===Ho.ROUND?u+=Ko(y,E,y-T*R,E-x*R,y-S*R,E-w*R,d,!1)+4:u+=2,d.push(y-S*P,E-w*P,y+S*R,E+w*R));continue}const c=(-T+v)*(-x+E)-(-T+y)*(-x+_),p=(-S+b)*(-w+E)-(-S+y)*(-w+A),I=(e*p-s*c)/l,L=(o*c-i*p)/l,M=(I-y)*(I-y)+(L-E)*(L-E),D=y+(I-y)*R,O=E+(L-E)*R,k=y-(I-y)*P,B=E-(L-E)*P,F=h?R:P,N=M<=Math.min(e*e+i*i,s*s+o*o)+F*F*g;let G=r.join;if(G===Ho.MITER&&M/g>m&&(G=Ho.BEVEL),N)switch(G){case Ho.MITER:d.push(D,O,k,B);break;case Ho.BEVEL:h?d.push(D,O,y+T*P,E+x*P,D,O,y+S*P,E+w*P):d.push(y-T*R,E-x*R,k,B,y-S*R,E-w*R,k,B),u+=2;break;case Ho.ROUND:h?(d.push(D,O,y+T*P,E+x*P),u+=Ko(y,E,y+T*P,E+x*P,y+S*P,E+w*P,d,!0)+4,d.push(D,O,y+S*P,E+w*P)):(d.push(y-T*R,E-x*R,k,B),u+=Ko(y,E,y-T*R,E-x*R,y-S*R,E-w*R,d,!1)+4,d.push(y-S*R,E-w*R,k,B))}else{switch(d.push(y-T*R,E-x*R,y+T*P,E+x*P),G){case Ho.MITER:h?d.push(k,B,k,B):d.push(D,O,D,O),u+=2;break;case Ho.ROUND:u+=h?Ko(y,E,y+T*P,E+x*P,y+S*P,E+w*P,d,!0)+2:Ko(y,E,y-T*R,E-x*R,y-S*R,E-w*R,d,!1)+2}d.push(y-S*R,E-w*R,y+S*P,E+w*P),u+=2}}v=n[2*(c-2)],_=n[2*(c-2)+1],y=n[2*(c-1)],E=n[2*(c-1)+1],T=-(_-E),x=v-y,C=Math.sqrt(T*T+x*x),T/=C,x/=C,T*=f,x*=f,d.push(y-T*R,E-x*R,y+T*P,E+x*P),l||(r.cap===Vo.ROUND?u+=Ko(y-T*(R-P)*.5,E-x*(R-P)*.5,y-T*R,E-x*R,y+T*P,E+x*P,d,!1)+2:r.cap===Vo.SQUARE&&(u+=Xo(y,E,T,x,R,P,!1,d)));const L=e.indices,M=zo.epsilon*zo.epsilon;for(let t=p;t<u+p-2;++t)v=d[2*t],_=d[2*t+1],y=d[2*(t+1)],E=d[2*(t+1)+1],b=d[2*(t+2)],A=d[2*(t+2)+1],!(Math.abs(v*(E-A)+y*(A-_)+b*(_-E))<M)&&L.push(t,t+1,t+2)}(t,e)}class $o{static curveLength(t,e,i,n,s,r){const o=t-2*i+s,a=e-2*n+r,l=2*i-2*t,h=2*n-2*e,d=4*(o*o+a*a),c=4*(o*l+a*h),u=l*l+h*h,p=2*Math.sqrt(d+c+u),f=Math.sqrt(d),g=2*d*f,m=2*Math.sqrt(u),v=c/f;return(g*p+f*c*(p-m)+(4*u*d-c*c)*Math.log((2*f+v+p)/(v+m)))/(4*g)}static curveTo(t,e,i,n,s){const r=s[s.length-2],o=s[s.length-1],a=zo._segmentsCount($o.curveLength(r,o,t,e,i,n));let l=0,h=0;for(let d=1;d<=a;++d){const c=d/a;l=r+(t-r)*c,h=o+(e-o)*c,s.push(l+(t+(i-t)*c-l)*c,h+(e+(n-e)*c-h)*c)}}}const qo={[Ve.POLY]:No,[Ve.CIRC]:Bo,[Ve.ELIP]:Bo,[Ve.RECT]:Go,[Ve.RREC]:Uo},Zo=[],Qo=[];class Jo{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Jo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class ta{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const ea=new ze,ia=class t extends Ne{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new vs,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Qo.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Zo.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const s=new Jo(t,e,i,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Jo(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,ea):ea.copyFrom(t),n.shape.contains(ea.x,ea.y))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++)if(n.holes[e].shape.contains(ea.x,ea.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let s=this.shapeIndex;s<e.length;s++){this.shapeIndex++;const r=e[s],o=r.fillStyle,a=r.lineStyle;qo[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix),(o.visible||a.visible)&&this.processHoles(r.holes);for(let e=0;e<2;e++){const s=0===e?o:a;if(!s.visible)continue;const l=s.texture.baseTexture,h=this.indices.length,d=this.points.length/2;l.wrapMode=K.REPEAT,0===e?this.processFill(r):this.processLine(r);const c=this.points.length/2-d;0!==c&&(i&&!this._compareStyles(n,s)&&(i.end(h,d),i=null),i||(i=Zo.pop()||new ta,i.begin(s,h,d),this.batches.push(i),n=s),this.addUvs(this.points,t,s.texture,d,c,s.matrix))}}const s=this.indices.length,r=this.points.length/2;if(i&&i.end(s,r),0===this.batches.length)return void(this.batchable=!0);const o=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,n=e.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE}buildDrawCalls(){let t=++Ie._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Qo.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let n=Qo.pop();n||(n=new Re,n.texArray=new Ri),n.texArray.count=0,n.start=0,n.size=0,n.type=H.TRIANGLES;let s=0,r=null,o=0,a=!1,l=H.TRIANGLES,h=0;this.drawCalls.push(n);for(let d=0;d<this.batches.length;d++){const c=this.batches[d],u=8,p=c.style,f=p.texture.baseTexture;a!==!!p.native&&(a=!!p.native,l=a?H.LINES:H.TRIANGLES,r=null,s=u,t++),r!==f&&(r=f,f._batchEnabled!==t&&(s===u&&(t++,s=0,n.size>0&&(n=Qo.pop(),n||(n=new Re,n.texArray=new Ri),this.drawCalls.push(n)),n.start=h,n.size=0,n.texArray.count=0,n.type=l),f.touched=1,f._batchEnabled=t,f._batchLocation=s,f.wrapMode=K.REPEAT,n.texArray.elements[n.texArray.count++]=f,s++)),n.size+=c.size,h+=c.size,o=f._batchLocation,this.addColors(e,p.color,p.alpha,c.attribSize,c.attribStart),this.addTextureIds(i,o,c.attribSize,c.attribStart)}Ie._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,s=new ArrayBuffer(3*t.length*4),r=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let s=0;s<t.length/2;s++)r[a++]=t[2*s],r[a++]=t[2*s+1],r[a++]=e[2*s],r[a++]=e[2*s+1],o[a++]=i[s],r[a++]=n[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?No.triangulate(t,this):qo[t.type].triangulate(t,this)}processLine(t){Yo(t,this);for(let e=0;e<t.holes.length;e++)Yo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];qo[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[2*i],s=t[2*i+1];t[2*i]=e.a*n+e.c*s+e.tx,t[2*i+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,i,n,s=0){const r=Xt.shared.setValue(e).toLittleEndianNumber(),o=Xt.shared.setValue(r).toPremultiplied(i);t.length=Math.max(t.length,s+n);for(let e=0;e<n;e++)t[s+e]=o}addTextureIds(t,e,i,n=0){t.length=Math.max(t.length,n+i);for(let s=0;s<i;s++)t[n+s]=e}addUvs(t,e,i,n,s,r=null){let o=0;const a=e.length,l=i.frame;for(;o<s;){let i=t[2*(n+o)],s=t[2*(n+o)+1];if(r){const t=r.a*i+r.c*s+r.tx;s=r.b*i+r.d*s+r.ty,i=t}o++,e.push(i/l.width,s/l.height)}const h=i.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(e,i,a,s)}adjustUvs(t,e,i,n){const s=e.baseTexture,r=1e-6,o=i+2*n,a=e.frame,l=a.width/s.width,h=a.height/s.height;let d=a.x/a.width,c=a.y/a.height,u=Math.floor(t[i]+r),p=Math.floor(t[i+1]+r);for(let e=i+2;e<o;e+=2)u=Math.min(u,Math.floor(t[e]+r)),p=Math.min(p,Math.floor(t[e+1]+r));d-=u,c-=p;for(let e=i;e<o;e+=2)t[e]=(t[e]+d)*l,t[e+1]=(t[e+1]+c)*h}};ia.BATCHABLE_SIZE=100;let na=ia;class sa{constructor(){this.color=16777215,this.alpha=1,this.texture=Xi.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new sa;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Xi.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class ra extends sa{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Vo.BUTT,this.join=Ho.MITER,this.miterLimit=10}clone(){const t=new ra;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Vo.BUTT,this.join=Ho.MITER,this.miterLimit=10}}const oa={},aa=class t extends Ts{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new sa,this._lineStyle=new ra,this._matrix=null,this._holeMode=!1,this.state=Ee.for2d(),this._geometry=t||new na,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Xt(16777215),this.blendMode=U.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new t(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,n=.5,s=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Xi.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Vo.BUTT,join:Ho.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ye,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ye,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],s=i[i.length-1];return(n!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),$o.curveTo(t,e,i,n,s),this}bezierCurveTo(t,e,i,n,s,r){return this._initCurve(),Wo.curveTo(t,e,i,n,s,r,this.currentPath.points),this}arcTo(t,e,i,n,s){this._initCurve(t,e);const r=this.currentPath.points,o=jo.curveTo(t,e,i,n,s,r);if(o){const{cx:t,cy:e,radius:i,startAngle:n,endAngle:s,anticlockwise:r}=o;this.arc(t,e,i,n,s,r)}return this}arc(t,e,i,n,s,r=!1){if(n===s)return this;if(!r&&s<=n?s+=Ge:r&&n<=s&&(n+=Ge),s-n==0)return this;const o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,l=this._geometry.closePointEps;let h=this.currentPath?this.currentPath.points:null;if(h){const t=Math.abs(h[h.length-2]-o),e=Math.abs(h[h.length-1]-a);t<l&&e<l||h.push(o,a)}else this.moveTo(o,a),h=this.currentPath.points;return jo.arc(o,a,t,e,i,n,s,r,h),this}beginFill(t=0,e){return this.beginTextureFill({texture:Xi.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Xt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Xi.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new We(t,e,i,n))}drawRoundedRect(t,e,i,n,s){return this.drawShape(new $e(t,e,i,n,s))}drawCircle(t,e,i){return this.drawShape(new Xe(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new Ke(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const s=new Ye(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Ve.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const i=t.batches[n],s=i.style.color,r=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),a={vertexData:r,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:Xt.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,n=this.worldAlpha,s=e.uniforms,r=i.drawCalls;s.translationMatrix=this.transform.worldTransform,Xt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let e=0,n=r.length;e<n;e++)this._renderDrawCallDirect(t,i.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:i,type:n,size:s,start:r}=e,o=i.count;for(let e=0;e<o;e++)t.texture.bind(i.elements[e],e);t.geometry.draw(n,s,r)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!oa[i]){const{maxTextures:e}=t.plugins[i],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new qe,default:wi.from({uSamplers:n},!0)},r=t.plugins[i]._shader.program;oa[i]=new Ci(r,s)}e=oa[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,s)}containsPoint(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Xt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,r=e.d,o=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData;let d=0;for(let t=0;t<l.length;t+=2){const e=l[t],c=l[t+1];h[d++]=i*e+s*c+o,h[d++]=r*c+n*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};aa.curves=zo,aa._TEMP_POINT=new ze;let la=aa;class ha{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const da=new ze,ca=new Ye,ua=class t extends Ts{constructor(t,e,i,n=H.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Ee.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=nt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(e){const i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===H.TRIANGLES&&i.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,r=n.b,o=n.c,a=n.d,l=n.tx,h=n.ty,d=this.vertexData;for(let t=0;t<d.length/2;t++){const i=e[2*t],n=e[2*t+1];d[2*t]=s*i+o*n+l,d[2*t+1]=r*i+a*n+h}if(this._roundPixels){const t=nt.RESOLUTION;for(let e=0;e<d.length;++e)d[e]=Math.round(d[e]*t)/t}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ha(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,da);const e=this.geometry.getBuffer("aVertexPosition").data,i=ca.points,n=this.geometry.getIndex().data,s=n.length,r=4===this.drawMode?3:1;for(let t=0;t+2<s;t+=r){const s=2*n[t],r=2*n[t+1],o=2*n[t+2];if(i[0]=e[s],i[1]=e[s+1],i[2]=e[r],i[3]=e[r+1],i[4]=e[o],i[5]=e[o+1],ca.contains(da.x,da.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};ua.BATCHABLE_SIZE=100;let pa=ua;class fa extends Fe{constructor(t,e,i){super();const n=new Le(t),s=new Le(e,!0),r=new Le(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,j.FLOAT).addAttribute("aTextureCoord",s,2,!1,j.FLOAT).addIndex(r),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class ga extends Ci{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:qe.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||xi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new ln(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Xt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Xt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ma{constructor(t,e,i){this.geometry=new Fe,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let n=t[i];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||j.FLOAT,offset:n.offset},e[i]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Le(function(t,e=null){const i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let t=0,n=0;t<i;t+=6,n+=4)e[t+0]=n+0,e[t+1]=n+1,e[t+2]=n+2,e[t+3]=n+0,e[t+4]=n+2,e[t+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];i.offset=e,e+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Le(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=n,n+=e.size,this.staticStride+=e.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Le(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];t.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===j.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let e=0;e<this.staticProperties.length;++e){const i=this.staticProperties[e];t.addAttribute(i.attributeName,this.staticBuffer,0,i.type===j.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,i,s.type===j.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,i,s.type===j.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class va extends Pi{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new qe,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:j.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ci.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Ee.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let r=e.length;if(0===r)return;r>i&&!t.autoResize&&(r=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,l=a.alphaMode>0;this.state.blendMode=Yt(t.blendMode,l),s.state.set(this.state);const h=s.gl,d=t.worldTransform.copyTo(this.tempMatrix);d.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=Xt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let i=0,a=0;i<r;i+=n,a+=1){let l=r-i;l>n&&(l=n),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const d=o[a];d.uploadDynamic(e,i,l);const u=t._bufferUpdateIDs[a]||0;c=c||d._updateID<u,c&&(d._updateID=t._updateID,d.uploadStatic(e,i,l)),s.geometry.bind(d.geometry),h.drawElements(h.TRIANGLES,6*l,h.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let t=0;t<i;t+=n)e.push(new ma(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new ma(this.properties,i,e)}uploadVertices(t,e,i,n,s,r){let o=0,a=0,l=0,h=0;for(let d=0;d<i;++d){const i=t[e+d],c=i._texture,u=i.scale.x,p=i.scale.y,f=c.trim,g=c.orig;f?(a=f.x-i.anchor.x*g.width,o=a+f.width,h=f.y-i.anchor.y*g.height,l=h+f.height):(o=g.width*(1-i.anchor.x),a=g.width*-i.anchor.x,l=g.height*(1-i.anchor.y),h=g.height*-i.anchor.y),n[r]=a*u,n[r+1]=h*p,n[r+s]=o*u,n[r+s+1]=h*p,n[r+2*s]=o*u,n[r+2*s+1]=l*p,n[r+3*s]=a*u,n[r+3*s+1]=l*p,r+=4*s}}uploadPosition(t,e,i,n,s,r){for(let o=0;o<i;o++){const i=t[e+o].position;n[r]=i.x,n[r+1]=i.y,n[r+s]=i.x,n[r+s+1]=i.y,n[r+2*s]=i.x,n[r+2*s+1]=i.y,n[r+3*s]=i.x,n[r+3*s+1]=i.y,r+=4*s}}uploadRotation(t,e,i,n,s,r){for(let o=0;o<i;o++){const i=t[e+o].rotation;n[r]=i,n[r+s]=i,n[r+2*s]=i,n[r+3*s]=i,r+=4*s}}uploadUvs(t,e,i,n,s,r){for(let o=0;o<i;++o){const i=t[e+o]._texture._uvs;i?(n[r]=i.x0,n[r+1]=i.y0,n[r+s]=i.x1,n[r+s+1]=i.y1,n[r+2*s]=i.x2,n[r+2*s+1]=i.y2,n[r+3*s]=i.x3,n[r+3*s+1]=i.y3,r+=4*s):(n[r]=0,n[r+1]=0,n[r+s]=0,n[r+s+1]=0,n[r+2*s]=0,n[r+2*s+1]=0,n[r+3*s]=0,n[r+3*s+1]=0,r+=4*s)}}uploadTint(t,e,i,n,s,r){for(let o=0;o<i;++o){const i=t[e+o],a=Xt.shared.setValue(i._tintRGB).toPremultiplied(i.alpha,i.texture.baseTexture.alphaMode>0);n[r]=a,n[r+s]=a,n[r+2*s]=a,n[r+3*s]=a,r+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}va.extension={name:"particle",type:pe.RendererPlugin},me.add(va);var _a=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(_a||{});const ya={willReadFrequently:!0},Ea=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const i=nt.ADAPTER.getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in i||"textLetterSpacing"in i}return e}constructor(t,e,i,n,s,r,o,a,l){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=s,this.lineWidths=r,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(e,i,n,s=t._canvas){n=n??i.wordWrap;const r=i.toFontString(),o=t.measureFont(r);0===o.fontSize&&(o.fontSize=i.fontSize,o.ascent=i.fontSize);const a=s.getContext("2d",ya);a.font=r;const l=(n?t.wordWrap(e,i,s):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let d=0;for(let e=0;e<l.length;e++){const n=t._measureText(l[e],i.letterSpacing,a);h[e]=n,d=Math.max(d,n)}let c=d+i.strokeThickness;i.dropShadow&&(c+=i.dropShadowDistance);const u=i.lineHeight||o.fontSize+i.strokeThickness;let p=Math.max(u,o.fontSize+2*i.strokeThickness)+i.leading+(l.length-1)*(u+i.leading);return i.dropShadow&&(p+=i.dropShadowDistance),new t(e,i,c,p,l,h,u+i.leading,d,o)}static _measureText(e,i,n){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(n.letterSpacing=`${i}px`,n.textLetterSpacing=`${i}px`,s=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let r=n.measureText(e).width;return r>0&&(s?r-=i:r+=(t.graphemeSegmenter(e).length-1)*i),r}static wordWrap(e,i,n=t._canvas){const s=n.getContext("2d",ya);let r=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:d}=i,c=t.collapseSpaces(d),u=t.collapseNewlines(d);let p=!c;const f=i.wordWrapWidth+h,g=t.tokenize(e);for(let e=0;e<g.length;e++){let n=g[e];if(t.isNewline(n)){if(!u){a+=t.addLine(o),p=!c,o="",r=0;continue}n=" "}if(c){const e=t.isBreakingSpace(n),i=t.isBreakingSpace(o[o.length-1]);if(e&&i)continue}const d=t.getFromCache(n,h,l,s);if(d>f)if(""!==o&&(a+=t.addLine(o),o="",r=0),t.canBreakWords(n,i.breakWords)){const e=t.wordWrapSplit(n);for(let d=0;d<e.length;d++){let c=e[d],u=c,g=1;for(;e[d+g];){const s=e[d+g];if(t.canBreakChars(u,s,n,d,i.breakWords))break;c+=s,u=s,g++}d+=g-1;const m=t.getFromCache(c,h,l,s);m+r>f&&(a+=t.addLine(o),p=!1,o="",r=0),o+=c,r+=m}}else{o.length>0&&(a+=t.addLine(o),o="",r=0);const i=e===g.length-1;a+=t.addLine(n,!i),p=!1,o="",r=0}else d+r>f&&(p=!1,a+=t.addLine(o),o="",r=0),(o.length>0||!t.isBreakingSpace(n)||p)&&(o+=n,r+=d)}return a+=t.addLine(o,!1),a}static addLine(e,i=!0){return e=t.trimRight(e),e=i?`${e}\n`:e}static getFromCache(e,i,n,s){let r=n[e];return"number"!=typeof r&&(r=t._measureText(e,i,s)+i,n[e]=r),r}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(e){if("string"!=typeof e)return"";for(let i=e.length-1;i>=0;i--){const n=e[i];if(!t.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,i){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const i=[];let n="";if("string"!=typeof e)return i;for(let s=0;s<e.length;s++){const r=e[s],o=e[s+1];t.isBreakingSpace(r,o)||t.isNewline(r)?(""!==n&&(i.push(n),n=""),i.push(r)):n+=r}return""!==n&&i.push(n),i}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const i={ascent:0,descent:0,fontSize:0},n=t._canvas,s=t._context;s.font=e;const r=t.METRICS_STRING+t.BASELINE_SYMBOL,o=Math.ceil(s.measureText(r).width);let a=Math.ceil(s.measureText(t.BASELINE_SYMBOL).width);const l=Math.ceil(t.HEIGHT_MULTIPLIER*a);if(a=a*t.BASELINE_MULTIPLIER|0,0===o||0===l)return t._fonts[e]=i,i;n.width=o,n.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,a);const h=s.getImageData(0,0,o,l).data,d=h.length,c=4*o;let u=0,p=0,f=!1;for(u=0;u<a;++u){for(let t=0;t<c;t+=4)if(255!==h[p+t]){f=!0;break}if(f)break;p+=c}for(i.ascent=a-u,p=d-c,f=!1,u=l;u>a;--u){for(let t=0;t<c;t+=4)if(255!==h[p+t]){f=!0;break}if(f)break;p-=c}return i.descent=u-a,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const i=new OffscreenCanvas(0,0);if(i.getContext("2d",ya)?.measureText)return t.__canvas=i,i;e=nt.ADAPTER.createCanvas()}catch{e=nt.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",ya)),t.__context}};Ea.METRICS_STRING="|q",Ea.BASELINE_SYMBOL="M",Ea.BASELINE_MULTIPLIER=1.4,Ea.HEIGHT_MULTIPLIER=2,Ea.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),Ea.experimentalLetterSpacing=!1,Ea._fonts={},Ea._newlines=[10,13],Ea._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let ba=Ea;const Aa=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ta=class t{constructor(t){this.styleID=0,this.reset(),wa(this,t,t)}clone(){const e={};return wa(e,this,t.defaultStyle),new t(e)}reset(){wa(this,t.defaultStyle,t.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Sa(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Sa(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Sa(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Aa.includes(i)&&(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Ta.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:_a.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let xa=Ta;function Sa(t){const e=Xt.shared,i=t=>{const i=e.setValue(t);return 1===i.alpha?i.toHex():i.toRgbaString()};return Array.isArray(t)?t.map(i):i(t)}function wa(t,e,i){for(const n in i)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}const Ca={texture:!0,children:!1,baseTexture:!0},Ia=class t extends ws{constructor(e,i,n){let s=!1;n||(n=nt.ADAPTER.createCanvas(),s=!0),n.width=3,n.height=3;const r=Xi.from(n);r.orig=new We,r.trim=new We,super(r),this._ownCanvas=s,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=t.defaultResolution??nt.RESOLUTION,this._autoResolution=t.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=i,this.localStyleID=-1}static get experimentalLetterSpacing(){return ba.experimentalLetterSpacing}static set experimentalLetterSpacing(t){dt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ba.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,n=ba.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,r=n.height,o=n.lines,a=n.lineHeight,l=n.lineWidths,h=n.maxLineWidth,d=n.fontProperties;let c,u;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let t=0;t<p;++t){const s=e.dropShadow&&0===t,p=s?Math.ceil(Math.max(1,r)+2*e.padding):0,f=p*this._resolution;if(s){i.fillStyle="black",i.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,s=e.dropShadowDistance*this._resolution;i.shadowColor=Xt.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=n,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*s,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*s+f}else i.fillStyle=this._generateFillStyle(e,o,n),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let g=(a-d.fontSize)/2;a-d.fontSize<0&&(g=0);for(let t=0;t<o.length;t++)c=e.strokeThickness/2,u=e.strokeThickness/2+t*a+d.ascent+g,"right"===e.align?c+=h-l[t]:"center"===e.align&&(c+=(h-l[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],c+e.padding,u+e.padding-p,!0),e.fill&&this.drawLetterSpacing(o[t],c+e.padding,u+e.padding-p)}this.updateTexture()}drawLetterSpacing(t,e,i,n=!1){const s=this._style.letterSpacing;let r=!1;if(ba.experimentalLetterSpacingSupported&&(ba.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,r=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||r)return void(n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));let o=e;const a=ba.graphemeSegmenter(t);let l=this.context.measureText(t).width,h=0;for(let t=0;t<a.length;++t){const e=a[t];n?this.context.strokeText(e,o,i):this.context.fillText(e,o,i);let r="";for(let e=t+1;e<a.length;++e)r+=a[e];h=this.context.measureText(r).width,o+=l-h+s,l=h}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=ce(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,i=this._style,n=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let s;const r=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-r-2*o,l=this.canvas.height/this._resolution-r-2*o,h=n.slice(),d=t.fillGradientStops.slice();if(!d.length){const t=h.length+1;for(let e=1;e<t;++e)d.push(e/t)}if(h.unshift(n[0]),d.unshift(0),h.push(n[n.length-1]),d.push(1),t.fillGradientType===_a.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);const n=i.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const r=i.lineHeight*(t-1)+n,o=i.lineHeight*t;let a=o;t>0&&r>o&&(a=(o+r)/2);const c=o+n,u=i.lineHeight*(t+1);let p=c;t+1<e.length&&u<c&&(p=(c+u)/2);const f=(p-a)/l;for(let t=0;t<h.length;t++){let e=0;e="number"==typeof d[t]?d[t]:t/h.length;let i=Math.min(1,Math.max(0,a/l+e*f));i=Number(i.toFixed(5)),s.addColorStop(i,h[t])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);const t=h.length+1;let e=1;for(let i=0;i<h.length;i++){let n;n="number"==typeof d[i]?d[i]:e/t,s.addColorStop(n,h[i]),e++}}return s}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ca,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=te(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=te(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof xa?t:new xa(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Ia.defaultAutoResolution=!0;let Ra=Ia;class Pa{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function La(t,e){let i=!1;if(t?._textures?.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Xi){const s=t._textures[n].baseTexture;e.includes(s)||(e.push(s),i=!0)}return i}function Ma(t,e){if(t.baseTexture instanceof Ie){const i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Da(t,e){if(t._texture&&t._texture instanceof Xi){const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Oa(t,e){return e instanceof Ra&&(e.updateText(!0),!0)}function ka(t,e){if(e instanceof xa){const t=e.toFontString();return ba.measureFont(t),!0}return!1}function Ba(t,e){if(t instanceof Ra){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Fa(t,e){return t instanceof xa&&(e.includes(t)||e.push(t),!0)}const Na=class t{constructor(e){this.limiter=new Pa(t.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Ba),this.registerFindHook(Fa),this.registerFindHook(La),this.registerFindHook(Ma),this.registerFindHook(Da),this.registerUploadHook(Oa),this.registerUploadHook(ka)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Jn.system.addOnce(this.tick,this,qn.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Jn.system.addOnce(this.tick,this,qn.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ts)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Jn.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Na.uploadsPerFrame=4;let Ga=Na;function Ua(t,e){return e instanceof Ie&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Ha(t,e){if(!(e instanceof la))return!1;const{geometry:i}=e;e.finishPoly(),i.updateBatches();const{batches:n}=i;for(let e=0;e<n.length;e++){const{texture:i}=n[e].style;i&&Ua(t,i.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function Va(t,e){return t instanceof la&&(e.push(t),!0)}Object.defineProperties(nt,{UPLOADS_PER_FRAME:{get:()=>Ga.uploadsPerFrame,set(t){dt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ga.uploadsPerFrame=t}}});class za extends Ga{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Va),this.registerUploadHook(Ua),this.registerUploadHook(Ha)}}za.extension={name:"prepare",type:pe.RendererSystem},me.add(za);new ze;var ja="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Wa=new qe;class Xa extends Pi{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new qi,this.state=Ee.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Ci.from(ja,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Ci.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Ci.from(ja,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,r=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-r,n[2]=n[4]=1-s,n[5]=n[7]=1-r,i.invalidate();const o=t._texture,a=o.baseTexture,l=a.alphaMode>0,h=t.tileTransform.localTransform,d=t.uvMatrix;let c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==K.CLAMP:a.wrapMode===K.CLAMP&&(a.wrapMode=K.REPEAT));const u=c?this.simpleShader:this.shader,p=o.width,f=o.height,g=t._width,m=t._height;Wa.set(h.a*p/g,h.b*p/m,h.c*f/g,h.d*f/m,h.tx/g,h.ty/m),Wa.invert(),c?Wa.prepend(d.mapCoord):(u.uniforms.uMapCoord=d.mapCoord.toArray(!0),u.uniforms.uClampFrame=d.uClampFrame,u.uniforms.uClampOffset=d.uClampOffset),u.uniforms.uTransform=Wa.toArray(!0),u.uniforms.uColor=Xt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(u.uniforms.uColor),u.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),u.uniforms.uSampler=o,e.shader.bind(u),e.geometry.bind(i),this.state.blendMode=Yt(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Xa.extension={name:"tilingSprite",type:pe.RendererPlugin},me.add(Xa);const Ka=class t{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof Xi?t:null,this.baseTexture=t instanceof Ie?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(i||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=ue(t,null);return null===i&&(i=parseFloat(e??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let i=e;const n=t.BATCH_SIZE;for(;i-e<n&&i<this._frameKeys.length;){const t=this._frameKeys[i],e=this._frames[t],n=e.frame;if(n){let i=null,s=null;const r=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,o=new We(0,0,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution);i=e.rotated?new We(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new We(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(s=new We(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new Xi(this.baseTexture,i,o,s,e.rotated?2:0,e.anchor,e.borders),Xi.addToCache(this.textures[t],t.toString())}i++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Ka.BATCH_SIZE=1e3;let Ya=Ka;const $a=["jpg","png","jpeg","avif","webp"];function qa(t,e,i){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[t]=e.textures[t]})),!i){const i=pt.dirname(t[0]);e.linkedSheets.forEach(((t,s)=>{const r=qa([`${i}/${e.data.meta.related_multi_packs[s]}`],t,!0);Object.assign(n,r)}))}return n}const Za={extension:pe.Asset,cache:{test:t=>t instanceof Ya,getCacheableAssets:(t,e)=>qa(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),i=e.pop(),n=e.pop();return"json"===i&&$a.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(nt.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:pe.LoadParser,priority:sr.Normal},testParse:async(t,e)=>".json"===pt.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,i){let n=pt.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let s=n+t.meta.image;s=jr(s,e.src);const r=(await i.load([s]))[s],o=new Ya(r.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const s of a){if("string"!=typeof s)continue;let r=n+s;e.data?.ignoreMultiPack||(r=jr(r,e.src),t.push(i.load({src:r,data:{ignoreMultiPack:!0}})))}const s=await Promise.all(t);o.linkedSheets=s,s.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};me.add(Za);class Qa{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Ja{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const n=e[t].match(/^[a-z]+/gm)[0],s=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),r={};for(const t in s){const e=s[t].split("="),i=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;r[i]=a}i[n].push(r)}const n=new Qa;return i.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),i.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),i.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),i.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),i.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),i.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class tl{static test(t){const e=t;return"string"!=typeof t&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Qa,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),r=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<i.length;t++)e.info.push({face:i[t].getAttribute("face"),size:parseInt(i[t].getAttribute("size"),10)});for(let t=0;t<n.length;t++)e.common.push({lineHeight:parseInt(n[t].getAttribute("lineHeight"),10)});for(let t=0;t<s.length;t++)e.page.push({id:parseInt(s[t].getAttribute("id"),10)||0,file:s[t].getAttribute("file")});for(let t=0;t<r.length;t++){const i=r[t];e.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class el{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&tl.test(nt.ADAPTER.parseXML(t))}static parse(t){return tl.parse(nt.ADAPTER.parseXML(t))}}const il=[Ja,tl,el];function nl(t,e,i,n,s,r,o){const a=i.text,l=i.fontProperties;e.translate(n,s),e.scale(r,r);const h=o.strokeThickness/2,d=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,i,n,s,r){const o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,d=t.width/n-l-2*h,c=t.height/n-l-2*h,u=o.slice(),p=i.fillGradientStops.slice();if(!p.length){const t=u.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(u.unshift(o[0]),p.unshift(0),u.push(o[o.length-1]),p.push(1),i.fillGradientType===_a.LINEAR_VERTICAL){a=e.createLinearGradient(d/2,h,d/2,c+h);let t=0;const n=(r.fontProperties.fontSize+i.strokeThickness)/c;for(let e=0;e<s.length;e++){const i=r.lineHeight*e;for(let e=0;e<u.length;e++){let s=0;s="number"==typeof p[e]?p[e]:e/u.length;const r=i/c+s*n;let o=Math.max(t,r);o=Math.min(o,1),a.addColorStop(o,u[e]),t=o}}}else{a=e.createLinearGradient(h,c/2,d+h,c/2);const t=u.length+1;let i=1;for(let e=0;e<u.length;e++){let n;n="number"==typeof p[e]?p[e]:i/t,a.addColorStop(n,u[e]),i++}}return a}(t,e,o,r,[a],i),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,i=o.dropShadowBlur*r,n=o.dropShadowDistance*r;e.shadowColor=Xt.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=i,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,h,d+i.lineHeight-l.descent),o.fill&&e.fillText(a,h,d+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function sl(t){return Array.from?Array.from(t):t.split("")}function rl(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const ol=class t{constructor(t,e,i){const[n]=t.info,[s]=t.common,[r]=t.page,[o]=t.distanceField,a=ue(r.file),l={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let i=0;i<t.page.length;i++){const{id:n,file:s}=t.page[i];l[n]=e instanceof Array?e[i]:e[s],o?.fieldType&&"none"!==o.fieldType&&(l[n].baseTexture.alphaMode=$.NO_PREMULTIPLIED_ALPHA,l[n].baseTexture.mipmap=Y.OFF)}for(let e=0;e<t.char.length;e++){const{id:i,page:n}=t.char[e];let{x:s,y:r,width:o,height:h,xoffset:d,yoffset:c,xadvance:u}=t.char[e];s/=a,r/=a,o/=a,h/=a,d/=a,c/=a,u/=a;const p=new We(s+l[n].frame.x/a,r+l[n].frame.y/a,o,h);this.chars[i]={xOffset:d,yOffset:c,xAdvance:u,kerning:{},texture:new Xi(l[n].baseTexture,p),page:n}}for(let e=0;e<t.kerning.length;e++){let{first:i,second:n,amount:s}=t.kerning[e];i/=a,n/=a,s/=a,this.chars[n]&&(this.chars[n].kerning[i]=s)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(e,i,n){let s;if(e instanceof Qa)s=e;else{const t=function(t){for(let e=0;e<il.length;e++)if(il[e].test(t))return il[e];return null}(e);if(!t)throw new Error("Unrecognized data format for font.");s=t.parse(e)}i instanceof Xi&&(i=[i]);const r=new t(s,i,n);return t.available[r.font]=r,r}static uninstall(e){const i=t.available[e];if(!i)throw new Error(`No font found named '${e}'`);i.destroy(),delete t.available[e]}static from(e,i,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:r,resolution:o,textureWidth:a,textureHeight:l,...h}=Object.assign({},t.defaultOptions,n),d=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),i=n[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,s=i;n<=s;n++)e.push(String.fromCharCode(n))}else e.push(...sl(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),c=i instanceof xa?i:new xa(i),u=a,p=new Qa;p.info[0]={face:c.fontFamily,size:c.fontSize},p.common[0]={lineHeight:c.fontSize};let f,g,m,v=0,_=0,y=0;const E=[],b=[];for(let t=0;t<d.length;t++){f||(f=nt.ADAPTER.createCanvas(),f.width=a,f.height=l,g=f.getContext("2d"),m=new Ie(f,{resolution:o,...h}),E.push(m),b.push(new Xi(m)),p.page.push({id:b.length-1,file:""}));const e=d[t],i=ba.measureText(e,c,!1,f),n=i.width,s=Math.ceil(i.height),A=Math.ceil(("italic"===c.fontStyle?2:1)*n);if(_>=l-s*o){if(0===_)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,f=null,g=null,m=null,_=0,v=0,y=0;continue}if(y=Math.max(s+i.fontProperties.descent,y),A*o+v>=u){if(0===v)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,_+=y*o,_=Math.ceil(_),v=0,y=0;continue}nl(f,g,i,v,_,o,c);const T=rl(i.text);p.char.push({id:T,page:b.length-1,x:v/o,y:_/o,width:A,height:s,xoffset:0,yoffset:0,xadvance:n-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),v+=(A+2*r)*o,v=Math.ceil(v)}if(!n?.skipKerning)for(let t=0,e=d.length;t<e;t++){const i=d[t];for(let t=0;t<e;t++){const e=d[t],n=g.measureText(i).width,s=g.measureText(e).width,r=g.measureText(i+e).width-(n+s);r&&p.kerning.push({first:rl(i),second:rl(e),amount:r})}}const A=new t(p,b,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=A,A}};ol.ALPHA=[["a","z"],["A","Z"]," "],ol.NUMERIC=[["0","9"]],ol.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ol.ASCII=[[" ","~"]],ol.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ol.ALPHANUMERIC},ol.available={};let al=ol;const ll=[],hl=[],dl=[],cl=class t extends Ts{constructor(e,i={}){super();const{align:n,tint:s,maxWidth:r,letterSpacing:o,fontName:a,fontSize:l}=Object.assign({},t.styleDefaults,i);if(!al.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new Xt(s),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=e,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new ri((()=>{this.dirty=!0}),this,0,0),this._roundPixels=nt.ROUND_PIXELS,this.dirty=!0,this._resolution=nt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=al.available[this._fontName],e=this.fontSize,i=e/t.size,n=new ze,s=[],r=[],o=[],a=sl(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*t.size/e,h="none"===t.distanceFieldType?ll:hl;let d=null,c=0,u=0,p=0,f=-1,g=0,m=0,v=0,_=0;for(let e=0;e<a.length;e++){const i=a[e],h=rl(i);if(/(?:\s)/.test(i)&&(f=e,g=c,_++),"\r"===i||"\n"===i){r.push(c),o.push(-1),u=Math.max(u,c),++p,++m,n.x=0,n.y+=t.lineHeight,d=null,_=0;continue}const y=t.chars[h];if(!y)continue;d&&y.kerning[d]&&(n.x+=y.kerning[d]);const E=dl.pop()||{texture:Xi.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ze};E.texture=y.texture,E.line=p,E.charCode=h,E.position.x=Math.round(n.x+y.xOffset+this._letterSpacing/2),E.position.y=Math.round(n.y+y.yOffset),E.prevSpaces=_,s.push(E),c=E.position.x+Math.max(y.xAdvance-y.xOffset,y.texture.orig.width),n.x+=y.xAdvance+this._letterSpacing,v=Math.max(v,y.yOffset+y.texture.height),d=h,-1!==f&&l>0&&n.x>l&&(++m,Jt(s,1+f-m,1+e-f),e=f,f=-1,r.push(g),o.push(s.length>0?s[s.length-1].prevSpaces:0),u=Math.max(u,g),p++,n.x=0,n.y+=t.lineHeight,d=null,_=0)}const y=a[a.length-1];"\r"!==y&&"\n"!==y&&(/(?:\s)/.test(y)&&(c=g),r.push(c),u=Math.max(u,c),o.push(-1));const E=[];for(let t=0;t<=p;t++){let e=0;"right"===this._align?e=u-r[t]:"center"===this._align?e=(u-r[t])/2:"justify"===this._align&&(e=o[t]<0?0:(u-r[t])/o[t]),E.push(e)}const b=s.length,A={},T=[],x=this._activePagesMeshData;h.push(...x);for(let e=0;e<b;e++){const i=s[e].texture,n=i.baseTexture.uid;if(!A[n]){let e=h.pop();if(!e){const i=new fa;let n,s;"none"===t.distanceFieldType?(n=new ga(Xi.EMPTY),s=U.NORMAL):(n=new ga(Xi.EMPTY,{program:xi.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),s=U.NORMAL_NPM);const r=new pa(i,n);r.blendMode=s,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:r,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:s}=this;s[n]=s[n]||new Xi(i.baseTexture),e.mesh.texture=s[n],e.mesh.tint=this._tintColor.value,T.push(e),A[n]=e}A[n].total++}for(let t=0;t<x.length;t++)T.includes(x[t])||this.removeChild(x[t].mesh);for(let t=0;t<T.length;t++)T[t].mesh.parent!==this&&this.addChild(T[t].mesh);this._activePagesMeshData=T;for(const t in A){const e=A[t],i=e.total;if(!(e.indices?.length>6*i)||e.vertices.length<2*pa.BATCHABLE_SIZE)e.vertices=new Float32Array(8*i),e.uvs=new Float32Array(8*i),e.indices=new Uint16Array(6*i);else{const t=e.total,i=e.vertices;for(let e=4*t*2;e<i.length;e++)i[e]=0}e.mesh.size=6*i}for(let t=0;t<b;t++){const e=s[t];let n=e.position.x+E[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(n=Math.round(n));const r=n*i,o=e.position.y*i,a=e.texture,l=A[a.baseTexture.uid],h=a.frame,d=a._uvs,c=l.index++;l.indices[6*c+0]=0+4*c,l.indices[6*c+1]=1+4*c,l.indices[6*c+2]=2+4*c,l.indices[6*c+3]=0+4*c,l.indices[6*c+4]=2+4*c,l.indices[6*c+5]=3+4*c,l.vertices[8*c+0]=r,l.vertices[8*c+1]=o,l.vertices[8*c+2]=r+h.width*i,l.vertices[8*c+3]=o,l.vertices[8*c+4]=r+h.width*i,l.vertices[8*c+5]=o+h.height*i,l.vertices[8*c+6]=r,l.vertices[8*c+7]=o+h.height*i,l.uvs[8*c+0]=d.x0,l.uvs[8*c+1]=d.y0,l.uvs[8*c+2]=d.x1,l.uvs[8*c+3]=d.y1,l.uvs[8*c+4]=d.x2,l.uvs[8*c+5]=d.y2,l.uvs[8*c+6]=d.x3,l.uvs[8*c+7]=d.y3}this._textWidth=u*i,this._textHeight=(n.y+t.lineHeight)*i;for(const t in A){const e=A[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const i=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let s=0;s<e.total;s++)e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n}this._maxLineHeight=v*i;const n=e.mesh.geometry.getBuffer("aVertexPosition"),s=e.mesh.geometry.getBuffer("aTextureCoord"),r=e.mesh.geometry.getIndex();n.data=e.vertices,s.data=e.uvs,r.data=e.indices,n.update(),s.update(),r.update()}for(let t=0;t<s.length;t++)dl.push(s[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:n}=al.available[this._fontName];if("none"!==i){const{a:i,b:s,c:r,d:o}=this.worldTransform,a=Math.sqrt(i*i+s*s),l=Math.sqrt(r*r+o*o),h=(Math.abs(a)+Math.abs(l))/2,d=this.fontSize/n,c=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=h*e*d*c}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=al.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!al.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??al.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i="none"===al.available[this._fontName].distanceFieldType?ll:hl;i.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],i.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Xi.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};cl.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let ul=cl;const pl=[".xml",".fnt"],fl={extension:{type:pe.LoadParser,priority:sr.Normal},name:"loadBitmapFont",test:t=>pl.includes(pt.extname(t).toLowerCase()),testParse:async t=>Ja.test(t)||el.test(t),async parse(t,e,i){const n=Ja.test(t)?Ja.parse(t):el.parse(t),{src:s}=e,{page:r}=n,o=[];for(let t=0;t<r.length;++t){const e=r[t].file;let i=pt.join(pt.dirname(s),e);i=jr(i,s),o.push(i)}const a=await i.load(o),l=o.map((t=>a[t]));return al.install(n,l,!0)},load:async(t,e)=>(await nt.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};me.add(fl);const gl=class t extends xa{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new t(Object.keys(t.defaultOptions).reduce(((t,i)=>({...t,[i]:e[i]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete t.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,i={}){const{availableFonts:n}=t;if(n[e]){const t=n[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return nt.ADAPTER.fetch(e).then((t=>t.blob())).then((async t=>new Promise(((e,i)=>{const n=URL.createObjectURL(t),s=new FileReader;s.onload=()=>e([n,s.result]),s.onerror=i,s.readAsDataURL(t)})))).then((async([t,s])=>{const r=Object.assign({family:pt.basename(e,pt.extname(e)),weight:"normal",style:"normal",display:"auto",src:t,dataSrc:s,refs:1,originalUrl:e,fontFace:null},i);n[e]=r,this._fonts.push(r),this.styleID++;const o=new FontFace(r.family,`url(${r.src})`,{weight:r.weight,style:r.style,display:r.display});r.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(i=t,dt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),t=Xt.shared.setValue(i).toNumber()),"number"==typeof t?(e=t,dt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Xt.shared.setValue(e).toHex()):t;var e,i}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const s=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,t.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=nt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};gl.availableFonts={},gl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let ml=gl;const vl=class t extends ws{constructor(e="",i={}){super(Xi.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,s=Xi.from(n,{scaleMode:nt.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new We,s.trim=new We,this.texture=s;const r="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(r,"svg"),l=document.createElementNS(r,"foreignObject"),h=document.createElementNS(o,"div"),d=document.createElementNS(o,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=t.defaultMaxWidth,this.maxHeight=t.defaultMaxHeight,this._domElement=h,this._styleElement=d,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(d),this._foreignObject.appendChild(h),this._image=n,this._loadImage=new Image,this._autoResolution=t.defaultAutoResolution,this._resolution=t.defaultResolution??nt.RESOLUTION,this.text=e,this.style=i}measureText(t){const{text:e,style:i,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(n)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:r,height:o}=s;(r>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const a=Math.min(this.maxWidth,Math.ceil(r)),l=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(n)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*i.padding,height:l+2*i.padding}}async updateText(t=!0){const{style:e,_image:i,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:r}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,s)),i.height=n.height=Math.ceil(Math.max(1,r)),this._updateID++;const o=this._updateID;await new Promise((t=>{n.onload=async()=>{o<this._updateID||(await e.onBeforeDraw(),i.src=n.src,n.onload=null,n.src="",this.updateTexture()),t()};const s=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:n}=this,{padding:s}=t,{baseTexture:r}=e;e.trim.width=e._frame.width=i.width/n,e.trim.height=e._frame.height=i.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),r.setRealSize(i.width,i.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},t.defaultDestroyOptions,e),super.destroy(e);const i=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=i,this._svgRoot?.remove(),this._svgRoot=i,this._domElement?.remove(),this._domElement=i,this._foreignObject?.remove(),this._foreignObject=i,this._styleElement?.remove(),this._styleElement=i,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=i,this._image.src="",this._image=i}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=te(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=te(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof ml?(this.ownsStyle=!1,this._style=t):t instanceof xa?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=ml.from(t)):(this.ownsStyle=!0,this._style=new ml(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};vl.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},vl.defaultMaxWidth=2024,vl.defaultMaxHeight=2024,vl.defaultAutoResolution=!0;let _l=vl;const yl="ADDED_TO_STAGE",El="REMOVED_FROM_STAGE";class bl extends Ts{constructor(...t){super(),this.isFContainer=!0,this.isNeedToDestructOnRemoveFromStage=!1,this.eventListenerHelper=new r(this),this.stageListenerHelper=new r(this),this.construction(...t),this.isConstructed=!0,this.onConstructedComplete(),this.stageListenerHelper.addEventListener(this,Ll.ADDED,(()=>{this.stage=Rl.findStageInDisplayList(this)})),this.stageListenerHelper.addEventListener(this,Ll.REMOVED,(t=>{this.stage=null})),this.stageListenerHelper.addEventListener(this,yl,this.onAddedToStage),this.stageListenerHelper.addEventListener(this,El,this.onRemovedFromStage)}construction(...t){}destruction(){this.destroy({children:!0}),this.eventListenerHelper&&(this.eventListenerHelper.destruction(),this.eventListenerHelper=null),this.stageListenerHelper&&(this.stageListenerHelper.destruction(),this.stageListenerHelper=null),this.removeListeners()}addListeners(){this.removeListeners()}removeListeners(){this.eventListenerHelper&&this.eventListenerHelper.removeAllListeners()}onConstructedComplete(){}onAddedToStage(){Xh(this),this.addListeners(),this.commitData(),this.processDataSet(this.data)}onRemovedFromStage(){Kh(this),this.removeListeners(),this.isNeedToDestructOnRemoveFromStage&&this.destruction()}forceCommitData(){this.commitData()}commitData(){this.arrange()}forceArrange(){this.arrange()}arrange(){}addChildBefore(t,e){const i=this.getChildIndex(e);if(-1===i)return;let n=i-1;n<0&&(n=0),this.addChildAt(t,n)}addChildAfter(t,e){const i=this.getChildIndex(e);if(-1===i)return;let n=i+1;n>this.children.length&&(n=this.children.length),this.addChildAt(t,n)}get data(){return this._data}set data(t){this.data!=t&&(this.processDataUnset(this._data),this._data=t,this.processDataSet(this._data),this.commitData())}processDataUnset(t){}processDataSet(t){}get stage(){return this._stage}set stage(t){t!==this._stage&&(this._stage&&t?I.error("FContainer | set stage __ The stage param can't be set to different value, before being empty!"):(this._stage=t,this.updateChildrenStage(),this.stage?this.emit(yl):this.emit(El)))}updateChildrenStage(){for(const t of this.children)bl.isFContainer(t)&&(t.stage=this.stage)}static isFContainer(t){return t.isFContainer}}class Al extends Ts{constructor(){super(...arguments),this.isFStage=!0}static isFStage(t){return t.isFStage}}var Tl,xl,Sl;!function(t){t.WIDTH="width",t.HEIGHT="height",t.BOTH="both"}(Tl||(Tl={}));!function(t){t.TEXT="text",t.HTML_TEXT="htmlText",t.BITMAP="bitmap"}(xl||(xl={})),function(t){t[t.THIN=100]="THIN",t[t.EXTRA_LIGHT=200]="EXTRA_LIGHT",t[t.LIGHT=300]="LIGHT",t[t.REGULAR=400]="REGULAR",t[t.MEDIUM=500]="MEDIUM",t[t.SEMIBOLD=600]="SEMIBOLD",t[t.BOLD=700]="BOLD",t[t.EXTRA_BOLD=800]="EXTRA_BOLD",t[t.BLACK=900]="BLACK"}(Sl||(Sl={}));class wl extends bl{constructor(t){super(t)}construction(t){super.construction(),this.fieldLocalBounds=new We,this._text="",Object.defineProperty(this,"width",{get(){return this._width},set(t){t!==this._width&&(this._width=t,this.applyStyle())}}),Object.defineProperty(this,"height",{get(){return this._height},set(t){t!==this._height&&(this._height=t,this.applyStyle())}}),t||(t={}),this.config=t,d.copyProps(this.config,wl.DEFAULT_CONFIG,{ignoreExistedProperties:!0}),this.bg=new la,this.addChild(this.bg),this.fieldMask=new la,this.addChild(this.fieldMask),this.fieldMask.beginFill(65280,1),this.fieldMask.drawRect(0,0,10,10),this.fieldMask.endFill(),this.createField(),this._width=this.field.width,this._height=this.field.height,this.updateBg()}destruction(){super.destruction(),this.field&&this.field.destroy()}onAddedToStage(){super.onAddedToStage(),this.applyText()}createField(){if(this.field&&(this.field.parent.removeChild(this.field),this.field=null),this.config.textType===xl.BITMAP){let t={fontName:this.config.fontFamily};this.config.size&&(t.fontSize=this.config.size),(this.config.color||0===this.config.color)&&(t.tint=this.config.color),this.field=new ul("",t)}else this.config.textType===xl.HTML_TEXT?this.field=new _l(""):this.field=new Ra("");this.applyStyle(),this.addChild(this.field),this.field.mask=this.fieldMask}applyStyle(){if(this.config.textType===xl.BITMAP){const t=this.field;this.config.fontFamily&&(t.fontName=this.config.fontFamily),this.config.size&&(t.fontSize=this.config.size),(this.config.color||0===this.config.color)&&(t.tint=this.config.color),this.config.wordWrapWidth&&(t.maxWidth=this.config.wordWrapWidth),this.config.align?t.align=this.config.align:t.align=nd.LEFT}else{const t=this.field;this.config.fontFamily&&(t.style.fontFamily=this.config.fontFamily),this.config.size&&(t.style.fontSize=this.config.size),this.config.lineHeight&&(t.style.lineHeight=this.config.lineHeight),this.config.lineJoin&&(t.style.lineJoin=this.config.lineJoin),(this.config.miterLimit||0===this.config.miterLimit)&&(t.style.miterLimit=this.config.miterLimit),(this.config.wordWrap||!1===this.wordWrap)&&(t.style.wordWrap=this.config.wordWrap),this.config.wordWrapWidth&&(t.style.wordWrapWidth=this.config.wordWrapWidth),(this.config.color||0===this.config.color)&&(t.style.fill=this.config.color),this.config.gradientColor&&(t.style.fill=this.config.gradientColor.colors,t.style.fillGradientStops=this.config.gradientColor.stops,t.style.fillGradientType=this.config.gradientColor.type),this.config.fontWeight?"string"==typeof this.config.fontWeight?t.style.fontWeight=this.config.fontWeight:t.style.fontWeight=this.config.fontWeight.toString():t.style.fontWeight=Sl.REGULAR.toString(),this.config.dropShadow?(t.style.dropShadow=!0,void 0!==this.config.dropShadowColor&&(t.style.dropShadowColor=this.config.dropShadowColor),void 0!==this.config.dropShadowAlpha&&(t.style.dropShadowAlpha=this.config.dropShadowAlpha),void 0!==this.config.dropShadowDistance&&(t.style.dropShadowDistance=this.config.dropShadowDistance),void 0!==this.config.dropShadowAngle&&(t.style.dropShadowAngle=this.config.dropShadowAngle),void 0!==this.config.dropShadowBlur&&(t.style.dropShadowBlur=this.config.dropShadowBlur)):t.style.dropShadow=!1,this.config.stroke||0===this.config.stroke?(t.style.stroke=this.config.stroke,this.config.strokeThickness?t.style.strokeThickness=this.config.strokeThickness:this.config.strokeThickness=0):t.style.stroke=0,this.config.align?t.style.align=this.config.align:t.style.align=nd.LEFT}this.arrange()}commitData(){super.commitData(),this.arrange()}arrange(){super.arrange(),this.field.scale.set(1),this.fieldLocalBounds=this.field.getLocalBounds(this.fieldLocalBounds),this.autosize&&(this.autosizeType&&this.autosizeType!==Tl.BOTH&&this.autosizeType!==Tl.WIDTH||(this._width=this.textWidth+2*this.fieldPaddingX,this.maxAutosizeWidth&&(this._width=Math.min(this._width,this.maxAutosizeWidth))),this.autosizeType&&this.autosizeType!==Tl.BOTH&&this.autosizeType!==Tl.HEIGHT||(this._height=this.textHeight+2*this.fieldPaddingY,this.maxAutosizeHeight&&(this._height=Math.min(this._height,this.maxAutosizeHeight))));let t=1;this.fitToSize&&(this.changeFontSizeToFit?(this.config.fitToSize=!1,this.config.size=this.config.changeFontSizeToFitStartSize,this.applyStyle(),Ul.changeFontSizeToFit(this,{stepChange:this.config.changeFontSizeStepChange}),this.config.fitToSize=!0):t=Nl.getScale(this.textWidth,this.textHeight,this.textAvailableWidth,this.textAvailableHeight)),this.field.scale.set(t),this.fieldLocalBounds=this.field.getLocalBounds(this.fieldLocalBounds),this.updateBg();let e=this.fieldPaddingX;switch(this.align){case nd.CENTER:e=Math.floor(.5*(this._width-this.textWidth*this.field.scale.x));break;case nd.RIGHT:e=Math.floor(this._width-this.textWidth*this.field.scale.x)-this.fieldPaddingX}this.field.x=e;let i=this.fieldPaddingY;switch(this.valign){case sd.MIDDLE:i=Math.floor(.5*(this._height-this.textHeight*this.field.scale.y));break;case sd.BOTTOM:i=Math.floor(this._height-this.textHeight*this.field.scale.y)-this.fieldPaddingY}this.field.y=i,this.fieldMask.x=this.fieldPaddingX,this.fieldMask.y=this.fieldPaddingY,this.fieldMask.width=this.fieldMaskWidth,this.fieldMask.height=this.fieldMaskHeight}get fieldMaskWidth(){return this._width-2*this.fieldPaddingX+this.maskToFieldShiftWidth}get fieldMaskHeight(){return this._height-2*this.fieldPaddingY+this.maskToFieldShiftHeight}get fontFamily(){return this.config.fontFamily}set fontFamily(t){t!==this.config.fontFamily&&(this.config.fontFamily=t,this.applyStyle())}get color(){return this.config.color}set color(t){t!==this.config.color&&(this.config.color=t,this.applyStyle())}get gradientColor(){return this.config.gradientColor}set gradientColor(t){this.config.gradientColor=t,this.applyStyle()}get size(){return this.config.size}set size(t){t!==this.config.size&&(this.config.size=t,this.applyStyle())}get align(){return this.config.align}set align(t){t!==this.config.align&&(this.config.align=t,this.applyStyle())}get valign(){return this.config.valign}set valign(t){t!==this.config.valign&&(this.config.valign=t,this.arrange())}get bgAlpha(){return this.config.bgAlpha}set bgAlpha(t){t!==this.config.bgAlpha&&(this.config.bgAlpha=t,this.arrange())}get bgColor(){return this.config.bgColor}set bgColor(t){t!==this.config.bgColor&&(this.config.bgColor=t,this.arrange())}get bgLineStyle(){return this.config.bgLineStyle}set bgLineStyle(t){d.checkIfEqual(t,this.config.bgLineStyle)||(this.config.bgLineStyle=t,this.arrange())}updateBg(){const t=this.config.bgColor?this.config.bgColor:0,e=this.config.bgAlpha?this.config.bgAlpha:0;this.bg.clear(),this.bgLineStyle&&this.bg.lineStyle(this.bgLineStyle),this.bg.beginFill(t,1),this.bg.drawRect(0,0,this._width,this._height),this.bg.endFill(),this.bg.alpha=e}get text(){return this._text}set text(t){t!==this.field.text&&(this._text=t,this.emit(Cl.TEXT_CHANGE),this.applyText())}applyText(){this.field.text=this._text,this.commitData()}get autosize(){return this.config.autosize}set autosize(t){t!==this.config.autosize&&(this.config.autosize=t,this.arrange())}get autosizeType(){return this.config.autosizeType}set autosizeType(t){t!==this.config.autosizeType&&(this.config.autosizeType=t,this.arrange())}get maxAutosizeWidth(){return this.config.maxAutosizeWidth||0}set maxAutosizeWidth(t){t!==this.config.maxAutosizeWidth&&(this.config.maxAutosizeWidth=t,this.arrange())}get maxAutosizeHeight(){return this.config.maxAutosizeHeight||0}set maxAutosizeHeight(t){t!==this.config.maxAutosizeHeight&&(this.config.maxAutosizeHeight=t,this.arrange())}get fitToSize(){return this.config.fitToSize}set fitToSize(t){t!==this.config.fitToSize&&(this.config.fitToSize=t,this.arrange())}get changeFontSizeToFit(){return this.config.changeFontSizeToFit}set changeFontSizeToFit(t){t!==this.config.changeFontSizeToFit&&(this.config.changeFontSizeToFit=t,this.arrange())}get textWidth(){return this.config.textType===xl.BITMAP?this.fieldLocalBounds.x+this.fieldLocalBounds.width:this.field.width/this.field.scale.x}get textHeight(){return this.config.textType===xl.BITMAP?this.fieldLocalBounds.y+this.fieldLocalBounds.height:this.field.height/this.field.scale.y}get textAvailableWidth(){return this.width-2*this.fieldPaddingX}get textAvailableHeight(){return this.height-2*this.fieldPaddingY}get fontWeight(){return this.config.fontWeight}set fontWeight(t){this.config.fontWeight!==t&&(this.config.fontWeight=t,this.applyStyle())}get dropShadow(){return this.config.dropShadow}set dropShadow(t){this.config.dropShadow!==t&&(this.config.dropShadow=t,this.applyStyle())}get stroke(){return this.config.stroke}set stroke(t){this.config.stroke!==t&&(this.config.stroke=t,this.applyStyle())}get strokeThickness(){return this.config.strokeThickness}set strokeThickness(t){this.config.strokeThickness!==t&&(this.config.strokeThickness=t,this.applyStyle())}get fieldPaddingX(){return this.config.fieldPaddingX||0}set fieldPaddingX(t){this.config.fieldPaddingX!==t&&(this.config.fieldPaddingX=t,this.arrange())}get fieldPaddingY(){return this.config.fieldPaddingY||0}set fieldPaddingY(t){this.config.fieldPaddingY!==t&&(this.config.fieldPaddingY=t,this.arrange())}get maskToFieldShiftWidth(){return this.config.maskToFieldShiftWidth||0}set maskToFieldShiftWidth(t){this.config.maskToFieldShiftWidth!==t&&(this.config.maskToFieldShiftWidth=t,this.arrange())}get maskToFieldShiftHeight(){return this.config.maskToFieldShiftHeight||0}set maskToFieldShiftHeight(t){this.config.maskToFieldShiftHeight!==t&&(this.config.maskToFieldShiftHeight=t,this.arrange())}get wordWrap(){return this.config.wordWrap}set wordWrap(t){this.config.wordWrap!==t&&(this.config.wordWrap=t,this.applyStyle())}get wordWrapWidth(){return this.config.wordWrapWidth}set wordWrapWidth(t){this.config.wordWrapWidth!==t&&(this.config.wordWrapWidth=t,this.applyStyle())}get engineField(){return this.field}changeConfig(t){d.copyProps(this.config,t),this.applyStyle()}}wl.DEFAULT_CONFIG=new class{constructor(){this.autosize=!0}};const Cl={TEXT_CHANGE:"FLabelEvent.TEXT_CHANGE"};var Il;!function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(Il||(Il={}));class Rl{static findStageInDisplayList(t){let e,i=t.parent;for(;i;){if(Al.isFStage(i)){e=i;break}i=i.parent}return e}static getObjectsUnderPoint(t,e,i,n=null){let s;if(t.visible&&t.renderable){let r=t;if(r.children&&r.children.length>0){let o,a,l=[],h=r.children.length;for(let t=0;t<h;t++)o=r.children[t],n&&!n(o)||(a=this.getObjectsUnderPoint(o,e,i,n),a&&l.push(a));l.length>0&&(s={object:t,children:l})}else{let n=!1;if(t.containsPoint)this.cachedPoint.x=e,this.cachedPoint.y=i,t.containsPoint(this.cachedPoint)&&(n=!0);else{t.getBounds().contains(e,i)&&(n=!0)}n&&(s={object:t})}}return s}static iterateThroughUnderPointData(t,e){if(t&&t.object&&t.children&&t.children.length>0){let i=t.children.length;for(let n=0;n<i;n++){const i=t.children[n];e(i),this.iterateThroughUnderPointData(i,e)}}}}Rl.cachedPoint=new ze;class Pl extends $s{constructor(t){super(t),this.options=t,this.lastTimeRendered=0,this.options=t,this.options||(this.options={}),this.options.targetFps&&(this.fpsLimitterEnabled=!0,this.targetRenderInterval=1e3/this.options.targetFps),Pl._instance=this,this.stage.isFStage=!0}render(t){if(!t&&this.fpsLimitterEnabled){Date.now()-this.lastTimeRendered>=this.targetRenderInterval&&(this.lastTimeRendered=Date.now(),super.render())}else super.render()}getGlobalInteractionPosition(){return this.renderer.plugins.interaction.pointer.global.clone()}static get instance(){return Pl._instance}}const Ll={ADDED:"added",REMOVED:"removed"},Ml="pointerdown",Dl="pointerup",Ol="pointertap",kl="pointerupoutside",Bl="pointerover",Fl="pointerout";class Nl{static scaleObject(t,e,i,n){let s=Nl.getScale(t.width,t.height,e,i,n);t.scale.set(s,s)}static getScale(t,e,i,n,s){let r=1;if(s||(s={}),i>0&&n>0&&(s.upscaleAllowed||t>i||e>n)){const o=i/n,a=t/e;r=a<=o&&s.scaleByMinSide||a>o&&!s.scaleByMinSide?i/t:n/e}return r}}class Gl{static removeAllChildren(t){for(;t.children.length>0;)t.removeChildAt(0)}static childRemoveItselfFromParent(t){t&&t.parent&&t.parent.removeChild(t)}static moveObjectToTopLayer(t){t&&t.parent&&t.parent.setChildIndex(t,t.parent.children.length-1)}static safeAddChildAt(t,e,i){i<0?i=0:i>t.children.length&&(i=t.children.length),t.addChildAt(e,i)}static addChildBefore(t,e,i){if(i.parent!==t)return void console.error("DisplayTools | addChildBefore __ ERROR! beforeTarget is not a child of the container!");const n=t.getChildIndex(i)-1;Gl.safeAddChildAt(t,e,n)}static findParentInDisplayList(t,e,i=null){let n,s=t.parent;for(;s&&(!i||i(s));){if(e(s)){n=s;break}s=s.parent}return n}}class Ul{static changeFontSizeToFit(t,e){if(e||(e={}),(!e.maxWidth||t.fieldMaskWidth<=e.maxWidth)&&(e.maxWidth=t.fieldMaskWidth),(!e.maxHeight||t.fieldMaskHeight<=e.maxHeight)&&(e.maxHeight=t.fieldMaskHeight),!t.text||t.textWidth<=e.maxWidth&&t.textHeight<=e.maxHeight)return;const i=e.maxStepsCount||100,n=e.stepChange||-1;let s=0;for(;t.size>0&&(t.textWidth>e.maxWidth||t.textHeight>e.maxHeight);)if(t.size+=n,s++,s>=i){I.error("FLabelTools | changeFontSizeToFit __ ERROR! Max steps count!");break}}static truncateToFit(t,e,i,n=Hl.FROM_RIGHT,s="..."){if((!e||t.width<=e)&&(e=t.width),(!i||t.height<=i)&&(i=t.height),!t.text||t.textWidth<=e&&t.textHeight<=i)return!1;for(var r=t.text,o=r,a=0;r.length>0&&(t.textWidth>e||t.textHeight>i);)if(n===Hl.FROM_LEFT?(r=r.substring(1,r.length),t.text=s+r):(r=r.substring(0,r.length-1),t.text=r+s),++a>=1e3){I.error("FLabelTools | truncateToFit __ ERROR! Max steps count!");break}return r!==o}}var Hl,Vl;!function(t){t.FROM_LEFT="FROM_LEFT",t.FROM_RIGHT="FROM_RIGHT"}(Hl||(Hl={})),function(t){t.PRERENDER="prerender",t.POSTRENDER="postrender",t.RESIZE="resize"}(Vl||(Vl={}));class zl{static getDocumentSize(){return new ze(Math.max(document.documentElement.clientWidth,window.innerWidth),Math.max(document.documentElement.clientHeight,window.innerHeight))}static createElementFromHTMLString(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}static checkIfElementIsParentOf(t,e,i=50){let n=!1,s=0,r=t.parentNode;for(;r;){if(r===e){n=!0;break}if(r=r.parentElement,s++,s>=i)break}return n}static scaleElement(t,e){t.style.transform=`scale(${e})`,t.style["transform-origin"]="0 0",t.style["-ms-zoom"]=e,t.style["-moz-transform"]=`scale(${e})`,t.style["-moz-transform-origin"]="0 0",t.style["-o-transform"]=`scale(${e})`,t.style["-o-transform-origin"]="0 0",t.style["-webkit-transform"]=`scale(${e})`,t.style["-webkit-transform-origin"]="0 0"}}const jl="DATA_CHANGE",Wl="KEY_DOWN",Xl="KEY_UP",Kl="STAGE_DOWN",Yl="STAGE_UP",$l="MOUSE_WHEEL";class ql{constructor(t){this.nativeEvent=t}}class Zl extends o{constructor(...t){super(...t),this.pressedKeyCodes={},this.prevPressedKeyCodes={},this.justPressedKeyCodes={},this.justReleasedKeyCodes={}}addListeners(){super.addListeners();var t=document;this.eventListenerHelper.addEventListener(t,L.KEY_DOWN,this.onKeyDown),this.eventListenerHelper.addEventListener(t,L.KEY_UP,this.onKeyUp),this.eventListenerHelper.addEventListener(t,f.MOUSE_WHEEL,this.onMouseWheel),this.eventListenerHelper.addEventListener(Pl.instance.stage,Ml,this.onStageDown),this.eventListenerHelper.addEventListener(Pl.instance.stage,Dl,this.onStageUp),Pl.instance.ticker.add(this.onTick,this)}removeListeners(){super.removeListeners(),Pl.instance.ticker.remove(this.onTick,this)}onMouseWheel(t){this.dispatchEvent($l,t)}onStageUp(){this.lastGlobalInteractionPos=Pl.instance.getGlobalInteractionPosition(),this.dispatchEvent(Yl,this.lastGlobalInteractionPos)}onStageDown(){this.lastGlobalInteractionPos=Pl.instance.getGlobalInteractionPosition(),this.dispatchEvent(Kl,this.lastGlobalInteractionPos)}onTick(){this.updateInput()}onKeyDown(t){this.pressedKeyCodes[t.code]||(this.pressedKeyCodes[t.code]=!0,this.isDataChanged=!0),this.updateInput();let e=new ql(t||window.event);e.nativeKeyboardEvent=e.nativeEvent,this.dispatchEvent(Wl,e)}onKeyUp(t){this.pressedKeyCodes[t.code]&&(this.pressedKeyCodes[t.code]=!1,this.isDataChanged=!0),this.updateInput();let e=new ql(t||window.event);e.nativeKeyboardEvent=e.nativeEvent,this.dispatchEvent(Xl,e)}updateInput(){if(this.isDataChanged){var t;for(t in this.isDataChanged=!1,this.pressedKeyCodes)this.pressedKeyCodes[t]&&!this.prevPressedKeyCodes[t]?this.justPressedKeyCodes[t]=!0:this.justPressedKeyCodes[t]=!1,!this.pressedKeyCodes[t]&&this.prevPressedKeyCodes[t]?this.justReleasedKeyCodes[t]=!0:this.justReleasedKeyCodes[t]=!1,this.prevPressedKeyCodes[t]=this.pressedKeyCodes[t];this.dispatchEvent(jl)}}checkIfKeyCodeJustPressed(t){return this.justPressedKeyCodes[t]}checkIfKeyCodeJustReleased(t){return this.justReleasedKeyCodes[t]}checkIfKeyCodeDown(t){return this.pressedKeyCodes[t]}checkIfAnyCodeDown(t){return t.some((t=>!!this.pressedKeyCodes[t]))}checkIfAnyCodeJustPressed(t){return t.some((t=>!!this.justPressedKeyCodes[t]))}checkIfAnyCodeJustReleased(t){return t.some((t=>!!this.justReleasedKeyCodes[t]))}getLastGlobalInteractionPos(){return this.lastGlobalInteractionPos}static get instance(){return Zl._instance||(Zl._instance=new Zl),Zl._instance}}const Ql="default",Jl="font",th="sound",eh="image",ih="spritesheet",nh="spine";class sh{constructor(){this.fileTypeToLoadItemClassMap={}}createItem(t){return this.prepareConfig(t),this.internalCreateItem(t)}internalCreateItem(t){let e=this.fileTypeToLoadItemClassMap[t.fileType];e||(e=this.fileTypeToLoadItemClassMap[Ql]);return new e(t)}prepareConfig(t){t.basePath||this.basePath&&(t.basePath=this.basePath);const e=jh(Hh);t.basePath&&(t.basePath=e.substituteUrlPlaceholders(t.basePath)),t.src&&(t.src=e.substituteUrlPlaceholders(t.src))}}class rh{static getUniqueLoadingId(t){return t.src+"_"+t.uniqueId}}class oh{constructor(){this.items=new b,this.itemsToLoad=new b,this.loadedItems=new b}add(t){this.isNeedSort=!0,this.items.push(t,rh.getUniqueLoadingId(t.config)),this.itemsToLoad.push(t,rh.getUniqueLoadingId(t.config))}get(t){const e=rh.getUniqueLoadingId(t);return this.items.getItem(e)}getNextToLoad(){return this.isNeedSort&&this.sortItems(),this.itemsToLoad.getItemByIndex(0)}sortItems(){this.itemsToLoad.sort(((t,e)=>{let i=0;return t.config.priority&&e.config.priority&&(t.config.priority>e.config.priority?i=-1:t.config.priority<e.config.priority&&(i=1)),i}))}onItemLoad(t){-1!==this.items.indexOf(t)&&(this.itemsToLoad.remove(t),this.loadedItems.push(t,rh.getUniqueLoadingId(t.config)))}}var ah;!function(t){t.WAIT="WAIT",t.LOADING="LOADING",t.COMPLETE="COMPLETE",t.ERROR="ERROR"}(ah||(ah={}));const lh="LoadStatusEvent.STATUS_CHANGE",hh="LoadEvent.START",dh="LoadEvent.PROGRESS",ch="LoadEvent.COMPLETE",uh="LoadEvent.ERROR",ph=(()=>{const t={};return t[ah.ERROR]=1e3,t[ah.LOADING]=100,t[ah.WAIT]=10,t[ah.COMPLETE]=0,t})();class fh{static getTopPriorityStatus(t){let e,i;for(let n of t){const t=ph[n];if((!e||t>i)&&(e=n,i=t),e===ah.ERROR)break}return e}}class gh extends o{constructor(t){super(),this.name=t,this.items=new b,this._status=ah.WAIT,this._progress=0}addItem(t){this.items.push(t,t.config.id),this.addItemListeners(t),this.updateItemsData()}getAllItems(){return this.items.getAllItems()}getTopPriorityLoadStatus(){const t=[],e=this.items.getAllItems();for(let i of e)t.push(i.status);return fh.getTopPriorityStatus(t)}updateItemsData(){this.updateLoadStatus(),this.updateLoadProgress()}updateLoadStatus(){const t=this.getTopPriorityLoadStatus();t!==this.status&&(this._status=t,this.dispatchEvent(lh),this.status===ah.ERROR?this.dispatchEvent(uh):this.status===ah.COMPLETE?this.dispatchEvent(ch):this.status===ah.LOADING&&this.dispatchEvent(hh))}updateLoadProgress(){const t=Sh.getProgressForItems(this.items.getAllItems());t.progress!==this._progress&&(this._progress=t.progress,this.dispatchEvent(dh))}get status(){return this._status}get progress(){return this._progress}addItemListeners(t){this.eventListenerHelper.addEventListener(t,lh,(()=>{this.updateItemsData()})),this.eventListenerHelper.addEventListener(t,dh,(()=>{this.updateLoadProgress()}))}}class mh extends o{constructor(t){super(t),this.stopOnError=!1,this.autoStartOnAdd=!0}construction(t){super.construction(),this.id=t,this.group=new gh(this.id),this.queue=new oh,this.curItemEventListenerHelper=new r(this)}destruction(){super.destruction(),this.curItemEventListenerHelper&&(this.curItemEventListenerHelper.destruction(),this.curItemEventListenerHelper=null)}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.group,lh,this.onGroupStatusChange),this.eventListenerHelper.addEventListener(this.group,dh,this.onGroupStatusChange)}onGroupStatusChange(){this.dispatchEvent(lh)}onGroupProgress(){this.dispatchEvent(dh)}start(){this.loadNext()}stop(){this.curItem&&this.curItem.stop()}add(t){let e=this.queue.get(t);if(!e){const i=[];if(t.dependencies)for(let e of t.dependencies){const t=this.add(e);i.push(t)}e=sh.instance.createItem(t),e.dependencies=i,this.queue.add(e)}return this.status!==ah.LOADING&&this.autoStartOnAdd&&this.start(),e}loadNext(){let t=this.queue.getNextToLoad();t?this.load(t):this.curItem=null}load(t){this.curItem=t,this.addCurItemListeners(),this.curItem.start()}addCurItemListeners(){this.removeCurItemListeners(),this.curItem&&(this.curItemEventListenerHelper.addEventListener(this.curItem,ch,this.onItemComplete),this.curItemEventListenerHelper.addEventListener(this.curItem,uh,this.onItemError))}removeCurItemListeners(){this.curItem&&this.curItemEventListenerHelper.removeAllListeners(this.curItem)}onItemComplete(){this.queue.onItemLoad(this.curItem),this.loadNext()}onItemError(){this.queue.onItemLoad(this.curItem),this.stopOnError?this.stop():this.loadNext()}getCurrentLoadingItem(){return this.curItem}get status(){return this.group.status}get progress(){return this.group.progress}}class vh{constructor(){this.loader=vh.DEFAULT_LOADER_ID,this.loadWeight=vh.DEFAULT_LOAD_WEIGHT}static addDefaultData(t){d.copyProps(t,vh.defaultLoadItem,{ignoreExistedProperties:!0}),t.loadGroups||(t.loadGroups=[]),t.loadGroups&&t.loadGroups.push(vh.DEFAULT_LOAD_GROUP)}}vh.DEFAULT_LOADER_ID="default",vh.DEFAULT_LOAD_WEIGHT=1,vh.DEFAULT_LOAD_GROUP="default",vh.defaultLoadItem=new vh;class _h extends o{constructor(){super(...arguments),this.substituteUrlParams={}}construction(...t){super.construction(...t),this.loadersToIdMap=new b,this.loadGroupsToNameMap=new b,this.loadItemsToIdMap=new b,this.addLoader(new mh(vh.DEFAULT_LOADER_ID))}addLoader(t){this.loadersToIdMap.push(t,t.id)}getLoader(t){let e;return t&&(e=this.loadersToIdMap.getItem(t)),e||(e=this.defaultLoader),e}get defaultLoader(){return this.loadersToIdMap.getItem(vh.DEFAULT_LOADER_ID)}getAllLoaders(){return this.loadersToIdMap.getAllItems().concat()}load(t){this.loadItemsToIdMap.getItem(t.id)&&console.warn("AbstractLoadManager | add __ WARNING! Item with the same id already exists. item:",t),vh.addDefaultData(t);const e=this.getLoader(t.loader).add(t);return this.loadItemsToIdMap.push(e,t.id),this.addItemToLoadGroups(e),e}getLoadItem(t){return this.loadItemsToIdMap.getItem(t)}getGroup(t){let e=this.loadGroupsToNameMap.getItem(t);return e||(e=new gh(t),this.loadGroupsToNameMap.push(e,t)),e}addItemToLoadGroups(t){for(let e of t.config.loadGroups){this.getGroup(e).addItem(t)}}getLoadStatusForGroups(t){const e=[];for(let i of t){const t=this.getGroup(i);e.push(t.status)}return fh.getTopPriorityStatus(e)}substituteUrlPlaceholders(t){return M.substitute(t,this.substituteUrlParams)}addSubstituteParams(t){d.copyProps(this.substituteUrlParams,t)}}class yh extends u{constructor(t){super(),this.loadConfig=t}executeInternal(){let t=jh(Hh);this.loadItem=t.load(this.loadConfig),this.eventListenerHelper.addEventListener(this.loadItem,lh,(()=>{this.processFinalStatus()})),this.processFinalStatus()}processFinalStatus(){this.loadItem.status===ah.COMPLETE?this.processComplete():this.loadItem.status===ah.ERROR&&this.processError()}processComplete(){this.notifyComplete(this.loadItem.data)}processError(){this.errorCode=l.GENERAL_ERROR,this.terminate()}}class Eh extends u{constructor(t){super(),this.items=t}executeInternal(){let t=[];for(let e of this.items){let i=new yh(e).execute();t.push(i)}Promise.all(t).then((()=>{this.notifyComplete()}),(()=>{this.errorCode=l.GENERAL_ERROR,this.terminate()}))}}class bh extends u{constructor(t){super(),this.groupName=t}executeInternal(){let t=jh(Hh).getGroup(this.groupName);t.status===ah.COMPLETE?this.notifyComplete():t.status===ah.WAIT&&t.getAllItems().length<=0?(console.log("WaitGroupLoadingCompleteCommand | executeInternal __ Group is not in the loading status! this.groupName: ",this.groupName," | tempGroup.status: ",t.status),this.notifyComplete()):this.eventListenerHelper.addEventListener(t,lh,(()=>{t.status===ah.COMPLETE&&this.notifyComplete()}))}}class Ah{static add(t,e){Ah.cache[t]=e}static get(t){return Ah.cache[t]}static remove(t){delete Ah.cache[t]}static reset(){Ah.cache={}}}Ah.cache={};class Th extends o{constructor(t){super(),this.config=t,this._status=ah.WAIT,this.internalPrepare()}internalPrepare(){this.eventListenerHelper=new r(this),this.dependencies=[]}start(){if(this.startPromise)return this.startPromise;this.startPromise=new Promise(((t,e)=>{if(this.startPromiseResolve=t,this.startPromiseReject=e,this.status===ah.LOADING)return;this.status=ah.LOADING;const i=[];for(let t of this.dependencies)i.push(t.start());Promise.all(i).then((()=>{this.addLoadingListeners(),this.internalStart()})).catch((t=>{this.processLoadingError(t)}))}))}internalStart(){}stop(){this.status!==ah.WAIT&&(this.status=ah.WAIT,this.removeLoadingListeners(),this.internalStop())}internalStop(){}addLoadingListeners(){}removeLoadingListeners(){this.eventListenerHelper.removeAllListeners()}processLoadingProgress(t){this.progress=t,this.dispatchEvent(dh)}processLoadingComplete(t,e){this.sourceData=t,this.data=e,this.status=ah.COMPLETE,Ah.add(this.config.id,e),this.removeLoadingListeners(),this.dispatchEvent(ch),this.startPromiseResolve()}processLoadingError(t){this.errorData=t,this.status=ah.ERROR,this.removeLoadingListeners(),this.dispatchEvent(uh),this.startPromiseReject()}getIsSuccess(){return!this.errorData}get status(){return this._status}set status(t){t!==this.status&&(this._status=t,this.dispatchEvent(lh))}}class xh extends Th{}class Sh{static getProgressForItems(t){let e,i=0,n=0;for(let s of t)e=s.config.loadWeight,e||(e=1),i+=e,s.status!==ah.COMPLETE&&s.status!==ah.ERROR||(n+=e);return{progress:n/i,loadedWeight:n,totalWeight:i}}}class wh extends Th{internalPrepare(){let t=this.config.src;if(this.config.basePath){t=new URL(this.config.src,this.config.basePath).href}Lr.add(this.config.id,t)}internalStart(){super.internalStart(),this.loadPromise=Lr.load(this.config.id,(t=>{this.listenersEnabled&&this.processLoadingProgress(t/100)})),this.loadPromise.then((t=>{this.listenersEnabled&&this.processLoadingComplete(t,t)})),this.loadPromise.catch((t=>{this.listenersEnabled&&this.processLoadingError({data:t,errorCode:t.toString})}))}onLoadingComplete(){}internalStop(){super.internalStop(),console.warn("FileLoadItem | internalStop __ WARNING! Stop loading is not implemented!")}addLoadingListeners(){super.addLoadingListeners(),this.listenersEnabled=!0}removeLoadingListeners(){super.removeLoadingListeners(),this.listenersEnabled=!1}}var Ch=i(933);class Ih extends Th{internalPrepare(){super.internalPrepare();let t=document.createElement("style");t.type="text/css";let e=this.generateFontFaceRule();document.getElementsByTagName("head")[0].appendChild(t),t.sheet.insertRule(e),this.fontLoadingConfig={custom:{families:[this.config.fontFace["font-family"]]},timeout:this.config.timeout||1e4}}internalStart(){super.internalStart(),Ch.load(this.fontLoadingConfig)}internalStop(){super.internalStop()}addLoadingListeners(){super.addLoadingListeners(),this.fontLoadingConfig.fontloading=(t,e)=>{console.log("FontLoadItem | fontloading __ familyName: ",t);var i=document.createElement("p");i.style.fontFamily=this.config.fontFace["font-family"],i.style.fontWeight=this.config.fontFace["font-weight"],i.style.fontStyle=this.config.fontFace["font-style"],i.style.fontSize="0px",i.style.visibility="hidden",i.innerHTML=".",document.body.appendChild(i)},this.fontLoadingConfig.fontactive=(t,e)=>{console.log("FontLoadItem | fontactive __ familyName: ",t),setTimeout((()=>{this.processLoadingComplete(t,t)}),500)},this.fontLoadingConfig.fontinactive=(t,e)=>{console.log("FontLoadItem | fontinactive __ familyName: ",t),this.processLoadingError({data:t})}}generateFontFaceRule(){let t=this.config.src,e=t.lastIndexOf(".");e>=0&&(t=t.substring(0,e));let i=t.split("/").pop(),n=`@font-face {\n            src: url('${t}.eot');\n            src: url('${t}.woff2') format('woff2'),\n                url('${t}.woff') format('woff'),\n                url('${t}.ttf') format('truetype'),\n                url('${t}.svg#${i}') format('svg'),\n                url('${t}.eot?#iefix') format('embedded-opentype');`;for(let t in this.config.fontFace)n+="font-family"==t?`${t}: "${this.config.fontFace[t]}";\n`:`${t}: ${this.config.fontFace[t]};\n`;return n+="}",n}}var Rh=i(766),Ph=i(521);class Lh extends o{constructor(t){super(t)}construction(t){super.construction(),this.mutedLock=new S,this.config=t}setVolume(t){Ph.TweenLite.killTweensOf(this),this.internalSetVolume(t)}tweenVolume(t,e,i){this.tweenVolumeValue=this.getVolume(),Ph.TweenLite.killTweensOf(this),Ph.TweenLite.to(this,e,{tweenVolumeValue:t,onComplete:()=>{i&&i()}})}get tweenVolumeValue(){return this._tweenVolumeValue}set tweenVolumeValue(t){t!==this._tweenVolumeValue&&(this._tweenVolumeValue=t,this.internalSetVolume(this._tweenVolumeValue))}calculateMuted(){const t=this.muted,e=this.mutedLock.enabled;e!==t&&(this._muted=e),this.commitData()}addMutedLock(t){this.mutedLock.add(t),this.calculateMuted()}removeMutedLock(t){this.mutedLock.remove(t),this.calculateMuted()}get muted(){return this._muted}}class Mh extends Lh{constructor(t){super(t)}construction(t){super.construction(t),this.engineSound=new Rh.Howl({src:this.config.src,preload:this.config.preload})}destruction(){super.destruction(),this.engineSound&&(this.engineSound.unload(),this.engineSound=null)}getVolume(){return this.engineSound.volume()}internalSetVolume(t){this.engineSound.volume(t)}play(t){t||(t={}),this.engineSound.loop(t.loop),this.engineSound.play()}stop(){this.engineSound.stop()}commitData(){super.commitData(),this.engineSound&&this.engineSound.mute(this.muted)}}const Dh="load",Oh="loaderror";class kh extends xh{constructor(){super(...arguments),this.soundsManager=jh(yd)}internalPrepare(){super.internalPrepare();let t=this.config.src;if(this.config.extensions&&this.config.extensions.length){t=[];let e=this.config.extensions.length;for(let i=0;i<e;i++)t.push(M.substitute(this.config.src,{extension:this.config.extensions[i]}))}this.sound=new Mh({id:this.config.id,src:t,preload:!1,tags:this.config.tags})}internalStart(){super.internalStart(),this.sound.engineSound.load()}internalStop(){super.internalStop(),this.sound&&this.sound.destruction()}addLoadingListeners(){super.addLoadingListeners(),this.sound.engineSound.on(Dh,(()=>{this.processLoadingComplete(this.sound.engineSound,this.sound.engineSound)})),this.sound.engineSound.on(Oh,((t,e)=>{this.processLoadingError({errorCode:e,data:e})}))}removeLoadingListeners(){super.removeLoadingListeners(),this.sound&&(this.sound.engineSound.off(Dh),this.sound.engineSound.off(Oh))}processLoadingComplete(t,e){this.soundsManager.registerSound(this.config.id,this.sound),super.processLoadingComplete(t,e)}}class Bh extends wh{onLoaderComplete(t){this.processLoadingComplete(t,t)}}class Fh extends wh{processLoadingComplete(t,e){super.processLoadingComplete(t,t.spineData)}}class Nh extends sh{constructor(){super(),this.fileTypeToLoadItemClassMap[Ql]=wh,this.fileTypeToLoadItemClassMap[Jl]=Ih,this.fileTypeToLoadItemClassMap[th]=kh,this.fileTypeToLoadItemClassMap[eh]=Bh,this.fileTypeToLoadItemClassMap[ih]=Bh,this.fileTypeToLoadItemClassMap[nh]=Fh}}class Gh extends Nh{}class Uh extends _h{constructor(){super(),sh.instance=new Nh}}class Hh extends Uh{}var Vh;!function(t){t.DEFAULT="default",t.EN="en",t.RU="ru"}(Vh||(Vh={}));class zh{static startInit(t={}){zh.config=t}static activate(){let t;const e=zh.injectionsMap.getKeys();for(let i of e)t=zh.injectionsMap.getItem(i),t.config&&t.config.forceCreation&&zh.getInstance(t.item)}static add(t,e){let i=zh.getInjection(t);if(e){if(e.toSubstitute){i.toSubstitute=e.toSubstitute;let n=zh.getInjection(i.toSubstitute);n.substitution=t,n.config&&(e.activateeConstructors||(e.activateeConstructors=[]),n.config.activateeConstructors&&e.activateeConstructors.push(...n.config.activateeConstructors),d.copyProps(e,n.config,{ignoreExistedProperties:!0}))}}else e={};i.config=e}static getInstance(t,...e){let i,n=zh.getInjection(t),s=[];if(e&&(s=e),n.config&&n.config.isSingleton?(n.singletonInstance||(n.singletonInstance=new n.item(...s)),i=n.singletonInstance):i=new n.item(...s),zh.config.debug){let e=zh.getConstructorName(t);window[e]=i}return i}static getInstanceById(t,...e){let i,n;const s=zh.injectionsMap.getKeys();for(let e of s)if(i=zh.injectionsMap.getItem(e),i.config&&i.config.id===t){n=i;break}let r=null;return n&&(r=zh.getInstance(n.item)),r}static getInjection(t){zh.injectionsMap.getItem(t)||zh.injectionsMap.addItem(t,{item:t});let e=zh.injectionsMap.getItem(t);return e.substitution&&(e=zh.getInjection(e.substitution)),e}static processItemOnActivate(t){if(!t.constructor)return;let e=zh.getInjection(t.constructor),i=zh.getChainActivateesConstructors(e);if(i&&i.length>0){let e=zh.activatorToActivateesMap.getItem(t);e||(e=[],zh.activatorToActivateesMap.addItem(t,e));let n=i.length;for(let s=0;s<n;s++){let n=i[s],r=zh.getInstance(n);r.onActivatorStart(t),e.push(r)}}}static processItemOnDeactivate(t){let e=zh.activatorToActivateesMap.getItem(t);if(!e)return;let i=e.length;for(let t=0;t<i;t++){e[t].onActivatorEnd()}zh.activatorToActivateesMap.removeItemByKey(t)}static getChainActivateesConstructors(t){let e=[];return t.config&&t.config.activateeConstructors&&e.push(...t.config.activateeConstructors),e}static getConstructorName(t){let e=d.getConstructorName(t);if(!e){var i="class ",n=t.toString().indexOf(i)+6,s=t.toString().indexOf(" extends");e=t.toString().slice(n,s)}return e}}zh.config={},zh.injectionsMap=new T,zh.activatorToActivateesMap=new T;const jh=zh.getInstance,Wh=zh.add,Xh=zh.processItemOnActivate,Kh=zh.processItemOnDeactivate;window.getInstance=jh;class Yh{constructor(){this.useTextLinks=!0,this.localeToIdMap={},this.bindMethodReplaceRegExpKeyByStrings=this.replaceRegExpKeyByStrings.bind(this),this.defaultLocaleId=Vh.EN,this.setCurrentLocaleId("")}addLocaleTexts(t,e){let i={texts:{}};this.localeToIdMap[e]&&(i=this.localeToIdMap[e]),Object.assign(i.texts,t.texts),this.localeToIdMap[e]=i,this.commitLocaleData()}getCurrentLocaleId(){return this._currentLocaleId}setCurrentLocaleId(t){t!=this._currentLocaleId&&(this._currentLocaleId=t,this.commitLocaleData())}checkIfLocaleExists(t){return!!this.localeToIdMap[t]}commitLocaleData(){let t=this.localeToIdMap[this._currentLocaleId];t||(t=this.localeToIdMap[this.defaultLocaleId]),this.currentLocaleTexts=t}getText(t,e=null){let i=t;if(this.currentLocaleTexts){const n=t.split(".");let s=this.currentLocaleTexts.texts;const r=n.length;for(let t=0;t<r;t++){const o=n[t];s[o]&&(s=s[o],t===r-1&&(i=s,i=this.format(i,e)))}}return i}format(t,e=null){var i=t;return this.useTextLinks&&(i=i.replace(/@([^@]+)@/gi,this.bindMethodReplaceRegExpKeyByStrings)),t&&e&&(i=M.substitute(i,e)),this.useTextLinks&&(i=i.replace(/@([^@]+)@/gi,this.bindMethodReplaceRegExpKeyByStrings)),i}replaceRegExpKeyByStrings(t,e,...i){return this.getText(e)}findAllUniqueCharactersForCurrentLocale(){const t=[];this.getAllTextsOf(this.currentLocaleTexts.texts,t);let e={},i=[];for(let n of t){const t=Array.from(n);for(let n of t)e[n]||(e[n]=!0,i.push(n))}return i}getAllTextsOf(t,e){for(let i in t){let n=t[i];d.isObject(n)?this.getAllTextsOf(n,e):e.push(n)}}}function $h(t,e=null){return jh(Yh).getText(t,e)}var qh;!function(t){t.UPDATE="update",t.REMOVE="remove"}(qh||(qh={}));const Zh="GenericObjectsModelEvent.CHANGE";class Qh extends o{construction(...t){super.construction(...t),this.items=new b,this.reset()}reset(){this.items.reset(),this.dispatchChangeEvent()}dispatchChangeEvent(){this.dispatchEvent(Zh)}parseSource(t){if(t.action===qh.REMOVE)this.removeItem(t.id);else this.updateItem(this.getItem(t.id),t);this.dispatchChangeEvent()}getItem(t,e=!0){let i=this.items.getItem(t);return i||e&&(i=this.createEmpty(t),this.items.push(i,i.id)),i}removeItem(t){this.items.removeByKey(t)}get itemsCount(){return this.items.length}createEmpty(t){let e;const i={id:t,type:this.itemsType};return e=this.DefaultItemClass?new this.DefaultItemClass:i,this.updateItem(e,i),e}updateItem(t,e){t.update?t.update(e):Object.assign(t,e)}getAllItems(t=!0){return this.items.getAllItems(t)}}class Jh{constructor(){this.modelsToTypeMap=new b,td=this.getItem.bind(this),ed=this.getItemsForType.bind(this),id=this.commitItems.bind(this),window.getItem=td,window.getItemsForType=ed,window.commitItems=id}commitItems(t){let e;for(let i of t)e=this.getModelForType(i.type),e.parseSource(i)}getModelForType(t){let e=this.modelsToTypeMap.getItem(t);return e||(e=new Qh,e.itemsType=t,this.mapModelToType(e,t)),e}getItem(t,e){return this.getModelForType(t).getItem(e)}getItemsForType(t,e=!0){return this.getModelForType(t).getAllItems(e)}mapModelToType(t,e){this.modelsToTypeMap.push(t,e)}}let td,ed,id;var nd,sd;!function(t){t.NONE="none",t.LEFT="left",t.CENTER="center",t.RIGHT="right"}(nd||(nd={})),function(t){t.NONE="none",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(sd||(sd={}));var rd;!function(t){t.LEFT="left",t.RIGHT="right",t.TOP="top",t.BOTTOM="bottom"}(rd||(rd={}));class od{}od.DRAG_START="UserActionsCheckerEvent_DRAG_START",od.DRAG_END="UserActionsCheckerEvent_DRAG_END",od.DRAG_UPDATE="UserActionsCheckerEvent_DRAG_UPDATE";class ad extends o{constructor(){super(),this.startDragGlobalX=0,this.startDragGlobalY=0,this.lastDragGlobalX=0,this.lastDragGlobalY=0,this.changeDragGlobalX=0,this.changeDragGlobalY=0,this.startDragLocalPoint=new ze,this.lastDragLocalPoint=new ze,this.startDragViewShiftPoint=new ze,this.dragUpdateDelay=0,this.dragStartTime=0}construction(){super.construction(),this.hitAreaEventListenerHelper=new r(this)}destruction(){super.destruction(),this.hitAreaEventListenerHelper&&(this.hitAreaEventListenerHelper.destruction(),this.hitAreaEventListenerHelper=null)}removeListeners(){super.removeListeners(),this.removeHitAreaListeners()}updateHitAreaListeners(){this.removeHitAreaListeners();let t=this.view;this.hitArea&&(t=this.hitArea),this.addHitAreaListeners(t)}addHitAreaListeners(t){t&&(this.hitAreaEventListenerHelper.addEventListener(t,Ml,this.onMouseDown),this.hitAreaEventListenerHelper.addEventListener(t,Dl,this.onMouseUp),this.hitAreaEventListenerHelper.addEventListener(t,kl,this.onMouseUp),Pl.instance.ticker.add(this.onTick,this))}removeHitAreaListeners(){this.hitAreaEventListenerHelper.removeAllListeners(),Pl.instance.ticker.remove(this.onTick,this)}onMouseDown(){this.startDrag()}onMouseUp(){this.stopDrag()}onTick(){this.isDragStarted&&this.checkIsNeedUpdateDrag()&&this.updateDrag()}dispatchDragStartEvent(){this.dispatchEvent(od.DRAG_START)}dispatchDragUpdateEvent(){this.dispatchEvent(od.DRAG_UPDATE)}dispatchDragEndEvent(){this.dispatchEvent(od.DRAG_END)}startDrag(){if(this.isDragStarted)return;this.isDragStarted=!0;const t=Pl.instance.getGlobalInteractionPosition();this.startDragGlobalX=t.x,this.startDragGlobalY=t.y,this.view.parent.toLocal({x:this.startDragGlobalX,y:this.startDragGlobalY},null,this.startDragLocalPoint),this.startDragViewShiftPoint.x=this.startDragLocalPoint.x-this.view.x,this.startDragViewShiftPoint.y=this.startDragLocalPoint.y-this.view.y,this.lastDragGlobalX=this.startDragGlobalX,this.lastDragGlobalY=this.startDragGlobalY,this.lastDragLocalPoint.x=this.startDragLocalPoint.x,this.lastDragLocalPoint.y=this.startDragLocalPoint.y,this.changeDragGlobalX=0,this.changeDragGlobalY=0,this.dispatchDragStartEvent()}stopDrag(){this.isDragStarted&&(this.isDragStarted=!1,this.updateDrag(),this.dispatchDragEndEvent())}updateDrag(){const t=Pl.instance.getGlobalInteractionPosition();this.lastDragGlobalX==t.x&&this.lastDragGlobalY==t.y||(this.lastDragGlobalX=t.x,this.lastDragGlobalY=t.y,this.changeDragGlobalX=this.lastDragGlobalX-this.startDragGlobalX,this.changeDragGlobalY=this.lastDragGlobalY-this.startDragGlobalY,console.log("this.lastDragGlobalX:",this.lastDragGlobalX," | this.lastDragGlobalY:",this.lastDragGlobalY),console.log("this.startDragGlobalX:",this.startDragGlobalX," | this.startDragGlobalY:",this.startDragGlobalY),this.view.parent.toLocal({x:this.lastDragGlobalX,y:this.lastDragGlobalY},null,this.lastDragLocalPoint),this.dispatchDragUpdateEvent())}get isDragStarted(){return this._isDragStarted}set isDragStarted(t){t!=this.isDragStarted&&(this._isDragStarted=t,this.isDragStarted&&(this.dragStartTime=Date.now()))}get view(){return this._view}set view(t){t!=this.view&&(this._view=t,this.updateHitAreaListeners())}get hitArea(){return this._hitArea}set hitArea(t){t!=this.hitArea&&(this._hitArea=t,this.updateHitAreaListeners())}checkIsNeedUpdateDrag(){var t;return Date.now()>=this.dragStartTime+this.dragUpdateDelay&&(t=!0),t}get startDragLocalX(){return this.startDragLocalPoint.x}get startDragLocalY(){return this.startDragLocalPoint.y}get lastDragLocalX(){return this.lastDragLocalPoint.x}get lastDragLocalY(){return this.lastDragLocalPoint.y}get changeDragLocalX(){return this.lastDragLocalPoint.x-this.startDragLocalPoint.x}get changeDragLocalY(){return this.lastDragLocalPoint.y-this.startDragLocalPoint.y}get lastDragWithShiftLocalX(){return this.lastDragLocalPoint.x-this.startDragViewShiftPoint.x}get lastDragWithShiftLocalY(){return this.lastDragLocalPoint.y-this.startDragViewShiftPoint.y}}const ld="KeyP",hd="KeyC",dd="ArrowUp",cd="ArrowDown",ud="ArrowLeft",pd="ArrowRight";class fd extends R{createNewObject(t,...e){return jh(t,...e)}}var gd,md;!function(t){t.VOLUME_CHANGE="SoundsManagerEvent.VOLUME_CHANGE",t.ENABLED_CHANGE="SoundsManagerEvent.ENABLED_CHANGE",t.IS_MUTED_CHANGE="SoundsManagerEvent.MUTED_CHANGE",t.TAGS_IS_MUTED_CHANGE="SoundsManagerEvent.TAGS_IS_MUTED_CHANGE"}(gd||(gd={}));class vd extends o{construction(...t){super.construction(...t),this.soundsToIdMap=new b,this._enabled=!1,this.disableLock=new S,this.defaultTweenTime=.5,this.volume=1,this.isMutedToTagsMap={},this.setVolume(this.volume),this.calculateEnabled()}registerSound(t,e){this.soundsToIdMap.push(e,t),this.commitTagsData()}getSound(t){return this.soundsToIdMap.getItem(t)}get enabled(){return this._enabled}calculateEnabled(){const t=this.enabled,e=!this.disableLock.enabled;this._enabled=e,e!==t&&this.dispatchEvent(gd.ENABLED_CHANGE),this.commitData()}addDisableLock(t){this.disableLock.add(t),this.calculateEnabled()}removeDisableLock(t){this.disableLock.remove(t),this.calculateEnabled()}get isActivated(){return this._isActivated}activate(){this._isActivated=!0,this.commitData()}get isMuted(){return this._isMuted}set isMuted(t){t!==this.isMuted&&(this._isMuted=t,this.dispatchEvent(gd.IS_MUTED_CHANGE),this.commitData())}commitData(){super.commitData();let t=this.getVolume();this.isActivated||(t=0),this.isMuted&&(t=0),this.enabled||(t=0);try{this.internalSetVolume(t)}catch(t){console.log("AbstractSoundsManager | commitData __ error: ",t)}this.commitTagsData()}commitTagsData(){this.soundsToIdMap.forEach((t=>{let e=!1;if(t.config.tags)for(let i of t.config.tags)if(this.getTagIsMuted(i)){e=!0;break}e?t.addMutedLock(this):t.removeMutedLock(this)}))}getVolume(){return this.volume}setVolume(t){Ph.TweenLite.killTweensOf(this),this.volume=t,this.dispatchEvent(gd.VOLUME_CHANGE),this.commitData()}tweenVolume(t,e,i){e||0===e||(e=this.defaultTweenTime),this.tweenVolumeValue=this.getVolume(),Ph.TweenLite.killTweensOf(this),Ph.TweenLite.to(this,e,{tweenVolumeValue:t,onComplete:()=>{i&&i()}})}get tweenVolumeValue(){return this._tweenVolumeValue}set tweenVolumeValue(t){t!==this._tweenVolumeValue&&(this._tweenVolumeValue=t,this.setVolume(this._tweenVolumeValue))}getTagIsMuted(t){return!!this.isMutedToTagsMap[t]}setTagIsMuted(t,e){this.getTagIsMuted(t)!==e&&(this.isMutedToTagsMap[t]=e,this.dispatchEvent(gd.TAGS_IS_MUTED_CHANGE),this.commitTagsData())}getTagsMuted(){let t=[];const e=Object.keys(this.isMutedToTagsMap);for(let i of e)this.getTagIsMuted(i)&&t.push(i);return t}}!function(t){t.SOUNDS="sounds",t.BG_MUSIC="bgMusic"}(md||(md={}));class _d extends vd{internalSetVolume(t){Rh.Howler.volume(t)}}class yd extends _d{}var Ed=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};class bd{static asyncTimeout(t){return Ed(this,void 0,void 0,(function*(){return new Promise((e=>{setTimeout((()=>{e()}),t)}))}))}}class Ad extends o{init(){}initCompleteHook(){}activateCompleteHook(){}}const Td="GlobalEventDispatcherEvent.PRE_DISPATCH_EVENT ",xd="GlobalEventDispatcherEvent.POST_DISPATCH_EVENT ";class Sd extends o{dispatchEvent(t,...e){super.dispatchEvent(this.getModifiedEventType(t,Td),...e),super.dispatchEvent(t,...e),super.dispatchEvent(this.getModifiedEventType(t,xd),...e)}addPreEventListener(t,e){this.addEventListener(this.getModifiedEventType(t,Td),e)}addPostEventListener(t,e){this.addEventListener(this.getModifiedEventType(t,xd),e)}removePreEventListener(t,e){this.removeEventListener(this.getModifiedEventType(t,Td),e)}removePostEventListener(t,e){this.removeEventListener(this.getModifiedEventType(t,xd),e)}getModifiedEventType(t,e){return e+t}}class wd extends o{construction(...t){super.construction(...t),this.globalDispatcher=jh(Sd)}dispatchEvent(t,...e){super.dispatchEvent(t,...e),this.globalDispatcher.dispatchEvent(t,...e)}}class Cd extends wd{}const Id="flashist__defaultStorageId";class Rd extends o{construction(){super.construction(),this.storageId=Id,this.prepareStorage(),this.createStorage()}getStorageId(){return this.storageId}getWindowStorageObject(){let t=localStorage.getItem(this.storageId);return t||(t="{}"),JSON.parse(t)}setParam(t,e){this.storageData[t]!==e&&(this.storageData[t]=e,this.writeSaves())}getParam(t){return this.storageData[t]}writeSaves(){let t=JSON.stringify(this.storageData);localStorage.setItem(this.storageId,t)}createStorage(){this.storageData=this.getWindowStorageObject(),this.storageData.isCreated&&this.initializeStorageData()}initializeStorageData(){this.storageData.isCreated=!0,this.writeSaves()}clearSaves(){this.initializeStorageData()}prepareStorage(){window.localStorage||Object.defineProperty(window,"localStorage",new function(){var t=[],e={};Object.defineProperty(e,"getItem",{value:function(t){return this[t]?this[t]:null},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"key",{value:function(e){return t[e]},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"setItem",{value:function(t,e){t&&(document.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"length",{get:function(){return t.length},configurable:!1,enumerable:!1}),Object.defineProperty(e,"removeItem",{value:function(t){t&&(document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"clear",{value:function(){if(t.length)for(var i in e)document.cookie=escape(i)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},writable:!1,configurable:!1,enumerable:!1}),this.get=function(){var i;for(var n in e)-1===(i=t.indexOf(n))?e.setItem(n,e[n]):t.splice(i,1),delete e[n];for(;t.length>0;t.splice(0,1))e.removeItem(t[0]);for(var s,r,o=0,a=document.cookie.split(/\s*;\s*/);o<a.length;o++)(s=a[o].split(/\s*=\s*/)).length>1&&(e[r=unescape(s[0])]=unescape(s[1]),t.push(r));return e},this.configurable=!1,this.enumerable=!0})}}class Pd{static getChangeEvent(t){return`appStateChange:${t.toString()}`}}class Ld{static prepareDeepKeyHelperData(t,e=null){const i={splitDeepKeyParts:[],dispatchingChangePaths:[],dispatchingChangePathsMap:{}};let n="";const s=t.split(".");for(let t of s)i.splitDeepKeyParts.push(t),n&&(n+="."),n+=t,i.dispatchingChangePaths.push(n),i.dispatchingChangePathsMap[n]=!0;if(e&&!d.isSimpleType(e.value)){const n=(t,e)=>{let i=[e];if(!d.isSimpleType(t)){const s=Object.keys(t);for(let r of s){const s=t[r],o=n(s,`${e}.${r}`);i.push(...o)}}return i},s=n(e.value,t);for(let t of s){const e=Ld.splitDeepKeyIntoEvents(t);for(let t of e.dispatchingChangePaths)i.dispatchingChangePathsMap[t]||(i.dispatchingChangePathsMap[t]=!0,i.dispatchingChangePaths.push(t))}}return i}static splitDeepKeyIntoEvents(t){const e={splitDeepKeyParts:[],dispatchingChangePaths:[],dispatchingChangePathsMap:{}};let i="";const n=t.split(".");for(let t of n)e.splitDeepKeyParts.push(t),i&&(i+="."),i+=t,e.dispatchingChangePaths.push(i),e.dispatchingChangePathsMap[i]=!0;return e}}var Md;!function(t){t.DELETE="delete",t.CHANGE="change",t.SUBSTITUTE="substitute",t.SPLICE="splice",t.PUSH="push"}(Md||(Md={}));class Dd extends wd{constructor(){super(...arguments),this.isInitialized=!1,this.state={},this.pathsHelperDataCache={},this.preChangeHooks=[]}changePropertyWrapper(){return t=>(e,i)=>{this.innerChange({},`${t}.${e}`,i)}}initializeWith(t){this.isInitialized||d.copyProps(this.state,t)}initializeComplete(){this.isInitialized=!0}getState(){return this.state}getMutableState(){return this.state}dispatchChangeEvents(t){for(let e of t.dispatchingChangePaths){const t=Pd.getChangeEvent(e);this.dispatchEvent(t)}}getPathsHelperData(t,e=null){let i=null;return e&&d.isSimpleType(e.value)?(i=this.pathsHelperDataCache[t],i||(i=Ld.prepareDeepKeyHelperData(t,e),this.pathsHelperDataCache[t]=i)):i=Ld.prepareDeepKeyHelperData(t,e),i}triggerPreChangeHooks(t,e,i){this.preChangeHooks.length<=0||this.preChangeHooks.forEach((n=>{n(t,e,i)}))}getValue(){return t=>this.innerGetValue({},t)}innerGetValue(t,e){let i;const n=this.getPathsHelperData(e,null);let s=this.state,r=n.splitDeepKeyParts.length;for(let t=0;t<r;t++){const e=n.splitDeepKeyParts[t];t===r-1?i=s[e]:s=s[e]}return i}processStateAction(t,e,i){let n;const s=this.getPathsHelperData(e,i);let r=this.state,o=s.splitDeepKeyParts.length;for(let t=0;t<o;t++){const e=s.splitDeepKeyParts[t];t===o-1?i.changeType===Md.SUBSTITUTE?(delete r[e],d.copySinglePropFromValue(r,e,i.value)):i.changeType===Md.CHANGE?d.copySinglePropFromValue(r,e,i.value):i.changeType===Md.DELETE?(n=r[e],delete r[e]):i.changeType===Md.PUSH?r[e].push(...i.elements):i.changeType===Md.SPLICE&&(n=r[e].splice(i.start,i.deleteCount)):r=r[e]}return this.dispatchChangeEvents(s),n}substitute(){return(t,e)=>{this.innerSubstitute({},t,e)}}innerSubstitute(t,e,i){const n={changeType:Md.SUBSTITUTE,value:i};this.triggerPreChangeHooks(t,e,n),this.processStateAction(t,e,n)}change(){return(t,e)=>{this.innerChange({},t,e)}}innerChange(t,e,i){const n={changeType:Md.CHANGE,value:i};this.triggerPreChangeHooks(t,e,n),this.processStateAction(t,e,n)}delete(){return t=>this.innerDelete({},t)}innerDelete(t,e){const i={changeType:Md.DELETE};return this.triggerPreChangeHooks(t,e,i),this.processStateAction(t,e,i)}push(){return(t,...e)=>this.innerPush({},t,...e)}innerPush(t,e,...i){const n={changeType:Md.PUSH,elements:i};this.triggerPreChangeHooks(t,e,n),this.processStateAction(t,e,n)}splice(){return(t,e,i)=>this.innerSplice({},t,e,i)}innerSplice(t,e,i,n){void 0===n&&(n=Number.MAX_SAFE_INTEGER);const s={changeType:Md.SPLICE,start:i,deleteCount:n};return this.triggerPreChangeHooks(t,e,s),this.processStateAction(t,e,s)}}class Od extends Ad{init(){super.init(),Wh(Dd,{isSingleton:!0})}initCompleteHook(){super.initCompleteHook(),jh(Dd).initializeComplete()}}const kd=()=>jh(Dd),Bd=()=>t=>Pd.getChangeEvent(t);window.appStorage=kd,window.appStateChangeEvent=Bd;const Fd="appModel",Nd="assets/app-config.json",Gd="assetsConfigFile",Ud="localeConfigFile",Hd="staticItemsFile";class Vd extends Cd{construction(...t){super.construction(t),this.storageManager=jh(Rd),this.appState=kd().getState();const e=this.storageManager.getParam(Fd);this.applyStorageData(e);let i=Date.now();(null===flashistGlobalVars||void 0===flashistGlobalVars?void 0:flashistGlobalVars.openTime)&&(i=null===flashistGlobalVars||void 0===flashistGlobalVars?void 0:flashistGlobalVars.openTime),kd().change()("app",{previousSessionTotalUsageTime:this.appState.app.totalUsageDuration,sessionStartTime:i,appLaunchesCount:this.appState.app.appLaunchesCount+1}),this.updateUsageTime(),this.updateTimeInterval=setInterval((()=>{this.updateUsageTime()}),1e3/60),this.updateStorageData(),this.updateStorageInterval=setInterval((()=>{this.updateStorageData()}),6e4)}updateUsageTime(){let t=Date.now()-this.appState.app.sessionStartTime;kd().change()("app",{sessionDuration:t,totalUsageDuration:this.appState.app.previousSessionTotalUsageTime+t}),this.updateStorageData()}applyStorageData(t){t&&kd().change()("app",{appLaunchesCount:t.appLaunchesCount,totalUsageDuration:t.totalUsageTime})}updateStorageData(){const t=this.generateStorageData();this.storageManager.setParam(Fd,t)}generateStorageData(){return{appLaunchesCount:this.appState.app.appLaunchesCount,totalUsageTime:this.appState.app.totalUsageDuration}}}const zd={app:{debug:!1,appLaunchesCount:0,sessionStartTime:0,sessionDuration:0,totalUsageDuration:0,previousSessionTotalUsageTime:0,config:{appName:null,appVersion:null,files:null,supportedLocales:null,targetFps:null,sizeArea:{x:0,y:0,width:1280,height:1920}}}};class jd extends Ad{constructor(t){super(),this.debug=t}init(){super.init();const t=d.clone(zd);d.copyProps(t,{app:{debug:this.debug}}),kd().initializeWith(t),Wh(Vd,{isSingleton:!0,forceCreation:!0})}}class Wd extends bl{construction(...t){super.construction(...t),this.dataEventListenerHelper=new r(this)}processDataUnset(t){super.processDataUnset(t),this.dataEventListenerHelper.removeAllListeners()}}class Xd extends Wd{construction(...t){super.construction(...t),this._minSize=new ze,this._maxSize=new ze,this._resizeSize=new ze}resize(t,e){this._minSize.x&&(t=Math.max(t,this._minSize.x)),this._maxSize.x&&(t=Math.min(t,this._maxSize.x)),this._minSize.y&&(e=Math.max(t,this._minSize.y)),this._maxSize.y&&(e=Math.min(e,this._maxSize.y)),this.resizeSize.x=t,this.resizeSize.y=e,this.isConstructed&&this.arrange()}get minSize(){return this._minSize}set minSize(t){t&&(t.x===this._minSize.x&&t.y===this._minSize.y||(this._minSize=t.clone(),this.resize(this.resizeSize.x,this.resizeSize.y)))}get maxSize(){return this._maxSize}set maxSize(t){t&&(t.x===this._maxSize.x&&t.y===this._maxSize.y||(this._maxSize=t.clone(),this.resize(this.resizeSize.x,this.resizeSize.y)))}get resizeSize(){return this._resizeSize}set resizeSize(t){throw new Error("Resize size should be changed through the resize method!")}}class Kd extends Xd{construction(...t){super.construction(...t),this.globalDispatcher=jh(Sd)}addGlobalEventListener(t,e){this.eventListenerHelper.addEventListener(this.globalDispatcher,t,e)}}class Yd extends Xd{construction(...t){super.construction(...t),this.viewToIdMap=new b}addView(t,e){this.viewToIdMap.push(t,e)}removeView(t){this.viewToIdMap.remove(t)}get selectedId(){return this._selectedId}set selectedId(t){t!=this.selectedId&&(this.selectedItem&&(this.selectedItem.parent.removeChild(this._selectedItem),this._selectedItem=null),this._selectedId=t,this._selectedItem=this.getViewById(this.selectedId),this.selectedItem&&this.addChild(this.selectedItem),this.commitData(),this.arrange())}getViewById(t){return this.viewToIdMap.getItem(t)}get selectedItem(){return this._selectedItem}commitData(){if(super.commitData(),this.selectedItem){this._selectedItem.data=this.data}}arrange(){if(super.arrange(),this._selectedItem&&this.resizeSize&&0!==this.resizeSize.x&&0!==this.resizeSize.y){const t=this._selectedItem;t.resize?t.resize(this.resizeSize.x,this.resizeSize.y):(this._selectedItem.width=this.resizeSize.x,this._selectedItem.height=this.resizeSize.y)}}}class $d extends Yd{construction(...t){super.construction(...t),this.viewClassToIdMap=new b}addViewClass(t,e){this.viewClassToIdMap.push(t,e)}removeViewClass(t){this.viewClassToIdMap.remove(t)}getViewById(t){return super.getViewById(t)||this.addView(this.getNewInstance(t),t),super.getViewById(t)}getNewInstance(t){let e,i=this.viewClassToIdMap.getItem(t);return i&&(e=new i),e}}class qd extends $d{getNewInstance(t){let e,i=this.viewClassToIdMap.getItem(t);return i&&(e=jh(i)),e}}class Zd extends Xd{construction(...t){super.construction(t),this.viewStack=new qd,this.addChild(this.viewStack);const e=kd().getMutableState();let i=Object.keys(e.pages.pageIdToViewClassMap);for(let t of i){let i=e.pages.pageIdToViewClassMap[t];this.viewStack.addViewClass(i,t)}this.commitPagesData()}addListeners(){super.addListeners()}commitPagesData(){this.viewStack.selectedId=kd().getState().pages.pageId,this.arrange()}arrange(){super.arrange(),this.viewStack.resize(this.resizeSize.x,this.resizeSize.y),this.viewStack.selectedItem&&this.viewStack.selectedItem.contentScale&&kd().change()("pages.activePageContentScale",{x:this.viewStack.selectedItem.contentScale.x,y:this.viewStack.selectedItem.contentScale.y})}}var Qd;!function(t){t.PRE_RESIZE="AppMainContainerEvent.PRE_RESIZE",t.POST_RESIZE="AppMainContainerEvent.POST_RESIZE"}(Qd||(Qd={}));class Jd extends Kd{construction(...t){super.construction(...t),this.bg=this.createBg(),this.addChild(this.bg),this.pagesView=new Zd,this.addChild(this.pagesView)}arrange(){super.arrange(),this.globalDispatcher.dispatchEvent(Qd.PRE_RESIZE),this.bg.width=this.resizeSize.x+2,this.bg.height=this.resizeSize.y+2,this.pagesView.resize(this.resizeSize.x,this.resizeSize.y),this.globalDispatcher.dispatchEvent(Qd.POST_RESIZE)}createBg(){let t=new la;return t.beginFill(16777215,1e-7),t.drawRect(0,0,10,10),t}}var tc,ec=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};class ic{constructor(){this.modules=[]}destroy(){this.modules=[]}addModule(t){this.modules.push(t)}removeModule(t){c.removeItem(this.modules,t)}initModules(){return ec(this,void 0,void 0,(function*(){let t=this.modules.length;for(let e=0;e<t;e++)this.modules[e].init();for(let e=0;e<t;e++)yield this.modules[e].initCompleteHook()}))}activateModules(){return ec(this,void 0,void 0,(function*(){let t=this.modules.length;for(let e=0;e<t;e++)yield this.modules[e].activateCompleteHook()}))}}class nc extends Cd{constructor(){super(...arguments),this.containersMap={}}addContainer(t,e){this.containersMap[e]=t}removeContainer(t){delete this.containersMap[t]}getContainer(t){let e;return this.containersMap[t]&&(e=this.containersMap[t]),e}}class sc extends Ad{init(){super.init(),Wh(nc,{isSingleton:!0})}}class rc{constructor(){this.password="`",this.localization={closeBtnTooltipTitle:"Close",onStatus:"on",offStatus:"off",closeBtnLabel:"X",displayListBtnLabel:"DL",displayListBtnTooltipTitle:"Display List Inspector",displayListBtnTooltipText:"Map the display list\nunder your mouse",captureClickBtnLabel:"Capture",captureClickBtnTooltip:"Click to show the display list data in the dev console",captureKeyBtnTooltipTitle:"Assign a key to copy display data into dev console",captureKeyBtnTooltipText:"Press an assinged key\nto add display list hierarchy\nto the browser console",captureKeyBtnNormalLabel:"Capture key: {key}",captureKeyBtnPressedLabel:"Press a key",captureKeyBtnNoKeyHelpText:"(click to add)",pauseUpdateKeyBtnTooltipTitle:"Assign a key to pause display list data update",pauseUpdateKeyBtnNormalLabel:"Pause key: {key} ({status})",pauseUpdateKeyBtnPressedLabel:"Press a key",pauseUpdateKeyBtnNoKeyHelpText:"(click to add)",displayListItemTooltipTitle:"Click to show the display item data in the dev console",displayListTitle:"Display List Inspector",displayListStructureLogTitle:"Display List Structure:",additionalInfoBtnNormalLabel:"Additional Info: off",additionalInfoBtnPressedLabel:"Additional Info: on",additionalInfoBtnTooltipTitle:"Additional visual objects info",additionalInfoBtnTooltipText:"Position, width, height, etc. (configurable)",visualControlsBtnNormalLabel:"Visual Controls: off",visualControlsBtnPressedLabel:"Visual Controls: on",visualControlsBtnTooltipTitle:"Visual Controls",visualControlsBtnTooltipText:"Click on object to switch visibility of objects",ignorelInfoBtnNormalLabel:"Ignore Console: off",ignoreInfoBtnPressedLabel:"Ignore Console: on",ignoreInfoBtnTooltipTitle:"Ignore console classes",ignoreInfoBtnTooltipText:"Console-related classes\nwon't be shown in the inspector",moveHelperBtnNormalLabel:"Move Helper: off",moveHelperBtnPressedLabel:"Move Helper: on",moveHelperTooltipTitle:"Move Helper",moveHelperTooltipText:"Enable Move Helper and press CTRL\nfor choosing an object to move\nwith arrow keys (   )",movableObjectText:"[MOVABLE]",fpsText:"FPS: {0}"},this.console={aboveAll:!0,defaultVisible:!1},this.btnSettings={labelSize:14,labelColor:16750848,smallSize:12},this.viewSettings={bgColor:0,bgAlpha:.75,bgToContentShift:{x:10,y:10},borderWidth:1,borderColor:6684672,borderAlpha:.75,titleLabelColor:16777215,titleLabelSize:14},this.displayListSettings={defaultVisible:!1,defaultCaptureKeyCode:hd,defaultCaptureKey:"c",defaultPauseKeyCode:ld,defaultPauseKey:"p",defaultIgnoreConsoleEnabled:!0,defaultAdditionalInfoEnabled:!1,defaultVisualControlsEnabled:!1,defaultMoveHelperEnabled:!1,hierarchyLabelColor:13421772,hierarchyLabelColorOver:16750848,hierarchyLabelSize:14,nameParamName:"name",additionalInfoParams:{x:{toFixed:2},y:{toFixed:2},width:{visualName:"w",toFixed:2},height:{visualName:"h",toFixed:2}},globalVarPoolId:"fconsole_globalVarPool",globalVarNamePattern:"fconsoleTemp{0}"},this.tooltipSettings={bgColor:0,bgAlpha:.75,bgToContentShift:{x:10,y:10},borderWidth:1,borderColor:6684672,borderAlpha:.75,titleLabelColor:16750848,titleLabelSize:14,textLabelColor:13421772,textLabelSize:12},this.fpsSettings={labelSize:12,labelColor:16750848,borderColor:16750848,borderWidth:50,borderHeight:16,fieldToBorderPadding:2,cumulativeFpsCount:60},this.customBtns=[]}}class oc extends o{constructor(){super(),this._text=""}construction(){super.construction(),this.view=new bl,this.view.interactive=!0,this.view.cursor="pointer",this.field=new wl({autosize:!0,color:Ec.config.btnSettings.labelColor,size:Ec.config.btnSettings.labelSize}),this.view.addChild(this.field),this.commitData(),this.onOut()}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.view,Bl,this.onOver),this.eventListenerHelper.addEventListener(this.view,Fl,this.onOut),this.eventListenerHelper.addEventListener(this.view,Ol,this.onClick),this.eventListenerHelper.addEventListener(this.view,kl,this.onOut)}onOver(){this.view.alpha=1,this.tooltipData&&Ec.tooltipManager.show(this.tooltipData)}onOut(){this.view.alpha=.75,Ec.tooltipManager.hide()}onClick(){this.onOut()}commitData(){super.commitData(),this.field.text=this.text,this.arrange()}arrange(){super.arrange()}get text(){return this._text}set text(t){t!=this.text&&(this._text=t,this.commitData())}}class ac{}ac.CAPTURE_KEY_PRESS="CAPTURE_KEY_PRESS";class lc extends oc{addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(Zl.instance,Xl,this.onKeyUp)}onClick(){super.onClick(),this.isClicked=!this.isClicked,this.isClicked||(this.captureKeyCode=null)}onKeyUp(t){this.view.worldVisible&&(this.isClicked?(this.isClicked=!1,this.captureKey=t.nativeKeyboardEvent.key,this.captureKeyCode=t.nativeKeyboardEvent.code,this.commitData()):this.captureKeyCode&&this.captureKeyCode===t.nativeKeyboardEvent.code&&this.dispatchEvent(ac.CAPTURE_KEY_PRESS))}commitData(){super.commitData(),this.isClicked?this.text=Ec.config.localization.captureKeyBtnPressedLabel:this.captureKeyCode?this.text=M.substitute(Ec.config.localization.captureKeyBtnNormalLabel,{key:this.captureKey}):this.text=M.substituteList(Ec.config.localization.captureKeyBtnNormalLabel,{key:Ec.config.localization.captureKeyBtnNoKeyHelpText})}arrange(){super.arrange()}get isClicked(){return this._isClicked}set isClicked(t){t!=this.isClicked&&(this._isClicked=t,this.commitData())}get captureKeyCode(){return this._captureKeyCode}set captureKeyCode(t){t!==this._captureKeyCode&&(this._captureKeyCode=t,this.commitData())}}class hc extends o{constructor(){super(...arguments),this.lastBgWidth=0,this.lastBgHeight=0}construction(){super.construction(),this._titleVisible=!0,this._captureVisible=!1,this.topLevelElements=[],this.titleBtns=[],this.view=new bl,this.bgGraphics=new la,this.view.addChild(this.bgGraphics),this.bgGraphics.interactive=!0,this.dragHelper=new ad,this.dragHelper.view=this.bgGraphics,this.contentCont=new bl,this.view.addChild(this.contentCont),this.titleCont=new bl,this.contentCont.addChild(this.titleCont),this.titleLabel=new wl({autosize:!0,color:Ec.config.viewSettings.titleLabelColor,size:Ec.config.viewSettings.titleLabelSize}),this.titleCont.addChild(this.titleLabel),this.titleLabel.text="Test Title",this.topLevelCont=new bl,this.titleCont.addChild(this.topLevelCont),this.captureClickBtn=new oc,this.titleCont.addChild(this.captureClickBtn.view),this.captureClickBtn.view.y=this.titleLabel.y+this.titleLabel.height+10,this.captureClickBtn.tooltipData={title:Ec.config.localization.captureClickBtnTooltip},this.captureClickBtn.text=Ec.config.localization.captureClickBtnLabel,this.captureKeyBtn=new lc,this.titleCont.addChild(this.captureKeyBtn.view),this.captureKeyBtn.view.y=this.captureClickBtn.view.y+this.captureClickBtn.view.height,this.captureKeyBtn.tooltipData={title:Ec.config.localization.captureKeyBtnTooltipTitle},this.insideContentCont=new bl,this.contentCont.addChild(this.insideContentCont)}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.dragHelper,od.DRAG_START,this.onDragStart),this.eventListenerHelper.addEventListener(this.dragHelper,od.DRAG_UPDATE,this.onDragUpdate),this.eventListenerHelper.addEventListener(this.captureKeyBtn,ac.CAPTURE_KEY_PRESS,this.onCapture),this.eventListenerHelper.addEventListener(this.captureClickBtn.view,Ol,this.onCapture)}onDragStart(){this.viewDragStartX=this.view.x,this.viewDragStartY=this.view.y,Ec.moveViewToTopLayer(this)}onDragUpdate(){this.view.x=this.viewDragStartX+this.dragHelper.changeDragGlobalX,this.view.y=this.viewDragStartY+this.dragHelper.changeDragGlobalY}onClose(){Ec.hideView(this)}onCapture(){}get visible(){return this._visible}set visible(t){t!=this.visible&&(this._visible=t,this.commitData())}commitData(){super.commitData(),this.view.visible=this.visible,this.titleLabel.visible=this.titleVisible,this.captureClickBtn.view.visible=this.captureVisible,this.captureKeyBtn.view.visible=this.captureVisible,this.arrange()}arrange(){let t,e,i=this.topLevelElements.length;for(let n=0;n<i;n++)t=this.topLevelElements[n],e&&(t.x=e.x+e.width+5),e=t;this.titleVisible?this.topLevelCont.x=this.titleLabel.x+this.titleLabel.width+10:this.topLevelCont.x=this.titleLabel.x,this.insideContentCont.visible?this.insideContentCont.y=this.titleCont.y+this.titleCont.height:this.insideContentCont.y=0;let n=this.contentCont.width+Ec.config.viewSettings.bgToContentShift.x,s=this.contentCont.height+Ec.config.viewSettings.bgToContentShift.y;n==this.lastBgWidth&&s==this.lastBgHeight||(this.lastBgWidth=n,this.lastBgHeight=s,this.bgGraphics.clear(),this.bgGraphics.beginFill(Ec.config.viewSettings.bgColor,Ec.config.viewSettings.bgAlpha),this.bgGraphics.lineStyle(Ec.config.viewSettings.borderWidth,Ec.config.viewSettings.borderColor,Ec.config.viewSettings.borderAlpha),this.bgGraphics.drawRect(0,0,n,s),this.bgGraphics.endFill()),this.contentCont.x=this.bgGraphics.x+(this.bgGraphics.width-this.contentCont.width>>1),this.contentCont.y=this.bgGraphics.y+(this.bgGraphics.height-this.contentCont.height>>1)}createTitleBtn(t,e,i){let n=new oc;return n.text=t,n.tooltipData=e,n.data=i,this.titleBtns.push(n),this.addTitleElement(n.view),n}addTitleElement(t){this.topLevelCont.addChild(t),this.topLevelElements.push(t)}get titleVisible(){return this._titleVisible}set titleVisible(t){t!=this.titleVisible&&(this._titleVisible=t,this.commitData())}get captureVisible(){return this._captureVisible}set captureVisible(t){t!=this.captureVisible&&(this._captureVisible=t,this.commitData())}}class dc extends bl{constructor(){super(...arguments),this.prevTime=0,this.time=0,this.stepFps=0,this.fpsValues=[],this.cumulativeFpsValue=0}construction(...t){super.construction(t),this.border=new la,this.addChild(this.border),this.border.beginFill(0,.5),this.border.drawRect(0,0,Ec.config.fpsSettings.borderWidth,Ec.config.fpsSettings.borderHeight),this.border.alpha=0,this.field=new wl({color:Ec.config.fpsSettings.labelColor,size:Ec.config.fpsSettings.labelSize}),this.addChild(this.field),this.field.text=M.substituteList(Ec.config.localization.fpsText,"00"),this.field.x=Ec.config.fpsSettings.fieldToBorderPadding,this.field.y=Ec.config.fpsSettings.fieldToBorderPadding,this.field.width=this.border.width-2*Ec.config.fpsSettings.fieldToBorderPadding,this.field.height=this.border.height-2*Ec.config.fpsSettings.fieldToBorderPadding}onAddedToStage(){super.onAddedToStage(),this.checkFps()}checkFps(){if(!this.stage)return;this.time=Date.now();let t=this.time-this.prevTime;if(this.stepFps=h.roundTo(1e3/t,.1),this.fpsValues.length>=Ec.config.fpsSettings.cumulativeFpsCount){let t=this.fpsValues.shift();this.cumulativeFpsValue-=t}this.fpsValues.push(this.stepFps),this.cumulativeFpsValue+=this.stepFps,(!this.cumulativeFpsValue||this.cumulativeFpsValue<0)&&(this.cumulativeFpsValue=0),this.field.text=M.substituteList(Ec.config.localization.fpsText,Math.floor(this.cumulativeFpsValue/this.fpsValues.length)),this.prevTime=this.time,requestAnimationFrame((()=>{this.checkFps()}))}}!function(t){t.CUSTOM_BTN_CLICK="ConsoleViewEvent.CUSTOM_BTN_CLICK"}(tc||(tc={}));class cc extends hc{construction(){if(super.construction(),this.titleVisible=!1,this.displayListBtn=this.createTitleBtn(Ec.config.localization.displayListBtnLabel,{title:Ec.config.localization.displayListBtnTooltipTitle,text:Ec.config.localization.displayListBtnTooltipText}),this.addTitleElement(new dc),Ec.config.customBtns)for(let t of Ec.config.customBtns)this.createTitleBtn(t.label,{title:t.tooltip},t);this.closeBtn=this.createTitleBtn(Ec.config.localization.closeBtnLabel,{title:Ec.config.localization.closeBtnTooltipTitle})}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.displayListBtn.view,Ol,this.onDisplayListClick),this.eventListenerHelper.addEventListener(this.closeBtn.view,Ol,this.onClose);const t=t=>{this.eventListenerHelper.addEventListener(t.view,Ol,(()=>{const e=t.data;e&&this.dispatchEvent(tc.CUSTOM_BTN_CLICK,e)}))};for(let e of this.titleBtns)t(e)}onDisplayListClick(){Ec.toggleView(Ec.displayListView)}}class uc extends o{constructor(t){super(t)}construction(t){super.construction(),this.tooltip=t,this.mouseShift=new ze,this.tooltipInsideCont=new bl,this.tooltipInsideCont.addChild(this.tooltip.view),this.hide()}addListeners(){super.addListeners(),Pl.instance.ticker.add(this.onTick,this)}removeListeners(){super.removeListeners(),Pl.instance.ticker.remove(this.onTick,this)}onTick(){this.update()}show(t){this.visible=!0,this.tooltip.data=t,this.update()}hide(){this.visible=!1}update(){if(!this.visible)return;if(!this.tooltipCont)return;this.tooltip;let t=Pl.instance.getGlobalInteractionPosition().clone();t.x+=this.mouseShift.x,t.y+=this.mouseShift.y,t.x<0?t.x=0:t.x+this.tooltip.view.width>Pl.instance.renderer.width&&(t.x=Pl.instance.renderer.width-this.tooltip.view.width),t.y<0?t.y=0:t.y+this.tooltip.view.height>Pl.instance.renderer.height&&(t.y=Pl.instance.renderer.height-this.tooltip.view.height),t=this.tooltip.view.parent.toLocal(t),this.moveTooltipTo(t.x,t.y)}moveTooltipTo(t,e){this.tooltip.view.x=t,this.tooltip.view.y=e}get tooltipCont(){return this._tooltipCont}set tooltipCont(t){this.tooltipCont!=t&&(this._tooltipCont=t,this.tooltipCont&&this.tooltipCont.addChild(this.tooltipInsideCont),this.update())}get mouseShift(){return this._mouseShift}set mouseShift(t){this._mouseShift=t.clone(),this.update()}get visible(){return this._visible}set visible(t){this._visible=t,this.tooltipInsideCont.visible=this.visible}}uc.SHOW_DELAY=.5;class pc extends o{construction(){super.construction(),this.view=new bl}commitData(){super.commitData(),this.tooltipData=this.data}}class fc extends pc{constructor(){super()}construction(){super.construction(),this.bg=new la,this.view.addChild(this.bg),this.contentCont=new bl,this.view.addChild(this.contentCont),this.titleLabel=new wl({autosize:!0,color:Ec.config.tooltipSettings.titleLabelColor,size:Ec.config.tooltipSettings.titleLabelSize,align:nd.CENTER}),this.contentCont.addChild(this.titleLabel),this.textLabel=new wl({autosize:!0,color:Ec.config.tooltipSettings.textLabelColor,size:Ec.config.tooltipSettings.textLabelSize,align:nd.CENTER}),this.contentCont.addChild(this.textLabel)}commitData(){super.commitData(),this.tooltipData&&(this.titleLabel.text=this.tooltipData.title,this.textLabel.text=this.tooltipData.text,this.tooltipData.text?this.textLabel.visible=!0:this.textLabel.visible=!1,this.arrange())}arrange(){if(super.arrange(),this.textLabel.visible){let t=Math.max(this.titleLabel.width,this.textLabel.width);this.titleLabel.x=t-this.titleLabel.width>>1,this.textLabel.x=t-this.textLabel.width>>1,this.textLabel.y=this.titleLabel.y+this.titleLabel.height}else this.titleLabel.x=0;this.bg.clear(),this.bg.beginFill(Ec.config.tooltipSettings.bgColor,Ec.config.tooltipSettings.bgAlpha),this.bg.lineStyle(Ec.config.tooltipSettings.borderWidth,Ec.config.tooltipSettings.borderColor,Ec.config.tooltipSettings.borderAlpha),this.bg.drawRect(0,0,this.contentCont.width+Ec.config.tooltipSettings.bgToContentShift.x,this.contentCont.height+Ec.config.tooltipSettings.bgToContentShift.y),this.bg.endFill(),this.contentCont.x=this.bg.x+(this.bg.width-this.contentCont.width>>1),this.contentCont.y=this.bg.y+(this.bg.height-this.contentCont.height>>1)}}class gc extends bl{}class mc{static getNextGlobalVarName(){const t=A.getUniqueIdForPool(Ec.config.displayListSettings.globalVarPoolId);return M.substituteList(Ec.config.displayListSettings.globalVarNamePattern,t)}static storeObjectAsGlobalVar(t){const e=mc.getNextGlobalVarName();console.log(e),window[e]=t}}class vc extends bl{constructor(){super(),this._text="",this.isVisualControlsEnabled=!1}construction(){super.construction(),this.contentCont=new bl,this.addChild(this.contentCont),this.contentCont.interactive=!0,this.contentCont.cursor="pointer",this.field=new wl({autosize:!0,color:Ec.config.displayListSettings.hierarchyLabelColor,size:Ec.config.displayListSettings.hierarchyLabelSize}),this.contentCont.addChild(this.field),this.tooltipData={title:Ec.config.localization.displayListItemTooltipTitle},this.commitData(),this.onOut()}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.contentCont,Bl,this.onOver),this.eventListenerHelper.addEventListener(this.contentCont,Fl,this.onOut),this.eventListenerHelper.addEventListener(this.contentCont,Ol,this.onClick),this.eventListenerHelper.addEventListener(this.contentCont,kl,this.onOut)}onOver(){this.field.color=Ec.config.displayListSettings.hierarchyLabelColorOver,Ec.tooltipManager.show(this.tooltipData)}onOut(){this.field.color=Ec.config.displayListSettings.hierarchyLabelColor,Ec.tooltipManager.hide()}onClick(){this.onOut(),console.log(this.data.object),mc.storeObjectAsGlobalVar(this.data.object),this.isVisualControlsEnabled&&(this.data.object.visible=!this.data.object.visible)}commitData(){super.commitData(),this.field.text=this.text,this.arrange()}arrange(){super.arrange()}get text(){return this._text}set text(t){t!=this.text&&(this._text=t,this.commitData())}}class _c extends oc{addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(Zl.instance,Xl,this.onKeyUp),Pl.instance.ticker.add(this.onTick,this)}onTick(){this.isClicked}onClick(){super.onClick(),this.isClicked=!this.isClicked,this.isClicked&&(this.pauseKeyCode=null,this.isActivated=!1)}onKeyUp(t){this.view.worldVisible&&(this.isClicked?(this.isClicked=!1,this.pauseKey=t.nativeKeyboardEvent.key,this.pauseKeyCode=t.nativeKeyboardEvent.code,this.commitData()):this.pauseKeyCode&&this.pauseKeyCode===t.nativeKeyboardEvent.code&&(this.isActivated=!this.isActivated))}commitData(){super.commitData(),this.isClicked?this.text=Ec.config.localization.pauseUpdateKeyBtnPressedLabel:this.pauseKeyCode?this.isActivated?this.text=M.substitute(Ec.config.localization.pauseUpdateKeyBtnNormalLabel,{key:this.pauseKey,status:Ec.config.localization.onStatus}):this.text=M.substitute(Ec.config.localization.pauseUpdateKeyBtnNormalLabel,{key:this.pauseKey,status:Ec.config.localization.offStatus}):this.text=M.substitute(Ec.config.localization.pauseUpdateKeyBtnNormalLabel,{key:Ec.config.localization.pauseUpdateKeyBtnNoKeyHelpText})}arrange(){super.arrange()}get isClicked(){return this._isClicked}set isClicked(t){t!=this.isClicked&&(this._isClicked=t,this.commitData())}get pauseKeyCode(){return this._pauseKeyCode}set pauseKeyCode(t){t!==this._pauseKeyCode&&(this._pauseKeyCode=t,this.commitData())}get isActivated(){return this._isActivated}set isActivated(t){t!==this.isActivated&&(this._isActivated=t,this.commitData())}}class yc extends hc{constructor(){super()}construction(){super.construction(),this.captureVisible=!0,this.pauseVisible=!0,this.lastCheckedPos=new ze,this.moveObjectIndex=-1,this.titleLabel.text=Ec.config.localization.displayListTitle,this.insideContentCont.visible=!0,this.pauseKeyBtn=new _c,this.insideContentCont.addChild(this.pauseKeyBtn.view),this.pauseKeyBtn.view.y=5,this.pauseKeyBtn.tooltipData={title:Ec.config.localization.pauseUpdateKeyBtnTooltipTitle},this.ignoreConsoleBtn=new oc,this.insideContentCont.addChild(this.ignoreConsoleBtn.view),this.ignoreConsoleBtn.tooltipData={title:Ec.config.localization.ignoreInfoBtnTooltipTitle,text:Ec.config.localization.ignoreInfoBtnTooltipText},this.ignoreConsoleBtn.field.size=Ec.config.btnSettings.smallSize,this.ignoreConsoleBtn.view.y=this.pauseKeyBtn.view.y+this.pauseKeyBtn.view.height+5,this.additionalInfoBtn=new oc,this.insideContentCont.addChild(this.additionalInfoBtn.view),this.additionalInfoBtn.tooltipData={title:Ec.config.localization.additionalInfoBtnTooltipTitle,text:Ec.config.localization.additionalInfoBtnTooltipText},this.additionalInfoBtn.field.size=Ec.config.btnSettings.smallSize,this.additionalInfoBtn.view.y=this.ignoreConsoleBtn.view.y+this.ignoreConsoleBtn.view.height,this.visualControlsBtn=new oc,this.insideContentCont.addChild(this.visualControlsBtn.view),this.visualControlsBtn.tooltipData={title:Ec.config.localization.visualControlsBtnTooltipTitle,text:Ec.config.localization.visualControlsBtnTooltipText},this.visualControlsBtn.field.size=Ec.config.btnSettings.smallSize,this.visualControlsBtn.view.y=this.additionalInfoBtn.view.y+this.additionalInfoBtn.view.height,this.moveHelperBtn=new oc,this.insideContentCont.addChild(this.moveHelperBtn.view),this.moveHelperBtn.tooltipData={title:Ec.config.localization.moveHelperTooltipTitle,text:Ec.config.localization.moveHelperTooltipText},this.moveHelperBtn.field.size=Ec.config.btnSettings.smallSize,this.moveHelperBtn.view.y=this.visualControlsBtn.view.y+this.visualControlsBtn.view.height,this.displayListField=new wl({autosize:!0,color:Ec.config.displayListSettings.hierarchyLabelColor,size:Ec.config.displayListSettings.hierarchyLabelSize}),this.insideContentCont.addChild(this.displayListField),this.displayListField.y=this.moveHelperBtn.view.y+this.moveHelperBtn.view.height+5,this.displayListField.visible=!1,this.displayListItemsPool=new R,this.displayListItemsCont=new bl,this.insideContentCont.addChild(this.displayListItemsCont),this.displayListItemsCont.y=this.moveHelperBtn.view.y+this.moveHelperBtn.view.height+5,this.closeBtn=this.createTitleBtn(Ec.config.localization.closeBtnLabel,{title:Ec.config.localization.closeBtnTooltipTitle}),this.captureKeyBtn.tooltipData.text=Ec.config.localization.captureKeyBtnTooltipText,Ec.config.displayListSettings.defaultCaptureKeyCode&&(this.captureKeyBtn.captureKey=Ec.config.displayListSettings.defaultCaptureKey,this.captureKeyBtn.captureKeyCode=Ec.config.displayListSettings.defaultCaptureKeyCode),Ec.config.displayListSettings.defaultPauseKeyCode&&(this.pauseKeyBtn.pauseKey=Ec.config.displayListSettings.defaultPauseKey,this.pauseKeyBtn.pauseKeyCode=Ec.config.displayListSettings.defaultPauseKeyCode),this.isIgnoreConsoleEnabled=Ec.config.displayListSettings.defaultIgnoreConsoleEnabled,this.isAdditionalInfoEnabled=Ec.config.displayListSettings.defaultAdditionalInfoEnabled,this.isVisualControlsEnabled=Ec.config.displayListSettings.defaultVisualControlsEnabled,this.isMoveHelperEnabled=Ec.config.displayListSettings.defaultMoveHelperEnabled}destruction(){super.destruction(),this.lastUnderPointData=null,this.lastAllObjectsUnderPointList=null,this.moveObject&&(this.moveObject=null),this.prevMoveObject=null}addListeners(){super.addListeners(),Pl.instance.ticker.add(this.onTick,this),this.eventListenerHelper.addEventListener(this.closeBtn.view,Ol,this.onClose),this.eventListenerHelper.addEventListener(this.additionalInfoBtn.view,Ol,this.onAdditionalInfo),this.eventListenerHelper.addEventListener(this.visualControlsBtn.view,Ol,this.onVisualControls),this.eventListenerHelper.addEventListener(this.ignoreConsoleBtn.view,Ol,this.onIgnoreConsole),this.eventListenerHelper.addEventListener(this.moveHelperBtn.view,Ol,this.onMoveHelper),this.eventListenerHelper.addEventListener(Zl.instance,Wl,this.onKeyDown)}removeListeners(){super.removeListeners(),Pl.instance.ticker.remove(this.onTick,this)}onTick(){if(!this.paused&&!this.pauseKeyBtn.isActivated&&this.visible){const t=Pl.instance.getGlobalInteractionPosition();this.lastCheckedPos.x=t.x,this.lastCheckedPos.y=t.y;let e=null;this.isIgnoreConsoleEnabled&&(e=t=>!(t instanceof gc));let i=Rl.getObjectsUnderPoint(Pl.instance.stage,t.x,t.y,e);!this.forceUpdateUnderPointView&&this.checkUnderPointDataEqual(i,this.lastUnderPointData)||(this.forceUpdateUnderPointView=!1,this.lastUnderPointData=i,this.lastAllObjectsUnderPointList=[],this.parseUnderPointDataToSingleList(this.lastUnderPointData,this.lastAllObjectsUnderPointList),this.commitDisplayListData())}}onCapture(){super.onCapture(),console.group(Ec.config.localization.displayListStructureLogTitle),this.groupLogUnderPointData(this.lastUnderPointData),console.groupEnd()}onIgnoreConsole(){this.isIgnoreConsoleEnabled=!this.isIgnoreConsoleEnabled}onAdditionalInfo(){this.isAdditionalInfoEnabled=!this.isAdditionalInfoEnabled}onVisualControls(){this.isVisualControlsEnabled=!this.isVisualControlsEnabled}onMoveHelper(){this.isMoveHelperEnabled=!this.isMoveHelperEnabled}onKeyDown(t){if(this.isMoveHelperEnabled){let e=t.nativeKeyboardEvent.code;if(t.nativeKeyboardEvent.ctrlKey)this.moveObjectIndex--,this.commitData();else if(-1!=yc.ARROW_KEY_CODES.indexOf(e)&&this.moveObject){let i=0,n=0;e==ud?i=-1:e==pd&&(i=1),e==dd?n=-1:e==cd&&(n=1),t.nativeKeyboardEvent.shiftKey&&(i*=10,n*=10),this.moveObject.x+=i,this.moveObject.y+=n,console.log("Movable object: ",this.moveObject),console.log("x: "+this.moveObject.x+", y: "+this.moveObject.y)}}}parseUnderPointDataToText(t,e=""){let i="";if(t&&t.object){let n=t.object.toString();if(t.object.constructor&&(n=d.getConstructorName(t.object.constructor)),i+=e+" "+n,Ec.config.displayListSettings.nameParamName&&t.object[Ec.config.displayListSettings.nameParamName]&&(i+=" ("+t.object[Ec.config.displayListSettings.nameParamName]+")"),this.isMoveHelperEnabled&&t.object==this.moveObject&&(i+=" "+Ec.config.localization.movableObjectText),this.isAdditionalInfoEnabled&&Ec.config.displayListSettings.additionalInfoParams){let e,n;i+=" - { ";let s,r,o=Object.keys(Ec.config.displayListSettings.additionalInfoParams),a=o.length;for(let l=0;l<a;l++)s=o[l],void 0!==t.object[s]&&(l>0&&(i+=", "),e=t.object[s],n=Ec.config.displayListSettings.additionalInfoParams[s],(n.toFixed||0===n.toFixed)&&e!==Math.floor(e)&&(e=e.toFixed(n.toFixed)),r=s,n.visualName&&(r=n.visualName),i+=r+": "+e);i+=" }"}if(t.children&&t.children.length>0){let n="- "+e,s=t.children.length;for(let e=0;e<s;e++)i+="\n"+this.parseUnderPointDataToText(t.children[e],n)}}return i}parseUnderPointDataToVisualItemsList(t,e=""){let i=[];if(t&&t.object){let n=t.object.toString();t.object.constructor&&(n=d.getConstructorName(t.object.constructor));let s=e+" "+n;if(Ec.config.displayListSettings.nameParamName&&t.object[Ec.config.displayListSettings.nameParamName]&&(s+=" ("+t.object[Ec.config.displayListSettings.nameParamName]+")"),this.isMoveHelperEnabled&&t.object==this.moveObject&&(s+=" "+Ec.config.localization.movableObjectText),this.isAdditionalInfoEnabled&&Ec.config.displayListSettings.additionalInfoParams){let e,i;s+=" - { ";let n,r,o=Object.keys(Ec.config.displayListSettings.additionalInfoParams),a=o.length;for(let l=0;l<a;l++)n=o[l],void 0!==t.object[n]&&(l>0&&(s+=", "),e=t.object[n],i=Ec.config.displayListSettings.additionalInfoParams[n],(i.toFixed||0===i.toFixed)&&e!==Math.floor(e)&&(e=e.toFixed(i.toFixed)),r=n,i.visualName&&(r=i.visualName),s+=r+": "+e);s+=" }"}let r=this.displayListItemsPool.getObject(vc);if(r.data=t,r.text=s,r.isVisualControlsEnabled=this.isVisualControlsEnabled,i.push(r),t.children&&t.children.length>0){let n="- "+e,s=t.children.length;for(let e=0;e<s;e++)i.push(...this.parseUnderPointDataToVisualItemsList(t.children[e],n))}}return i}groupLogUnderPointData(t,e=""){if(t&&t.object){const i=d.getConstructorName(t.object);let n=e;if(i&&(n=e+" "+i),console.log(n,t.object),t.children&&t.children.length>0){let i=t.children.length;for(let n=0;n<i;n++)this.groupLogUnderPointData(t.children[n],"    "+e)}}}checkUnderPointDataEqual(t,e){let i=!0;if(!!t!=!!e)i=!1;else if(t&&e)if(t.object!=e.object)i=!1;else if(!!t.children!=!!e.children)i=!1;else if(t.children&&e.children)if(t.children.length!=e.children.length)i=!1;else{let n=t.children.length;for(let s=0;s<n;s++)if(!this.checkUnderPointDataEqual(t.children[s],e.children[s])){i=!1;break}}return i}parseUnderPointDataToSingleList(t,e){if(t&&t.object&&(e.push(t.object),t.children&&t.children.length>0)){let i=t.children.length;for(let n=0;n<i;n++)this.parseUnderPointDataToSingleList(t.children[n],e)}}get isAdditionalInfoEnabled(){return this._isAdditionalInfoEnabled}set isAdditionalInfoEnabled(t){t!=this._isAdditionalInfoEnabled&&(this._isAdditionalInfoEnabled=t,this.commitData())}get isVisualControlsEnabled(){return this._isVisualControlsEnabled}set isVisualControlsEnabled(t){t!=this._isVisualControlsEnabled&&(this._isVisualControlsEnabled=t,this.commitData())}get isMoveHelperEnabled(){return this._isMoveHelperEnabled}set isMoveHelperEnabled(t){t!=this._isMoveHelperEnabled&&(this._isMoveHelperEnabled=t,this.commitData())}get isIgnoreConsoleEnabled(){return this._isIgnoreConsoleEnabled}set isIgnoreConsoleEnabled(t){t!=this._isIgnoreConsoleEnabled&&(this._isIgnoreConsoleEnabled=t,this.commitData())}commitData(){super.commitData(),this.commitDisplayListData(),this.visible||(this.isAdditionalInfoEnabled=!1,this.isMoveHelperEnabled=!1,this.isVisualControlsEnabled=!1),this.pauseKeyBtn&&(this.pauseKeyBtn.view.visible=this.pauseVisible),this.ignoreConsoleBtn&&(this.isIgnoreConsoleEnabled?this.ignoreConsoleBtn.text=Ec.config.localization.ignoreInfoBtnPressedLabel:this.ignoreConsoleBtn.text=Ec.config.localization.ignorelInfoBtnNormalLabel),this.additionalInfoBtn&&(this.isAdditionalInfoEnabled?this.additionalInfoBtn.text=Ec.config.localization.additionalInfoBtnPressedLabel:this.additionalInfoBtn.text=Ec.config.localization.additionalInfoBtnNormalLabel),this.visualControlsBtn&&(this.isVisualControlsEnabled?this.visualControlsBtn.text=Ec.config.localization.visualControlsBtnPressedLabel:this.visualControlsBtn.text=Ec.config.localization.visualControlsBtnNormalLabel),this.moveHelperBtn&&(this.isMoveHelperEnabled?(this.moveHelperBtn.text=Ec.config.localization.moveHelperBtnPressedLabel,(this.moveObjectIndex<-1||this.moveObjectIndex>=this.lastAllObjectsUnderPointList.length)&&(this.moveObjectIndex=this.lastAllObjectsUnderPointList.length-1),this.lastAllObjectsUnderPointList[this.moveObjectIndex]?this.moveObject=this.lastAllObjectsUnderPointList[this.moveObjectIndex]:this.moveObject=null):(this.moveHelperBtn.text=Ec.config.localization.moveHelperBtnNormalLabel,this.moveObject=null,this.moveObjectIndex=-1),this.prevMoveObject!==this.moveObject&&(this.forceUpdateUnderPointView=!0),this.prevMoveObject=this.moveObject)}commitDisplayListData(){if(!this.lastUnderPointData)return;let t=this.parseUnderPointDataToText(this.lastUnderPointData);this.displayListField.text=t,this.clearDisplayListItems();let e=this.parseUnderPointDataToVisualItemsList(this.lastUnderPointData);this.createDisplayListItems(e),this.arrange()}get pauseVisible(){return this._pauseVisible}set pauseVisible(t){t!=this.pauseVisible&&(this._pauseVisible=t,this.commitData())}clearDisplayListItems(){let t=this.displayListItemsCont.children.length;for(let e=0;e<t;e++){let t=this.displayListItemsCont.children[e];this.displayListItemsPool.addObject(t,vc)}Gl.removeAllChildren(this.displayListItemsCont)}createDisplayListItems(t){let e,i=t.length;for(let n=0;n<i;n++){let i=t[n];this.displayListItemsCont.addChild(i),i.y=e?e.y+e.height:0,e=i}}}yc.ARROW_KEY_CODES=[ud,pd,dd,cd];class Ec{static startInit(t,e){I.log("FConsole Class (FC): ",Ec);const i=new rc;e&&d.copyProps(i,e),Ec.config=i,Ec.eventListenerHelper=new r(Ec),Ec.contentCont=new gc,Ec.viewsCont=new bl,Ec.contentCont.addChild(Ec.viewsCont),Ec.tooltipsCont=new bl,Ec.contentCont.addChild(Ec.tooltipsCont);let n=new fc;Ec.tooltipManager=new uc(n),Ec.tooltipManager.tooltipCont=Ec.tooltipsCont,Ec.tooltipManager.mouseShift=new ze(10,15),Ec.view=new cc,Ec.hideView(Ec.view),Ec.displayListView=new yc,Ec.eventListenerHelper.addEventListener(Zl.instance,Wl,(t=>{t.nativeKeyboardEvent.key.toUpperCase()===Ec.config.password.charAt(Ec.passwordInputIndex).toUpperCase()?(Ec.passwordInputIndex++,Ec.passwordInputIndex>=Ec.config.password.length&&(Ec.onPasswordInput(),Ec.passwordInputIndex=0)):Ec.passwordInputIndex=0})),Pl.instance.ticker.add(Ec.onTicker),Ec.root=t,Ec.visible=Ec.config.console.defaultVisible}static onTicker(){Ec.config.console.aboveAll&&Gl.moveObjectToTopLayer(Ec.contentCont)}static onPasswordInput(){Ec.visible=!Ec.visible}static get visible(){return Ec.view.visible}static set visible(t){t?(Ec.showView(Ec.view,!1),Gl.moveObjectToTopLayer(Ec.viewsCont),Gl.moveObjectToTopLayer(Ec.tooltipsCont),Ec.config.displayListSettings.defaultVisible&&Ec.showView(Ec.displayListView)):Ec.hideView(Ec.view)}static showView(t,e=!0){if(Ec.viewsCont.addChild(t.view),t.visible=!0,Ec.moveViewToTopLayer(t),e){const e=Pl.instance.getGlobalInteractionPosition();let i=t.view.parent.toLocal(new ze(e.x+1,e.y+1));t.view.x=i.x,t.view.y=i.y}}static hideView(t){t.view.parent&&t.view.parent.removeChild(t.view),t.visible=!1}static toggleView(t,e=!0){t.visible?Ec.hideView(t):Ec.showView(t,e)}static moveViewToTopLayer(t){Gl.moveObjectToTopLayer(t.view)}static get root(){return Ec._root}static set root(t){Ec.root&&Ec.root.removeChild(Ec.contentCont),Ec._root=t,Ec.root&&Ec.root.addChild(Ec.contentCont)}}Ec.passwordInputIndex=0;const bc={debug:{fconsole:{console:{defaultVisible:!0}}}};class Ac extends Ad{init(){super.init(),kd().initializeWith(bc)}activateCompleteHook(){super.activateCompleteHook();const t=kd().getState();Ec.startInit(Pl.instance.stage,t.debug.fconsole),I.addLoggerItem(new C)}}const Tc={device:class{static getDeviceInfo(t){var e,i;let n=D.DESKTOP;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))n=D.MOBILE;else{/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(t)&&(n=D.TABLET)}let s=1;window.devicePixelRatio&&(s=window.devicePixelRatio);const r=(null===(i=null===(e=window.navigator)||void 0===e?void 0:e.userAgentData)||void 0===i?void 0:i.platform)||window.navigator.platform,o=[];navigator.languages&&o.push(...navigator.languages),navigator.language&&-1===o.indexOf(navigator.language)&&o.push(navigator.language);let a,l="";if(o.length>0){l=o[0].split("-")[0].toLowerCase()}-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(r)?a=O.MAC_OS:-1!==["iPhone","iPad","iPod"].indexOf(r)?a=O.IOS:-1!==["Win32","Win64","Windows","WinCE"].indexOf(r)?a=O.WINDOWS:/Android/.test(t)?a=O.ANDROID:/Linux/.test(r)&&(a=O.LINUX);let h={deviceType:n,pixelRatio:s,isFullScreenApiAvailable:!1,osType:a,mainLocale:l,languages:o};try{h.isFullScreenApiAvailable=B.isEnabled}catch(t){console.log("ERROR! DeviceTools | getDeviceInfo __ error: ",t)}return h}}.getDeviceInfo(navigator.userAgent)};class xc extends Ad{init(){super.init(),kd().initializeWith(Tc)}}class Sc extends Cd{bindCommand(t,e,i){this.eventListenerHelper.addEventListener(this.globalDispatcher,t,((...t)=>{i&&!i(...t)||jh(e,...t).execute()}))}}class wc extends Ad{init(){super.init(),Wh(Sd,{isSingleton:!0}),Wh(Sc,{isSingleton:!0})}}var Cc,Ic;!function(t){t.FOCUS_RECEIVED="HTMLManagerEvent.FOCUS_RECEIVED",t.FOCUS_LOST="HTMLManagerEvent.FOCUS_LOST"}(Cc||(Cc={}));class Rc extends Cd{constructor(){super(...arguments),this.soundsManager=jh(yd),this.isFirstClickComplete=!1,this.blurLocker={id:"HTMLManager.blurLocker"},this.visibilityLocker={id:"HTMLManager.visibilityLocker"}}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(document,"click",this.onInteraction),this.eventListenerHelper.addEventListener(document,"touchend",this.onInteraction),this.eventListenerHelper.addEventListener(window,"focus",this.onFocus),this.eventListenerHelper.addEventListener(window,"blur",this.onBlur),this.eventListenerHelper.addEventListener(document,"visibilitychange",this.onVisibilityChange)}onInteraction(){this.isFirstClickComplete||(this.isFirstClickComplete=!0,this.soundsManager.activate(),this.onFocus())}onVisibilityChange(){console.log("HTML MANAGER | onVisibilityChange __ document.visibilityState: "+document.visibilityState),"visible"===document.visibilityState?this.soundsManager.removeDisableLock(this.visibilityLocker):this.soundsManager.addDisableLock(this.visibilityLocker)}onFocus(t){console.log("HTML MANAGER | onFocus"),this.soundsManager.removeDisableLock(this.blurLocker),this.dispatchEvent(Cc.FOCUS_RECEIVED)}onBlur(t){console.log("HTML MANAGER | onBlur"),this.soundsManager.addDisableLock(this.blurLocker),this.dispatchEvent(Cc.FOCUS_LOST)}}class Pc extends Ad{init(){super.init(),Wh(Rc,{isSingleton:!0,forceCreation:!0})}}class Lc extends u{construction(...t){super.construction(...t),this.globalDispatcher=jh(Sd)}dispatchEvent(t,...e){super.dispatchEvent(t,...e),this.globalDispatcher.dispatchEvent(t,...e)}}class Mc extends Lc{executeInternal(){new yh({src:Nd,id:Nd}).execute().then((t=>{console.log("LoadAppConfigCommand | executeInternal __ data: ",t),kd().change()("app.config",t);const e=kd().getMutableState(),i=kd().getState();jh(Hh).addSubstituteParams({locale:e.device.mainLocale}),t.files&&new Eh(i.app.config.files).execute(),this.notifyComplete()}),(()=>{const t="LoadAppConfigCommand | executeInternal __ ERROR! Can't load the app-config.json file!";console.error(t),alert(t),this.errorCode=l.GENERAL_ERROR,this.terminate()}))}}!function(t){t.CONFIG="config",t.PRELOAD="preload",t.INIT="init"}(Ic||(Ic={}));class Dc extends Lc{constructor(t){super(),this.pageId=t}executeInternal(){kd().change()("pages.pageId",this.pageId),this.notifyComplete()}}const Oc="InitApplicationDataEvent.INTI_APPLICATION_DATA_COMPLETE";class kc extends Lc{executeInternal(){this.notifyComplete()}notifyComplete(t,e){this.dispatchEvent(Oc),super.notifyComplete(t,e)}}var Bc;!function(t){t.UPDATE="TimeManagerEvent.UPDATE"}(Bc||(Bc={}));const Fc="EntitiesQueryEvent.ENTITY_ADDED",Nc="EntitiesQueryEvent.ENTITY_REMOVED";class Gc extends o{constructor(t,e=[]){super(),this.includeTypes=t,this.excludeTypes=e,this._entities=[]}get entities(){return this._entities}addEntity(t){-1===this._entities.indexOf(t)&&(this._entities.push(t),this.dispatchEvent(Fc,t))}removeEntity(t){-1!==this._entities.indexOf(t)&&(c.removeItem(this._entities,t),this.dispatchEvent(Nc,t))}}class Uc extends Cd{constructor(){super(...arguments),this.entitiesList=[],this.entitiesToIdMap={},this.queriesToTypesMap={},this.queriesList=[],this.systemsList=[],this.entitiesUniquePoolId="ecsEntitiesUniquePool",this.entities={get:t=>this.entitiesToIdMap[t],getAll:()=>this.entitiesList.concat(),create:t=>{const e=Object.assign(Object.assign({},t),{id:A.getUniqueIdForPool(this.entitiesUniquePoolId)});return this.entities.add(e),e},add:t=>{-1===this.entitiesList.indexOf(t)&&(this.entitiesList.push(t),this.entitiesToIdMap[t.id]=t,this.addEntityToQueries(t))},remove:t=>{c.removeItem(this.entitiesList,t),delete this.entitiesToIdMap[t.id],this.removeEntityFromAllQueries(t)},addComponents:(t,...e)=>{for(let i of e)t.components[i.type]=i;this.updateAllQueriesForEntity(t)},removeComponents:(t,...e)=>{for(let i of e)delete t.components[i];this.updateAllQueriesForEntity(t)}},this.queries={get:(t,e)=>{var i;const n=t.concat().sort().join();let s="";e&&(s=e.concat().sort().join());let r=null===(i=this.queriesToTypesMap[n])||void 0===i?void 0:i[s];return r||(r=new Gc(t,e),this.queriesToTypesMap[n]||(this.queriesToTypesMap[n]={}),this.queriesToTypesMap[n][s]=r,this.queriesList.push(r),this.updateAllEntitiesForQuery(r)),r}},this.systems={add:t=>{-1===this.systemsList.indexOf(t)&&this.systemsList.push(t)}}}construction(...t){super.construction(...t),this.timeState=kd().getState()}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.globalDispatcher,Bc.UPDATE,this.onTimeUpdate)}onTimeUpdate(){this.update(this.timeState.time.lastTimeDelta)}addEntityToQueries(t,e){e||(e=this.queriesList);for(let i of e)if(-1===i.entities.indexOf(t)){let e=!0;for(let n of i.includeTypes)if(!t.components[n]){e=!1;break}let n=!1;if(e)for(let e of i.excludeTypes)if(t.components[e]){n=!0;break}e&&!n&&i.addEntity(t)}}removeEntityFromAllQueries(t){for(let e of this.queriesList)e.removeEntity(t)}updateAllQueriesForEntity(t){this.removeEntityFromAllQueries(t),this.addEntityToQueries(t)}updateAllEntitiesForQuery(t){for(let e of this.entitiesList)this.addEntityToQueries(e,[t])}update(t){for(let e of this.systemsList)e.update(t)}}class Hc extends wd{onActivatorStart(t){this.activator=t}onActivatorEnd(){this.destruction()}addActivatorListener(t,e){this.eventListenerHelper.addEventListener(this.activator,t,e)}}class Vc extends Lc{executeInternal(){let t=jh(Hh).getLoadItem(Hd);if(t&&t.data){if(t.data){if(t.data.entities){const e=jh(Uc);for(let i of t.data.entities)e.entities.add(i)}if(t.data.items){jh(Jh).commitItems(t.data.items)}if(t.data.state){const e=Object.keys(t.data.state);for(let i of e)kd().change()(i,t.data.state[i])}}this.notifyComplete()}else console.error("ParseStaticItemsCommand | executeInternal __ ERROR! Can't find config file!"),this.errorCode=l.GENERAL_ERROR,this.terminate()}}class zc extends Lc{executeInternal(){let t=jh(Hh).getLoadItem(Ud);if(t&&t.data){let e=t.data,i=jh(Yh);kd().getState();let n=Object.keys(e);for(let t of n){const n=e[t];i.addLocaleTexts(n,t)}this.notifyComplete()}else console.error("ParseLocalizationCommand | executeInternal __ ERROR! Can't find config file!"),this.terminate()}}class jc extends Lc{executeInternal(){let t=jh(Hh).getLoadItem(Gd);t&&t.data?(t.data.files&&new Eh(t.data.files).execute(),this.notifyComplete()):(console.error("ParseAssetsConfigCommand | executeInternal __ ERROR! Can't find config file!"),this.terminate())}}class Wc extends u{constructor(t){super(),this.event=t,this.globalDispatcher=jh(Sd)}executeInternal(){this.globalDispatcher.dispatchEvent(this.event),this.notifyComplete()}}const Xc="InitApplicationEvent.READY_TO_INIT_VIEW",Kc="preloaderPage";class Yc extends Lc{executeInternal(){const t=kd().getState();jh(Yh).setCurrentLocaleId(t.device.mainLocale),this.notifyComplete()}}class $c extends y{constructor(){super([jh(Mc),jh(bh,Ic.CONFIG),jh(Yc),jh(zc),jh(jc),jh(Vc),jh(bh,Ic.PRELOAD),jh(Wc,Xc),jh(kc),jh(Dc,Kc)])}}class qc extends Ad{constructor(t=""){super(),this.basePath=t}init(){super.init(),Wh(Hh,{isSingleton:!0,forceCreation:!0})}activateCompleteHook(){super.activateCompleteHook(),Gh.instance.basePath=this.basePath}}class Zc extends Ad{init(){super.init(),Wh(Rd,{isSingleton:!0,forceCreation:!0})}}class Qc extends Ad{init(){super.init(),Wh(Yh,{isSingleton:!0})}}class Jc extends Hc{onActivatorStart(t){super.onActivatorStart(t),this.eventListenerHelper.addEventListener(this.globalDispatcher,Bd()("pages.pageId"),this.onPageIdChange)}onPageIdChange(){this.activator.commitPagesData()}}const tu={pages:{pageId:"",pageIdToViewClassMap:{},activePageContentScale:{x:0,y:0}}};class eu extends Ad{init(){super.init(),kd().initializeWith(tu),Wh(Zd,{activateeConstructors:[Jc]})}}class iu extends Ad{init(){super.init(),Wh(R,{isSingleton:!0}),Wh(fd,{toSubstitute:R})}}const nu="RendererManagerEvent.PRE_RESIZE_HOOK",su="RendererManagerEvent.RESIZE";class ru{constructor(){this.antialias=!0,this.backgroundAlpha=0,this.canvasCss={position:"absolute",top:"0px",left:"0px"}}}class ou extends Cd{construction(){super.construction(),this.config=jh(ru),this.padding={top:0,bottom:0,left:0,right:0},this.config.targetFps&&(nt.TARGET_FPMS=this.config.targetFps/1e3);const t=Object.assign({},this.config);if(mu.instance.app=new Pl(t),mu.instance.app.stage.interactive=!0,this.config.canvasCss){const t=Object.keys(this.config.canvasCss);for(let e of t)mu.instance.app.renderer.view.style[e]=this.config.canvasCss[e]}let e=document.body;this.config.canvasParentElementId&&(e=document.getElementById(this.config.canvasParentElementId)),e.appendChild(mu.instance.app.view)}resize(t,e,i){let n=0;this.padding.left&&(n+=this.padding.left),this.padding.right&&(n+=this.padding.right);let s=0;this.padding.top&&(s+=this.padding.top),this.padding.bottom&&(s+=this.padding.bottom);let r=t-n,o=e-s;this.dispatchEvent(nu,new ze(r,o)),mu.instance.app.renderer.resize(r*i,o*i),mu.instance.app.renderer.view.style.width=r+"px",mu.instance.app.renderer.view.style.height=o+"px",this.padding.top&&(mu.instance.app.renderer.view.style.top=this.padding.top+"px"),this.padding.bottom&&(mu.instance.app.renderer.view.style.bottom=this.padding.bottom+"px"),this.padding.left&&(mu.instance.app.renderer.view.style.left=this.padding.left+"px"),this.padding.right&&(mu.instance.app.renderer.view.style.right=this.padding.right+"px"),this.dispatchEvent(su)}get rendererWidth(){return mu.instance.app.renderer.width}get rendererHeight(){return mu.instance.app.renderer.height}showView(){delete mu.instance.app.renderer.view.style.display}hideView(){mu.instance.app.renderer.view.style.display="none"}}class au extends Ad{init(){super.init(),Wh(ru,{isSingleton:!0}),Wh(ou,{isSingleton:!0,forceCreation:!0})}}class lu extends o{constructor(){super(...arguments),this.soundsManager=jh(yd),this.fadeInTime=.5,this.fadeOutTime=.5}changeMusic(t){this.currentMusicId!==t&&(this.stopMusic(),this.currentMusicId=t,this.currentMusic=this.soundsManager.getSound(t),this.currentMusic&&(this.currentMusic.play({loop:!0}),this.currentMusic.tweenVolume(1,this.fadeInTime)))}stopMusic(){if(!this.currentMusic)return;const t=this.currentMusic;this.currentMusic=null,this.currentMusicId=null,t.tweenVolume(0,this.fadeOutTime,(()=>{t.stop()}))}}const hu={isMutedParamId:"SoundsSettings.isMutedParamId",mutedTags:"SoundsSettings.mutedTags"};class du extends o{construction(...t){this.soundsManager=jh(yd),this.storageManager=jh(Rd),super.construction(...t)}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.soundsManager,gd.IS_MUTED_CHANGE,this.onSoundsDataChange),this.eventListenerHelper.addEventListener(this.soundsManager,gd.TAGS_IS_MUTED_CHANGE,this.onSoundsDataChange)}onSoundsDataChange(){this.commitSoundsData()}activateCompleteHook(){const t=this.storageManager.getParam(hu.isMutedParamId);!0!==t&&!1!==t||(this.soundsManager.isMuted=t);const e=this.storageManager.getParam(hu.mutedTags);if(e)for(let t of e)this.soundsManager.setTagIsMuted(t,!0);this.commitSoundsData()}commitSoundsData(){this.storageManager.setParam(hu.isMutedParamId,this.soundsManager.isMuted),this.storageManager.setParam(hu.mutedTags,this.soundsManager.getTagsMuted())}}class cu extends Ad{init(){super.init(),Wh(yd,{isSingleton:!0}),Wh(lu,{isSingleton:!0}),Wh(du,{isSingleton:!0,forceCreation:!0})}activateCompleteHook(){super.activateCompleteHook();jh(du).activateCompleteHook();const t=jh(Sd),e=jh(yd),i=Object.keys(gd);for(let n of i){const i=gd[n];this.eventListenerHelper.addEventListener(e,i,((...e)=>{t.dispatchEvent(i,...e)}))}}}const uu={time:{startTime:0,curTime:0,lastTimeDelta:0,lastTimeDeltaSec:0,minTimeDelta:0,maxTimeDelta:0}};class pu extends Cd{constructor(){super(...arguments),this.appStateStorage=kd(),this.timeModuleState=kd().getState()}addListeners(){super.addListeners(),Jn.shared.add(this.onTick,this)}removeListeners(){super.removeListeners(),Jn.shared.remove(this.onTick,this)}onTick(){const t=Date.now();let e=t-this.timeModuleState.time.curTime;this.timeModuleState.time.minTimeDelta&&e<this.timeModuleState.time.minTimeDelta||(this.timeModuleState.time.maxTimeDelta&&e>this.timeModuleState.time.maxTimeDelta&&(e=this.timeModuleState.time.maxTimeDelta),this.appStateStorage.change()("time.curTime",t),this.appStateStorage.change()("time.lastTimeDelta",e),this.appStateStorage.change()("time.lastTimeDeltaSec",e/1e3),this.dispatchEvent(Bc.UPDATE))}}class fu extends Ad{init(){super.init(),kd().initializeWith(uu),Wh(pu,{isSingleton:!0,forceCreation:!0})}}var gu=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};class mu extends o{constructor(t){super(t)}construction(t){const e=Object.create(null,{construction:{get:()=>super.construction}});return gu(this,void 0,void 0,(function*(){e.construction.call(this,t),this.options=t,mu._instance=this,this.options.debug&&(window.Facade=this),zh.startInit({debug:this.options.debug}),this.addModules(),yield this.activateModules(),this.rendererManager=jh(ou),this.initApp()}))}addModules(){this.modulesManager=new ic,this.addSingleModule(new wc),this.addSingleModule(new Od),this.addSingleModule(new jd(this.options.debug)),this.addSingleModule(new iu),this.addSingleModule(new xc),this.addSingleModule(new au),this.addSingleModule(new Zc),this.addSingleModule(new qc),this.addSingleModule(new cu),this.addSingleModule(new Pc),this.addSingleModule(new Qc),this.addSingleModule(new eu),this.addSingleModule(new fu),this.addSingleModule(new sc),this.options.debug&&this.addSingleModule(new Ac)}activateModules(){return gu(this,void 0,void 0,(function*(){this.modulesManager.initModules(),zh.activate(),yield this.modulesManager.activateModules()}))}addSingleModule(t){this.modulesManager.addModule(t)}onReadyToInitView(){this.initView()}initView(){this.mainContainer=jh(Jd),Pl.instance.stage.addChild(this.mainContainer),this.onWindowResize(),this.onRendererResize()}addListeners(){super.addListeners(),this.resizeListener=()=>{this.onWindowResize(),setTimeout((()=>{this.onWindowResize()}),100)},window.addEventListener("resize",this.resizeListener);const t=jh(Sd);this.eventListenerHelper.addEventListener(t,su,this.onRendererResize),this.eventListenerHelper.addEventListener(t,Xc,this.onReadyToInitView)}removeListeners(){super.removeListeners(),window.removeEventListener("resize",this.resizeListener)}onWindowResize(){const t=zl.getDocumentSize(),e=kd().getState();this.rendererManager&&this.rendererManager.resize(t.x,t.y,e.device.pixelRatio)}onRendererResize(){this.arrange()}initApp(){return gu(this,void 0,void 0,(function*(){yield jh($c).execute()}))}readyToInitView(){this.initView()}arrange(){this.mainContainer&&this.rendererManager&&this.mainContainer.resize(this.rendererManager.rendererWidth,this.rendererManager.rendererHeight)}static init(t){t||(t={});let e=t.FacadeClass;e||(e=mu),new e(t)}static get instance(){if(mu._instance)return mu._instance;console.error("ERROR! Facade should be prepared via the Facade.init method before used via Facade.instance!")}}function vu(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))}Object.create;Object.create;class _u extends wd{constructor(t,e=[]){super(t,e),this.ecsManager=jh(Uc)}construction(t,e=[]){super.construction(),this.ecsManager=jh(Uc),this.includeTypes=t,this.excludeTypes=e,this.query=this.ecsManager.queries.get(this.includeTypes,this.excludeTypes)}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.query,Fc,this.onEntityAdded),this.eventListenerHelper.addEventListener(this.query,Nc,this.onEntityRemoved)}onEntityAdded(t){}onEntityRemoved(t){}update(t){}}const yu="render";class Eu extends _u{constructor(){super([yu])}construction(t,e){super.construction(t,e),this.rootContainer=new bl,this.containersManager=jh(nc),this.containersManager.addContainer(this.rootContainer,"renderRootContainer")}onEntityAdded(t){super.onEntityAdded(t);this.getContainer(t.components.render.containerId).addChild(t.components.render.view)}onEntityRemoved(t){super.onEntityAdded(t),Gl.childRemoveItselfFromParent(t.components.render.view)}getContainer(t){let e;return t&&(e=this.containersManager.getContainer(t)),e||(e=this.rootContainer),e}}class bu extends Ad{init(){super.init(),Wh(Eu,{isSingleton:!0})}activateCompleteHook(){super.activateCompleteHook();const t=jh(Eu);jh(Uc).systems.add(t)}}class Au extends Ad{init(){super.init(),Wh(Uc,{isSingleton:!0,forceCreation:!0})}}const Tu={MS_IN_SECOND:1e3,MS_IN_MINUTE:6e4,MS_IN_HOUR:36e5,MS_IN_DAY:864e5};class xu{}xu.NORMAL="normal",xu.OVER="over",xu.PRESS="press",xu.DISABLED="disabled",xu.SELECTED_NORMAL="selected_normal",xu.SELECTED_OVER="selected_over",xu.SELECTED_PRESS="selected_press",xu.SELECTED_DISABLED="selected_disabled",xu.NORMAL_TO_SELECTED_MAP=(()=>{let t={};return t[xu.NORMAL]=xu.SELECTED_NORMAL,t[xu.OVER]=xu.SELECTED_OVER,t[xu.PRESS]=xu.SELECTED_PRESS,t[xu.DISABLED]=xu.SELECTED_DISABLED,t})(),xu.SELECTED_TO_NORMAL_MAP=(()=>{let t={};return t[xu.SELECTED_NORMAL]=xu.NORMAL,t[xu.SELECTED_OVER]=xu.OVER,t[xu.SELECTED_PRESS]=xu.PRESS,t[xu.SELECTED_DISABLED]=xu.DISABLED,t})();const Su="STATE_CHANGE",wu="SELECTED_CHANGE";class Cu extends o{construction(){super.construction(),this.interactiveEventHelper=new r(this),this.state=xu.NORMAL,this.enabled=!0}destruction(){super.destruction(),this.interactiveEventHelper&&(this.interactiveEventHelper.destruction(),this.interactiveEventHelper=null)}removeListeners(){super.removeListeners(),this.removeMouseListeners()}addMouseListeners(t){t&&(this.removeMouseListeners(),this.interactiveEventHelper.addEventListener(t,Bl,this.onOver),this.interactiveEventHelper.addEventListener(t,Fl,this.onOut),this.interactiveEventHelper.addEventListener(t,Ml,this.onMouseDown),this.interactiveEventHelper.addEventListener(t,Ol,this.onTap))}removeMouseListeners(){this.isConstructed&&this.interactiveEventHelper.removeAllListeners()}onOver(){this._enabled&&(this.state=this.findStateValue(xu.OVER),this.redispatchEvent(Bl))}onOut(){this._enabled&&(this.state=this.findStateValue(xu.NORMAL),this.redispatchEvent(Fl))}onMouseDown(){this._enabled&&(this.state=this.findStateValue(xu.PRESS),this.redispatchEvent(Ml))}onTap(){this._enabled&&(this.autoToggleSelected&&(this.selected=!this.selected),this.state=this.findStateValue(xu.OVER),this.redispatchEvent(Ol))}redispatchEvent(t){this.dispatchEvent(t)}commitStateData(){this.isConstructed&&this.commitEnabledData()}commitEnabledData(){this.hitArea&&(this.enabled?(this.hitArea.interactive=!0,this.hitArea.cursor="pointer"):(this.hitArea.interactive=!1,this.hitArea.cursor=null))}get state(){return this._state}set state(t){t!=this.state&&(this._state=t,this.commitStateData(),this.dispatchEvent(Su))}get selected(){return this._selected}set selected(t){t!=this.selected&&(this._selected=t,this._selected?this.state=xu.SELECTED_NORMAL:this.state=xu.NORMAL,this.dispatchEvent(wu))}get enabled(){return this._enabled}set enabled(t){t!=this.enabled&&(this._enabled=t,this._enabled?this.state=this.findStateValue(xu.NORMAL):this.state=this.findStateValue(xu.DISABLED),this.commitEnabledData())}commitData(){super.commitData(),this.isConstructed&&this.commitStateData()}get hitArea(){return this._hitArea}set hitArea(t){t!=this.hitArea&&(this.removeMouseListeners(),this._hitArea=t,this.addMouseListeners(this.hitArea),this.commitData())}findStateValue(t){let e;return e=this.selected?xu.NORMAL_TO_SELECTED_MAP[t]:xu.SELECTED_TO_NORMAL_MAP[t],e||(e=t),e}}class Iu extends Xd{constructor(t){super(t)}construction(t){super.construction(t),this._config=t,this._config||(this._config=Iu.DEFAULT_CONFIG),d.copyProps(this._config,Iu.DEFAULT_CONFIG,{ignoreExistedProperties:!0}),this.contentCont=new bl,this.addChild(this.contentCont),this.bg=new la,this.contentCont.addChild(this.bg),this.bg.beginFill(0),this.bg.drawRect(0,0,10,10),this.bg.alpha=0,this.pressView=new ws,this.contentCont.addChild(this.pressView),this.overView=new ws,this.contentCont.addChild(this.overView),this.icon=new ws,this.contentCont.addChild(this.icon),this.btn=new Cu,this.btn.hitArea=this,t.size?this.resize(t.size.x,t.size.y):this.resize(Iu.DEFAULT_SIZE.x,Iu.DEFAULT_SIZE.y),this.commitStateData()}destruction(){super.destruction(),this.btn&&this.btn.destruction()}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.btn,Su,this.onBtnStateChange),this.eventListenerHelper.addEventListener(this.btn,wu,this.onBtnSelectedChange)}onBtnStateChange(){this.commitStateData(),this.emit(Su)}onBtnSelectedChange(){this.emit(wu)}commitData(){super.commitData(),this.config.pressTextureId&&(this.pressView.texture=Xi.from(this.config.pressTextureId)),this.config.overTextureId&&(this.overView.texture=Xi.from(this.config.overTextureId)),this.config.iconTextureId&&(this.icon.texture=Xi.from(this.config.iconTextureId)),this.commitStateData()}commitStateData(){this.contentCont.visible=!0,this.pressView.visible=!1,this.overView.visible=!1;let t=1;switch(this.btn.state){case xu.NORMAL:this.config.alphaNormal&&(t=this.config.alphaNormal);break;case xu.OVER:this.config.alphaOver&&(t=this.config.alphaOver),this.overView.visible=!0;break;case xu.PRESS:this.pressView.visible=!0;break;case xu.SELECTED_NORMAL:this.config.alphaNormal&&(t=this.config.alphaNormal),this.pressView.visible=!0;break;case xu.SELECTED_OVER:this.config.alphaOver&&(t=this.config.alphaOver),this.overView.visible=!0,this.pressView.visible=!0;break;case xu.SELECTED_PRESS:this.pressView.visible=!0;break;default:this.contentCont.visible=!0}this.alpha=t,this.isConstructed&&this.arrange()}get selected(){return this.btn.selected}set selected(t){t!==this.btn.selected&&(this.btn.selected=t)}arrange(){super.arrange(),this.bg.width=this.resizeSize.x,this.bg.height=this.resizeSize.y,this.icon.scale.set(1,1),Nl.scaleObject(this.icon,this.resizeSize.x-2*this.config.iconPadding.x,this.resizeSize.y-2*this.config.iconPadding.y),this.overView.scale.set(1,1),Nl.scaleObject(this.overView,this.resizeSize.x,this.resizeSize.y),this.pressView.scale.set(1,1),Nl.scaleObject(this.pressView,this.resizeSize.x,this.resizeSize.y),this.overView.x=Math.floor(this.bg.x+(this.bg.width-this.overView.width)/2),this.overView.y=Math.floor(this.bg.y+(this.bg.height-this.overView.height)/2),this.pressView.x=Math.floor(this.bg.x+(this.bg.width-this.pressView.width)/2),this.pressView.y=Math.floor(this.bg.y+(this.bg.height-this.pressView.height)/2),this.icon.x=Math.floor(this.bg.x+(this.bg.width-this.icon.width)/2),this.icon.y=Math.floor(this.bg.y+(this.bg.height-this.icon.height)/2)}get config(){return this._config}set config(t){this._config=t,this.commitData()}}Iu.DEFAULT_CONFIG=new class{constructor(){this.iconPadding=new ze,this.iconTextureId="",this.pressTextureId="tools_press_bg.png",this.overTextureId="tools_over_bg.png"}},Iu.DEFAULT_SIZE=new ze(30,24);var Ru;!function(t){t.NORMAL="normal",t.OVER="over",t.PRESS="press",t.DISABLED="disabled",t.SELECTED_NORMAL="selected_normal",t.SELECTED_OVER="selected_over",t.SELECTED_PRESS="selected_press",t.SELECTED_DISABLED="selected_disabled"}(Ru||(Ru={}));Ru.NORMAL,Ru.SELECTED_NORMAL,Ru.OVER,Ru.SELECTED_OVER,Ru.PRESS,Ru.SELECTED_PRESS,Ru.DISABLED,Ru.SELECTED_DISABLED,Ru.SELECTED_NORMAL,Ru.NORMAL,Ru.SELECTED_OVER,Ru.OVER,Ru.SELECTED_PRESS,Ru.PRESS,Ru.SELECTED_DISABLED,Ru.DISABLED;var Pu;!function(t){t.NORMAL="normal",t.OVER="over",t.PRESS="press",t.DISABLED="disabled",t.SELECTED_NORMAL="selected_normal",t.SELECTED_OVER="selected_over",t.SELECTED_PRESS="selected_press",t.SELECTED_DISABLED="selected_disabled"}(Pu||(Pu={}));const Lu={labelConfig:null,bgConfig:{bgAlpha:.001,bgColor:0,bgLineWidth:0,bgLineColor:0,bgLineAlpha:0,bgCornerRadius:0,contentToBgPaddingX:0,contentToBgPaddingY:0,contentToBgShiftX:0,contentToBgShiftY:0},states:{normal:{alpha:.75},over:{alpha:1},press:{alpha:1},disabled:{alpha:.5}}};class Mu extends bl{layoutGetChildrenNum(){return this.children.length}layoutGetChildAt(t){return this.children[t]}}class Du extends Xd{constructor(t){super(t)}construction(t){super.construction(),this.config=d.clone(Lu),d.copyProps(this.config,t),this.bg=new la,this.addChild(this.bg),this.contentCont=new bl,this.addChild(this.contentCont),this.layoutableCont=new Mu,this.contentCont.addChild(this.layoutableCont),this.icon=new ws,this.layoutableCont.addChild(this.icon),this.label=new wl(this.config.labelConfig),this.layoutableCont.addChild(this.label),this.state=Pu.NORMAL,this.enabled=!0}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this,Bl,this.onOver),this.eventListenerHelper.addEventListener(this,Fl,this.onOut),this.eventListenerHelper.addEventListener(this,Ml,this.onDown),this.eventListenerHelper.addEventListener(this,Dl,this.onUp),this.eventListenerHelper.addEventListener(this,Ol,this.onTap),this.eventListenerHelper.addEventListener(this,kl,this.onUpOutside)}onUpOutside(){this.state=this.findStateValue(Pu.NORMAL)}onOver(){this.state=this.findStateValue(Pu.OVER)}onOut(){this.state=this.findStateValue(Pu.NORMAL)}onDown(){this.state=this.findStateValue(Pu.PRESS)}onUp(){this.state=this.findStateValue(Pu.OVER)}onTap(){this.onOut()}arrange(){if(super.arrange(),this.contentLayout&&this.contentLayout.arrange(this.layoutableCont),this.resizeSize.x&&this.resizeSize.y){this.contentCont.scale.set(1);const t=Nl.getScale(this.contentCont.width,this.contentCont.height,this.resizeSize.x,this.resizeSize.y);this.contentCont.scale.set(t)}this.updateBg(),this.contentCont.x=this.bg.x+Math.floor((this.bg.width-this.contentCont.width)/2)+this.config.bgConfig.contentToBgShiftX,this.contentCont.y=this.bg.y+Math.floor((this.bg.height-this.contentCont.height)/2)+this.config.bgConfig.contentToBgShiftY}get enabled(){return this._enabled}set enabled(t){t!==this._enabled&&(this._enabled=t,this._enabled?this.state=this.findStateValue(Pu.NORMAL):this.state=this.findStateValue(Pu.DISABLED),this.commitData())}get text(){return this.label.text}set text(t){this.label.text=t,this.arrange()}get state(){return this._state}set state(t){t!=this.state&&(this._state=t,this.commitData())}commitData(){super.commitData();let t=this.state;this.config.states[t]||this.selected&&(t=Du.SELECTED_TO_NORMAL_MAP[this.state]),this.config.states[t]||(t=Pu.NORMAL);let e=this.config.states[t];(e.alpha||0===e.alpha)&&(this.alpha=e.alpha),e.icon&&(this.icon.texture=Xi.from(e.icon)),e.labelConfig&&this.label.changeConfig(e.labelConfig),this.enabled?(this.interactive=!0,this.cursor="pointer"):(this.interactive=!1,this.cursor=null),this.arrange()}get selected(){return this._selected}set selected(t){t!=this.selected&&(this._selected=t,this.state=this.findStateValue(Pu.NORMAL))}findStateValue(t){let e;return this.selected&&(e=Du.NORMAL_TO_SELECTED_MAP[t]),e||(e=t),e}addExternalView(t,e){e||0===e?this.layoutableCont.addChildAt(t,e):this.layoutableCont.addChild(t),this.arrange()}updateBg(){this.bg.clear(),this.bg.beginFill(this.config.bgConfig.bgColor,this.config.bgConfig.bgAlpha),this.bg.lineStyle(this.config.bgConfig.bgLineWidth,this.config.bgConfig.bgLineColor,this.config.bgConfig.bgLineAlpha,0),this.bg.drawRoundedRect(0,0,this.contentCont.width+2*this.config.bgConfig.contentToBgPaddingX,this.contentCont.height+2*this.config.bgConfig.contentToBgPaddingY,this.config.bgConfig.bgCornerRadius),this.bg.endFill()}get contentLayout(){return this._contentLayout}set contentLayout(t){this._contentLayout=t,this.arrange()}}Du.NORMAL_TO_SELECTED_MAP=(()=>{let t={};return t[Pu.NORMAL]=Pu.SELECTED_NORMAL,t[Pu.OVER]=Pu.SELECTED_OVER,t[Pu.PRESS]=Pu.SELECTED_PRESS,t[Pu.DISABLED]=Pu.SELECTED_DISABLED,t})(),Du.SELECTED_TO_NORMAL_MAP=(()=>{let t={};return t[Pu.SELECTED_NORMAL]=Pu.NORMAL,t[Pu.SELECTED_OVER]=Pu.OVER,t[Pu.SELECTED_PRESS]=Pu.PRESS,t[Pu.SELECTED_DISABLED]=Pu.DISABLED,t})();class Ou extends Kd{constructor(){super(...arguments),this.sizeAreaColor=255,this.sizeAreaColorAlpha=.5}construction(...t){super.construction(t),this.resizeConfig={upscaleAllowed:!1},this.contentContReversedResizeSize=new We,this.contentContLocalPosOfGlobalZero=new ze,this.contentCont=new bl,this.addChild(this.contentCont),this.contentCont.interactive=!0,this.sizeAreaView=new la,this.contentCont.addChild(this.sizeAreaView),this.sizeAreaView.visible=!1,this._sizeArea=new We;const e=kd().getState();e.app.config.sizeArea&&(this._sizeArea=new We(e.app.config.sizeArea.x||0,e.app.config.sizeArea.y||0,e.app.config.sizeArea.width||0,e.app.config.sizeArea.height||0)),this.updateSizeAreaView()}get sizeArea(){return this._sizeArea}set sizeArea(t){t.x===this.sizeArea.x&&t.y===this.sizeArea.y&&t.width===this.sizeArea.width&&t.height===this.sizeArea.height||(this.sizeArea.copyFrom(t),this.updateSizeAreaView())}updateSizeAreaView(){this.sizeAreaView.clear(),this.sizeAreaView.beginFill(this.sizeAreaColor,this.sizeAreaColorAlpha),this.sizeAreaView.drawRect(this.sizeArea.x,this.sizeArea.y,this.sizeArea.width,this.sizeArea.height),this.sizeAreaView.endFill()}arrange(){super.arrange(),this.contentCont.scale.set(1,1);let t=Nl.getScale(this.sizeArea.width,this.sizeArea.height,this.resizeSize.x,this.resizeSize.y,this.resizeConfig);this.contentCont.scale.set(t),this.contentCont.toLocal({x:0,y:0},null,this.contentContLocalPosOfGlobalZero),this.contentContReversedResizeSize.x=this.contentContLocalPosOfGlobalZero.x,this.contentContReversedResizeSize.y=this.contentContLocalPosOfGlobalZero.y,this.contentContReversedResizeSize.width=Math.floor(this.resizeSize.x/this.contentCont.scale.x),this.contentContReversedResizeSize.height=Math.floor(this.resizeSize.y/this.contentCont.scale.y)}get contentScale(){return this.contentCont.scale.clone()}}class ku extends wd{activate(){I.log("BaseStrategy | activate __ this: ",this),-1==ku.cache.indexOf(this)&&ku.cache.push(this)}deactivate(){this.eventListenerHelper.removeAllListeners(),c.removeItem(ku.cache,this)}}ku.cache=[];const Bu={sizeArea:{x:0,y:0,width:1080,height:1575},colors:{white:16777215,darkGrey:2171169,red:13840175,green:3706428,black:0,lightBlue:9484512,blue:8298694,grey:9144718,darkerGrey:3353900,darkRed:12604759},fonts:{mainFont:"NotoSans"},grid:{width:30,height:30},gameplay:{availableLettersCount:12,levelTime:Tu.MS_IN_MINUTE/2,cheatMoreTime:Tu.MS_IN_MINUTE}},Fu={app:{config:{sizeArea:Bu.sizeArea}}},Nu="tutorialCont";class Gu extends Jd{construction(...t){super.construction(...t);const e=jh(nc),i=new bl;this.addChild(i),e.addContainer(i,Nu);const n=new bl;this.addChild(n),e.addContainer(n,"effectsContainer"),this.resizeSizeArea=new la,this.resizeSizeArea.beginFill(16711680,.5),this.resizeSizeArea.drawRect(0,0,Bu.sizeArea.width,Bu.sizeArea.height)}arrange(){super.arrange(),this.bg.scale.set(1),Nl.scaleObject(this.bg,this.resizeSize.x,this.resizeSize.y,{scaleByMinSide:!0,upscaleAllowed:!0}),this.bg.x=(this.resizeSize.x-this.bg.width)/2,this.bg.y=(this.resizeSize.y-this.bg.height)/2;let t=Nl.getScale(Bu.sizeArea.width,Bu.sizeArea.height,this.resizeSize.x,this.resizeSize.y,{upscaleAllowed:!0});this.resizeSizeArea.scale.set(t),this.resizeSizeArea.x=(this.resizeSize.x-this.resizeSizeArea.width)/2,this.resizeSizeArea.y=(this.resizeSize.y-this.resizeSizeArea.height)/2}}class Uu extends Ad{init(){super.init(),kd().initializeWith(Fu),Wh(Gu,{toSubstitute:Jd})}}const Hu={gameLogic:{coins:0,maxCompleteLevelIndex:-1}},Vu={maxLevelIndex:29,levelIndicesToIgnorTime:[0,1,2],minLevelIndexToEnableCheatButtons:2,minLevelToRequireAdvForCheats:3};class zu extends Ad{init(){super.init(),kd().initializeWith(Hu),kd().initializeWith(Vu)}activateCompleteHook(){super.activateCompleteHook()}}var ju;!function(t){t.YANDEX_GAMES="yandexGames",t.YANDEX_WEB_RU="yandexWebRu",t.YANDEX_WEB_EN="yandexWebEn",t.ANDROID="android"}(ju||(ju={}));var Wu,Xu,Ku,Yu=i(806);class $u{static init(t,e,i=""){$u.isInitialized||($u.isInitialized=!0,$u.eventPropNamesPrefix=i,Yu.GameAnalytics.setEnabledInfoLog(!0),Yu.GameAnalytics.setEnabledVerboseLog(!0),Yu.GameAnalytics.configureBuild("0.10"),Yu.GameAnalytics.initialize(t.gameKey,t.secretKey))}static logEvent(t,e){$u.isInitialized&&Yu.GameAnalytics.addDesignEvent(t,e)}}!function(t){t.GAME_OPEN="gameOpen",t.APP_FRAMEWORK_INITILIZED="appFrameworkInitialized",t.GAME_START_AFTER_LOADING="gameStartAfterLoading",t.NEW_USER="newUser",t.RETURNED_USER="returnedUser",t.PRELOADER_PROGRESS="preloaderProgress",t.GAME_LOADED="gameLoaded",t.VIEW_ELEMENT="viewElement",t.LEVEL_START_FIRST_PART="level:start:"}(Wu||(Wu={})),function(t){t.TOTAL_SCORE="totalScore",t.DEATH="death",t.RESTART="restart",t.NEXT_LEVEL="nextLevel"}(Xu||(Xu={})),function(t){t.ASK_TO_REVIEW_SHOW="platform:askToReview:show",t.ASK_TO_REVIEW_SUCCESS="platform:askToReview:success",t.ASK_TO_REVIEW_FAIL="platform:askToReview:fail",t.ASK_TO_REVIEW_ERROR="platform:askToReview:error",t.ASK_TO_INSTALL_SHOW="platform:askToInstall:show",t.ASK_TO_INSTALL_SUCCESS="platform:askToInstall:success",t.ASK_TO_INSTALL_FAIL="platform:askToInstall:fail",t.ASK_TO_INSTALL_ERROR="platform:askToInstall:error"}(Ku||(Ku={}));class qu extends Cd{constructor(){super(...arguments),this.playerDataAppStorageId="flashist__platformAdapter__playerDataApp",this.playerDataTimestampStorageId="flashist__platformAdapter__playerDataTimestamp",this.defaultLeaderboardId="default",this.minDelayBetweenSetSdkPlayerData=1e4}construction(t){super.construction(t),this.localStorageManager=jh(Rd),this.init(t)}init(t){return vu(this,void 0,void 0,(function*(){return this.initPromise||(this.initPromise=new Promise((e=>vu(this,void 0,void 0,(function*(){yield this.internalInit(t);let i=this.getPlayerAppData();const n=yield this.getSdkPlayerData();if(n){const t=n[this.playerDataTimestampStorageId];if(t){const e=this.getLocalPlayerDataTimestamp();if(!e||t>e){i=n[this.playerDataAppStorageId]}}}this.setPlayerAppData(i),e()}))))),this.initPromise}))}internalInit(t){return vu(this,void 0,void 0,(function*(){}))}onInitPromise(){return vu(this,void 0,void 0,(function*(){return this.initPromise}))}gameIsReadyCallback(){return vu(this,void 0,void 0,(function*(){console.log("PlatformAdapter | gameIsReadyCallback")}))}checkIfLeaderboardAvailable(){return vu(this,void 0,void 0,(function*(){return!0}))}setLeaderboardScore(t,e,i,n=!0){return vu(this,void 0,void 0,(function*(){return Promise.resolve(!1)}))}checkIfAskToReviewAvailable(){return vu(this,void 0,void 0,(function*(){return!0}))}askToReview(){return vu(this,void 0,void 0,(function*(){$u.logEvent(Ku.ASK_TO_REVIEW_SHOW);const t=this.internalAskToReview();return t.then((t=>{t?$u.logEvent(Ku.ASK_TO_REVIEW_SUCCESS):$u.logEvent(Ku.ASK_TO_REVIEW_FAIL)})),t.catch((t=>{$u.logEvent(Ku.ASK_TO_REVIEW_ERROR)})),t}))}internalAskToReview(){return vu(this,void 0,void 0,(function*(){return confirm("TEST! Do you want to review app?")}))}checkIfAskToInstallAvailable(){return vu(this,void 0,void 0,(function*(){return!0}))}askToInstall(){return vu(this,void 0,void 0,(function*(){$u.logEvent(Ku.ASK_TO_INSTALL_SHOW);const t=this.internalAskToInstall();return t.then((t=>{t?$u.logEvent(Ku.ASK_TO_INSTALL_SUCCESS):$u.logEvent(Ku.ASK_TO_INSTALL_FAIL)})),t.catch((t=>{$u.logEvent(Ku.ASK_TO_INSTALL_ERROR)})),t}))}internalAskToInstall(){return vu(this,void 0,void 0,(function*(){return confirm("TEST! Do you want to install app?")}))}getPlayerAppData(){return this.localStorageManager.getParam(this.playerDataAppStorageId)}getSdkPlayerData(){return vu(this,void 0,void 0,(function*(){return Promise.resolve(null)}))}getLocalPlayerDataTimestamp(){return this.localStorageManager.getParam(this.playerDataTimestampStorageId)}setPlayerAppData(t){if(!t)return;t[this.playerDataAppStorageId]&&delete t[this.playerDataAppStorageId],t[this.playerDataTimestampStorageId]&&delete t[this.playerDataTimestampStorageId];const e=this.localStorageManager.getStorageId();t[e]&&delete t[e];const i=Date.now();this.localStorageManager.setParam(this.playerDataTimestampStorageId,i),this.localStorageManager.setParam(this.playerDataAppStorageId,t);const n={[this.playerDataAppStorageId]:t,[this.playerDataTimestampStorageId]:i};this.setSdkPlayerDataWithCheck(n)}setSdkPlayerDataWithCheck(t){let e=!1,i=0;if(this.lastTimeSdkPlayerDataSetTimestamp){const t=Date.now()-this.lastTimeSdkPlayerDataSetTimestamp;i=this.minDelayBetweenSetSdkPlayerData-t,i<=0&&(e=!0)}else e=!0;clearTimeout(this.delaySetSdkPlayerDataTimeout);const n=()=>{this.setSdkPlayerData(t),this.lastTimeSdkPlayerDataSetTimestamp=Date.now()};e?n():this.delaySetSdkPlayerDataTimeout=setTimeout((()=>{n()}),i)}setSdkPlayerData(t){return vu(this,void 0,void 0,(function*(){return Promise.resolve(!0)}))}}class Zu extends qu{internalInit(t){return vu(this,void 0,void 0,(function*(){yield YaGames.init(t).then((t=>{console.log("YandexGamesPlaytformAdapter | internalInit __ then"),this.sdk=t})).catch((t=>{console.log("YandexGamesPlatformAdapter | internalInit __ catch __ error: ",t)})).finally((()=>vu(this,void 0,void 0,(function*(){console.log("YandexGamesPlatformAdapter | internalInit __ finally")})))),yield this.initPlayer()}))}gameIsReadyCallback(){var t;return vu(this,void 0,void 0,(function*(){this.sdk?null===(t=this.sdk.features.LoadingAPI)||void 0===t||t.ready():console.error("ERROR! The method should be called only after SDK is initialized (see the init method)!")}))}checkIfLeaderboardAvailable(){return vu(this,void 0,void 0,(function*(){return yield this.sdk.isAvailableMethod("leaderboards.setLeaderboardScore")}))}setLeaderboardScore(t,e,i,n=!0){return vu(this,void 0,void 0,(function*(){const s=yield this.sdk.getLeaderboards();let r=!0;if(n){let i=0;try{e||(e=this.defaultLeaderboardId);i=(yield s.getLeaderboardPlayerEntry(e)).score}catch(t){console.error("YandexGamesPlaytformAdapter | setLeaderboardScore __ error: ",t)}i>=t&&(r=!1)}let o=!1;return r&&(o=yield s.setLeaderboardScore(e,t,i)),o}))}checkIfAskToReviewAvailable(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.sdk.feedback.canReview().then((e=>{t(e.value)}))}))}))}internalAskToReview(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.sdk.feedback.canReview().then((e=>{e.value?this.sdk.feedback.requestReview().then((e=>{let i=!1;(null==e?void 0:e.feedbackSent)&&(i=!0),t(i)})):t(!1)}))}))}))}checkIfAskToInstallAvailable(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.sdk.shortcut.canShowPrompt().then((e=>{t(e.canShow)}))}))}))}internalAskToInstall(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.sdk.shortcut.canShowPrompt().then((e=>{e.canShow?this.sdk.shortcut.showPrompt().then((e=>{let i=!1;"accepted"===(null==e?void 0:e.outcome)&&(i=!0),t(i)})):t(!1)}))}))}))}initPlayer(){return vu(this,void 0,void 0,(function*(){try{this.playerSdk=yield this.sdk.getPlayer(),console.log("YandexGamesPlaytformAdapter | initPlayer __ playerSdk received")}catch(t){console.error("YandexGamesPlaytformAdapter | initPlayer __ catch __ error: ",t)}}))}getSdkPlayerData(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>vu(this,void 0,void 0,(function*(){const e=yield this.playerSdk.getData();t(e)}))))}))}setSdkPlayerData(t){return vu(this,void 0,void 0,(function*(){return console.log("YandexGamesPlaytformAdapter | setPlayerAppData __ data: ",t),new Promise((e=>{this.playerSdk.setData(t,!0).then((()=>{console.log("YandexGamesPlaytformAdapter | setPlayerAppData __ SUCCESS!"),e(!0)})).catch((t=>{console.error("YandexGamesPlaytformAdapter | setPlayerAppData __ error: ",t),e(!1)}))}))}))}}let Qu={};Qu={indexPage:"indexYandexGames.html",buildType:{prod:{bundlePath:"bundle.js",iframeAppIndexPath:"pop-adventure/iframe.html"},dev:{bundlePath:"dist/bundle.js",iframeAppIndexPath:"pop-adventure/iframe.html"}},gameAnalytics:{config:{gameKey:"326dd74356a37dff92cb68aa3aeeccca",secretKey:"ab2416c88082452f5f86f1d9d25bba2480a1a0e3"}}},console.log("IS_DEV: ",!1),console.log("BUILD_PLATFORM: ","yandexGames"),console.log("VERSION: ",'"0.0.1"'),console.log("CUR_BUILD_CONFIG:",Qu);const Ju="yandexGames"===ju.YANDEX_GAMES;ju.YANDEX_WEB_EN,ju.YANDEX_WEB_EN;class tp extends Ad{activateCompleteHook(){const t=Object.create(null,{activateCompleteHook:{get:()=>super.activateCompleteHook}});var e,i,n,s,r,o;return vu(this,void 0,void 0,(function*(){t.activateCompleteHook.call(this);const a=kd().getMutableState();if(console.log("GameDeviceModule | activateCompleteHook __ IS_DEV: ",!1," | isYandexGames: ",Ju),Ju){const t=jh(Zu);try{yield t.onInitPromise(),console.log("GameDeviceModule | activateCompleteHook __ yandexPlatform?.sdk?.environment?.i18n?.lang: ",null===(n=null===(i=null===(e=null==t?void 0:t.sdk)||void 0===e?void 0:e.environment)||void 0===i?void 0:i.i18n)||void 0===n?void 0:n.lang),(null===(o=null===(r=null===(s=null==t?void 0:t.sdk)||void 0===s?void 0:s.environment)||void 0===r?void 0:r.i18n)||void 0===o?void 0:o.lang)&&(a.device.mainLocale=t.sdk.environment.i18n.lang)}catch(t){console.error("GameDeviceModule | activateCompleteHook __ ERROR! error: ",t)}-1!==["ru","be","kk","uk","uz"].indexOf(a.device.mainLocale)?a.device.mainLocale="ru":"tr"===a.device.mainLocale?a.device.mainLocale="tr":a.device.mainLocale="en"}a.device.mainLocale="ru"}))}}class ep extends Cd{constructor(){super(...arguments),this.messageIdToCallbackMap={}}addListeners(){super.addListeners(),window.onmessage=t=>{const e=t.data,i=this.messageIdToCallbackMap[e.messageId];i&&i(e)}}sendMessageToIframe(t,e){var i;const n=jh(sp),s={messageId:t,data:e};(null===(i=null==n?void 0:n.iframeAppElement)||void 0===i?void 0:i.contentWindow)&&n.iframeAppElement.contentWindow.postMessage(s,"*")}addMessageCallback(t,e){this.messageIdToCallbackMap[t]?console.error("IFrameGameCommunicationManager | addMessageCallback __ ERROR! There is already a callback for the messageId: ",t):this.messageIdToCallbackMap[t]=e}removeMessageCallback(t){this.messageIdToCallbackMap[t]&&(this.messageIdToCallbackMap[t]=null)}}var ip;!function(t){t.CHILD_IFRAME_TO_PARENT_APP_INIT="childIframeToParent_appInit",t.CHILD_IFRAME_TO_PARENT_LOAD_PROGRESS="childIframeToParent_LoadProgress",t.CHILD_IFRAME_TO_PARENT_ANALYTICS="childIframeToParent_Analytics",t.PARENT_IFRAME_TO_CHILD_PAUSE="parentIframeToChild_Pause",t.PARENT_IFRAME_TO_CHILD_RESUME="parentIframeToChild_Resume",t.PARENT_IFRAME_TO_CHILD_MUTE="parentIframeToChild_Mute",t.PARENT_IFRAME_TO_CHILD_UNMUTE="parentIframeToChild_Unmute",t.CHILD_IFRAME_TO_PARENT_WAIT_APPROVE="childIframeToParent_waitApprove",t.PARENT_IFRAME_TO_CHILD_WAIT_APPROVE_RESULT="parentIframeToChild_waitApproveResult",t.CHILD_IFRAME_TO_PARENT_SET_TOTAL_SCORE="childIframeToParent_setTotalScore",t.CHILD_IFRAME_TO_PARENT_SET_PLAYER_APP_DATA="childIframeToParent_setPlayerAppData",t.CHILD_IFRAME_TO_PARENT_IAP_CHECK_IF_AVAILABLE="childIframeToParent_iapCheckIfAvailable",t.PARENT_IFRAME_TO_CHILD_IAP_CHECK_IF_AVAILABLE_RESULT="parentIframeToChild_iapCheckIfAvailableResult",t.CHILD_IFRAME_TO_PARENT_IAP_GET_CATALOG="childIframeToParent_iapGetCatalog",t.PARENT_IFRAME_TO_CHILD_IAP_GET_CATALOG_RESULT="parentIframeToChild_iapGetCatalogResult"}(ip||(ip={}));const np="iframeApp";class sp extends Cd{constructor(){super(...arguments),this.pauseLock=new S,this.muteLock=new S}construction(...t){super.construction(...t),this.localStorageManager=jh(Rd),this.iframeAppState=kd().getState();const e=this.localStorageManager.getParam(np);e&&kd().change()("iframeApp",e.iframeApp),this.updateStorageData(),this.updateLocalStorageInterval=setInterval((()=>{this.updateStorageData()}),6e4)}addListeners(){super.addListeners();const t=jh(ep);t.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_ANALYTICS,(t=>{$u.logEvent(t.data.analyticEventId,t.data.value)})),t.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_APP_INIT,(t=>{this.commitPauseChangeData(),this.commitMuteChangeData()}))}addPauseLock(t){const e=this.pauseLock.enabled;this.pauseLock.add(t),e!==this.pauseLock.enabled&&this.commitPauseChangeData()}removePauseLock(t){const e=this.pauseLock.enabled;this.pauseLock.remove(t),e!==this.pauseLock.enabled&&this.commitPauseChangeData()}commitPauseChangeData(){console.log("IframeAppManager __ commitPauseChangeData __ this.pauseLock.enabled: ",this.pauseLock.enabled);const t=jh(ep);this.pauseLock.enabled?t.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_PAUSE):t.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_RESUME)}addMuteLock(t){const e=this.muteLock.enabled;this.muteLock.add(t),e!==this.muteLock.enabled&&this.commitMuteChangeData()}removeMuteLock(t){const e=this.muteLock.enabled;this.muteLock.remove(t),e!==this.muteLock.enabled&&this.commitMuteChangeData()}commitMuteChangeData(){console.log("IframeAppManager __ commitMuteChangeData __ this.muteLock.enabled: ",this.muteLock.enabled);const t=jh(ep);this.muteLock.enabled?t.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_MUTE):t.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_UNMUTE)}get iframeAppElement(){return this._iframeAppElement}createIframeApp(t,e){return this._iframeAppElement=zl.createElementFromHTMLString(t),e.appendChild(this._iframeAppElement),this._iframeAppElement}hideIframeApp(){this._iframeAppElement&&(this._iframeAppElement.style.opacity="0")}showIframeApp(){this._iframeAppElement&&(this._iframeAppElement.style.opacity="1")}updateStorageData(){this.localStorageManager.setParam(np,this.iframeAppState)}}class rp extends Rc{constructor(){super(...arguments),this.iframeAppManager=jh(sp)}addListeners(){super.addListeners()}workaraundCheckOfFocus(){var t,e;let i=!1;if(console.log("GameHTMLManager | workaraundCheckOfFocus __ "," document.hasFocus: ",document.hasFocus," | this.iframeAppManager.iframeAppElement?.contentDocument: ",null===(t=this.iframeAppManager.iframeAppElement)||void 0===t?void 0:t.contentDocument),document.hasFocus&&(null===(e=this.iframeAppManager.iframeAppElement)||void 0===e?void 0:e.contentDocument)&&(i=!0),console.log("GameHTMLManager | workaraundCheckOfFocus __ "," canDoWorkaroundCheck: ",i),i){let t=!1;console.log("GameHTMLManager | workaraundCheckOfFocus __ "," document.hasFocus(): ",document.hasFocus()," this.iframeAppManager.iframeAppElement.contentDocument.hasFocus(): ",this.iframeAppManager.iframeAppElement.contentDocument.hasFocus()),(document.hasFocus()||this.iframeAppManager.iframeAppElement.contentDocument.hasFocus())&&(t=!0),console.log("GameHTMLManager | workaraundCheckOfFocus __ "," newFocus: ",t," this.lastFocus: ",this.lastFocus),this.lastFocus=t,t&&this.onFocus(),this.iframeAppManager.commitMuteChangeData(),this.iframeAppManager.commitPauseChangeData()}}removeListeners(){super.removeListeners(),(this.iframeFocusWorkaroundInterval||0===this.iframeFocusWorkaroundInterval)&&(clearInterval(this.iframeFocusWorkaroundInterval),this.iframeFocusWorkaroundInterval=null)}onBlur(t){super.onBlur(t),this.workaraundCheckOfFocus()}}class op extends Ad{init(){const t=Object.create(null,{init:{get:()=>super.init}});return vu(this,void 0,void 0,(function*(){t.init.call(this),Wh(rp,{toSubstitute:Rc})}))}}var ap;!function(t){t.PREPARE_IFRAME_APP="prepareIframeApp"}(ap||(ap={}));const lp="gamePage";var hp;!function(t){t.WAIT_USER_ACTION="waitUserAction",t.PROCESSING="processing",t.PROCESSING_ERROR="processingError",t.RESULT="result"}(hp||(hp={}));const dp={gamePage:{state:hp.WAIT_USER_ACTION,imageProcessProgress:0}};class cp extends Hc{}class up extends Ou{construction(...t){super.construction(...t)}arrange(){super.arrange()}}const pp={gameCharacters:{characters:[{id:"aleksandr-sheps",imageId:"Character_AleksandrSheps",nameId:"characters.aleksandr-sheps"},{id:"dmitriy-matveev",imageId:"Character_DmitriyMatveev",nameId:"characters.dmitriy-matveev"},{id:"dzhuliya-vang",imageId:"Character_DzhuliyaVang",nameId:"characters.dzhuliya-vang"},{id:"grigoriy-kuznetsov",imageId:"Character_GrigoriyKuznetsov",nameId:"characters.grigoriy-kuznetsov"},{id:"konstantin-getsati",imageId:"Character_KonstantinGetsati",nameId:"characters.konstantin-getsati"},{id:"lina-dzhebisashvili",imageId:"Character_LinaDzhebisashvili",nameId:"characters.lina-dzhebisashvili"},{id:"maksim-levin",imageId:"Character_MaksimLevin",nameId:"characters.maksim-levin"},{id:"maryana-romanova",imageId:"Character_MaryanaRomanova",nameId:"characters.maryana-romanova"},{id:"merilin-kerro",imageId:"Character_MerilinKerro",nameId:"characters.merilin-kerro"},{id:"nadezhda-shevchenko",imageId:"Character_NadezhdaShevchenko",nameId:"characters.nadezhda-shevchenko"},{id:"nikol-kuznetsova",imageId:"Character_NikolKuznetsova",nameId:"characters.nikol-kuznetsova"},{id:"oleg-sheps",imageId:"Character_OlegSheps",nameId:"characters.oleg-sheps"},{id:"olga-yakubovich",imageId:"Character_OlgaYakubovich",nameId:"characters.olga-yakubovich"},{id:"pahom",imageId:"Character_Pahom",nameId:"characters.pahom"},{id:"sonya-egorova",imageId:"Character_SonyaEgorova",nameId:"characters.sonya-egorova"},{id:"svami-dashi",imageId:"Character_SvamiDashi",nameId:"characters.svami-dashi"},{id:"tatiana-larina",imageId:"Character_TatianaLarina",nameId:"characters.tatiana-larina"},{id:"timofey-rudenko",imageId:"Character_TimofeyRudenko",nameId:"characters.timofey-rudenko"},{id:"viktoriya-raydos",imageId:"Character_ViktoriyaRaydos",nameId:"characters.viktoriya-raydos"},{id:"vladislav-cherevatyi",imageId:"Character_VladislavCherevatyi",nameId:"characters.vladislav-cherevatyi"}]}};class fp extends Ad{init(){super.init(),kd().initializeWith(dp),kd().initializeWith(pp),Wh(up,{activateeConstructors:[cp]})}activateCompleteHook(){super.activateCompleteHook(),kd().change()(`pages.pageIdToViewClassMap.${lp}`,up)}}class gp{}class mp extends gp{constructor(){super(),d.copyProps(this,Qu.yandex.adv)}}class vp extends Ad{init(){super.init(),Wh(mp,{toSubstitute:gp})}}class _p extends Lc{constructor(){super(...arguments),this.gameLogicState=kd().getState()}executeInternal(){return vu(this,void 0,void 0,(function*(){yield jh(Dc,lp).execute(),this.notifyComplete()}))}}var yp;!function(t){t.MAIN_EXTRABOLD_256_WHITE="MAIN_EXTRABOLD_256_WHITE",t.MAIN_EXTRABOLD_128_WHITE="MAIN_EXTRABOLD_128_WHITE",t.MAIN_SEMIBOLD_80_WHITE="MAIN_SEMIBOLD_80_WHITE",t.MAIN_SEMIBOLD_128_WHITE="MAIN_SEMIBOLD_128_WHITE",t.MAIN_SEMIBOLD_160_WHITE="MAIN_SEMIBOLD_160_WHITE",t.MAIN_SEMIBOLD_240_WHITE="MAIN_SEMIBOLD_240_WHITE",t.MAIN_SEMIBOLD_256_WHITE="MAIN_SEMIBOLD_256_WHITE",t.MAIN_BOLD_80_WHITE="MAIN_BOLD_80_WHITE",t.MAIN_SEMIBOLD_15_WHITE="MAIN_SEMIBOLD_15_WHITE",t.MAIN_LIGHT_25_WHITE="MAIN_LIGHT_25_WHITE",t.MAIN_REGULAR_20_WHITE="MAIN_REGULAR_20_WHITE",t.MAIN_REGULAR_25_WHITE="MAIN_REGULAR_25_WHITE",t.MAIN_SEMIBOLD_25_WHITE="MAIN_SEMIBOLD_25_WHITE",t.MAIN_SEMIBOLD_25_BLACK="MAIN_SEMIBOLD_25_BLACK"}(yp||(yp={}));class Ep extends Lc{constructor(){super(...arguments),this.localeManager=jh(Yh),this.deviceState=kd().getState()}executeInternal(){return vu(this,void 0,void 0,(function*(){this.notifyComplete()}))}prepareFonts(){return vu(this,void 0,void 0,(function*(){const t=this.localeManager.findAllUniqueCharactersForCurrentLocale();if(t.push(...al.ALPHANUMERIC,...al.ASCII),"ru"===this.deviceState.device.mainLocale){const e=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];t.push(...e)}const e=[];let i;i={label:new wl({fontFamily:Bu.fonts.mainFont,size:128,fontWeight:Sl.EXTRA_BOLD,color:Bu.colors.white,autosize:!0}),bitmapFontId:yp.MAIN_EXTRABOLD_128_WHITE,textureWidth:1024,textureHeight:1024,padding:10},e.push(i),i={label:new wl({fontFamily:Bu.fonts.mainFont,size:256,fontWeight:Sl.EXTRA_BOLD,color:Bu.colors.white,autosize:!0}),bitmapFontId:yp.MAIN_EXTRABOLD_256_WHITE,textureWidth:1024,textureHeight:1024,padding:10},e.push(i);for(let i of e)al.from(i.bitmapFontId,i.label.engineField.style,{chars:t,textureWidth:i.textureWidth,textureHeight:i.textureHeight,padding:i.padding}),yield bd.asyncTimeout(250)}))}}class bp extends Lc{executeInternal(){return vu(this,void 0,void 0,(function*(){this.notifyComplete()}))}}var Ap,Tp;!function(t){t.FULLSCREEN_ADV_SHOW="adv:fullscreen:show",t.FULLSCREEN_ADV_SUCCESS="adv:fullscreen:success",t.FULLSCREEN_ADV_ERROR="adv:fullscreen:error",t.REWARDED_ADV_SHOW="adv:rewarded:show",t.REWARDED_ADV_SUCCESS="adv:rewarded:success",t.REWARDED_ADV_ERROR="adv:rewarded:error",t.BANNER_ADV_SHOW="adv:banner:show",t.BANNER_ADV_SUCCESS="adv:banner:success",t.BANNER_ADV_ERROR="adv:banner:error"}(Ap||(Ap={})),function(t){t.FULLSCREEN_ADV_SHOW="AdvAdapterEvent.FULLSCREEN_ADV_SHOW",t.FULLSCREEN_ADV_SUCCESS="AdvAdapterEvent.FULLSCREEN_ADV_SUCCESS",t.FULLSCREEN_ADV_ERROR="AdvAdapterEvent.FULLSCREEN_ADV_ERROR",t.REWARDED_ADV_SHOW="AdvAdapterEvent.REWARDED_ADV_SHOW",t.REWARDED_ADV_SUCCESS="AdvAdapterEvent.REWARDED_ADV_SUCCESS",t.REWARDED_ADV_ERROR="AdvAdapterEvent.REWARDED_ADV_ERROR",t.BANNER_ADV_SHOW="AdvAdapterEvent.BANNER_ADV_SHOW",t.BANNER_ADV_SUCCESS="AdvAdapterEvent.BANNER_ADV_SUCCESS",t.BANNER_ADV_ERROR="AdvAdapterEvent.BANNER_ADV_ERROR"}(Tp||(Tp={}));class xp extends Cd{constructor(){super(...arguments),this.soundsManager=jh(yd),this.appState=kd().getState(),this.fullscreenAdvMinInterval=18e4,this.fullscreenAdvLastTimeShown=0,this.rewardedAdvMinInterval=0,this.rewardedAdvLastTimeShown=0}checkIfFullscreenAdvAvailable(){let t=!1;return(0===this.fullscreenAdvLastTimeShown||this.appState.app.sessionDuration>=this.fullscreenAdvLastTimeShown+this.fullscreenAdvMinInterval)&&(t=!0),t}showFullscreenAdv(){return vu(this,void 0,void 0,(function*(){this.fullscreenAdvLastTimeShown=this.appState.app.sessionDuration,this.muteSoundsDuringAdv&&this.addDisableSoundsLock(),$u.logEvent(Ap.FULLSCREEN_ADV_SHOW),this.dispatchEvent(Tp.FULLSCREEN_ADV_SHOW);const t=this.internalShowFullscreenAdv();return t.then((()=>{$u.logEvent(Ap.FULLSCREEN_ADV_SUCCESS),this.dispatchEvent(Tp.FULLSCREEN_ADV_SUCCESS)})),t.catch((t=>{$u.logEvent(Ap.FULLSCREEN_ADV_ERROR),this.dispatchEvent(Tp.FULLSCREEN_ADV_ERROR)})),t.finally((()=>{this.removeDisalbeSoundsLock()})),t}))}internalShowFullscreenAdv(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{console.log("AdvAdapter | internalShowFullscreenAdv __ Start Showing Fullscreen Adv"),setTimeout((()=>{console.log("AdvAdapter | internalShowFullscreenAdv __ Stop Showing Fullscreen Adv"),t({})}),1e4)}))}))}checkIfRewardedAdvAvailable(){let t=!1;return(0===this.rewardedAdvLastTimeShown||this.appState.app.sessionDuration>=this.rewardedAdvLastTimeShown+this.rewardedAdvMinInterval)&&(t=!0),t}showRewardedAdv(){return vu(this,void 0,void 0,(function*(){this.rewardedAdvLastTimeShown=this.appState.app.sessionDuration,this.muteSoundsDuringAdv&&this.addDisableSoundsLock(),$u.logEvent(Ap.REWARDED_ADV_SHOW),this.dispatchEvent(Tp.REWARDED_ADV_SHOW);const t=yield this.internalShowRewardedAdv();return t?($u.logEvent(Ap.REWARDED_ADV_SUCCESS),this.dispatchEvent(Tp.REWARDED_ADV_SUCCESS)):($u.logEvent(Ap.REWARDED_ADV_ERROR),this.dispatchEvent(Tp.REWARDED_ADV_ERROR)),this.removeDisalbeSoundsLock(),t}))}internalShowRewardedAdv(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>vu(this,void 0,void 0,(function*(){console.log("AdvAdapter | internalShowRewardedAdv __ Start Showing Rewarded Adv");yield bd.asyncTimeout(1e4),t(!0)}))))}))}checkIfBannerAdvAvailable(){return!0}showBannerAdv(){return vu(this,void 0,void 0,(function*(){$u.logEvent(Ap.BANNER_ADV_SHOW),this.dispatchEvent(Tp.BANNER_ADV_SHOW);const t=this.internalShowBannerAdv();return t.then((()=>{kd().change()("advAdapter.banner.shown",!0),this.updateBannerData(),$u.logEvent(Ap.BANNER_ADV_SUCCESS),this.dispatchEvent(Tp.BANNER_ADV_SUCCESS)})),t.catch((t=>{$u.logEvent(Ap.BANNER_ADV_ERROR),this.dispatchEvent(Tp.BANNER_ADV_ERROR)})),t}))}internalShowBannerAdv(){return vu(this,void 0,void 0,(function*(){}))}updateBannerData(){}getBannerRect(){return null}addDisableSoundsLock(){this.soundsManager.addDisableLock(this)}removeDisalbeSoundsLock(){this.soundsManager.removeDisableLock(this)}}const Sp="GamePreloaderPageViewEvent.PROGRESS_COMPLETE";var wp;!function(t){t.LOADING_COMPLETE="GamePreloaderEvent.LOADING_COMPLETE"}(wp||(wp={}));class Cp extends Hc{constructor(){super(...arguments),this.loadManager=jh(Hh),this.platformAdapter=jh(qu),this.advAdapter=jh(xp),this.iframeAppCommunicationManager=jh(ep),this.iframeAppManager=jh(sp),this.rendererManager=jh(ou),this.initLoadingGroupCoef=.25,this.prepareGameLoadingCoef=.05,this.totalProgress=0,this.lastProcessedInitLoadingGroupProgress=0,this.fakeProgressValue=0,this.fakeProgressIncreasePerMs=1e-5/3,this.fakeProgressMaxLimit=.97,this.lastProcessedIframeAppTotalLoadingProgress=0,this.iframeAppTotalLoadingCoef=1-(this.initLoadingGroupCoef+this.prepareGameLoadingCoef)}onActivatorStart(t){super.onActivatorStart(t),this.advAdapter.checkIfFullscreenAdvAvailable()&&this.advAdapter.showFullscreenAdv(),this.initLoadingGroup=this.loadManager.getGroup(Ic.INIT),this.initLoadingGroup.getAllItems().length>0?(this.eventListenerHelper.addEventListener(this.initLoadingGroup,dh,this.onInitLoadingGroupProgress),this.onInitLoadingGroupProgress()):this.processInitLoadingGroupProgress(1),this.eventListenerHelper.addEventListener(this.activator,Sp,this.onViewProgressComplete),jh(bh,"prepareGame").execute().then((()=>{this.prepareGame()})),this.iframeAppCommunicationManager.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_LOAD_PROGRESS,(t=>{if(console.log("GamePreloaderPageMediator | onActivatorStart __ CHILD_IFRAME_TO_PARENT_LOAD_PROGRESS __ data: ",t),t.data.total){const e=t.data.progress/t.data.total;this.onIframeTotalLoadingProgress(e)}})),this.startFakeProgress()}onActivatorEnd(){super.onActivatorEnd(),this.stopFakeProgress()}onIframeTotalLoadingProgress(t){if(console.log("GamePreloaderPageMediator | onIframeTotalLoadingProgress _ progress: ",t),!this.lastProcessedIframeAppTotalLoadingProgress||t>this.lastProcessedIframeAppTotalLoadingProgress){const e=t-this.lastProcessedIframeAppTotalLoadingProgress,i=this.totalProgress+e*this.iframeAppTotalLoadingCoef;this.setProgress(i),this.lastProcessedIframeAppTotalLoadingProgress=t}}onInitLoadingGroupProgress(){this.processInitLoadingGroupProgress(this.initLoadingGroup.progress)}processInitLoadingGroupProgress(t){if(!this.lastProcessedInitLoadingGroupProgress||t>this.lastProcessedInitLoadingGroupProgress){const e=t-this.lastProcessedInitLoadingGroupProgress,i=this.totalProgress+e*this.initLoadingGroupCoef;this.setProgress(i),this.lastProcessedInitLoadingGroupProgress=t}}setProgress(t){console.log("FlashistAdaptation __ GamePreloaderPageMediator | setProgress _ progress: ",t),this.totalProgress=t,this.totalProgress>this.fakeProgressValue&&(this.fakeProgressValue=this.totalProgress),$u.logEvent(Wu.PRELOADER_PROGRESS,this.totalProgress),this.commitProgressData()}commitProgressData(){console.log("GamePreloaderPageMediator | commitProgressData __ this.totalProgress: ",this.totalProgress," | this.fakeProgressValue: ",this.fakeProgressValue);let t=this.totalProgress;this.fakeProgressValue>t&&(t=this.fakeProgressValue),this.activator.loadingProgress=t}prepareGame(){return vu(this,void 0,void 0,(function*(){if(this.isPrepareStarted)return;this.isPrepareStarted=!0,yield jh(Ep).execute(),this.isPrepareComplete=!0;const t=this.totalProgress+this.prepareGameLoadingCoef;this.setProgress(t)}))}onViewProgressComplete(){return vu(this,void 0,void 0,(function*(){const t=kd().getState();$u.logEvent(Wu.GAME_LOADED,t.app.sessionDuration),yield bd.asyncTimeout(500),yield new y([jh(bp),jh(_p),new m((()=>vu(this,void 0,void 0,(function*(){this.globalDispatcher.dispatchEvent(wp.LOADING_COMPLETE)})))),new m((()=>vu(this,void 0,void 0,(function*(){$u.logEvent(Wu.GAME_START_AFTER_LOADING,t.app.sessionDuration)})))),new m((()=>vu(this,void 0,void 0,(function*(){yield this.platformAdapter.onInitPromise(),yield this.platformAdapter.gameIsReadyCallback()}))))]).execute()}))}stopFakeProgress(){this.fakeProgressInterval&&(clearInterval(this.fakeProgressInterval),this.fakeProgressInterval=null)}startFakeProgress(){this.stopFakeProgress(),this.fakeProgressInterval=setInterval((()=>{const t=Date.now();if(this.fakeProgressLastProcessedTime){const e=(t-this.fakeProgressLastProcessedTime)*this.fakeProgressIncreasePerMs;this.fakeProgressValue+=e,this.fakeProgressValue=Math.min(this.fakeProgressMaxLimit,this.fakeProgressValue),this.commitProgressData()}this.fakeProgressLastProcessedTime=t}),1e3)}}class Ip extends Ou{constructor(){super(...arguments),this._loadingProgress=0,this._viewProgress=0}construction(...t){super.construction(...t),this.resizeConfig.upscaleAllowed=!0,this.subtitleLabel=new wl({fontFamily:Bu.fonts.mainFont,size:80,fontWeight:Sl.EXTRA_BOLD,color:Bu.colors.white,autosize:!0,align:nd.CENTER}),this.subtitleLabel.text=$h("preloader.subtitle"),this.progressLabel=new wl({fontFamily:"Helvetica, Arial, sans-serif",fontWeight:Sl.LIGHT,size:96,color:Bu.colors.darkGrey,autosize:!0}),this.contentCont.addChild(this.progressLabel),this.progressLabel.alpha=0,this.viewProgress=0}get loadingProgress(){return this._loadingProgress}set loadingProgress(t){t!==this._loadingProgress&&(this._loadingProgress=t,Ph.TweenLite.killTweensOf(this),Ph.TweenLite.to(this,.5,{viewProgress:this.loadingProgress}))}get viewProgress(){return this._viewProgress}set viewProgress(t){t!==this._viewProgress&&(this._viewProgress=t,this.commitData(),this.viewProgress>=1&&this.emit(Sp))}commitData(){super.commitData(),this.progressLabel.text=$h("preloader.progress",{progress:Math.floor(100*this.viewProgress)}),this.viewProgress>0&&(this.progressLabel.alpha=1),this.arrange()}arrange(){super.arrange(),this.progressLabel.x=Math.floor((this.contentContReversedResizeSize.width-this.progressLabel.width)/2),this.progressLabel.y=Math.floor((this.contentContReversedResizeSize.height-this.progressLabel.height)/2)}}class Rp extends Ad{init(){super.init(),Wh(Ip,{activateeConstructors:[Cp]})}activateCompleteHook(){super.activateCompleteHook(),kd().change()(`pages.pageIdToViewClassMap.${Kc}`,Ip)}}class Pp extends ru{constructor(){super(...arguments),this.antialias=!0,this.backgroundAlpha=0,this.backgroundColor=Bu.colors.white}}class Lp extends Ad{init(){super.init(),Wh(Pp,{toSubstitute:ru})}}class Mp extends Cd{constructor(){super(...arguments),this.storageManager=jh(Rd)}addListeners(){super.addListeners()}updateSaveData(){}}class Dp extends Ad{init(){super.init(),Wh(Mp,{isSingleton:!0,forceCreation:!0})}activateCompleteHook(){super.activateCompleteHook();let t=jh(Rd).getParam("gameSave");t&&kd().initializeWith(t)}}const Op={tutorialStepConfigs:{configs:{}}};var kp,Bp;!function(t){t.START="TutorialStepEvent.START",t.COMPLETE="TutorialStepEvent.COMPLETE"}(kp||(kp={})),function(t){t.TUTORIAL_START="tutorial:start",t.TUTORIAL_COMPLETE="tutorial:complete",t.TUTORIAL_STEP_START="tutorial:stepStart",t.TUTORIAL_STEP_COMPLETE="tutorial:stepComplete"}(Bp||(Bp={}));class Fp extends wd{constructor(t){super(t),this.targetViewHolePadding=0,this.stepInfoToViewPadding=20}construction(t){super.construction(t),this.tutorialStepConfigsState=kd().getState(),this.containersManager=jh(nc),this.stepId=t,this.stepConfig=this.tutorialStepConfigsState.tutorialStepConfigs.configs[this.stepId]}destruction(){super.destruction(),this.isActive=!1,this.updateTargetViewTimeout&&(clearTimeout(this.updateTargetViewTimeout),this.updateTargetViewTimeout=null),this.stepViewCont&&Gl.childRemoveItselfFromParent(this.stepViewCont)}addListeners(){super.addListeners(),this.eventListenerHelper.addEventListener(this.globalDispatcher,Qd.POST_RESIZE,this.updateTutorialView),this.stepConfig.completeByStageDown&&this.eventListenerHelper.addEventListener(Pl.instance.stage,Ml,this.onStageTap),this.stepConfig.globalEventToComplete&&this.eventListenerHelper.addEventListener(this.globalDispatcher,this.stepConfig.globalEventToComplete,this.onGlobalEventToComplete)}onGlobalEventToComplete(){this.processEventToComplete()}onStageTap(){this.processEventToComplete()}processEventToComplete(){this.stepConfig.minTimeToDisplayMs&&Date.now()-this.startTime<this.stepConfig.minTimeToDisplayMs||this.complete()}activate(){return this.isActive||(this.isActive=!0,$u.logEvent(Bp.TUTORIAL_STEP_START+":"+this.stepId),this.stepConfig.startAnalyticsEvent&&$u.logEvent(this.stepConfig.startAnalyticsEvent),this.startTime=Date.now(),this.activatePromise=new Promise((t=>{this.activatePromiseResolve=t,this.createContent()}))),this.dispatchEvent(kp.START,this.stepConfig),this.activatePromise}complete(){this.isActive&&($u.logEvent(Bp.TUTORIAL_STEP_COMPLETE+":"+this.stepConfig.id),this.stepConfig.completeAnalyticsEvent&&$u.logEvent(this.stepConfig.completeAnalyticsEvent+":"+this.stepConfig.id),this.isActive=!1,this.activatePromiseResolve(),this.dispatchEvent(kp.COMPLETE,this.stepConfig))}createContent(){const t=jh(nc),e=t.getContainer(Nu);this.targetView=t.getContainer(this.stepConfig.viewId),this.targetViewBounds=new We,this.prevTargetViewBounds=new We,this.stepViewContBounds=new We,this.stepViewCont=new bl,e.addChild(this.stepViewCont),this.stepViewCont.interactive=!!this.stepConfig.blocking,this.stepBg=new la,this.stepViewCont.addChild(this.stepBg),this.stepBg.filters=[new Ds.BlurFilter],this.stepBlockingHoleBg=new la,this.stepViewCont.addChild(this.stepBlockingHoleBg),this.stepBlockingHoleBg.visible=!!this.stepConfig.blockingHole,this.stepScaledCont=new bl,this.stepViewCont.addChild(this.stepScaledCont),this.stepLabel=new wl({fontFamily:Bu.fonts.mainFont,size:72,color:Bu.colors.white,fontWeight:Sl.BOLD,stroke:0,strokeThickness:10,align:this.stepConfig.labelAlign,valign:this.stepConfig.labelValign,autosize:!0,autosizeType:Tl.HEIGHT,maxAutosizeWidth:800,wordWrap:!0}),this.stepScaledCont.addChild(this.stepLabel),this.stepConfig.textId?this.stepLabel.text=$h(this.stepConfig.textId):this.stepLabel.visible=!1,this.updateTutorialView(),this.updateTargetViewTimeout=setInterval((()=>{this.updateTutorialView()}),100)}updateTutorialView(){if(!this.isActive)return;if(this.targetView.getBounds(!1,this.targetViewBounds),this.prevTargetViewBounds.x===this.targetViewBounds.x&&this.prevTargetViewBounds.y===this.targetViewBounds.y&&this.prevTargetViewBounds.width===this.targetViewBounds.width&&this.prevTargetViewBounds.height===this.targetViewBounds.height)return;this.prevTargetViewBounds.x=this.targetViewBounds.x,this.prevTargetViewBounds.y=this.targetViewBounds.y,this.prevTargetViewBounds.width=this.targetViewBounds.width,this.prevTargetViewBounds.height=this.targetViewBounds.height;const t=Pl.instance.renderer.width,e=Pl.instance.renderer.height;this.stepBg.clear(),this.stepBg.beginFill(0,.85),this.stepBg.lineTo(t,0),this.stepBg.lineTo(t,e),this.stepBg.lineTo(0,e),this.stepBg.lineTo(0,0),this.stepBg.endFill(),this.stepBg.beginHole(),this.stepBg.drawRect(this.targetViewBounds.x-this.targetViewHolePadding,this.targetViewBounds.y-this.targetViewHolePadding,this.targetViewBounds.width+2*this.targetViewHolePadding,this.targetViewBounds.height+2*this.targetViewHolePadding),this.stepBg.endHole(),this.stepBlockingHoleBg.clear(),this.stepBlockingHoleBg.beginFill(0,.01),this.stepBlockingHoleBg.lineTo(t,0),this.stepBlockingHoleBg.lineTo(t,e),this.stepBlockingHoleBg.lineTo(0,e),this.stepBlockingHoleBg.lineTo(0,0),this.stepBlockingHoleBg.endFill();const i=kd().getState(),n=t/i.pages.activePageContentScale.x;this.stepLabel.width=n-100,this.stepLabel.wordWrapWidth=this.stepLabel.width,this.stepScaledCont.scale.set(i.pages.activePageContentScale.x,i.pages.activePageContentScale.y);let s=Math.floor((t-this.stepScaledCont.width)/2),r=this.targetViewBounds.y+Math.floor((this.prevTargetViewBounds.height-this.stepScaledCont.height)/2);this.stepConfig.valign&&(this.stepConfig.valign===sd.TOP?r=this.targetViewBounds.y-this.stepScaledCont.height-this.stepInfoToViewPadding:this.stepConfig.valign===sd.BOTTOM&&(r=this.targetViewBounds.y+this.targetViewBounds.height+this.stepInfoToViewPadding)),this.stepScaledCont.x=s,this.stepScaledCont.y=r}}class Np{constructor(){this.tutorialStepIdsToControllerClassesMap={}}addTutorialClass(t,e){this.tutorialStepIdsToControllerClassesMap[t]=e}createStepController(t){let e=this.tutorialStepIdsToControllerClassesMap[t];e||(e=Fp);return jh(Fp,t)}}const Gp="tutorialSave";class Up extends Cd{constructor(){super(...arguments),this.tutorialState=kd().getState(),this.tutorialStepCofnigsState=kd().getState(),this.tutorialStepsFactory=jh(Np),this.storageManager=jh(Rd),this.stepsEventListenerHelper=new r(this),this.activeStepControllers=[]}destruction(){super.destruction(),this.stepsEventListenerHelper&&(this.stepsEventListenerHelper.destruction(),this.stepsEventListenerHelper=null)}updateSaveData(){const t={tutorial:{completeStepIds:this.tutorialState.tutorial.completeStepIds.concat()}};this.storageManager.setParam(Gp,t)}startStep(t){if(!this.checkIfStepCanBeStarted(t))return;kd().push()("tutorial.activeStepIds",t);const e=this.tutorialStepsFactory.createStepController(t);return this.addStepListeners(e),this.activeStepControllers.push(e),e.activate()}processControllerComplete(t){c.removeItem(this.activeStepControllers,t),this.removeStepListeners(t);const e=this.tutorialState.tutorial.activeStepIds.indexOf(t.stepId);kd().splice()("tutorial.activeStepIds",e),t.stepConfig.completeSaveStepId&&kd().push()("tutorial.completeStepIds",t.stepConfig.completeSaveStepId),this.updateSaveData(),t.destruction()}addStepListeners(t){this.stepsEventListenerHelper.addEventListener(t,kp.COMPLETE,(()=>{this.processControllerComplete(t)}))}removeStepListeners(t){this.stepsEventListenerHelper.removeAllListeners(t)}checkIfStepCanBeStarted(t){let e=!0;const i=this.tutorialStepCofnigsState.tutorialStepConfigs.configs[t];if(i||(e=!1),e&&this.checkIfStepActive(t)&&(e=!1),e&&this.checkIfStepComplete(t)&&(e=!1),e&&i.requiredCompleteStepIds)for(let t of i.requiredCompleteStepIds)if(!this.checkIfStepComplete(t)){e=!1;break}return e}checkIfStepComplete(t){let e=!1;return-1!==this.tutorialState.tutorial.completeStepIds.indexOf(t)&&(e=!0),e}checkIfStepActive(t){let e=!1;return-1!==this.tutorialState.tutorial.activeStepIds.indexOf(t)&&(e=!0),e}}class Hp extends Cd{constructor(){super(...arguments),this.gamePageState=kd().getState(),this.gameLogicState=kd().getState(),this.tutorialManager=jh(Up)}addListeners(){super.addListeners()}}class Vp extends Ad{init(){super.init(),kd().initializeWith(Op),Wh(Hp,{isSingleton:!0,forceCreation:!0})}}const zp={iframeApp:{totalScore:0}};class jp{prepareHtmlConent(t,e){let i=t;if(e){const t=`\n                <script>\n                    var parentIframeData = ${JSON.stringify(e.data)};\n                <\/script>\n            `;if(e.placeholder)i.split(e.placeholder).join(t);else{const e="</head>";i.split(e).join(t+e)}}return i}}class Wp extends Ad{init(){super.init(),kd().initializeWith(zp),Wh(sp,{isSingleton:!0,forceCreation:!0}),Wh(ep,{isSingleton:!0,forceCreation:!0}),Wh(jp,{isSingleton:!0})}}const Xp="nextLevel",Kp="rewarded",Yp={advAdapter:{banner:{shown:!1,rect:{x:0,y:0,width:0,height:0}}}};class $p extends Cd{checkIfIapAvailable(){return vu(this,void 0,void 0,(function*(){return!0}))}getCatalog(){return vu(this,void 0,void 0,(function*(){return Promise.resolve(null)}))}getPurchases(){return vu(this,void 0,void 0,(function*(){return Promise.resolve(null)}))}purchase(t,e){return vu(this,void 0,void 0,(function*(){return Promise.resolve(null)}))}consumePurchase(t){return Promise.resolve(!1)}}class qp extends Ad{init(){super.init(),kd().initializeWith(Yp),Wh(qu,{isSingleton:!0,forceCreation:!0}),Wh(xp,{isSingleton:!0,forceCreation:!0}),Wh($p,{isSingleton:!0,forceCreation:!0})}}class Zp extends xp{constructor(){super(...arguments),this.platformAdapter=jh(Zu)}construction(...t){super.construction(t),this.muteSoundsDuringAdv=!0}internalShowFullscreenAdv(){return vu(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{this.platformAdapter.sdk.adv.showFullscreenAdv({callbacks:{onClose:e=>{t(e)},onError:t=>{e(t)}}})}))}))}internalShowRewardedAdv(){return vu(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{{let e=!1;this.platformAdapter.sdk.adv.showRewardedVideo({callbacks:{onOpen:()=>{console.log("YandexAdvAdapter | internalShowRewardedAdv __ Video ad open.")},onRewarded:()=>{console.log("YandexAdvAdapter | internalShowRewardedAdv __ Rewarded!"),e=!0},onClose:()=>{console.log("YandexAdvAdapter | internalShowRewardedAdv __ Video ad closed."),t(e)},onError:e=>{console.error("YandexAdvAdapter | internalShowRewardedAdv __ Error while open video ad:",e),t(!1)}}})}}))}))}}class Qp extends $p{constructor(){super(...arguments),this.platformAdapter=jh(Zu),this.paymentsSdk=null}checkIfIapAvailable(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.platformAdapter.sdk.getPayments({signed:!0}).then((e=>{console.log("YandexGamesIAPAdapter || checkIfIAPAvailable __ then __ _payments: ",e),this.paymentsSdk=e,t(!0)})).catch((e=>{console.error("YandexGamesIAPAdapter || checkIfIAPAvailable __ catch __ error: ",e),t(!1)}))}))}))}getCatalog(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.paymentsSdk.getCatalog().then((e=>{console.log("YandexGamesIAPAdapter || getCatalog __ then __ products: ",e),t(e)})).catch((e=>{console.error("YandexGamesIAPAdapter || getCatalog __ catch __ error: ",e),t(!1)}))}))}))}getPurchases(){return vu(this,void 0,void 0,(function*(){return new Promise((t=>{this.paymentsSdk.getPurchases().then((e=>{console.log("YandexGamesIAPAdapter || getPurchases __ then __ purchases: ",e),t(e)})).catch((e=>{console.error("YandexGamesIAPAdapter || getPurchases __ catch __ error: ",e),t(!1)}))}))}))}purchase(t,e){return vu(this,void 0,void 0,(function*(){return new Promise((i=>{this.paymentsSdk.purchase({id:t,developerPayload:e}).then((t=>vu(this,void 0,void 0,(function*(){console.log("YandexGamesIAPAdapter || purchase __ then __ purchaseData: ",t);const e={token:t.purchaseToken};i(e)})))).catch((t=>{console.error("YandexGamesIAPAdapter || purchase __ catch __ error: ",t),i(null)}))}))}))}consumePurchase(t){return new Promise((e=>{this.paymentsSdk.consumePurchase(t).then((()=>{console.log("YandexGamesIAPAdapter || consumePurchase __ then"),e(!0)})).catch((t=>{console.error("YandexGamesIAPAdapter || purchase __ catch __ error: ",t),e(!1)}))}))}}class Jp extends Ad{init(){super.init(),Wh(Zu,{toSubstitute:qu}),Wh(Zp,{toSubstitute:xp}),Wh(Qp,{toSubstitute:$p})}}class tf extends qu{constructor(){super(),this.yaCallbackSdk=window.yaContextCb}}class ef extends xp{construction(...t){super.construction(t),this.deviceState=kd().getState(),this.platformAdapter=jh(tf),this.config=jh(gp),this.deviceState.device.deviceType===D.DESKTOP?this.deviceConfig=this.config.desktop:this.deviceConfig=this.config.mobile,this.muteSoundsDuringAdv=!0}internalShowFullscreenAdv(){return vu(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{this.platformAdapter.yaCallbackSdk.push((()=>{i.g.Ya.Context.AdvManager.render(Object.assign(Object.assign({},this.deviceConfig.fullscreen.yandexConfig),{onClose:()=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onClose"),t()},onRender:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onRender, data: ",t)},onError:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onError, data: ",t),e(t)}}))}))}))}))}internalShowRewardedAdv(){return vu(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{this.platformAdapter.yaCallbackSdk.push((()=>{i.g.Ya.Context.AdvManager.render(Object.assign(Object.assign({},this.deviceConfig.rewarded.yandexConfig),{onClose:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onClose, data: ",t)},onRewarded:i=>{console.log("YandexWebAdvPlatformAdapter | internalShowRewardedAdv __ Rewarded, isRewarded",i),i?t():e()},onRender:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onRender, data: ",t)},onError:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowFullscreenAdv __ onError, data: ",t),e(t)}}))}))}))}))}internalShowBannerAdv(){return vu(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{this.platformAdapter.yaCallbackSdk.push((()=>{i.g.Ya.Context.AdvManager.render(Object.assign(Object.assign({},this.deviceConfig.banner.yandexConfig),{onClose:()=>{console.log("YandexWebAdvPlatformAdapter | internalShowBannerAdv __ onClose")},onRender:e=>{console.log("YandexWebAdvPlatformAdapter | internalShowBannerAdv __ onRender, data: ",e),t()},onError:t=>{console.log("YandexWebAdvPlatformAdapter | internalShowBannerAdv __ onError, data: ",t),e(t)}}))}))}))}))}updateBannerData(){const t=this.getBannerRect();kd().change()("advAdapter.banner.rect",{x:t.x,y:t.y,width:t.width,height:t.height})}getBannerRect(){const t=new We,e=document.getElementById(this.deviceConfig.banner.yandexConfig.renderTo);if(e){const i=e.getBoundingClientRect();t.x=i.left,t.y=i.top,t.width=i.width,t.height=i.height}return t}}class nf extends Ad{init(){super.init(),Wh(tf,{toSubstitute:qu}),Wh(ef,{toSubstitute:xp}),Wh(gp)}}const sf={tutorial:{activeStepIds:[],completeStepIds:[]}},rf={tutorialStepConfigs:{configs:{}}};class of extends Ad{init(){super.init(),kd().initializeWith(sf),kd().initializeWith(rf);let t=jh(Rd).getParam(Gp);t&&kd().initializeWith(t),Wh(Np,{isSingleton:!0}),Wh(Up,{isSingleton:!0,forceCreation:!0})}}class af extends mu{constructor(){super(...arguments),this.iframeBaseSize=new ze(540,960),this.askToReviewMinTimeout=42e4,this.wasAskedToReview=!1,this.askToInstallMinTimeout=3e5,this.wasAskedToInstall=!1}addModules(){switch(super.addModules(),this.addSingleModule(new qp),"yandexGames"){case ju.YANDEX_GAMES:this.addSingleModule(new Jp);break;case ju.YANDEX_WEB_EN:case ju.YANDEX_WEB_RU:case ju.ANDROID:this.addSingleModule(new nf),this.addSingleModule(new vp)}this.addSingleModule(new Rp),this.addSingleModule(new fp),this.addSingleModule(new of),this.addSingleModule(new Au),this.addSingleModule(new bu),this.addSingleModule(new Vp),this.addSingleModule(new Uu),this.addSingleModule(new zu),this.addSingleModule(new Dp),this.addSingleModule(new Lp),this.addSingleModule(new tp),this.addSingleModule(new op),this.addSingleModule(new Wp)}initApp(){const t=Object.create(null,{initApp:{get:()=>super.initApp}});return vu(this,void 0,void 0,(function*(){yield t.initApp.call(this);const e=kd().getState();$u.logEvent(Wu.APP_FRAMEWORK_INITILIZED,e.app.sessionDuration),1===e.app.appLaunchesCount?$u.logEvent(Wu.NEW_USER):$u.logEvent(Wu.RETURNED_USER),yield new bh(ap.PREPARE_IFRAME_APP).execute(),this.activateIframeApp()}))}activateIframeApp(){return vu(this,void 0,void 0,(function*(){const t=jh(qu);yield t.onInitPromise();try{const e=t.getPlayerAppData();if(e){let t=Object.keys(e);for(let i of t){const t=e[i];localStorage.setItem(i,t)}}}catch(t){console.error("GameFacade | activateIframeApp __ Error during using user data for local storage __ error: ",t)}const e=jh(xp),i=jh($p),n=jh(ep),s=jh(yd);let r=0;const o=i=>vu(this,void 0,void 0,(function*(){r++;const o=kd().getState();if($u.logEvent(Xu.NEXT_LEVEL,o.app.sessionDuration),r>=2){let i=!0,n=!1;if(this.wasAskedToReview||o.app.sessionDuration>=this.askToReviewMinTimeout&&t.checkIfAskToReviewAvailable()&&(n=!0),n){i=!1,this.wasAskedToReview=!0;const e={id:"askToReview"};s.addDisableLock(e),d.addPauseLock(e),yield t.askToReview(),s.removeDisableLock(e),d.removePauseLock(e)}else{let e=!1;if(this.wasAskedToInstall||o.app.sessionDuration>=this.askToInstallMinTimeout&&t.checkIfAskToInstallAvailable()&&(e=!0),e){i=!1,this.wasAskedToInstall=!0;const e={id:"askToInstall"};s.addDisableLock(e),d.addPauseLock(e),yield t.askToInstall(),s.removeDisableLock(e),d.removePauseLock(e)}}i&&e.checkIfFullscreenAdvAvailable()&&(yield e.showFullscreenAdv())}n.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_WAIT_APPROVE_RESULT,{approveId:i})})),a=t=>vu(this,void 0,void 0,(function*(){let i=!1;e.checkIfRewardedAdvAvailable()&&(i=yield e.showRewardedAdv()),n.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_WAIT_APPROVE_RESULT,{approveId:t,isRewarded:i})}));n.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_WAIT_APPROVE,(t=>vu(this,void 0,void 0,(function*(){t.data.approveId===Xp?o(t.data.approveId):t.data.approveId===Kp&&a(t.data.approveId)})))),n.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_IAP_CHECK_IF_AVAILABLE,(()=>vu(this,void 0,void 0,(function*(){const t=yield i.checkIfIapAvailable();n.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_IAP_CHECK_IF_AVAILABLE_RESULT,{isIapAvailable:t})})))),n.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_IAP_GET_CATALOG,(()=>vu(this,void 0,void 0,(function*(){const t=yield i.getCatalog();n.sendMessageToIframe(ip.PARENT_IFRAME_TO_CHILD_IAP_GET_CATALOG_RESULT,{catalog:t})})))),n.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_SET_TOTAL_SCORE,(e=>vu(this,void 0,void 0,(function*(){console.log("GameFacade | CHILD_IFRAME_TO_PARENT_SET_TOTAL_SCORE __ data: ",e);const i=kd().getState();if(i.iframeApp.totalScore&&i.iframeApp.totalScore>=e.data.score)return void console.log("GameFacade | CHILD_IFRAME_TO_PARENT_SET_TOTAL_SCORE __ Previous score is greater or equal than the new one __ iframeAppModuleState.iframeApp.totalScore: ",i.iframeApp.totalScore);kd().change()("iframeApp.totalScore",e.data.score);(yield t.checkIfLeaderboardAvailable())&&(yield t.setLeaderboardScore(e.data.score)),$u.logEvent(Xu.TOTAL_SCORE,e.data.score)})))),n.addMessageCallback(ip.CHILD_IFRAME_TO_PARENT_SET_PLAYER_APP_DATA,(e=>vu(this,void 0,void 0,(function*(){t.setPlayerAppData(e.data)}))));const l=kd().getState(),h=kd().getState(),d=jh(sp),c=zl.createElementFromHTMLString("\n            <style>\n                #childIframeWrap { width: 100%; height: 100%; padding: 0; overflow: hidden; }\n                #childIframe { \n                    width: 100%; \n                    height: 100%; \n                    border: 0; \n                }\n            </style>\n        ");document.body.appendChild(c),this.iframeParentElement=zl.createElementFromHTMLString("\n            <div id='childIframeWrap'>\n            </div>\n        "),document.body.appendChild(this.iframeParentElement);let u={language:l.device.mainLocale,deviceType:l.device.deviceType,totalScore:h.iframeApp.totalScore};const p=`<iframe id="childIframe" src="${`pop-adventure/iframe.html?parentAppGlobalVars=${encodeURIComponent(JSON.stringify(u))}`}" width="100%" height="100%" frameBorder="0" style="position: absolute; top: 0; left: 0;"></iframe>`;this.iframeElement=d.createIframeApp(p,this.iframeParentElement),d.hideIframeApp();const f=jh(Sd),g=()=>{d.addPauseLock(e),d.addMuteLock(e)},m=()=>{d.removePauseLock(e),d.removeMuteLock(e)};this.eventListenerHelper.addEventListener(f,Tp.FULLSCREEN_ADV_SHOW,g),this.eventListenerHelper.addEventListener(f,Tp.FULLSCREEN_ADV_SUCCESS,m),this.eventListenerHelper.addEventListener(f,Tp.FULLSCREEN_ADV_ERROR,m),this.eventListenerHelper.addEventListener(f,Tp.REWARDED_ADV_SHOW,g),this.eventListenerHelper.addEventListener(f,Tp.REWARDED_ADV_SUCCESS,m),this.eventListenerHelper.addEventListener(f,Tp.REWARDED_ADV_ERROR,m),this.eventListenerHelper.addEventListener(f,gd.ENABLED_CHANGE,(()=>{s.enabled?d.removeMuteLock(s):d.addMuteLock(s)}))}))}addListeners(){super.addListeners();const t=jh(Sd);this.eventListenerHelper.addEventListener(t,Bd()("advAdapter.banner.rect"),this.onWindowResize),this.eventListenerHelper.addEventListener(t,kp.COMPLETE,(t=>{switch("yandexGames"){case ju.YANDEX_WEB_EN:case ju.YANDEX_WEB_RU:t.completeAnalyticsEvent}})),this.eventListenerHelper.addEventListener(t,wp.LOADING_COMPLETE,this.onPreloaderLoadingComplete)}onPreloaderLoadingComplete(){jh(sp).showIframeApp(),this.rendererManager.hideView(),this.onWindowResize()}onWindowResize(){super.onWindowResize()}}$u.init(Qu.gameAnalytics.config),$u.logEvent(Wu.GAME_OPEN),wl.DEFAULT_CONFIG.lineJoin="round";const lf=[Promise.resolve()];if("yandexGames"===ju.YANDEX_GAMES){const t=()=>new Promise((t=>{var e=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src="https://yandex.ru/games/sdk/v2",i.async=!0,e.parentNode.insertBefore(i,e),i.onload=()=>{t()}})),e=t();lf.push(e)}Promise.all(lf).then((()=>{mu.init({debug:!1,FacadeClass:af})}))})()})();